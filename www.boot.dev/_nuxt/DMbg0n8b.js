import{ax as ae,bJ as N,bZ as se,f as oe,cz as ie,I as B,E as le,g as ue,r as P,d8 as re,P as ce,cU as V,d9 as fe,cR as f,da as M,cO as _,db as Se,dc as Ce,s as w,v,x as p}from"./Djz0RQIo.js";function he(){const{loadUserLessonData:S}=ae(),{loadUserChallengeData:C}=N();async function h(i,u){i&&(u==="lesson"?await S(i):u==="challenge"&&await C(i))}return{loadUserSourceData:h}}let x=!1;const ge=se("cheat",()=>{const{loadUserSourceData:S}=he(),{loadChallengeByID:C}=N(),{isLessonComplete:h,lessonViewedSolution:i,lessonSuccessCount:u,getLesson:r,getUserLessonData:Q}=oe(),{getChallenge:L,isChallengeComplete:R,challengeViewedSolution:y,challengeSuccessCount:W,getUserChallengeData:$}=ie(),{loadNumSeerStones:z}=B(),{numSeerStones:A}=le(B()),{createToast:F,errToast:E}=ue();let l;const c=P(!1),o=P(!1);async function G(){return c.value=!0,new Promise(e=>{l=e})}function H(e){l?.(e),l=void 0,c.value=!1}function I(){l?.(void 0),l=void 0,c.value=!1}async function D(e,t,n,a){if(!x){x=!0;try{await X(e,t,a)&&await n()}catch(s){E(s)}finally{x=!1}}}function J(e,t){if(t==="lesson"){const a=Q(e);if(!a)return;a.SolutionViewedAt=new Date().toISOString();return}const n=$(e);n&&(n.SolutionViewedAt=new Date().toISOString())}async function d(e,t,n,a){await Z(e,t),n||(J(e,t),S(e,t)),a&&(A.value--,z())}async function X(e,t,n){const a=ne(e,t),s=te(e,t);if(n)return await d(e,t,s,!1),!0;if(!a)return await d(e,t,s,!1),!0;const g=await G();if(g===void 0)return!1;const b=A.value>0;!b&&g&&await re();const k=b||g;return F(k?{type:"success",text:"Seer Stone used!"}:{type:"error",text:`XP for this ${t} reduced by 100%`}),await d(e,t,s,k),!0}async function Z(e,t){if(e)switch(t){case"lesson":await j(e);break;case"challenge":await q(e);break;default:return t}}async function j(e){const t=r(e);if(t)try{if(_(t.Lesson)){if(ee(t.Lesson))return;o.value=!0;const n=await Se(e);Y(e,n)}if(V(t.Lesson)){if(O(t.Lesson))return;o.value=!0;const a=(await Ce(e)).SolutionFiles;K(e,a)}if(f(t.Lesson)){if(m(t.Lesson))return;o.value=!0;const n=await M("lesson",e);T("lesson",e,n)}}finally{o.value=!1}}async function q(e){try{let t=L(e);if(!t&&(t=await C(e),!t))return;if(V(t)){if(O(t))return;o.value=!0;const a=(await fe(e)).SolutionFiles;U(e,a)}if(f(t)){if(m(t))return;o.value=!0;const n=await M("challenge",t.UUID);T("challenge",t.UUID,n)}}finally{o.value=!1}}function O(e){return w(e)?e.LessonDataCodeSQL.SolutionFiles!==void 0:v(e)?e.LessonDataCodeOutput.SolutionFiles!==void 0:p(e)?e.LessonDataCodeTests.SolutionFiles!==void 0:e}function K(e,t){const n=r(e);n&&(v(n.Lesson)&&(n.Lesson.LessonDataCodeOutput.SolutionFiles=t),p(n.Lesson)&&(n.Lesson.LessonDataCodeTests.SolutionFiles=t),w(n.Lesson)&&(n.Lesson.LessonDataCodeSQL.SolutionFiles=t))}function Y(e,t){const n=r(e);!n||!_(n.Lesson)||(n.Lesson.LessonDataTextInput.TextInputData.ContainsAll=t.ContainsAll,n.Lesson.LessonDataTextInput.TextInputData.ContainsNone=t.ContainsNone,n.Lesson.LessonDataTextInput.TextInputData.MatchesOne=t.MatchesOne)}function U(e,t){const n=L(e);n&&(v(n)&&(n.LessonDataCodeOutput.SolutionFiles=t),p(n)&&(n.LessonDataCodeTests.SolutionFiles=t),w(n)&&(n.LessonDataCodeSQL.SolutionFiles=t))}function ee(e){return e.LessonDataTextInput.TextInputData.ContainsAll!==void 0||e.LessonDataTextInput.TextInputData.ContainsNone!==void 0||e.LessonDataTextInput.TextInputData.MatchesOne!==void 0}function T(e,t,n){if(e==="challenge"){const s=L(t);if(!s||!f(s))return;s.LessonDataInterviewChat.AcceptanceCriteria=n.AcceptanceCriteria;return}const a=r(t);!a||!f(a.Lesson)||(a.Lesson.LessonDataInterviewChat.AcceptanceCriteria=n.AcceptanceCriteria)}function m(e){return!!e.LessonDataInterviewChat.AcceptanceCriteria}function te(e,t){return t==="challenge"?y(e):i(e)}function ne(e,t){return t==="challenge"?!y(e)&&!R(e)&&W(e)===0:!i(e)&&!h(e)&&u(e)===0}return{cheatModalOpen:c,isFetchingSolution:o,confirmCheat:H,cancelCheat:I,attemptCheatWithCallback:D,viewSolutionFiles:async(e,t)=>{t==="lesson"&&await D(e,t,()=>{ce(`/solution/${e}`,{open:{target:"_blank"}})})}}});export{ge as a,he as u};
