import{ao as I,d as T,E as V,aq as q,N,g as L,r as f,G as R,ar as C,m as p,o as v,a as d,a7 as B,n as i,b as o,as as F,e as y,C as _,ag as M,at as O,au as j,av as z,P as E}from"./Djz0RQIo.js";import{C as X}from"./D7aoQ3Ru.js";import{u as x}from"./Hp647MZf.js";const $=I("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),A={key:0,class:"flex flex-col items-center"},G={class:"text-primary-normal flex text-xl italic text-gray-250"},H={class:"font-bold not-italic text-white"},W={key:1,class:"flex w-full justify-center"},J={class:"mr-1 mt-4"},K={class:"mt-4 justify-self-end text-center"},Q={type:"submit"},te=T({__name:"PromoCodeNotice",setup(Y){const{respSubPlans:s}=V(x()),{loadSubscriptionPlans:h}=x(),{ensureUserUUIDCookie:c,userUUID:a}=q(),u=N(),{createToast:P,errToast:r}=L(),l=f(!1),m=async()=>{c();let t;if(a.value)try{t=(await j(a.value))?.PromoCode}catch{r("Failed to get saved promo code")}await h(u.query.country_code,t)},k=async()=>{l.value=!0;try{c();try{a.value&&await z(a.value)}catch{r("Failed to remove promo code")}await m()}catch{r("Failed to load subscription plans")}l.value=!1};R(async()=>{let t;for(const e in u?.query)if(e.toLowerCase()==="promo"){t=u?.query[e];break}t&&(c(),await C(a.value,t)),await m()});const n=f(""),w=async()=>{if(n.value){l.value=!0;try{c(),a.value&&await C(a.value,n.value),await m()}catch{r("Couldn't get promo codes")}l.value=!1,s.value?.PromoCodeDetails||(n.value?.length===24?P({type:"error",text:"That's a gift code! Activate it on the redeem page by clicking here",onClick:()=>{E({path:"/redeem"})},timeoutMs:1e4}):r("Invalid promo code"))}};return(t,e)=>{const g=B,b=$,D=M,S=X;return v(),p("div",null,[d(g,{"is-loading":l.value,"is-full-page":""},null,8,["is-loading"]),i(s)?.PromoCodeDetails?(v(),p("div",A,[o("span",G,[d(b,{"stroke-width":"1.5",class:"mb-1 mr-1 inline-block h-6 w-6 cursor-pointer hover:text-red-500",onClick:k}),F(t.$slots,"default",{promoCode:i(s)?.PromoCodeDetails.PromoCode,discountDescription:i(s).PromoCodeDetails.DescriptionOfDiscount},()=>[o("div",null,[e[1]||(e[1]=y(" Code ",-1)),o("span",H,_(i(s)?.PromoCodeDetails.PromoCode),1),y(" will apply for "+_(i(s).PromoCodeDetails.DescriptionOfDiscount),1)])])])])):(v(),p("div",W,[o("form",{class:"flex flex-wrap",onSubmit:O(w,["prevent"])},[o("div",J,[o("span",null,[d(D,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=U=>n.value=U),class:"w-full",type:"text","aria-label":"Promocode"},null,8,["modelValue"]),e[2]||(e[2]=o("label",{class:"text-xs text-gray-300"},"Have a promo code?",-1))])]),o("div",K,[o("button",Q,[d(S,{class:"h-8 w-8 cursor-pointer hover:text-yellow-500","stroke-width":"1.5"}),e[3]||(e[3]=o("span",{class:"sr-only"},"Save Promocode",-1))])])],32)]))])}}});export{te as _};
