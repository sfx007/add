import{_ as La,O as In}from"./D6Ho5i_A.js";import{ao as lt,d as he,m as I,F as me,B as Ue,o as g,c as F,b as h,w as O,a as U,at as We,A as L,C as M,aT as Na,am as Oe,P as Ct,W as He,i as ue,r as W,h as hs,G as Ht,c5 as xl,c6 as Sl,c7 as tr,aG as po,z as Ot,n as v,c8 as fo,c9 as gs,ca as Tl,cb as Cl,cc as Al,ap as za,_ as mo,bc as Fa,aU as it,ay as Dl,g as Gt,j as K,a_ as $l,cd as Rn,V as ct,e as te,E as ke,I as tt,ce as nr,b8 as or,aJ as ho,l as un,cf as El,cg as Ul,ch as Ol,t as Ba,ci as Rl,ag as Wt,cj as Pl,ck as Ml,cl as Ll,cm as Nl,c2 as zl,cn as Fl,co as Bl,cp as Zl,cq as Za,cr as sr,cs as jl,ct as ql,cu as Jl,cv as Vl,cw as Hl,bh as ys,cx as Gl,bz as Wl,cy as Kl,f as Yl,cz as Ql,N as Xl,bw as Ke,bf as ja,s as Et,x as Ut,v as ft,cA as ec,cB as tc,cC as nc,cD as oc,cE as sc,cF as rc,bV as rr,a8 as ac,cG as Yo,J as sn,ax as ic,cH as uc,Q as vs,as as qa,cI as lc,p as Ja,a7 as _s,cJ as cc,cK as ar,cL as dc,cM as Xt,cN as vn,cO as _n,cP as Gn,cQ as wn,cR as Fn,cS as pc,K as fc,cT as mc,cU as Va}from"./Djz0RQIo.js";import{C as Ha,a as hc}from"./0YUWycGk.js";import{u as At}from"./BqYrpIRu.js";import{_ as ws}from"./Bkt-Up1H.js";import{_ as Pn,a as gc,b as yc,c as vc,d as _c}from"./BQ1Pr_bT.js";import{B as wc}from"./DZls_1QG.js";import{B as bc}from"./TAdLFOgE.js";import{R as kc}from"./Ci1uNmdM.js";import{u as go}from"./Cnao2d2z.js";import{b as Wn}from"./BRKYYb7N.js";import{b as Ic}from"./BmzF0E8B.js";import{c as xc}from"./C-qm-qlq.js";import{_ as Sc}from"./B97M0pee.js";import{u as Tc,a as Sn}from"./DMbg0n8b.js";import{u as Cc}from"./C3lkWRQw.js";import{n as Ga,g as Ac,m as Wa,H as Dc,i as ir}from"./UNvvHO8y.js";import{A as $c}from"./BZ8i8vD6.js";import{B as Ec}from"./DLM9x6eN.js";import{_ as bs}from"./FbJafgTE.js";import{u as Ka}from"./LzMEUYpQ.js";import{g as Ya,r as ur,a as Uc}from"./DvE5EybM.js";/* empty css        */import{S as Oc}from"./DUy7MZc7.js";import{E as Rc}from"./mEd-U4yU.js";import{_ as Pc}from"./u1FX4Fat.js";import"./CeI-xotQ.js";import"./BUi9Q6PF.js";import{b as No}from"./cmT8Ehoo.js";const Mc=lt("circle-stop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);const Lc=lt("dumbbell",[["path",{d:"M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z",key:"9m4mmf"}],["path",{d:"m2.5 21.5 1.4-1.4",key:"17g3f0"}],["path",{d:"m20.1 3.9 1.4-1.4",key:"1qn309"}],["path",{d:"M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z",key:"1t2c92"}],["path",{d:"m9.6 14.4 4.8-4.8",key:"6umqxw"}]]);const Nc=lt("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);const zc=lt("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const Fc=lt("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]);const Bc=lt("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);const Zc=lt("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]);const jc=lt("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const qc=lt("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Jc=lt("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Qa=lt("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),Vc={class:"flex"},Hc={class:"w-32"},Gc={key:0},Wc={key:1,class:"pt-2 font-mono text-xs italic text-gray-300"},Kc={class:"border-y border-gray-600/30"},SS=he({__name:"ProgressOrbBar",props:{steps:{},orbSize:{default:12},spacerWidth:{default:36},spacerHeight:{default:2}},setup(e){const t=o=>{Ct(o)},n=o=>{switch(!0){case o.isComplete:return In.Yellow;case o.isReset:return In.Red;default:return In.Gray}};return(o,s)=>{const a=La,r=He;return g(),I("div",Vc,[(g(!0),I(me,null,Ue(e.steps,(i,l)=>(g(),I("div",{key:i.link?.path??i.text??l,class:"flex items-center"},[i.text||i.subtext?(g(),F(r,{key:0,position:"bottom",color:"gray"},{tip:O(()=>[h("div",Hc,[i.text?(g(),I("p",Gc,M(i.text),1)):L("",!0),i.subtext?(g(),I("p",Wc,M(i.subtext),1)):L("",!0)])]),default:O(()=>[U(a,{color:n(i),size:e.orbSize,glow:i.selected,hover:!!i.link,class:"flex items-center",onMouseenter:u=>i.hoverCallback?.(),onClick:We(u=>i.link&&t(i.link),["prevent"])},null,8,["color","size","glow","hover","onMouseenter","onClick"])]),_:2},1024)):(g(),F(a,{key:1,color:n(i),size:e.orbSize,glow:i.selected,hover:!!i.link,onClick:We(u=>i.link&&t(i.link),["prevent"])},null,8,["color","size","glow","hover","onClick"])),h("div",Kc,[l!==e.steps.length-1?(g(),I("div",{key:0,class:Oe(["my-px",{"bg-yellow-400/90":i.isComplete,"bg-gray-600/90":!i.isComplete}]),style:Na({width:`${e.spacerWidth}px`,height:`${e.spacerHeight}px`})},null,6)):L("",!0)])]))),128))])}}}),Yc={key:0,class:"bg-gray-900 sticky top-0 z-sticky md:flex w-full flex-col items-end hidden"},Qc=["volume","playbackRate"],Xc=he({__name:"LessonAudioPlayer",props:{lessonUUID:{},addSideBorders:{type:Boolean,default:!1}},setup(e){const t=ue("audioElement"),n=W(1),o=W(1),s=W(!1),a=e,r=`https://storage.googleapis.com/qvault-webapp-dynamic-assets/course_assets/lesson_audio/${a.lessonUUID}.mp3`,{eventLessonAudioPlay:i}=hs(),{inGuestMode:l}=At(),u=W(!1),c=W(!1),d=async()=>{i(a.lessonUUID),u.value=!u.value,Tl(u.value)},p=W(),m=()=>{t.value&&(p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{Cl(t.value.volume)},100))},y=()=>s.value=!0,_=()=>s.value=!1;Ht(()=>{const k=xl();k&&(n.value=k);const S=Sl();S&&(o.value=S),u.value=tr(),t.value&&(t.value.addEventListener("play",y),t.value.addEventListener("pause",_))}),po(()=>{t.value?.removeEventListener("play",y),t.value?.removeEventListener("pause",_),p.value&&clearTimeout(p.value)}),Ot(()=>a.lessonUUID,()=>{u.value=tr(),c.value=!1,s.value=!1});const b=k=>{if(!t.value)return;const S=k.target;Al(S.playbackRate)},x=()=>{c.value=!0};return(k,S)=>{const A=Qa,w=Ha,D=hc,E=He;return v(l)?L("",!0):(g(),I("div",Yc,[fo(h("audio",{ref_key:"audioElement",ref:t,class:Oe(["m-0 ml-2 h-14 w-full border-y border-gray-600 px-4 py-2 transition-all duration-200 md:border-t-transparent",{"border-x ":e.addSideBorders}]),onerror:x,volume:n.value,playbackRate:o.value,src:r,controls:"",onVolumechange:m,onRatechange:b},null,42,Qc),[[gs,u.value&&!c.value]]),U(E,{position:"bottom-left",class:"h-0"},{tip:O(()=>[...S[0]||(S[0]=[h("p",null,"Lesson Audio",-1)])]),default:O(()=>[h("button",{class:Oe(["relative -top-px mr-4 flex items-center overflow-visible rounded-b border border-gray-600 bg-gray-900 p-2 hover:text-gray-500 md:border-t-0",{"border-t-0":u.value&&!c.value}]),"aria-label":"Toggle Lesson Audio Player",onClick:d},[U(A,{"stroke-width":"1.5",class:"h-6 w-6"}),u.value?(g(),F(w,{key:0,"stroke-width":"1.5",class:"h-4 w-4 pl-1"})):(g(),F(D,{key:1,"stroke-width":"1.5",class:"h-4 w-4 pl-1"}))],2)]),_:1})]))}}}),ed=za(Xc,[["__scopeId","data-v-336f5af5"]]),td={class:"flex justify-end"},nd=he({__name:"DebugChallengeButton",props:{challengeUUID:{}},setup(e){return(t,n)=>{const o=wc,s=mo,a=He;return g(),I("div",td,[U(a,{position:"left"},{tip:O(()=>[...n[0]||(n[0]=[h("p",null,"Open Debug View",-1)])]),default:O(()=>[U(s,Fa({to:"/challenges-debug/"+e.challengeUUID,"aria-label":"Open Debug View",class:"p-2"},t.$attrs),{default:O(()=>[U(o,{"stroke-width":"1.5",class:"inline-block h-6 w-6"})]),_:1},16,["to"])]),_:1})])}}}),od=he({__name:"CreateSimilarChallengeButton",props:{lessonUUID:{},courseUUID:{},topics:{}},setup(e){const t=e,n=it();function o(){const s=n.courses.get(t.courseUUID);if(!s){window.open("/training-grounds#generate","_blank");return}let a=s.Language;a&&(a=a.charAt(0).toUpperCase()+a.slice(1));const r=t.topics.join(", "),i=`Please create me a new challenge in ${a} about ${r}.`,l=`/training-grounds?q=${encodeURIComponent(i)}#generate`;window.open(l,"_blank")}return(s,a)=>{const r=Lc,i=He;return g(),F(i,{position:"left"},{tip:O(()=>[...a[0]||(a[0]=[h("p",null,"Create similar challenge",-1)])]),default:O(()=>[h("button",{type:"button","aria-label":"Create similar challenge",class:"p-2",onClick:o},[U(r,{"stroke-width":"1.5",class:"inline-block h-6 w-6"})])]),_:1})}}}),sd=["disabled"],rd=he({__name:"BookmarkContentButton",props:{sourceType:{},sourceUUID:{}},setup(e){const t=e,n=W(!1),{bookmarkContent:o,isBookmarked:s,removeBookmark:a}=Dl(),{errToast:r}=Gt(),i=async()=>{if(!n.value)try{n.value=!0,l.value?await a(t.sourceUUID):l.value||await o(t.sourceUUID)}catch(u){r(u)}finally{n.value=!1}},l=K(()=>s(t.sourceUUID));return(u,c)=>{const d=bc,p=He;return g(),F(p,{position:"left"},{tip:O(()=>[h("p",null,M(l.value?"Remove bookmark":"Add bookmark"),1)]),default:O(()=>[h("button",Fa({type:"button",disabled:n.value,"aria-label":"Toggle bookmark"},u.$attrs,{class:"p-2",onClick:We(i,["prevent"])}),[U(d,{fill:l.value?"currentColor":"none","stroke-width":"1.5",class:"inline-block h-6 w-6"},null,8,["fill"])],16,sd)]),_:1})}}}),ad={class:"flex justify-end"},id=["disabled"],ud={key:0},ld={key:1},cd={key:2},dd=he({__name:"ResetLessonButton",props:{isFree:{type:Boolean,default:!1},resetCallback:{type:Function,default:void 0},disabled:{type:Boolean,default:!1}},setup(e){const t=e,{inGuestMode:n}=At(),o=ue("resetCodeModal"),s=async()=>{try{await t.resetCallback?.()}catch(a){console.log(a)}};return(a,r)=>{const i=$l,l=kc,u=He;return g(),I("div",ad,[U(i,{ref_key:"resetCodeModal",ref:o,"button-color":"red",heading:"Reset all progress for this lesson?",text:"You cannot earn any previously claimed rewards and this will overwrite any code you may have written.","enable-teleport":"",onConfirm:s},null,512),U(u,{position:"left"},{tip:O(()=>[v(n)&&e.isFree?(g(),I("p",ud,"Login to Reset")):v(n)?(g(),I("p",ld,"Become a member to Reset")):(g(),I("p",cd,"Reset Lesson"))]),default:O(()=>[h("button",{disabled:v(n)||e.disabled,color:"gray","aria-label":"Reset Lesson",class:"p-2",onClick:r[0]||(r[0]=(...c)=>o.value?.show&&o.value?.show(...c))},[U(l,{"stroke-width":"1.5",class:"inline-block h-6 w-6"})],8,id)]),_:1})])}}}),pd={class:"max-w-lg p-6"},fd={class:"mb-2"},md={class:"grid grid-cols-2 gap-x-4"},hd={class:"flex w-full flex-col items-center"},gd={class:"flex w-full flex-col items-center"},yd=he({__name:"ConfirmIssueModal",props:{onClickReport:{},onClickHelp:{},isSpellbook:{type:Boolean,default:!1}},setup(e,{expose:t}){const n=ue("confirmIssueModal");return t({show:()=>{n.value?.show()},hide:()=>{n.value?.hide()}}),(a,r)=>{const i=ct,l=Rn;return g(),F(l,{ref_key:"confirmIssueModal",ref:n,"enable-teleport":""},{default:O(()=>[h("div",pd,[r[4]||(r[4]=h("h2",{class:"mb-2 pt-4 text-2xl"},"Report Issue?",-1)),h("p",fd,M(e.isSpellbook?"Does this spellbook need some attention?":"Have you found a problem you'd like to let us know about?"),1),h("div",md,[h("div",hd,[U(i,{class:"mb-2 w-full focus:ring-1 focus:ring-white",autofocus:"",onClick:e.onClickReport},{default:O(()=>[...r[0]||(r[0]=[te(" Yes ",-1)])]),_:1},8,["onClick"]),r[1]||(r[1]=h("p",null,"I'd like to submit a report",-1))]),h("div",gd,[U(i,{class:"mb-2 w-full focus:ring-1 focus:ring-white",color:"gray",onClick:e.onClickHelp},{default:O(()=>[...r[2]||(r[2]=[te(" No ",-1)])]),_:1},8,["onClick"]),r[3]||(r[3]=h("p",null,"I need help or have a question",-1))])])])]),_:1},512)}}}),vd={class:"max-w-lg p-6"},_d=he({__name:"LessonHelpModal",setup(e,{expose:t}){const n=ue("lessonHelpModal");return t({show:()=>n.value?.show(),hide:()=>n.value?.hide(),toggle:()=>n.value?.toggle()}),(r,i)=>{const l=ct,u=Rn;return g(),F(u,{ref_key:"lessonHelpModal",ref:n,"enable-teleport":""},{default:O(()=>[h("div",vd,[i[1]||(i[1]=h("h3",{class:"mb-2 pt-4 text-2xl"},"Need help?",-1)),i[2]||(i[2]=h("p",{class:"mb-2"}," Want to get help from someone human? Join our Discord community! ",-1)),i[3]||(i[3]=h("p",{class:"mb-2"}," We have dedicated help forums for all our courses, lively discussions and hundreds of students who are eager to help. ",-1)),U(l,{class:"my-4 mb-4 w-52 focus:ring-1 focus:ring-white",link:"https://www.boot.dev/community",autofocus:""},{default:O(()=>[...i[0]||(i[0]=[te(" Join our community ",-1)])]),_:1})])]),_:1},512)}}}),lr=""+new URL("BootsThumbsUp_128x.D5DnFmxU.png",import.meta.url).href,wd={class:"grid grid-cols-[50px_minmax(0,1fr)] px-4 text-gray-400"},bd=["href"],kd=["width","height","src"],Id=["width","height","src"],xd={class:"px-3 text-left"},Sd={key:0,class:"-mt-3 flex h-7 justify-end"},Td={key:0},Cd={key:1},Ad={key:2},Dd=["src"],$d=["disabled"],Ed=["src"],Ud=["disabled"],Od=["src"],Rd={class:"h-2 w-2 motion-safe:animate-throb rounded-full bg-white p-2"},ks=he({__name:"BootsChatText",props:{img:{},chatUUID:{},messageUUID:{},sourceUUID:{},imgLink:{},imgClick:{},content:{default:""},isStreaming:{type:Boolean,default:!1},ratingsEnabled:{type:Boolean,default:!1},reaction:{},reactionsDisabled:{type:Boolean,default:!1},audioURL:{},audioEnabled:{type:Boolean,default:!1},audioType:{}},emits:["thumbsUp","thumbsDown"],setup(e){const{user:t}=ke(tt()),{errToast:n}=Gt(),o=e,s=ue("audioElement"),a=W("stopped"),{isMobile:r}=go(),i=()=>{a.value="stopped"},l=()=>{a.value="stopped"},u=async()=>{if(!s.value||a.value==="generating")return;if(a.value==="playing"){s.value.pause(),s.value.currentTime=0,a.value="stopped";return}const d=s.value.src,m=new URLSearchParams(d.split("?")[1]).get("expires");if(d&&(!m||!c(m)))s.value.play(),a.value="playing";else try{a.value="generating";let y;if(o.audioType==="chat"){if(!o.chatUUID||!o.messageUUID){console.error("Chat UUID or Message UUID missing for audio generation!");return}const _=await nr({audioType:"chat",bootsChat:{chatUUID:o.chatUUID,messageUUID:o.messageUUID}}),{signature:b,expires:x}=_;y=`${or}/v1/audio/boots_chats/${o.chatUUID}/${o.messageUUID}/stream?signature=${b}&expires=${x}`}if(o.audioType==="interview_message"){if(!o.sourceUUID||!o.messageUUID){console.error("Source UUID or Message UUID missing for audio generation!");return}const _=await nr({audioType:"interview_message",bootsInterviewMessage:{sourceUUID:o.sourceUUID,messageUUID:o.messageUUID}}),{signature:b,expires:x}=_;y=`${or}/v1/audio/boots_interviews/${o.sourceUUID}/users/${t.value.UUID}/${o.messageUUID}/stream?signature=${b}&expires=${x}`}if(!y){console.error("invalid audio type");return}s.value.src=y,s.value.play(),a.value="playing"}catch{n("Failed to play audio")}},c=d=>{const p=Math.floor(Date.now()/1e3);return parseInt(d,10)<p};return(d,p)=>{const m=ws,y=zc,_=Mc,b=Qa,x=He;return g(),I("div",wd,[h("div",null,[e.imgLink?(g(),I("a",{key:0,class:"textlink cursor-pointer",href:e.imgLink,target:"_blank"},[h("img",{width:v(r)?44:50,height:v(r)?44:50,class:"mb-4 rounded-full border-2 border-gray-500",loading:"lazy",src:e.img,alt:"Boots"},null,8,kd)],8,bd)):(g(),I("div",{key:1,class:"textlink cursor-pointer",onClick:p[0]||(p[0]=(...k)=>e.imgClick&&e.imgClick(...k))},[h("img",{width:v(r)?44:50,height:v(r)?44:50,class:"mb-4 rounded-full border-2 border-gray-500",loading:"lazy",src:e.img,alt:"Boots"},null,8,Id)]))]),h("div",xd,[U(m,{source:e.content},null,8,["source"]),!e.isStreaming&&e.content?(g(),I("div",Sd,[e.audioEnabled?(g(),F(x,{key:0,position:"top"},{tip:O(()=>[a.value==="stopped"&&!s.value?.src?(g(),I("span",Td,"Summoning Boots Voice...")):a.value==="playing"?(g(),I("span",Cd,"Stop Listening")):(g(),I("span",Ad,"Listen to Boots"))]),default:O(()=>[h("button",{class:Oe(["mr-3 mt-0.5 w-6 hover:text-blue-400",{"cursor-pointer":a.value!=="generating","cursor-not-allowed":a.value==="generating"}]),onClick:u},[a.value==="generating"?(g(),F(y,{key:0,class:"h-full w-full animate-spin transition-all duration-150","stroke-width":"1.5"})):a.value==="playing"?(g(),F(_,{key:1,class:"h-full w-full opacity-100 transition-all duration-150 hover:drop-shadow-[0_0_6px_#3b82f6]","stroke-width":"1.5"})):a.value==="stopped"?(g(),F(b,{key:2,class:"h-full w-full transition-all duration-150 hover:drop-shadow-[0_0_6px_#3b82f6] opacity-50","stroke-width":"1.5"})):L("",!0)],2)]),_:1})):L("",!0),h("audio",{ref_key:"audioElement",ref:s,preload:"auto",src:o.audioURL,onEnded:i,onError:l},null,40,Dd),e.ratingsEnabled?(g(),I("button",{key:1,disabled:e.reaction==="like"||e.reactionsDisabled,class:Oe(["mr-1 w-7 hover:text-green-400",{"cursor-pointer":!e.reactionsDisabled||e.reaction==="like","cursor-not-allowed":e.reactionsDisabled&&e.reaction!=="like"}]),onClick:p[1]||(p[1]=k=>d.$emit("thumbsUp"))},[h("img",{src:v(lr),alt:"Thumbs up",class:Oe(["h-full w-full transition-all duration-150 hover:drop-shadow-[0_0_6px_#22c55e]",e.reaction==="like"?"opacity-100":"opacity-50"])},null,10,Ed)],10,$d)):L("",!0),e.ratingsEnabled?(g(),I("button",{key:2,disabled:e.reaction==="dislike"||e.reactionsDisabled,class:Oe(["w-7 hover:text-red-400",{"cursor-pointer":!e.reactionsDisabled||e.reaction==="dislike","cursor-not-allowed":e.reactionsDisabled&&e.reaction!=="dislike"}]),onClick:p[2]||(p[2]=k=>d.$emit("thumbsDown"))},[h("img",{src:v(lr),alt:"Thumbs down",class:Oe(["h-full w-full rotate-180 transform transition-all duration-150 hover:drop-shadow-[0_0_6px_#ef4444]",e.reaction==="dislike"?"opacity-100":"opacity-50"])},null,10,Od)],10,Ud)):L("",!0)])):L("",!0),fo(h("div",Rd,null,512),[[gs,e.isStreaming||!e.content]])])])}}}),Pd={key:0,class:"max-w-lg p-6"},Md={key:0,class:"mb-4 ml-4 list-disc text-sm text-gray-300"},Ld={key:1,class:"mb-4 ml-4 list-disc text-sm text-gray-300"},Nd=["maxlength"],zd={key:1,class:"max-w-md"},Fd={class:"flex justify-center"},Bd=he({__name:"SubmitIssueModal",props:{lessonUUID:{},userCode:{default:""},isSpellbook:{type:Boolean,default:!1}},setup(e,{expose:t}){const{createToast:n,errToast:o}=Gt(),s=e,{setModalQuery:a}=ho(),r=()=>{a("info-boots"),k()},i=ue("submitIssueModal"),l=ue("userFeedbackInput"),u=W(),c=W(!1),d=W(),p=W(512),m=K(()=>u.value?.length||0),y=K(()=>m.value===p.value&&_.value?"text-red-600":"text-gray-400"),_=W(!1);function b(){_.value=m.value===p.value}const x=()=>{i.value?.show()},k=()=>{i.value?.hide(),S()},S=()=>{d.value=void 0,c.value=!1};t({show:x,hide:k}),un(()=>{l.value&&l.value?.focus()});const A=async()=>{try{if(u.value===void 0)throw new Error("Please enter some feedback before submitting.");const w=u.value;u.value=void 0,d.value=void 0,c.value=!0,n({type:"success",text:"Thanks for your feedback!"});let D;s.isSpellbook?D=await Ul(s.lessonUUID,w):D=await Ol(s.lessonUUID,s.userCode,w),d.value=D.response}catch(w){o(w)}};return(w,D)=>{const E=ct,B=ks,R=Rn;return g(),F(R,{ref_key:"submitIssueModal",ref:i,"enable-teleport":"","on-close":S},{default:O(()=>[c.value?(g(),I("div",zd,[D[9]||(D[9]=h("h3",{class:"mb-2 ml-4 pt-4 text-2xl"},"Thanks for your feedback!",-1)),U(B,{class:"my-4 min-w-[400px]",img:v(Wn),"img-click":r,content:d.value,"is-streaming":!d.value},null,8,["img","content","is-streaming"]),h("div",Fd,[U(E,{color:"gray",class:"mb-4 ml-4 focus:ring-1 focus:ring-white",onClick:k},{default:O(()=>[...D[8]||(D[8]=[te(" Close ",-1)])]),_:1})])])):(g(),I("div",Pd,[D[5]||(D[5]=h("h3",{class:"mb-2 pt-4 text-2xl"},"How can we improve?",-1)),e.isSpellbook?(g(),I("ul",Md,[...D[2]||(D[2]=[h("li",null,"I think this spellbook is weak sauce because...",-1),h("li",null,"This spellbook needs something else like...",-1),h("li",null,"By Boots' blue hat! There's a typo...",-1)])])):(g(),I("ul",Ld,[...D[3]||(D[3]=[h("li",null,"I think this lesson is broken because...",-1),h("li",null,"This lesson could be better if...",-1),h("li",null,"I found a grammar mistake...",-1)])])),D[6]||(D[6]=h("p",{class:"mb-4"}," If you have a question or need help, do NOT ask here, we can't respond. Ask in the Discord instead so we can help you. ",-1)),D[7]||(D[7]=h("p",{class:"mb-2 text-sm italic text-gray-300"}," Your current code will be automatically included in the report. ",-1)),fo(h("textarea",{ref_key:"userFeedbackInput",ref:l,"onUpdate:modelValue":D[0]||(D[0]=z=>u.value=z),placeholder:"I think something is wrong because...",class:"autoexpand mb-2 block w-full appearance-none rounded-sm bg-gray-700 px-4 py-2 leading-relaxed tracking-wide focus:outline-hidden",rows:"4","aria-label":"Issue description",maxlength:p.value,onKeydown:[b,D[1]||(D[1]=We(()=>{},["stop"]))]},null,40,Nd),[[El,u.value]]),h("p",{class:Oe(["mb-2 text-sm text-right",y.value])},M(m.value)+"/"+M(p.value),3),U(E,{disabled:!u.value,class:"mb-4 ml-4 focus:ring-1 focus:ring-white",autofocus:"",onClick:A},{default:O(()=>[...D[4]||(D[4]=[te(" Submit ",-1)])]),_:1},8,["disabled"])]))]),_:1},512)}}}),Zd={class:"flex justify-end"},jd={class:"flex flex-col items-end justify-end"},Xa=he({__name:"SubmitIssue",props:{lessonUUID:{},userCode:{default:void 0},isSpellbook:{type:Boolean,default:!1}},setup(e){const t=ue("submitIssueModal"),n=ue("issueConfirmationModal"),o=ue("lessonHelpModal"),s=()=>{n.value?.show()},a=()=>{t.value?.show(),n.value?.hide()},r=()=>{o.value?.show(),n.value?.hide()};return(i,l)=>{const u=yd,c=_d,d=Bd,p=Jc,m=He;return g(),I("div",Zd,[U(u,{ref_key:"issueConfirmationModal",ref:n,"on-click-report":a,"on-click-help":r,"is-spellbook":e.isSpellbook},null,8,["is-spellbook"]),U(c,{ref_key:"lessonHelpModal",ref:o},null,512),U(d,{ref_key:"submitIssueModal",ref:t,"lesson-u-u-i-d":e.lessonUUID,"user-code":e.userCode,"is-spellbook":e.isSpellbook},null,8,["lesson-u-u-i-d","user-code","is-spellbook"]),h("div",jd,[U(m,{position:"left"},{tip:O(()=>[h("p",null,M(e.isSpellbook?"Report Issue with Spellbook":"Report Issue with Lesson"),1)]),default:O(()=>[h("button",{color:"gray","aria-label":"Report Issue",class:"p-2",onClick:s},[U(p,{"stroke-width":"1.5",class:"inline-block h-6 w-6"})])]),_:1})])])}}}),qd={key:1,class:"text-sm pt-4 px-4 text-gray-400 italic"},Jd={key:2,class:"flex flex-row justify-end p-4"},Vd={key:0},Hd={key:1},Gd={key:2},Wd={key:3,class:"flex justify-end"},Kd={class:"flex items-center justify-end p-4 *:hover:text-gray-400 gap-1"},Yd=he({__name:"LessonMarkdownSide",props:{readme:{},sourceUUID:{},courseUUID:{},sourceType:{},isFree:{type:Boolean,default:!1},userCode:{default:void 0},progLang:{default:void 0},isLessonComplete:{type:Boolean,default:!1},isManualLessonType:{type:Boolean,default:!1},solutionAlreadyViewed:{type:Boolean,default:!1},submitCallback:{type:Function,default:void 0},resetCallback:{type:Function,default:void 0},viewSolutionFilesCallback:{},containsCompleteDir:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},addSideBorders:{type:Boolean,default:!1},seriesIndex:{default:0},seriesLength:{default:0},topics:{},generateChallenge:{type:Boolean,default:!1}},setup(e){const t=e,{submissionLoading:n}=ke(it()),{isLoggedIn:o,isAdmin:s}=ke(tt()),{isLessonComplete:a}=Ba(t),{inGuestMode:r}=At(),i=W(!1),{isMobile:l}=go(),u=async()=>{t.submitCallback&&await t.submitCallback()};return Ot(n,c=>{c&&(i.value=!0)}),Ot(a,c=>{i.value=c}),(c,d)=>{const p=ed,m=ws,y=ct,_=He,b=Pn,x=nd,k=od,S=rd,A=dd,w=Xa;return g(),I(me,null,[v(o)&&!v(l)&&e.sourceType==="lesson"?(g(),F(p,{key:0,"lesson-u-u-i-d":e.sourceUUID,"add-side-borders":e.addSideBorders},null,8,["lesson-u-u-i-d","add-side-borders"])):L("",!0),e.seriesLength?(g(),I("p",qd," You're on assignment part "+M(e.seriesIndex+1)+"/"+M(e.seriesLength)+" for this lesson. ",1)):L("",!0),U(m,{source:e.readme,"render-checkboxes":"","collapse-headings":"","allow-html":"",class:"mt-2 px-4"},null,8,["source"]),e.isManualLessonType?(g(),I("div",Jd,[U(_,{position:"top-manual"},{tip:O(()=>[v(r)&&e.isFree?(g(),I("p",Vd,"Login to Complete")):v(r)?(g(),I("p",Hd,"Become a member to Complete")):(g(),I("p",Gd,"Complete this step"))]),default:O(()=>[!v(a)&&!i.value?(g(),F(y,{key:0,disabled:v(r),onClick:u},{default:O(()=>[...d[0]||(d[0]=[te(" I'm done with this step ",-1)])]),_:1},8,["disabled"])):L("",!0)]),_:1}),e.containsCompleteDir?(g(),F(b,{key:0,class:"pl-4",text:"Solution Files","is-lesson-complete":v(a),"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(r)||v(n),"is-free":e.isFree,color:"gray","tool-tip-position":"top",onClick:e.viewSolutionFilesCallback},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","onClick"])):L("",!0)])):L("",!0),v(o)?(g(),I("div",Wd,[h("div",Kd,[v(s)&&e.sourceType=="challenge"?(g(),F(x,{key:0,"challenge-u-u-i-d":e.sourceUUID},null,8,["challenge-u-u-i-d"])):L("",!0),e.generateChallenge&&e.sourceType==="lesson"&&e.courseUUID&&Array.isArray(e.topics)&&e.topics.length>0?(g(),F(k,{key:1,"lesson-u-u-i-d":e.sourceUUID,topics:e.topics,"course-u-u-i-d":e.courseUUID},null,8,["lesson-u-u-i-d","topics","course-u-u-i-d"])):L("",!0),e.sourceType==="lesson"?(g(),F(S,{key:2,"source-type":e.sourceType,"source-u-u-i-d":e.sourceUUID},null,8,["source-type","source-u-u-i-d"])):L("",!0),U(A,{"is-free":e.isFree,disabled:e.readOnly,"reset-callback":e.resetCallback},null,8,["is-free","disabled","reset-callback"]),v(o)&&e.sourceType==="lesson"?(g(),F(w,{key:3,"lesson-u-u-i-d":e.sourceUUID,"user-code":e.userCode},null,8,["lesson-u-u-i-d","user-code"])):L("",!0)])])):L("",!0)],64)}}}),Qd={class:"w-full max-w-4xl p-6"},Xd={class:"mb-4 text-gray-400"},ep={class:"flex items-center mb-4"},tp=["src"],np=["src"],op={class:"ml-2 flex items-baseline text-gray-400"},sp={class:"ml-3 text-3xl font-bold text-gray-200"},rp={class:"flex flex-row"},cr=!0,ei=he({__name:"HintViewModal",props:{onConfirm:{type:Function}},setup(e,{expose:t}){const{numBakedSalmon:n,user:o}=ke(tt()),s=e,a=K(()=>(o.value?.Gems||0)>=xc),r=K(()=>n.value>0),i=()=>{s.onConfirm(cr),p()},l=()=>{s.onConfirm(!cr),p()},u=K(()=>r.value?"Feed Boots 1 baked salmon to get help?":a.value?"You are out of baked salmon! Buy another or continue with a 50% XP reduction for this lesson!":"Sure you want Boots' help? Your XP gain will be reduced by 50% for this lesson."),c=ue("hintViewModal"),d=()=>c.value?.show(),p=()=>c.value?.hide();return t({show:d,hide:p,toggle:()=>c.value?.toggle()}),(y,_)=>{const b=ct,x=Rn;return g(),F(x,{ref_key:"hintViewModal",ref:c,"enable-teleport":""},{default:O(()=>[h("div",Qd,[_[6]||(_[6]=h("h1",{class:"mb-4 pr-6 text-2xl"},"Do you want to ask Boots a question?",-1)),h("p",Xd,M(u.value),1),h("div",ep,[r.value?(g(),I("img",{key:0,src:v(Rl),alt:"baked salmon",class:"-ml-2 h-16"},null,8,tp)):(g(),I("img",{key:1,src:v(Ic),alt:"baked salmon",class:"-ml-2 h-16"},null,8,np)),h("div",op,[_[0]||(_[0]=h("span",{class:"text-lg"},"You have",-1)),h("span",sp,M(v(n)),1),_[1]||(_[1]=h("span",{class:"ml-0.5 text-lg"},"x",-1))])]),h("div",rp,[r.value?(g(),F(b,{key:0,class:"mr-4",autofocus:r.value,onClick:l},{default:O(()=>[..._[2]||(_[2]=[te(" Confirm ",-1)])]),_:1},8,["autofocus"])):L("",!0),!r.value&&a.value?(g(),F(b,{key:1,class:"mr-4",autofocus:!r.value&&a.value,onClick:i},{default:O(()=>[..._[3]||(_[3]=[te(" Buy Baked Salmon and Continue ",-1)])]),_:1},8,["autofocus"])):L("",!0),r.value?L("",!0):(g(),F(b,{key:2,color:a.value?"gray":"yellow",class:"mr-4",autofocus:!r.value&&!a.value,onClick:l},{default:O(()=>[..._[4]||(_[4]=[te(" Confirm ",-1)])]),_:1},8,["color","autofocus"])),U(b,{color:"gray",onClick:p},{default:O(()=>[..._[5]||(_[5]=[te(" Cancel ",-1)])]),_:1})])])]),_:1},512)}}}),ap={class:"m-10 sm:m-14 max-w-screen flex flex-col items-center justify-center"},ip={class:"flex flex-row gap-6"},up="personal-instructions",lp=he({__name:"PersonalInstructionsModal",setup(e,{expose:t}){const n=tt(),{user:o}=ke(n),{loadUser:s}=n,{createToast:a,errToast:r}=Gt(),i=ue("personalInstructionsModal"),l=K(()=>o.value?.PersonalInstructions||""),u=W(""),c=W(`Get straight to the point, and don't call me "young cub". Give me code examples after every explanation.`),d=W(1024),p=K(()=>u.value.length),m=K(()=>p.value===d.value&&y.value?"text-red-600":"text-gray-400"),y=W(!1);function _(){y.value=p.value===d.value}const b=K(()=>u.value!==l.value);async function x(){try{const D=u.value.trim();await Pl(D),S(),a({type:"success",text:"Updated Personal Instructions!"}),s()}catch(D){r(D)}}function k(){i.value?.show()}function S(){i.value?.hide()}function A(){i.value?.toggle()}function w(){u.value=l.value}return t({show:k,hide:S,toggle:A}),(D,E)=>{const B=Wt,R=ct,z=Rn;return g(),F(z,{ref_key:"personalInstructionsModal",ref:i,"modal-query":up,"on-open":w},{default:O(()=>[h("div",ap,[E[3]||(E[3]=h("h1",{class:"mx-4 mb-6 text-3xl sm:text-5xl text-center"}," Personal Instructions ",-1)),E[4]||(E[4]=h("p",{class:"mb-8 text-gray-400 w-90"}," Your instructions will be included at the start of new Boots Chats! ",-1)),U(B,{ref:"textInput",modelValue:u.value,"onUpdate:modelValue":E[0]||(E[0]=j=>u.value=j),tabindex:"0",class:"mx-8 sm:mx-10 overflow-y-auto max-h-96",type:"textarea","textarea-rows":3,maxlength:d.value,placeholder:c.value,"aria-label":"Write personal instructions for Boots","enable-auto-resize":"",autofocus:"",onKeydown:_},null,8,["modelValue","maxlength","placeholder"]),h("p",{class:Oe(["mb-4 mt-1 text-sm self-end",m.value])},M(p.value)+"/"+M(d.value),3),h("div",ip,[U(R,{disabled:!b.value,onClick:x},{default:O(()=>[...E[1]||(E[1]=[te(" Update ",-1)])]),_:1},8,["disabled"]),U(R,{color:"gray",onClick:S},{default:O(()=>[...E[2]||(E[2]=[te(" Cancel ",-1)])]),_:1})])])]),_:1},512)}}}),cp=he({__name:"AudioVisualization",props:{audioData:{default:void 0},config:{default:()=>({})},isSpeechDetected:{type:Boolean,default:!1}},setup(e){const t=e,n={fadeSpeed:.1,barWidth:2,barSpacing:1,decayTimeMs:25,amplitudeHistorySize:1,minScale:500,maxScale:2e3,defaultScale:100,silenceThreshold:.01,inactiveSquareSize:2,maxBarHeightRatio:1,smoothingFactor:.1,logMultiplier:1,minHeightOffset:.01},o=K(()=>({...n,...t.config})),s=ue("canvasRef"),{width:a,height:r}=Ml(s),i=window.devicePixelRatio||1;let l;function u(){if(!s.value)return;const R=a.value*i,z=r.value*i;(s.value.width!==R||s.value.height!==z)&&(s.value.width=R,s.value.height=z,l?.scale(i,i))}Ll(s,u);function c(R){const z=new Float32Array(R);let j=0;return{push(J){z[j]=J,j=(j+1)%R},forEach(J){for(let le=0;le<R;le++)J(z[(j+le)%R],le)},fill(J){z.fill(J)}}}let d=c(1),p=c(o.value.amplitudeHistorySize),m=o.value.inactiveSquareSize,y=0,_=0,b=0;const x=(R,z,j)=>R*(1-j)+z*j;function k(){let R=0;return p.forEach(z=>{z>R&&(R=z)}),R===0?o.value.defaultScale:Math.min(o.value.minScale/R,o.value.maxScale)}function S(R,z,j){const J=R*z,le=Math.log10(J+1)/Math.log10(z+1);return Math.max(Math.min(le*o.value.logMultiplier,1)*j,o.value.inactiveSquareSize+o.value.minHeightOffset)}function A(R,z){const j=Math.max(0,1-z/o.value.decayTimeMs),J=R*Math.pow(j,.5);return J<=o.value.inactiveSquareSize+1?o.value.inactiveSquareSize:J}function w(){const R=t.audioData?.[0]??0;if(y=x(y,R,o.value.smoothingFactor),y<o.value.silenceThreshold){m=o.value.inactiveSquareSize,_=performance.now();return}p.push(y),m=S(y,k(),r.value*o.value.maxBarHeightRatio),_=performance.now()}let D=0;function E(){if(!l||(b=Math.min(1,b+o.value.fadeSpeed),b===0))return;const R=o.value.barWidth+o.value.barSpacing,z=Math.max(1,Math.floor(a.value/R));z!==D&&(d=c(z),d.fill(o.value.inactiveSquareSize),D=z),w(),d.push(A(m,performance.now()-_)),l.clearRect(0,0,a.value,r.value),l.save(),l.globalAlpha=b,l.fillStyle=t.isSpeechDetected?"white":"grey";const j=r.value/2;d.forEach((J,le)=>{const oe=a.value-(z-le)*R;if(!(oe<-o.value.barWidth))if(J===o.value.inactiveSquareSize){const ve=j-o.value.inactiveSquareSize/2;l?.fillRect(oe,ve,o.value.inactiveSquareSize,o.value.inactiveSquareSize)}else{const ve=j-J/2;l?.fillRect(oe,ve,o.value.barWidth,J)}}),l.restore()}const{resume:B}=Nl(E,{immediate:!1});return Ht(()=>{l=s.value?.getContext("2d")??void 0,u(),b=0,m=o.value.inactiveSquareSize,y=0,_=0,p=c(o.value.amplitudeHistorySize),B()}),(R,z)=>(g(),I("canvas",{ref_key:"canvasRef",ref:s,"aria-label":"Live audio level",role:"img",class:"pointer-events-none block h-full w-full"},null,512))}}),Qo={version:"0.3.7"};async function Is(e){try{return[null,await e()]}catch(t){return[t,null]}}function $(e,t,n){function o(i,l){if(i._zod||Object.defineProperty(i,"_zod",{value:{def:l,constr:r,traits:new Set},enumerable:!1}),i._zod.traits.has(e))return;i._zod.traits.add(e),t(i,l);const u=r.prototype,c=Object.keys(u);for(let d=0;d<c.length;d++){const p=c[d];p in i||(i[p]=u[p].bind(i))}}const s=n?.Parent??Object;class a extends s{}Object.defineProperty(a,"name",{value:e});function r(i){var l;const u=n?.Parent?new a:this;o(u,i),(l=u._zod).deferred??(l.deferred=[]);for(const c of u._zod.deferred)c();return u}return Object.defineProperty(r,"init",{value:o}),Object.defineProperty(r,Symbol.hasInstance,{value:i=>n?.Parent&&i instanceof n.Parent?!0:i?._zod?.traits?.has(e)}),Object.defineProperty(r,"name",{value:e}),r}class rn extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class ti extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const ni={};function Rt(e){return ni}function oi(e){const t=Object.values(e).filter(o=>typeof o=="number");return Object.entries(e).filter(([o,s])=>t.indexOf(+o)===-1).map(([o,s])=>s)}function Xo(e,t){return typeof t=="bigint"?t.toString():t}function yo(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function xs(e){return e==null}function Ss(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function dp(e,t){const n=(e.toString().split(".")[1]||"").length,o=t.toString();let s=(o.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(o)){const l=o.match(/\d?e-(\d?)/);l?.[1]&&(s=Number.parseInt(l[1]))}const a=n>s?n:s,r=Number.parseInt(e.toFixed(a).replace(".","")),i=Number.parseInt(t.toFixed(a).replace(".",""));return r%i/10**a}const dr=Symbol("evaluating");function de(e,t,n){let o;Object.defineProperty(e,t,{get(){if(o!==dr)return o===void 0&&(o=dr,o=n()),o},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function Kt(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Lt(...e){const t={};for(const n of e){const o=Object.getOwnPropertyDescriptors(n);Object.assign(t,o)}return Object.defineProperties({},t)}function pr(e){return JSON.stringify(e)}function pp(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const si="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Tn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const fp=yo(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function ln(e){if(Tn(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Tn(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function ri(e){return ln(e)?{...e}:Array.isArray(e)?[...e]:e}const mp=new Set(["string","number","symbol"]);function cn(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Nt(e,t,n){const o=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(o._zod.parent=e),o}function Q(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function hp(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const gp={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function yp(e,t){const n=e._zod.def,o=n.checks;if(o&&o.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const a=Lt(e._zod.def,{get shape(){const r={};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(r[i]=n.shape[i])}return Kt(this,"shape",r),r},checks:[]});return Nt(e,a)}function vp(e,t){const n=e._zod.def,o=n.checks;if(o&&o.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const a=Lt(e._zod.def,{get shape(){const r={...e._zod.def.shape};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete r[i]}return Kt(this,"shape",r),r},checks:[]});return Nt(e,a)}function _p(e,t){if(!ln(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0){const a=e._zod.def.shape;for(const r in t)if(Object.getOwnPropertyDescriptor(a,r)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const s=Lt(e._zod.def,{get shape(){const a={...e._zod.def.shape,...t};return Kt(this,"shape",a),a}});return Nt(e,s)}function wp(e,t){if(!ln(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n=Lt(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return Kt(this,"shape",o),o}});return Nt(e,n)}function bp(e,t){const n=Lt(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t._zod.def.shape};return Kt(this,"shape",o),o},get catchall(){return t._zod.def.catchall},checks:[]});return Nt(e,n)}function kp(e,t,n){const s=t._zod.def.checks;if(s&&s.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const r=Lt(t._zod.def,{get shape(){const i=t._zod.def.shape,l={...i};if(n)for(const u in n){if(!(u in i))throw new Error(`Unrecognized key: "${u}"`);n[u]&&(l[u]=e?new e({type:"optional",innerType:i[u]}):i[u])}else for(const u in i)l[u]=e?new e({type:"optional",innerType:i[u]}):i[u];return Kt(this,"shape",l),l},checks:[]});return Nt(t,r)}function Ip(e,t,n){const o=Lt(t._zod.def,{get shape(){const s=t._zod.def.shape,a={...s};if(n)for(const r in n){if(!(r in a))throw new Error(`Unrecognized key: "${r}"`);n[r]&&(a[r]=new e({type:"nonoptional",innerType:s[r]}))}else for(const r in s)a[r]=new e({type:"nonoptional",innerType:s[r]});return Kt(this,"shape",a),a}});return Nt(t,o)}function en(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function tn(e,t){return t.map(n=>{var o;return(o=n).path??(o.path=[]),n.path.unshift(e),n})}function Bn(e){return typeof e=="string"?e:e?.message}function Pt(e,t,n){const o={...e,path:e.path??[]};if(!e.message){const s=Bn(e.inst?._zod.def?.error?.(e))??Bn(t?.error?.(e))??Bn(n.customError?.(e))??Bn(n.localeError?.(e))??"Invalid input";o.message=s}return delete o.inst,delete o.continue,t?.reportInput||delete o.input,o}function Ts(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Cn(...e){const[t,n,o]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:o}:{...t}}const ai=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Xo,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},ii=$("$ZodError",ai),ui=$("$ZodError",ai,{Parent:Error});function xp(e,t=n=>n.message){const n={},o=[];for(const s of e.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(t(s))):o.push(t(s));return{formErrors:o,fieldErrors:n}}function Sp(e,t=n=>n.message){const n={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(r=>o({issues:r}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)n._errors.push(t(a));else{let r=n,i=0;for(;i<a.path.length;){const l=a.path[i];i===a.path.length-1?(r[l]=r[l]||{_errors:[]},r[l]._errors.push(t(a))):r[l]=r[l]||{_errors:[]},r=r[l],i++}}};return o(e),n}const Cs=e=>(t,n,o,s)=>{const a=o?Object.assign(o,{async:!1}):{async:!1},r=t._zod.run({value:n,issues:[]},a);if(r instanceof Promise)throw new rn;if(r.issues.length){const i=new(s?.Err??e)(r.issues.map(l=>Pt(l,a,Rt())));throw si(i,s?.callee),i}return r.value},As=e=>async(t,n,o,s)=>{const a=o?Object.assign(o,{async:!0}):{async:!0};let r=t._zod.run({value:n,issues:[]},a);if(r instanceof Promise&&(r=await r),r.issues.length){const i=new(s?.Err??e)(r.issues.map(l=>Pt(l,a,Rt())));throw si(i,s?.callee),i}return r.value},vo=e=>(t,n,o)=>{const s=o?{...o,async:!1}:{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new rn;return a.issues.length?{success:!1,error:new(e??ii)(a.issues.map(r=>Pt(r,s,Rt())))}:{success:!0,data:a.value}},Tp=vo(ui),_o=e=>async(t,n,o)=>{const s=o?Object.assign(o,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(r=>Pt(r,s,Rt())))}:{success:!0,data:a.value}},Cp=_o(ui),Ap=e=>(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Cs(e)(t,n,s)},Dp=e=>(t,n,o)=>Cs(e)(t,n,o),$p=e=>async(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return As(e)(t,n,s)},Ep=e=>async(t,n,o)=>As(e)(t,n,o),Up=e=>(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return vo(e)(t,n,s)},Op=e=>(t,n,o)=>vo(e)(t,n,o),Rp=e=>async(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return _o(e)(t,n,s)},Pp=e=>async(t,n,o)=>_o(e)(t,n,o),Mp=/^[cC][^\s-]{8,}$/,Lp=/^[0-9a-z]+$/,Np=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,zp=/^[0-9a-vA-V]{20}$/,Fp=/^[A-Za-z0-9]{27}$/,Bp=/^[a-zA-Z0-9_-]{21}$/,Zp=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,jp=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,fr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,qp=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Jp="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Vp(){return new RegExp(Jp,"u")}const Hp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Gp=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Wp=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Kp=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Yp=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,li=/^[A-Za-z0-9_-]*$/,Qp=/^\+[1-9]\d{6,14}$/,ci="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Xp=new RegExp(`^${ci}$`);function di(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function ef(e){return new RegExp(`^${di(e)}$`)}function tf(e){const t=di({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const o=`${t}(?:${n.join("|")})`;return new RegExp(`^${ci}T(?:${o})$`)}const nf=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},of=/^-?\d+$/,pi=/^-?\d+(?:\.\d+)?$/,sf=/^(?:true|false)$/i,rf=/^[^A-Z]*$/,af=/^[^a-z]*$/,Ye=$("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),fi={number:"number",bigint:"bigint",object:"date"},mi=$("$ZodCheckLessThan",(e,t)=>{Ye.init(e,t);const n=fi[typeof t.value];e._zod.onattach.push(o=>{const s=o._zod.bag,a=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<a&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value<=t.value:o.value<t.value)||o.issues.push({origin:n,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),hi=$("$ZodCheckGreaterThan",(e,t)=>{Ye.init(e,t);const n=fi[typeof t.value];e._zod.onattach.push(o=>{const s=o._zod.bag,a=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>a&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value>=t.value:o.value>t.value)||o.issues.push({origin:n,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),uf=$("$ZodCheckMultipleOf",(e,t)=>{Ye.init(e,t),e._zod.onattach.push(n=>{var o;(o=n._zod.bag).multipleOf??(o.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):dp(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),lf=$("$ZodCheckNumberFormat",(e,t)=>{Ye.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),o=n?"int":"number",[s,a]=gp[t.format];e._zod.onattach.push(r=>{const i=r._zod.bag;i.format=t.format,i.minimum=s,i.maximum=a,n&&(i.pattern=of)}),e._zod.check=r=>{const i=r.value;if(n){if(!Number.isInteger(i)){r.issues.push({expected:o,format:t.format,code:"invalid_type",continue:!1,input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?r.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,inclusive:!0,continue:!t.abort}):r.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,inclusive:!0,continue:!t.abort});return}}i<s&&r.issues.push({origin:"number",input:i,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),i>a&&r.issues.push({origin:"number",input:i,code:"too_big",maximum:a,inclusive:!0,inst:e,continue:!t.abort})}}),cf=$("$ZodCheckMaxLength",(e,t)=>{var n;Ye.init(e,t),(n=e._zod.def).when??(n.when=o=>{const s=o.value;return!xs(s)&&s.length!==void 0}),e._zod.onattach.push(o=>{const s=o._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(o._zod.bag.maximum=t.maximum)}),e._zod.check=o=>{const s=o.value;if(s.length<=t.maximum)return;const r=Ts(s);o.issues.push({origin:r,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),df=$("$ZodCheckMinLength",(e,t)=>{var n;Ye.init(e,t),(n=e._zod.def).when??(n.when=o=>{const s=o.value;return!xs(s)&&s.length!==void 0}),e._zod.onattach.push(o=>{const s=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(o._zod.bag.minimum=t.minimum)}),e._zod.check=o=>{const s=o.value;if(s.length>=t.minimum)return;const r=Ts(s);o.issues.push({origin:r,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),pf=$("$ZodCheckLengthEquals",(e,t)=>{var n;Ye.init(e,t),(n=e._zod.def).when??(n.when=o=>{const s=o.value;return!xs(s)&&s.length!==void 0}),e._zod.onattach.push(o=>{const s=o._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=o=>{const s=o.value,a=s.length;if(a===t.length)return;const r=Ts(s),i=a>t.length;o.issues.push({origin:r,...i?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!t.abort})}}),wo=$("$ZodCheckStringFormat",(e,t)=>{var n,o;Ye.init(e,t),e._zod.onattach.push(s=>{const a=s._zod.bag;a.format=t.format,t.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(o=e._zod).check??(o.check=()=>{})}),ff=$("$ZodCheckRegex",(e,t)=>{wo.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),mf=$("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=rf),wo.init(e,t)}),hf=$("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=af),wo.init(e,t)}),gf=$("$ZodCheckIncludes",(e,t)=>{Ye.init(e,t);const n=cn(t.includes),o=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=o,e._zod.onattach.push(s=>{const a=s._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(o)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),yf=$("$ZodCheckStartsWith",(e,t)=>{Ye.init(e,t);const n=new RegExp(`^${cn(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.startsWith(t.prefix)||o.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:o.value,inst:e,continue:!t.abort})}}),vf=$("$ZodCheckEndsWith",(e,t)=>{Ye.init(e,t);const n=new RegExp(`.*${cn(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.endsWith(t.suffix)||o.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:o.value,inst:e,continue:!t.abort})}}),_f=$("$ZodCheckOverwrite",(e,t)=>{Ye.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class wf{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const o=t.split(`
`).filter(r=>r),s=Math.min(...o.map(r=>r.length-r.trimStart().length)),a=o.map(r=>r.slice(s)).map(r=>" ".repeat(this.indent*2)+r);for(const r of a)this.content.push(r)}compile(){const t=Function,n=this?.args,s=[...(this?.content??[""]).map(a=>`  ${a}`)];return new t(...n,s.join(`
`))}}const bf={major:4,minor:3,patch:5},Se=$("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=bf;const o=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&o.unshift(e);for(const s of o)for(const a of s._zod.onattach)a(e);if(o.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(r,i,l)=>{let u=en(r),c;for(const d of i){if(d._zod.def.when){if(!d._zod.def.when(r))continue}else if(u)continue;const p=r.issues.length,m=d._zod.check(r);if(m instanceof Promise&&l?.async===!1)throw new rn;if(c||m instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await m,r.issues.length!==p&&(u||(u=en(r,p)))});else{if(r.issues.length===p)continue;u||(u=en(r,p))}}return c?c.then(()=>r):r},a=(r,i,l)=>{if(en(r))return r.aborted=!0,r;const u=s(i,o,l);if(u instanceof Promise){if(l.async===!1)throw new rn;return u.then(c=>e._zod.parse(c,l))}return e._zod.parse(u,l)};e._zod.run=(r,i)=>{if(i.skipChecks)return e._zod.parse(r,i);if(i.direction==="backward"){const u=e._zod.parse({value:r.value,issues:[]},{...i,skipChecks:!0});return u instanceof Promise?u.then(c=>a(c,r,i)):a(u,r,i)}const l=e._zod.parse(r,i);if(l instanceof Promise){if(i.async===!1)throw new rn;return l.then(u=>s(u,o,i))}return s(l,o,i)}}de(e,"~standard",()=>({validate:s=>{try{const a=Tp(e,s);return a.success?{value:a.data}:{issues:a.error?.issues}}catch{return Cp(e,s).then(r=>r.success?{value:r.data}:{issues:r.error?.issues})}},vendor:"zod",version:1}))}),Ds=$("$ZodString",(e,t)=>{Se.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??nf(e._zod.bag),e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),Ce=$("$ZodStringFormat",(e,t)=>{wo.init(e,t),Ds.init(e,t)}),kf=$("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=jp),Ce.init(e,t)}),If=$("$ZodUUID",(e,t)=>{if(t.version){const o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(o===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=fr(o))}else t.pattern??(t.pattern=fr());Ce.init(e,t)}),xf=$("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=qp),Ce.init(e,t)}),Sf=$("$ZodURL",(e,t)=>{Ce.init(e,t),e._zod.check=n=>{try{const o=n.value.trim(),s=new URL(o);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=s.href:n.value=o;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Tf=$("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Vp()),Ce.init(e,t)}),Cf=$("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Bp),Ce.init(e,t)}),Af=$("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Mp),Ce.init(e,t)}),Df=$("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Lp),Ce.init(e,t)}),$f=$("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Np),Ce.init(e,t)}),Ef=$("$ZodXID",(e,t)=>{t.pattern??(t.pattern=zp),Ce.init(e,t)}),Uf=$("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Fp),Ce.init(e,t)}),Of=$("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=tf(t)),Ce.init(e,t)}),Rf=$("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Xp),Ce.init(e,t)}),Pf=$("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=ef(t)),Ce.init(e,t)}),Mf=$("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Zp),Ce.init(e,t)}),Lf=$("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Hp),Ce.init(e,t),e._zod.bag.format="ipv4"}),Nf=$("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Gp),Ce.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),zf=$("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Wp),Ce.init(e,t)}),Ff=$("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Kp),Ce.init(e,t),e._zod.check=n=>{const o=n.value.split("/");try{if(o.length!==2)throw new Error;const[s,a]=o;if(!a)throw new Error;const r=Number(a);if(`${r}`!==a)throw new Error;if(r<0||r>128)throw new Error;new URL(`http://[${s}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function gi(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Bf=$("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Yp),Ce.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{gi(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function Zf(e){if(!li.test(e))return!1;const t=e.replace(/[-_]/g,o=>o==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return gi(n)}const jf=$("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=li),Ce.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{Zf(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),qf=$("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Qp),Ce.init(e,t)});function Jf(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[o]=n;if(!o)return!1;const s=JSON.parse(atob(o));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const Vf=$("$ZodJWT",(e,t)=>{Ce.init(e,t),e._zod.check=n=>{Jf(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),yi=$("$ZodNumber",(e,t)=>{Se.init(e,t),e._zod.pattern=e._zod.bag.pattern??pi,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const s=n.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return n;const a=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...a?{received:a}:{}}),n}}),Hf=$("$ZodNumberFormat",(e,t)=>{lf.init(e,t),yi.init(e,t)}),Gf=$("$ZodBoolean",(e,t)=>{Se.init(e,t),e._zod.pattern=sf,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=!!n.value}catch{}const s=n.value;return typeof s=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),n}}),Wf=$("$ZodAny",(e,t)=>{Se.init(e,t),e._zod.parse=n=>n}),Kf=$("$ZodUnknown",(e,t)=>{Se.init(e,t),e._zod.parse=n=>n}),Yf=$("$ZodNever",(e,t)=>{Se.init(e,t),e._zod.parse=(n,o)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function mr(e,t,n){e.issues.length&&t.issues.push(...tn(n,e.issues)),t.value[n]=e.value}const Qf=$("$ZodArray",(e,t)=>{Se.init(e,t),e._zod.parse=(n,o)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),n;n.value=Array(s.length);const a=[];for(let r=0;r<s.length;r++){const i=s[r],l=t.element._zod.run({value:i,issues:[]},o);l instanceof Promise?a.push(l.then(u=>mr(u,n,r))):mr(l,n,r)}return a.length?Promise.all(a).then(()=>n):n}});function Yn(e,t,n,o,s){if(e.issues.length){if(s&&!(n in o))return;t.issues.push(...tn(n,e.issues))}e.value===void 0?n in o&&(t.value[n]=void 0):t.value[n]=e.value}function vi(e){const t=Object.keys(e.shape);for(const o of t)if(!e.shape?.[o]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${o}": expected a Zod schema`);const n=hp(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function _i(e,t,n,o,s,a){const r=[],i=s.keySet,l=s.catchall._zod,u=l.def.type,c=l.optout==="optional";for(const d in t){if(i.has(d))continue;if(u==="never"){r.push(d);continue}const p=l.run({value:t[d],issues:[]},o);p instanceof Promise?e.push(p.then(m=>Yn(m,n,d,t,c))):Yn(p,n,d,t,c)}return r.length&&n.issues.push({code:"unrecognized_keys",keys:r,input:t,inst:a}),e.length?Promise.all(e).then(()=>n):n}const Xf=$("$ZodObject",(e,t)=>{if(Se.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const i=t.shape;Object.defineProperty(t,"shape",{get:()=>{const l={...i};return Object.defineProperty(t,"shape",{value:l}),l}})}const o=yo(()=>vi(t));de(e._zod,"propValues",()=>{const i=t.shape,l={};for(const u in i){const c=i[u]._zod;if(c.values){l[u]??(l[u]=new Set);for(const d of c.values)l[u].add(d)}}return l});const s=Tn,a=t.catchall;let r;e._zod.parse=(i,l)=>{r??(r=o.value);const u=i.value;if(!s(u))return i.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),i;i.value={};const c=[],d=r.shape;for(const p of r.keys){const m=d[p],y=m._zod.optout==="optional",_=m._zod.run({value:u[p],issues:[]},l);_ instanceof Promise?c.push(_.then(b=>Yn(b,i,p,u,y))):Yn(_,i,p,u,y)}return a?_i(c,u,i,l,o.value,e):c.length?Promise.all(c).then(()=>i):i}}),em=$("$ZodObjectJIT",(e,t)=>{Xf.init(e,t);const n=e._zod.parse,o=yo(()=>vi(t)),s=p=>{const m=new wf(["shape","payload","ctx"]),y=o.value,_=S=>{const A=pr(S);return`shape[${A}]._zod.run({ value: input[${A}], issues: [] }, ctx)`};m.write("const input = payload.value;");const b=Object.create(null);let x=0;for(const S of y.keys)b[S]=`key_${x++}`;m.write("const newResult = {};");for(const S of y.keys){const A=b[S],w=pr(S),E=p[S]?._zod?.optout==="optional";m.write(`const ${A} = ${_(S)};`),E?m.write(`
        if (${A}.issues.length) {
          if (${w} in input) {
            payload.issues = payload.issues.concat(${A}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${w}, ...iss.path] : [${w}]
            })));
          }
        }
        
        if (${A}.value === undefined) {
          if (${w} in input) {
            newResult[${w}] = undefined;
          }
        } else {
          newResult[${w}] = ${A}.value;
        }
        
      `):m.write(`
        if (${A}.issues.length) {
          payload.issues = payload.issues.concat(${A}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${w}, ...iss.path] : [${w}]
          })));
        }
        
        if (${A}.value === undefined) {
          if (${w} in input) {
            newResult[${w}] = undefined;
          }
        } else {
          newResult[${w}] = ${A}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const k=m.compile();return(S,A)=>k(p,S,A)};let a;const r=Tn,i=!ni.jitless,u=i&&fp.value,c=t.catchall;let d;e._zod.parse=(p,m)=>{d??(d=o.value);const y=p.value;return r(y)?i&&u&&m?.async===!1&&m.jitless!==!0?(a||(a=s(t.shape)),p=a(p,m),c?_i([],y,p,m,d,e):p):n(p,m):(p.issues.push({expected:"object",code:"invalid_type",input:y,inst:e}),p)}});function hr(e,t,n,o){for(const a of e)if(a.issues.length===0)return t.value=a.value,t;const s=e.filter(a=>!en(a));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(a=>a.issues.map(r=>Pt(r,o,Rt())))}),t)}const wi=$("$ZodUnion",(e,t)=>{Se.init(e,t),de(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),de(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),de(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),de(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(a=>a._zod.pattern);return new RegExp(`^(${s.map(a=>Ss(a.source)).join("|")})$`)}});const n=t.options.length===1,o=t.options[0]._zod.run;e._zod.parse=(s,a)=>{if(n)return o(s,a);let r=!1;const i=[];for(const l of t.options){const u=l._zod.run({value:s.value,issues:[]},a);if(u instanceof Promise)i.push(u),r=!0;else{if(u.issues.length===0)return u;i.push(u)}}return r?Promise.all(i).then(l=>hr(l,s,e,a)):hr(i,s,e,a)}}),tm=$("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,wi.init(e,t);const n=e._zod.parse;de(e._zod,"propValues",()=>{const s={};for(const a of t.options){const r=a._zod.propValues;if(!r||Object.keys(r).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(a)}"`);for(const[i,l]of Object.entries(r)){s[i]||(s[i]=new Set);for(const u of l)s[i].add(u)}}return s});const o=yo(()=>{const s=t.options,a=new Map;for(const r of s){const i=r._zod.propValues?.[t.discriminator];if(!i||i.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(const l of i){if(a.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);a.set(l,r)}}return a});e._zod.parse=(s,a)=>{const r=s.value;if(!Tn(r))return s.issues.push({code:"invalid_type",expected:"object",input:r,inst:e}),s;const i=o.value.get(r?.[t.discriminator]);return i?i._zod.run(s,a):t.unionFallback?n(s,a):(s.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:r,path:[t.discriminator],inst:e}),s)}}),nm=$("$ZodIntersection",(e,t)=>{Se.init(e,t),e._zod.parse=(n,o)=>{const s=n.value,a=t.left._zod.run({value:s,issues:[]},o),r=t.right._zod.run({value:s,issues:[]},o);return a instanceof Promise||r instanceof Promise?Promise.all([a,r]).then(([l,u])=>gr(n,l,u)):gr(n,a,r)}});function es(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(ln(e)&&ln(t)){const n=Object.keys(t),o=Object.keys(e).filter(a=>n.indexOf(a)!==-1),s={...e,...t};for(const a of o){const r=es(e[a],t[a]);if(!r.valid)return{valid:!1,mergeErrorPath:[a,...r.mergeErrorPath]};s[a]=r.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let o=0;o<e.length;o++){const s=e[o],a=t[o],r=es(s,a);if(!r.valid)return{valid:!1,mergeErrorPath:[o,...r.mergeErrorPath]};n.push(r.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function gr(e,t,n){const o=new Map;let s;for(const i of t.issues)if(i.code==="unrecognized_keys"){s??(s=i);for(const l of i.keys)o.has(l)||o.set(l,{}),o.get(l).l=!0}else e.issues.push(i);for(const i of n.issues)if(i.code==="unrecognized_keys")for(const l of i.keys)o.has(l)||o.set(l,{}),o.get(l).r=!0;else e.issues.push(i);const a=[...o].filter(([,i])=>i.l&&i.r).map(([i])=>i);if(a.length&&s&&e.issues.push({...s,keys:a}),en(e))return e;const r=es(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const om=$("$ZodRecord",(e,t)=>{Se.init(e,t),e._zod.parse=(n,o)=>{const s=n.value;if(!ln(s))return n.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),n;const a=[],r=t.keyType._zod.values;if(r){n.value={};const i=new Set;for(const u of r)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){i.add(typeof u=="number"?u.toString():u);const c=t.valueType._zod.run({value:s[u],issues:[]},o);c instanceof Promise?a.push(c.then(d=>{d.issues.length&&n.issues.push(...tn(u,d.issues)),n.value[u]=d.value})):(c.issues.length&&n.issues.push(...tn(u,c.issues)),n.value[u]=c.value)}let l;for(const u in s)i.has(u)||(l=l??[],l.push(u));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:l})}else{n.value={};for(const i of Reflect.ownKeys(s)){if(i==="__proto__")continue;let l=t.keyType._zod.run({value:i,issues:[]},o);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof i=="string"&&pi.test(i)&&l.issues.length&&l.issues.some(d=>d.code==="invalid_type"&&d.expected==="number")){const d=t.keyType._zod.run({value:Number(i),issues:[]},o);if(d instanceof Promise)throw new Error("Async schemas not supported in object keys currently");d.issues.length===0&&(l=d)}if(l.issues.length){t.mode==="loose"?n.value[i]=s[i]:n.issues.push({code:"invalid_key",origin:"record",issues:l.issues.map(d=>Pt(d,o,Rt())),input:i,path:[i],inst:e});continue}const c=t.valueType._zod.run({value:s[i],issues:[]},o);c instanceof Promise?a.push(c.then(d=>{d.issues.length&&n.issues.push(...tn(i,d.issues)),n.value[l.value]=d.value})):(c.issues.length&&n.issues.push(...tn(i,c.issues)),n.value[l.value]=c.value)}}return a.length?Promise.all(a).then(()=>n):n}}),sm=$("$ZodEnum",(e,t)=>{Se.init(e,t);const n=oi(t.entries),o=new Set(n);e._zod.values=o,e._zod.pattern=new RegExp(`^(${n.filter(s=>mp.has(typeof s)).map(s=>typeof s=="string"?cn(s):s.toString()).join("|")})$`),e._zod.parse=(s,a)=>{const r=s.value;return o.has(r)||s.issues.push({code:"invalid_value",values:n,input:r,inst:e}),s}}),rm=$("$ZodLiteral",(e,t)=>{if(Se.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(t.values);e._zod.values=n,e._zod.pattern=new RegExp(`^(${t.values.map(o=>typeof o=="string"?cn(o):o?cn(o.toString()):String(o)).join("|")})$`),e._zod.parse=(o,s)=>{const a=o.value;return n.has(a)||o.issues.push({code:"invalid_value",values:t.values,input:a,inst:e}),o}}),am=$("$ZodTransform",(e,t)=>{Se.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new ti(e.constructor.name);const s=t.transform(n.value,n);if(o.async)return(s instanceof Promise?s:Promise.resolve(s)).then(r=>(n.value=r,n));if(s instanceof Promise)throw new rn;return n.value=s,n}});function yr(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const bi=$("$ZodOptional",(e,t)=>{Se.init(e,t),e._zod.optin="optional",e._zod.optout="optional",de(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),de(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Ss(n.source)})?$`):void 0}),e._zod.parse=(n,o)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>yr(a,n.value)):yr(s,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,o)}}),im=$("$ZodExactOptional",(e,t)=>{bi.init(e,t),de(e._zod,"values",()=>t.innerType._zod.values),de(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(n,o)=>t.innerType._zod.run(n,o)}),um=$("$ZodNullable",(e,t)=>{Se.init(e,t),de(e._zod,"optin",()=>t.innerType._zod.optin),de(e._zod,"optout",()=>t.innerType._zod.optout),de(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Ss(n.source)}|null)$`):void 0}),de(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,o)=>n.value===null?n:t.innerType._zod.run(n,o)}),lm=$("$ZodDefault",(e,t)=>{Se.init(e,t),e._zod.optin="optional",de(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);if(n.value===void 0)return n.value=t.defaultValue,n;const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>vr(a,t)):vr(s,t)}});function vr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const cm=$("$ZodPrefault",(e,t)=>{Se.init(e,t),e._zod.optin="optional",de(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>(o.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,o))}),dm=$("$ZodNonOptional",(e,t)=>{Se.init(e,t),de(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(o=>o!==void 0)):void 0}),e._zod.parse=(n,o)=>{const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>_r(a,e)):_r(s,e)}});function _r(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const pm=$("$ZodCatch",(e,t)=>{Se.init(e,t),de(e._zod,"optin",()=>t.innerType._zod.optin),de(e._zod,"optout",()=>t.innerType._zod.optout),de(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>(n.value=a.value,a.issues.length&&(n.value=t.catchValue({...n,error:{issues:a.issues.map(r=>Pt(r,o,Rt()))},input:n.value}),n.issues=[]),n)):(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>Pt(a,o,Rt()))},input:n.value}),n.issues=[]),n)}}),fm=$("$ZodPipe",(e,t)=>{Se.init(e,t),de(e._zod,"values",()=>t.in._zod.values),de(e._zod,"optin",()=>t.in._zod.optin),de(e._zod,"optout",()=>t.out._zod.optout),de(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,o)=>{if(o.direction==="backward"){const a=t.out._zod.run(n,o);return a instanceof Promise?a.then(r=>Zn(r,t.in,o)):Zn(a,t.in,o)}const s=t.in._zod.run(n,o);return s instanceof Promise?s.then(a=>Zn(a,t.out,o)):Zn(s,t.out,o)}});function Zn(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const mm=$("$ZodReadonly",(e,t)=>{Se.init(e,t),de(e._zod,"propValues",()=>t.innerType._zod.propValues),de(e._zod,"values",()=>t.innerType._zod.values),de(e._zod,"optin",()=>t.innerType?._zod?.optin),de(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(wr):wr(s)}});function wr(e){return e.value=Object.freeze(e.value),e}const hm=$("$ZodLazy",(e,t)=>{Se.init(e,t),de(e._zod,"innerType",()=>t.getter()),de(e._zod,"pattern",()=>e._zod.innerType?._zod?.pattern),de(e._zod,"propValues",()=>e._zod.innerType?._zod?.propValues),de(e._zod,"optin",()=>e._zod.innerType?._zod?.optin??void 0),de(e._zod,"optout",()=>e._zod.innerType?._zod?.optout??void 0),e._zod.parse=(n,o)=>e._zod.innerType._zod.run(n,o)}),gm=$("$ZodCustom",(e,t)=>{Ye.init(e,t),Se.init(e,t),e._zod.parse=(n,o)=>n,e._zod.check=n=>{const o=n.value,s=t.fn(o);if(s instanceof Promise)return s.then(a=>br(a,n,o,e));br(s,n,o,e)}});function br(e,t,n,o){if(!e){const s={code:"custom",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(s.params=o._zod.def.params),t.issues.push(Cn(s))}}var kr;class ym{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const o=n[0];return this._map.set(t,o),o&&typeof o=="object"&&"id"in o&&this._idmap.set(o.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const o={...this.get(n)??{}};delete o.id;const s={...o,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function vm(){return new ym}(kr=globalThis).__zod_globalRegistry??(kr.__zod_globalRegistry=vm());const bn=globalThis.__zod_globalRegistry;function _m(e,t){return new e({type:"string",...Q(t)})}function wm(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...Q(t)})}function Ir(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...Q(t)})}function bm(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...Q(t)})}function km(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Q(t)})}function Im(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Q(t)})}function xm(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Q(t)})}function Sm(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...Q(t)})}function Tm(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...Q(t)})}function Cm(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...Q(t)})}function Am(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...Q(t)})}function Dm(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...Q(t)})}function $m(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...Q(t)})}function Em(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...Q(t)})}function Um(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...Q(t)})}function Om(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...Q(t)})}function Rm(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...Q(t)})}function Pm(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Q(t)})}function Mm(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Q(t)})}function Lm(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...Q(t)})}function Nm(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...Q(t)})}function zm(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...Q(t)})}function Fm(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...Q(t)})}function Bm(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Q(t)})}function Zm(e,t){return new e({type:"string",format:"date",check:"string_format",...Q(t)})}function jm(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...Q(t)})}function qm(e,t){return new e({type:"string",format:"duration",check:"string_format",...Q(t)})}function Jm(e,t){return new e({type:"number",checks:[],...Q(t)})}function Vm(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...Q(t)})}function Hm(e,t){return new e({type:"boolean",...Q(t)})}function Gm(e){return new e({type:"any"})}function Wm(e){return new e({type:"unknown"})}function Km(e,t){return new e({type:"never",...Q(t)})}function xr(e,t){return new mi({check:"less_than",...Q(t),value:e,inclusive:!1})}function zo(e,t){return new mi({check:"less_than",...Q(t),value:e,inclusive:!0})}function Sr(e,t){return new hi({check:"greater_than",...Q(t),value:e,inclusive:!1})}function Fo(e,t){return new hi({check:"greater_than",...Q(t),value:e,inclusive:!0})}function Tr(e,t){return new uf({check:"multiple_of",...Q(t),value:e})}function ki(e,t){return new cf({check:"max_length",...Q(t),maximum:e})}function Qn(e,t){return new df({check:"min_length",...Q(t),minimum:e})}function Ii(e,t){return new pf({check:"length_equals",...Q(t),length:e})}function Ym(e,t){return new ff({check:"string_format",format:"regex",...Q(t),pattern:e})}function Qm(e){return new mf({check:"string_format",format:"lowercase",...Q(e)})}function Xm(e){return new hf({check:"string_format",format:"uppercase",...Q(e)})}function eh(e,t){return new gf({check:"string_format",format:"includes",...Q(t),includes:e})}function th(e,t){return new yf({check:"string_format",format:"starts_with",...Q(t),prefix:e})}function nh(e,t){return new vf({check:"string_format",format:"ends_with",...Q(t),suffix:e})}function pn(e){return new _f({check:"overwrite",tx:e})}function oh(e){return pn(t=>t.normalize(e))}function sh(){return pn(e=>e.trim())}function rh(){return pn(e=>e.toLowerCase())}function ah(){return pn(e=>e.toUpperCase())}function ih(){return pn(e=>pp(e))}function uh(e,t,n){return new e({type:"array",element:t,...Q(n)})}function lh(e,t,n){return new e({type:"custom",check:"custom",fn:t,...Q(n)})}function ch(e){const t=dh(n=>(n.addIssue=o=>{if(typeof o=="string")n.issues.push(Cn(o,n.value,t._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),n.issues.push(Cn(s))}},e(n.value,n)));return t}function dh(e,t){const n=new Ye({check:"custom",...Q(t)});return n._zod.check=e,n}function Xn(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??bn,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function Ie(e,t,n={path:[],schemaPath:[]}){var o;const s=e._zod.def,a=t.seen.get(e);if(a)return a.count++,n.schemaPath.includes(e)&&(a.cycle=n.path),a.schema;const r={schema:{},count:1,cycle:void 0,path:n.path};t.seen.set(e,r);const i=e._zod.toJSONSchema?.();if(i)r.schema=i;else{const c={...n,schemaPath:[...n.schemaPath,e],path:n.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,r.schema,c);else{const p=r.schema,m=t.processors[s.type];if(!m)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);m(e,t,p,c)}const d=e._zod.parent;d&&(r.ref||(r.ref=d),Ie(d,t,c),t.seen.get(d).isParent=!0)}const l=t.metadataRegistry.get(e);return l&&Object.assign(r.schema,l),t.io==="input"&&Je(e)&&(delete r.schema.examples,delete r.schema.default),t.io==="input"&&r.schema._prefault&&((o=r.schema).default??(o.default=r.schema._prefault)),delete r.schema._prefault,t.seen.get(e).schema}function eo(e,t){const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=new Map;for(const r of e.seen.entries()){const i=e.metadataRegistry.get(r[0])?.id;if(i){const l=o.get(i);if(l&&l!==r[0])throw new Error(`Duplicate schema id "${i}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);o.set(i,r[0])}}const s=r=>{const i=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const d=e.external.registry.get(r[0])?.id,p=e.external.uri??(y=>y);if(d)return{ref:p(d)};const m=r[1].defId??r[1].schema.id??`schema${e.counter++}`;return r[1].defId=m,{defId:m,ref:`${p("__shared")}#/${i}/${m}`}}if(r[1]===n)return{ref:"#"};const u=`#/${i}/`,c=r[1].schema.id??`__schema${e.counter++}`;return{defId:c,ref:u+c}},a=r=>{if(r[1].schema.$ref)return;const i=r[1],{ref:l,defId:u}=s(r);i.def={...i.schema},u&&(i.defId=u);const c=i.schema;for(const d in c)delete c[d];c.$ref=l};if(e.cycles==="throw")for(const r of e.seen.entries()){const i=r[1];if(i.cycle)throw new Error(`Cycle detected: #/${i.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const r of e.seen.entries()){const i=r[1];if(t===r[0]){a(r);continue}if(e.external){const u=e.external.registry.get(r[0])?.id;if(t!==r[0]&&u){a(r);continue}}if(e.metadataRegistry.get(r[0])?.id){a(r);continue}if(i.cycle){a(r);continue}if(i.count>1&&e.reused==="ref"){a(r);continue}}}function to(e,t){const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=r=>{const i=e.seen.get(r);if(i.ref===null)return;const l=i.def??i.schema,u={...l},c=i.ref;if(i.ref=null,c){o(c);const p=e.seen.get(c),m=p.schema;if(m.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(l.allOf=l.allOf??[],l.allOf.push(m)):Object.assign(l,m),Object.assign(l,u),r._zod.parent===c)for(const _ in l)_==="$ref"||_==="allOf"||_ in u||delete l[_];if(m.$ref)for(const _ in l)_==="$ref"||_==="allOf"||_ in p.def&&JSON.stringify(l[_])===JSON.stringify(p.def[_])&&delete l[_]}const d=r._zod.parent;if(d&&d!==c){o(d);const p=e.seen.get(d);if(p?.schema.$ref&&(l.$ref=p.schema.$ref,p.def))for(const m in l)m==="$ref"||m==="allOf"||m in p.def&&JSON.stringify(l[m])===JSON.stringify(p.def[m])&&delete l[m]}e.override({zodSchema:r,jsonSchema:l,path:i.path??[]})};for(const r of[...e.seen.entries()].reverse())o(r[0]);const s={};if(e.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const r=e.external.registry.get(t)?.id;if(!r)throw new Error("Schema is missing an `id` property");s.$id=e.external.uri(r)}Object.assign(s,n.def??n.schema);const a=e.external?.defs??{};for(const r of e.seen.entries()){const i=r[1];i.def&&i.defId&&(a[i.defId]=i.def)}e.external||Object.keys(a).length>0&&(e.target==="draft-2020-12"?s.$defs=a:s.definitions=a);try{const r=JSON.parse(JSON.stringify(s));return Object.defineProperty(r,"~standard",{value:{...t["~standard"],jsonSchema:{input:no(t,"input",e.processors),output:no(t,"output",e.processors)}},enumerable:!1,writable:!1}),r}catch{throw new Error("Error converting schema to JSON.")}}function Je(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const o=e._zod.def;if(o.type==="transform")return!0;if(o.type==="array")return Je(o.element,n);if(o.type==="set")return Je(o.valueType,n);if(o.type==="lazy")return Je(o.getter(),n);if(o.type==="promise"||o.type==="optional"||o.type==="nonoptional"||o.type==="nullable"||o.type==="readonly"||o.type==="default"||o.type==="prefault")return Je(o.innerType,n);if(o.type==="intersection")return Je(o.left,n)||Je(o.right,n);if(o.type==="record"||o.type==="map")return Je(o.keyType,n)||Je(o.valueType,n);if(o.type==="pipe")return Je(o.in,n)||Je(o.out,n);if(o.type==="object"){for(const s in o.shape)if(Je(o.shape[s],n))return!0;return!1}if(o.type==="union"){for(const s of o.options)if(Je(s,n))return!0;return!1}if(o.type==="tuple"){for(const s of o.items)if(Je(s,n))return!0;return!!(o.rest&&Je(o.rest,n))}return!1}const ph=(e,t={})=>n=>{const o=Xn({...n,processors:t});return Ie(e,o),eo(o,e),to(o,e)},no=(e,t,n={})=>o=>{const{libraryOptions:s,target:a}=o??{},r=Xn({...s??{},target:a,io:t,processors:n});return Ie(e,r),eo(r,e),to(r,e)},fh={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},xi=(e,t,n,o)=>{const s=n;s.type="string";const{minimum:a,maximum:r,format:i,patterns:l,contentEncoding:u}=e._zod.bag;if(typeof a=="number"&&(s.minLength=a),typeof r=="number"&&(s.maxLength=r),i&&(s.format=fh[i]??i,s.format===""&&delete s.format,i==="time"&&delete s.format),u&&(s.contentEncoding=u),l&&l.size>0){const c=[...l];c.length===1?s.pattern=c[0].source:c.length>1&&(s.allOf=[...c.map(d=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},Si=(e,t,n,o)=>{const s=n,{minimum:a,maximum:r,format:i,multipleOf:l,exclusiveMaximum:u,exclusiveMinimum:c}=e._zod.bag;typeof i=="string"&&i.includes("int")?s.type="integer":s.type="number",typeof c=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.minimum=c,s.exclusiveMinimum=!0):s.exclusiveMinimum=c),typeof a=="number"&&(s.minimum=a,typeof c=="number"&&t.target!=="draft-04"&&(c>=a?delete s.minimum:delete s.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.maximum=u,s.exclusiveMaximum=!0):s.exclusiveMaximum=u),typeof r=="number"&&(s.maximum=r,typeof u=="number"&&t.target!=="draft-04"&&(u<=r?delete s.maximum:delete s.exclusiveMaximum)),typeof l=="number"&&(s.multipleOf=l)},Ti=(e,t,n,o)=>{n.type="boolean"},mh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},hh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},gh=(e,t,n,o)=>{t.target==="openapi-3.0"?(n.type="string",n.nullable=!0,n.enum=[null]):n.type="null"},yh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},vh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},Ci=(e,t,n,o)=>{n.not={}},Ai=(e,t,n,o)=>{},Di=(e,t,n,o)=>{},_h=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},$i=(e,t,n,o)=>{const s=e._zod.def,a=oi(s.entries);a.every(r=>typeof r=="number")&&(n.type="number"),a.every(r=>typeof r=="string")&&(n.type="string"),n.enum=a},Ei=(e,t,n,o)=>{const s=e._zod.def,a=[];for(const r of s.values)if(r===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof r=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");a.push(Number(r))}else a.push(r);if(a.length!==0)if(a.length===1){const r=a[0];n.type=r===null?"null":typeof r,t.target==="draft-04"||t.target==="openapi-3.0"?n.enum=[r]:n.const=r}else a.every(r=>typeof r=="number")&&(n.type="number"),a.every(r=>typeof r=="string")&&(n.type="string"),a.every(r=>typeof r=="boolean")&&(n.type="boolean"),a.every(r=>r===null)&&(n.type="null"),n.enum=a},wh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},bh=(e,t,n,o)=>{const s=n,a=e._zod.pattern;if(!a)throw new Error("Pattern not found in template literal");s.type="string",s.pattern=a.source},kh=(e,t,n,o)=>{const s=n,a={type:"string",format:"binary",contentEncoding:"binary"},{minimum:r,maximum:i,mime:l}=e._zod.bag;r!==void 0&&(a.minLength=r),i!==void 0&&(a.maxLength=i),l?l.length===1?(a.contentMediaType=l[0],Object.assign(s,a)):(Object.assign(s,a),s.anyOf=l.map(u=>({contentMediaType:u}))):Object.assign(s,a)},Ih=(e,t,n,o)=>{n.type="boolean"},Ui=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},xh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},Oi=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Sh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},Th=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},Ri=(e,t,n,o)=>{const s=n,a=e._zod.def,{minimum:r,maximum:i}=e._zod.bag;typeof r=="number"&&(s.minItems=r),typeof i=="number"&&(s.maxItems=i),s.type="array",s.items=Ie(a.element,t,{...o,path:[...o.path,"items"]})},Pi=(e,t,n,o)=>{const s=n,a=e._zod.def;s.type="object",s.properties={};const r=a.shape;for(const u in r)s.properties[u]=Ie(r[u],t,{...o,path:[...o.path,"properties",u]});const i=new Set(Object.keys(r)),l=new Set([...i].filter(u=>{const c=a.shape[u]._zod;return t.io==="input"?c.optin===void 0:c.optout===void 0}));l.size>0&&(s.required=Array.from(l)),a.catchall?._zod.def.type==="never"?s.additionalProperties=!1:a.catchall?a.catchall&&(s.additionalProperties=Ie(a.catchall,t,{...o,path:[...o.path,"additionalProperties"]})):t.io==="output"&&(s.additionalProperties=!1)},Mi=(e,t,n,o)=>{const s=e._zod.def,a=s.inclusive===!1,r=s.options.map((i,l)=>Ie(i,t,{...o,path:[...o.path,a?"oneOf":"anyOf",l]}));a?n.oneOf=r:n.anyOf=r},Li=(e,t,n,o)=>{const s=e._zod.def,a=Ie(s.left,t,{...o,path:[...o.path,"allOf",0]}),r=Ie(s.right,t,{...o,path:[...o.path,"allOf",1]}),i=u=>"allOf"in u&&Object.keys(u).length===1,l=[...i(a)?a.allOf:[a],...i(r)?r.allOf:[r]];n.allOf=l},Ch=(e,t,n,o)=>{const s=n,a=e._zod.def;s.type="array";const r=t.target==="draft-2020-12"?"prefixItems":"items",i=t.target==="draft-2020-12"||t.target==="openapi-3.0"?"items":"additionalItems",l=a.items.map((p,m)=>Ie(p,t,{...o,path:[...o.path,r,m]})),u=a.rest?Ie(a.rest,t,{...o,path:[...o.path,i,...t.target==="openapi-3.0"?[a.items.length]:[]]}):null;t.target==="draft-2020-12"?(s.prefixItems=l,u&&(s.items=u)):t.target==="openapi-3.0"?(s.items={anyOf:l},u&&s.items.anyOf.push(u),s.minItems=l.length,u||(s.maxItems=l.length)):(s.items=l,u&&(s.additionalItems=u));const{minimum:c,maximum:d}=e._zod.bag;typeof c=="number"&&(s.minItems=c),typeof d=="number"&&(s.maxItems=d)},Ni=(e,t,n,o)=>{const s=n,a=e._zod.def;s.type="object";const r=a.keyType,l=r._zod.bag?.patterns;if(a.mode==="loose"&&l&&l.size>0){const c=Ie(a.valueType,t,{...o,path:[...o.path,"patternProperties","*"]});s.patternProperties={};for(const d of l)s.patternProperties[d.source]=c}else(t.target==="draft-07"||t.target==="draft-2020-12")&&(s.propertyNames=Ie(a.keyType,t,{...o,path:[...o.path,"propertyNames"]})),s.additionalProperties=Ie(a.valueType,t,{...o,path:[...o.path,"additionalProperties"]});const u=r._zod.values;if(u){const c=[...u].filter(d=>typeof d=="string"||typeof d=="number");c.length>0&&(s.required=c)}},zi=(e,t,n,o)=>{const s=e._zod.def,a=Ie(s.innerType,t,o),r=t.seen.get(e);t.target==="openapi-3.0"?(r.ref=s.innerType,n.nullable=!0):n.anyOf=[a,{type:"null"}]},Fi=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType},Bi=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType,n.default=JSON.parse(JSON.stringify(s.defaultValue))},Zi=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType,t.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},ji=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType;let r;try{r=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=r},qi=(e,t,n,o)=>{const s=e._zod.def,a=t.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;Ie(a,t,o);const r=t.seen.get(e);r.ref=a},Ji=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType,n.readOnly=!0},Ah=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType},$s=(e,t,n,o)=>{const s=e._zod.def;Ie(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType},Vi=(e,t,n,o)=>{const s=e._zod.innerType;Ie(s,t,o);const a=t.seen.get(e);a.ref=s},Cr={string:xi,number:Si,boolean:Ti,bigint:mh,symbol:hh,null:gh,undefined:yh,void:vh,never:Ci,any:Ai,unknown:Di,date:_h,enum:$i,literal:Ei,nan:wh,template_literal:bh,file:kh,success:Ih,custom:Ui,function:xh,transform:Oi,map:Sh,set:Th,array:Ri,object:Pi,union:Mi,intersection:Li,tuple:Ch,record:Ni,nullable:zi,nonoptional:Fi,default:Bi,prefault:Zi,catch:ji,pipe:qi,readonly:Ji,promise:Ah,optional:$s,lazy:Vi};function Dh(e,t){if("_idmap"in e){const o=e,s=Xn({...t,processors:Cr}),a={};for(const l of o._idmap.entries()){const[u,c]=l;Ie(c,s)}const r={},i={registry:o,uri:t?.uri,defs:a};s.external=i;for(const l of o._idmap.entries()){const[u,c]=l;eo(s,c),r[u]=to(s,c)}if(Object.keys(a).length>0){const l=s.target==="draft-2020-12"?"$defs":"definitions";r.__shared={[l]:a}}return{schemas:r}}const n=Xn({...t,processors:Cr});return Ie(e,n),eo(n,e),to(n,e)}const $h=$("ZodISODateTime",(e,t)=>{Of.init(e,t),$e.init(e,t)});function Eh(e){return Bm($h,e)}const Uh=$("ZodISODate",(e,t)=>{Rf.init(e,t),$e.init(e,t)});function Oh(e){return Zm(Uh,e)}const Rh=$("ZodISOTime",(e,t)=>{Pf.init(e,t),$e.init(e,t)});function Ph(e){return jm(Rh,e)}const Mh=$("ZodISODuration",(e,t)=>{Mf.init(e,t),$e.init(e,t)});function Lh(e){return qm(Mh,e)}const Hi=(e,t)=>{ii.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Sp(e,n)},flatten:{value:n=>xp(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,Xo,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,Xo,2)}},isEmpty:{get(){return e.issues.length===0}}})},Nh=$("ZodError",Hi),nt=$("ZodError",Hi,{Parent:Error}),zh=Cs(nt),Fh=As(nt),Bh=vo(nt),Zh=_o(nt),jh=Ap(nt),qh=Dp(nt),Jh=$p(nt),Vh=Ep(nt),Hh=Up(nt),Gh=Op(nt),Wh=Rp(nt),Kh=Pp(nt),Te=$("ZodType",(e,t)=>(Se.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:no(e,"input"),output:no(e,"output")}}),e.toJSONSchema=ph(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(Lt(t,{checks:[...t.checks??[],...n.map(o=>typeof o=="function"?{_zod:{check:o,def:{check:"custom"},onattach:[]}}:o)]}),{parent:!0}),e.with=e.check,e.clone=(n,o)=>Nt(e,n,o),e.brand=()=>e,e.register=((n,o)=>(n.add(e,o),e)),e.parse=(n,o)=>zh(e,n,o,{callee:e.parse}),e.safeParse=(n,o)=>Bh(e,n,o),e.parseAsync=async(n,o)=>Fh(e,n,o,{callee:e.parseAsync}),e.safeParseAsync=async(n,o)=>Zh(e,n,o),e.spa=e.safeParseAsync,e.encode=(n,o)=>jh(e,n,o),e.decode=(n,o)=>qh(e,n,o),e.encodeAsync=async(n,o)=>Jh(e,n,o),e.decodeAsync=async(n,o)=>Vh(e,n,o),e.safeEncode=(n,o)=>Hh(e,n,o),e.safeDecode=(n,o)=>Gh(e,n,o),e.safeEncodeAsync=async(n,o)=>Wh(e,n,o),e.safeDecodeAsync=async(n,o)=>Kh(e,n,o),e.refine=(n,o)=>e.check(Jg(n,o)),e.superRefine=n=>e.check(Vg(n)),e.overwrite=n=>e.check(pn(n)),e.optional=()=>Er(e),e.exactOptional=()=>Eg(e),e.nullable=()=>Ur(e),e.nullish=()=>Er(Ur(e)),e.nonoptional=n=>Lg(e,n),e.array=()=>se(e),e.or=n=>ht([e,n]),e.and=n=>Sg(e,n),e.transform=n=>Or(e,Dg(n)),e.default=n=>Rg(e,n),e.prefault=n=>Mg(e,n),e.catch=n=>zg(e,n),e.pipe=n=>Or(e,n),e.readonly=()=>Zg(e),e.describe=n=>{const o=e.clone();return bn.add(o,{description:n}),o},Object.defineProperty(e,"description",{get(){return bn.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return bn.get(e);const o=e.clone();return bn.add(o,n[0]),o},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=n=>n(e),e)),Gi=$("_ZodString",(e,t)=>{Ds.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(o,s,a)=>xi(e,o,s);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...o)=>e.check(Ym(...o)),e.includes=(...o)=>e.check(eh(...o)),e.startsWith=(...o)=>e.check(th(...o)),e.endsWith=(...o)=>e.check(nh(...o)),e.min=(...o)=>e.check(Qn(...o)),e.max=(...o)=>e.check(ki(...o)),e.length=(...o)=>e.check(Ii(...o)),e.nonempty=(...o)=>e.check(Qn(1,...o)),e.lowercase=o=>e.check(Qm(o)),e.uppercase=o=>e.check(Xm(o)),e.trim=()=>e.check(sh()),e.normalize=(...o)=>e.check(oh(...o)),e.toLowerCase=()=>e.check(rh()),e.toUpperCase=()=>e.check(ah()),e.slugify=()=>e.check(ih())}),Yh=$("ZodString",(e,t)=>{Ds.init(e,t),Gi.init(e,t),e.email=n=>e.check(wm(Qh,n)),e.url=n=>e.check(Sm(Xh,n)),e.jwt=n=>e.check(Fm(mg,n)),e.emoji=n=>e.check(Tm(eg,n)),e.guid=n=>e.check(Ir(Ar,n)),e.uuid=n=>e.check(bm(jn,n)),e.uuidv4=n=>e.check(km(jn,n)),e.uuidv6=n=>e.check(Im(jn,n)),e.uuidv7=n=>e.check(xm(jn,n)),e.nanoid=n=>e.check(Cm(tg,n)),e.guid=n=>e.check(Ir(Ar,n)),e.cuid=n=>e.check(Am(ng,n)),e.cuid2=n=>e.check(Dm(og,n)),e.ulid=n=>e.check($m(sg,n)),e.base64=n=>e.check(Lm(dg,n)),e.base64url=n=>e.check(Nm(pg,n)),e.xid=n=>e.check(Em(rg,n)),e.ksuid=n=>e.check(Um(ag,n)),e.ipv4=n=>e.check(Om(ig,n)),e.ipv6=n=>e.check(Rm(ug,n)),e.cidrv4=n=>e.check(Pm(lg,n)),e.cidrv6=n=>e.check(Mm(cg,n)),e.e164=n=>e.check(zm(fg,n)),e.datetime=n=>e.check(Eh(n)),e.date=n=>e.check(Oh(n)),e.time=n=>e.check(Ph(n)),e.duration=n=>e.check(Lh(n))});function f(e){return _m(Yh,e)}const $e=$("ZodStringFormat",(e,t)=>{Ce.init(e,t),Gi.init(e,t)}),Qh=$("ZodEmail",(e,t)=>{xf.init(e,t),$e.init(e,t)}),Ar=$("ZodGUID",(e,t)=>{kf.init(e,t),$e.init(e,t)}),jn=$("ZodUUID",(e,t)=>{If.init(e,t),$e.init(e,t)}),Xh=$("ZodURL",(e,t)=>{Sf.init(e,t),$e.init(e,t)}),eg=$("ZodEmoji",(e,t)=>{Tf.init(e,t),$e.init(e,t)}),tg=$("ZodNanoID",(e,t)=>{Cf.init(e,t),$e.init(e,t)}),ng=$("ZodCUID",(e,t)=>{Af.init(e,t),$e.init(e,t)}),og=$("ZodCUID2",(e,t)=>{Df.init(e,t),$e.init(e,t)}),sg=$("ZodULID",(e,t)=>{$f.init(e,t),$e.init(e,t)}),rg=$("ZodXID",(e,t)=>{Ef.init(e,t),$e.init(e,t)}),ag=$("ZodKSUID",(e,t)=>{Uf.init(e,t),$e.init(e,t)}),ig=$("ZodIPv4",(e,t)=>{Lf.init(e,t),$e.init(e,t)}),ug=$("ZodIPv6",(e,t)=>{Nf.init(e,t),$e.init(e,t)}),lg=$("ZodCIDRv4",(e,t)=>{zf.init(e,t),$e.init(e,t)}),cg=$("ZodCIDRv6",(e,t)=>{Ff.init(e,t),$e.init(e,t)}),dg=$("ZodBase64",(e,t)=>{Bf.init(e,t),$e.init(e,t)}),pg=$("ZodBase64URL",(e,t)=>{jf.init(e,t),$e.init(e,t)}),fg=$("ZodE164",(e,t)=>{qf.init(e,t),$e.init(e,t)}),mg=$("ZodJWT",(e,t)=>{Vf.init(e,t),$e.init(e,t)}),Wi=$("ZodNumber",(e,t)=>{yi.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(o,s,a)=>Si(e,o,s),e.gt=(o,s)=>e.check(Sr(o,s)),e.gte=(o,s)=>e.check(Fo(o,s)),e.min=(o,s)=>e.check(Fo(o,s)),e.lt=(o,s)=>e.check(xr(o,s)),e.lte=(o,s)=>e.check(zo(o,s)),e.max=(o,s)=>e.check(zo(o,s)),e.int=o=>e.check(Dr(o)),e.safe=o=>e.check(Dr(o)),e.positive=o=>e.check(Sr(0,o)),e.nonnegative=o=>e.check(Fo(0,o)),e.negative=o=>e.check(xr(0,o)),e.nonpositive=o=>e.check(zo(0,o)),e.multipleOf=(o,s)=>e.check(Tr(o,s)),e.step=(o,s)=>e.check(Tr(o,s)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function N(e){return Jm(Wi,e)}const hg=$("ZodNumberFormat",(e,t)=>{Hf.init(e,t),Wi.init(e,t)});function Dr(e){return Vm(hg,e)}const gg=$("ZodBoolean",(e,t)=>{Gf.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ti(e,n,o)});function Jt(e){return Hm(gg,e)}const yg=$("ZodAny",(e,t)=>{Wf.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ai()});function ae(){return Gm(yg)}const vg=$("ZodUnknown",(e,t)=>{Kf.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Di()});function $r(){return Wm(vg)}const _g=$("ZodNever",(e,t)=>{Yf.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ci(e,n,o)});function wg(e){return Km(_g,e)}const bg=$("ZodArray",(e,t)=>{Qf.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ri(e,n,o,s),e.element=t.element,e.min=(n,o)=>e.check(Qn(n,o)),e.nonempty=n=>e.check(Qn(1,n)),e.max=(n,o)=>e.check(ki(n,o)),e.length=(n,o)=>e.check(Ii(n,o)),e.unwrap=()=>e.element});function se(e,t){return uh(bg,e,t)}const kg=$("ZodObject",(e,t)=>{em.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Pi(e,n,o,s),de(e,"shape",()=>t.shape),e.keyof=()=>Re(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:$r()}),e.loose=()=>e.clone({...e._zod.def,catchall:$r()}),e.strict=()=>e.clone({...e._zod.def,catchall:wg()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>_p(e,n),e.safeExtend=n=>wp(e,n),e.merge=n=>bp(e,n),e.pick=n=>yp(e,n),e.omit=n=>vp(e,n),e.partial=(...n)=>kp(Yi,e,n[0]),e.required=(...n)=>Ip(Qi,e,n[0])});function T(e,t){const n={type:"object",shape:e??{},...Q(t)};return new kg(n)}const Ki=$("ZodUnion",(e,t)=>{wi.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Mi(e,n,o,s),e.options=t.options});function ht(e,t){return new Ki({type:"union",options:e,...Q(t)})}const Ig=$("ZodDiscriminatedUnion",(e,t)=>{Ki.init(e,t),tm.init(e,t)});function je(e,t,n){return new Ig({type:"union",options:t,discriminator:e,...Q(n)})}const xg=$("ZodIntersection",(e,t)=>{nm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Li(e,n,o,s)});function Sg(e,t){return new xg({type:"intersection",left:e,right:t})}const Tg=$("ZodRecord",(e,t)=>{om.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ni(e,n,o,s),e.keyType=t.keyType,e.valueType=t.valueType});function we(e,t,n){return new Tg({type:"record",keyType:e,valueType:t,...Q(n)})}const ts=$("ZodEnum",(e,t)=>{sm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(o,s,a)=>$i(e,o,s),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(o,s)=>{const a={};for(const r of o)if(n.has(r))a[r]=t.entries[r];else throw new Error(`Key ${r} not found in enum`);return new ts({...t,checks:[],...Q(s),entries:a})},e.exclude=(o,s)=>{const a={...t.entries};for(const r of o)if(n.has(r))delete a[r];else throw new Error(`Key ${r} not found in enum`);return new ts({...t,checks:[],...Q(s),entries:a})}});function Re(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,o])):e;return new ts({type:"enum",entries:n,...Q(t)})}const Cg=$("ZodLiteral",(e,t)=>{rm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ei(e,n,o),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function C(e,t){return new Cg({type:"literal",values:Array.isArray(e)?e:[e],...Q(t)})}const Ag=$("ZodTransform",(e,t)=>{am.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Oi(e,n),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new ti(e.constructor.name);n.addIssue=a=>{if(typeof a=="string")n.issues.push(Cn(a,n.value,t));else{const r=a;r.fatal&&(r.continue=!1),r.code??(r.code="custom"),r.input??(r.input=n.value),r.inst??(r.inst=e),n.issues.push(Cn(r))}};const s=t.transform(n.value,n);return s instanceof Promise?s.then(a=>(n.value=a,n)):(n.value=s,n)}});function Dg(e){return new Ag({type:"transform",transform:e})}const Yi=$("ZodOptional",(e,t)=>{bi.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>$s(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Er(e){return new Yi({type:"optional",innerType:e})}const $g=$("ZodExactOptional",(e,t)=>{im.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>$s(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Eg(e){return new $g({type:"optional",innerType:e})}const Ug=$("ZodNullable",(e,t)=>{um.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>zi(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Ur(e){return new Ug({type:"nullable",innerType:e})}const Og=$("ZodDefault",(e,t)=>{lm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Bi(e,n,o,s),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Rg(e,t){return new Og({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():ri(t)}})}const Pg=$("ZodPrefault",(e,t)=>{cm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Zi(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Mg(e,t){return new Pg({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():ri(t)}})}const Qi=$("ZodNonOptional",(e,t)=>{dm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Fi(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Lg(e,t){return new Qi({type:"nonoptional",innerType:e,...Q(t)})}const Ng=$("ZodCatch",(e,t)=>{pm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>ji(e,n,o,s),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function zg(e,t){return new Ng({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Fg=$("ZodPipe",(e,t)=>{fm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>qi(e,n,o,s),e.in=t.in,e.out=t.out});function Or(e,t){return new Fg({type:"pipe",in:e,out:t})}const Bg=$("ZodReadonly",(e,t)=>{mm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ji(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Zg(e){return new Bg({type:"readonly",innerType:e})}const jg=$("ZodLazy",(e,t)=>{hm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Vi(e,n,o,s),e.unwrap=()=>e._zod.def.getter()});function qg(e){return new jg({type:"lazy",getter:e})}const Xi=$("ZodCustom",(e,t)=>{gm.init(e,t),Te.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Ui(e,n)});function Jg(e,t={}){return lh(Xi,e,t)}function Vg(e){return ch(e)}function eu(e,t={}){const n=new Xi({type:"custom",check:"custom",fn:o=>o instanceof e,abort:!0,...Q(t)});return n._zod.bag.Class=e,n._zod.check=o=>{o.value instanceof e||o.issues.push({code:"invalid_type",expected:e.name,input:o.value,inst:n,path:[...n._zod.def.path??[]]})},n}function Hg(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}const Gg=Symbol("Let zodToJsonSchema decide on which parser to use"),Rr={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Wg=e=>typeof e=="string"?{...Rr,basePath:["#"],definitions:{},name:e}:{...Rr,basePath:["#"],definitions:{},...e},ns=e=>"_def"in e?e._def:e;function Kg(e){if(!e)return!0;for(const t in e)return!1;return!0}const Yg=e=>{const t=Wg(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([o,s])=>[ns(s),{def:ns(s),path:[...t.basePath,t.definitionPath,o],jsonSchema:void 0}]))}};function tu(e,t,n,o){o?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function ye(e,t,n,o,s){e[t]=n,tu(e,t,o,s)}var An;(function(e){e.assertEqual=s=>{};function t(s){}e.assertIs=t;function n(s){throw new Error}e.assertNever=n,e.arrayToEnum=s=>{const a={};for(const r of s)a[r]=r;return a},e.getValidEnumValues=s=>{const a=e.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),r={};for(const i of a)r[i]=s[i];return e.objectValues(r)},e.objectValues=s=>e.objectKeys(s).map(function(a){return s[a]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&a.push(r);return a},e.find=(s,a)=>{for(const r of s)if(a(r))return r},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function o(s,a=" | "){return s.map(r=>typeof r=="string"?`'${r}'`:r).join(a)}e.joinValues=o,e.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(An||(An={}));var Pr;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(Pr||(Pr={}));An.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);An.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class oo extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=o=>{this.issues=[...this.issues,o]},this.addIssues=(o=[])=>{this.issues=[...this.issues,...o]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(a){return a.message},o={_errors:[]},s=a=>{for(const r of a.issues)if(r.code==="invalid_union")r.unionErrors.map(s);else if(r.code==="invalid_return_type")s(r.returnTypeError);else if(r.code==="invalid_arguments")s(r.argumentsError);else if(r.path.length===0)o._errors.push(n(r));else{let i=o,l=0;for(;l<r.path.length;){const u=r.path[l];l===r.path.length-1?(i[u]=i[u]||{_errors:[]},i[u]._errors.push(n(r))):i[u]=i[u]||{_errors:[]},i=i[u],l++}}};return s(this),o}static assert(t){if(!(t instanceof oo))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,An.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n=Object.create(null),o=[];for(const s of this.issues)if(s.path.length>0){const a=s.path[0];n[a]=n[a]||[],n[a].push(t(s))}else o.push(t(s));return{formErrors:o,fieldErrors:n}}get formErrors(){return this.flatten()}}oo.create=e=>new oo(e);var Mr;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(Mr||(Mr={}));var re;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(re||(re={}));function Qg(){return{}}function Xg(e,t){const n={type:"array"};return e.type?._def?.typeName!==re.ZodAny&&(n.items=pe(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&ye(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&ye(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(ye(n,"minItems",e.exactLength.value,e.exactLength.message,t),ye(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function ey(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const o of e.checks)switch(o.kind){case"min":t.target==="jsonSchema7"?o.inclusive?ye(n,"minimum",o.value,o.message,t):ye(n,"exclusiveMinimum",o.value,o.message,t):(o.inclusive||(n.exclusiveMinimum=!0),ye(n,"minimum",o.value,o.message,t));break;case"max":t.target==="jsonSchema7"?o.inclusive?ye(n,"maximum",o.value,o.message,t):ye(n,"exclusiveMaximum",o.value,o.message,t):(o.inclusive||(n.exclusiveMaximum=!0),ye(n,"maximum",o.value,o.message,t));break;case"multipleOf":ye(n,"multipleOf",o.value,o.message,t);break}return n}function ty(){return{type:"boolean"}}function ny(e,t){return pe(e.type._def,t)}const oy=(e,t)=>pe(e.innerType._def,t);function nu(e,t,n){const o=n??t.dateStrategy;if(Array.isArray(o))return{anyOf:o.map((s,a)=>nu(e,t,s))};switch(o){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return sy(e,t)}}const sy=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const o of e.checks)switch(o.kind){case"min":ye(n,"minimum",o.value,o.message,t);break;case"max":ye(n,"maximum",o.value,o.message,t);break}return n};function ry(e,t){return{...pe(e.innerType._def,t),default:e.defaultValue()}}function ay(e,t,n){return t.effectStrategy==="input"?pe(e.schema._def,t,n):{}}function iy(e){return{type:"string",enum:[...e.values]}}const uy=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function ly(e,t){const n=[pe(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),pe(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a);let o=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(uy(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(o=void 0);else{let r=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:i,...l}=a;r=l}else o=void 0;s.push(r)}}),s.length?{allOf:s,...o}:void 0}function cy(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let Bo;const Ft={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Bo===void 0&&(Bo=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Bo),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function ou(e,t){const n={type:"string"};function o(s){return t.patternStrategy==="escape"?dy(s):s}if(e.checks)for(const s of e.checks)switch(s.kind){case"min":ye(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,t);break;case"max":ye(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,t);break;case"email":switch(t.emailStrategy){case"format:email":rt(n,"email",s.message,t);break;case"format:idn-email":rt(n,"idn-email",s.message,t);break;case"pattern:zod":at(n,Ft.email,s.message,t);break}break;case"url":rt(n,"uri",s.message,t);break;case"uuid":rt(n,"uuid",s.message,t);break;case"regex":at(n,s.regex,s.message,t);break;case"cuid":at(n,Ft.cuid,s.message,t);break;case"cuid2":at(n,Ft.cuid2,s.message,t);break;case"startsWith":at(n,RegExp(`^${o(s.value)}`),s.message,t);break;case"endsWith":at(n,RegExp(`${o(s.value)}$`),s.message,t);break;case"datetime":rt(n,"date-time",s.message,t);break;case"date":rt(n,"date",s.message,t);break;case"time":rt(n,"time",s.message,t);break;case"duration":rt(n,"duration",s.message,t);break;case"length":ye(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,t),ye(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,t);break;case"includes":{at(n,RegExp(o(s.value)),s.message,t);break}case"ip":{s.version!=="v6"&&rt(n,"ipv4",s.message,t),s.version!=="v4"&&rt(n,"ipv6",s.message,t);break}case"emoji":at(n,Ft.emoji,s.message,t);break;case"ulid":{at(n,Ft.ulid,s.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{rt(n,"binary",s.message,t);break}case"contentEncoding:base64":{ye(n,"contentEncoding","base64",s.message,t);break}case"pattern:zod":{at(n,Ft.base64,s.message,t);break}}break}case"nanoid":at(n,Ft.nanoid,s.message,t)}return n}const dy=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),rt=(e,t,n,o)=>{e.format||e.anyOf?.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&o.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&o.errorMessages&&{errorMessage:{format:n}}})):ye(e,"format",t,n,o)},at=(e,t,n,o)=>{e.pattern||e.allOf?.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&o.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Lr(t,o),...n&&o.errorMessages&&{errorMessage:{pattern:n}}})):ye(e,"pattern",Lr(t,o),n,o)},Lr=(e,t)=>{const n=typeof e=="function"?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const o={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},s=o.i?n.source.toLowerCase():n.source;let a="",r=!1,i=!1,l=!1;for(let u=0;u<s.length;u++){if(r){a+=s[u],r=!1;continue}if(o.i){if(i){if(s[u].match(/[a-z]/)){l?(a+=s[u],a+=`${s[u-2]}-${s[u]}`.toUpperCase(),l=!1):s[u+1]==="-"&&s[u+2]?.match(/[a-z]/)?(a+=s[u],l=!0):a+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){a+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(o.m){if(s[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(o.s&&s[u]==="."){a+=i?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}a+=s[u],s[u]==="\\"?r=!0:i&&s[u]==="]"?i=!1:!i&&s[u]==="["&&(i=!0)}try{const u=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a};function su(e,t){if(t.target==="openApi3"&&e.keyType?._def.typeName===re.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((o,s)=>({...o,[s]:pe(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:pe(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(e.keyType?._def.typeName===re.ZodString&&e.keyType._def.checks?.length){const o=Object.entries(ou(e.keyType._def,t)).reduce((s,[a,r])=>a==="type"?s:{...s,[a]:r},{});return{...n,propertyNames:o}}else if(e.keyType?._def.typeName===re.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};return n}function py(e,t){if(t.mapStrategy==="record")return su(e,t);const n=pe(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},o=pe(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,o],minItems:2,maxItems:2}}}function fy(e){const t=e.values,o=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),s=Array.from(new Set(o.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:o}}function my(){return{not:{}}}function hy(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const so={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function gy(e,t){if(t.target==="openApi3")return Nr(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(o=>o._def.typeName in so&&(!o._def.checks||!o._def.checks.length))){const o=n.reduce((s,a)=>{const r=so[a._def.typeName];return r&&!s.includes(r)?[...s,r]:s},[]);return{type:o.length>1?o:o[0]}}else if(n.every(o=>o._def.typeName==="ZodLiteral"&&!o.description)){const o=n.reduce((s,a)=>{const r=typeof a._def.value;switch(r){case"string":case"number":case"boolean":return[...s,r];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];default:return s}},[]);if(o.length===n.length){const s=o.filter((a,r,i)=>i.indexOf(a)===r);return{type:s.length>1?s:s[0],enum:n.reduce((a,r)=>a.includes(r._def.value)?a:[...a,r._def.value],[])}}}else if(n.every(o=>o._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((o,s)=>[...o,...s._def.values.filter(a=>!o.includes(a))],[])};return Nr(e,t)}const Nr=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((o,s)=>pe(o._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(o=>!!o&&(!t.strictUnions||typeof o=="object"&&Object.keys(o).length>0));return n.length?{anyOf:n}:void 0};function yy(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"||t.nullableStrategy==="property"?{type:so[e.innerType._def.typeName],nullable:!0}:{type:[so[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const o=pe(e.innerType._def,{...t,currentPath:[...t.currentPath]});return o&&"$ref"in o?{allOf:[o],nullable:!0}:o&&{...o,nullable:!0}}const n=pe(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function vy(e,t){const n={type:"number"};if(!e.checks)return n;for(const o of e.checks)switch(o.kind){case"int":n.type="integer",tu(n,"type",o.message,t);break;case"min":t.target==="jsonSchema7"?o.inclusive?ye(n,"minimum",o.value,o.message,t):ye(n,"exclusiveMinimum",o.value,o.message,t):(o.inclusive||(n.exclusiveMinimum=!0),ye(n,"minimum",o.value,o.message,t));break;case"max":t.target==="jsonSchema7"?o.inclusive?ye(n,"maximum",o.value,o.message,t):ye(n,"exclusiveMaximum",o.value,o.message,t):(o.inclusive||(n.exclusiveMaximum=!0),ye(n,"maximum",o.value,o.message,t));break;case"multipleOf":ye(n,"multipleOf",o.value,o.message,t);break}return n}function _y(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":pe(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":pe(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function wy(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((o,[s,a])=>{if(a===void 0||a._def===void 0)return o;const r=[...t.currentPath,"properties",s],i=pe(a._def,{...t,currentPath:r,propertyPath:r});if(i===void 0)return o;if(t.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&typeof a._def?.defaultValue>"u")throw new Error(`Zod field at \`${r.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...o.properties,[s]:i},required:a.isOptional()&&!t.openaiStrictMode?o.required:[...o.required,s]}},{properties:{},required:[]}),additionalProperties:_y(e,t)};return n.required.length||delete n.required,n}const by=(e,t)=>{if(t.propertyPath&&t.currentPath.slice(0,t.propertyPath.length).toString()===t.propertyPath.toString())return pe(e.innerType._def,{...t,currentPath:t.currentPath});const n=pe(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},ky=(e,t)=>{if(t.pipeStrategy==="input")return pe(e.in._def,t);if(t.pipeStrategy==="output")return pe(e.out._def,t);const n=pe(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),o=pe(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,o].filter(s=>s!==void 0)}};function Iy(e,t){return pe(e.type._def,t)}function xy(e,t){const o={type:"array",uniqueItems:!0,items:pe(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&ye(o,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&ye(o,"maxItems",e.maxSize.value,e.maxSize.message,t),o}function Sy(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,o)=>pe(n._def,{...t,currentPath:[...t.currentPath,"items",`${o}`]})).reduce((n,o)=>o===void 0?n:[...n,o],[]),additionalItems:pe(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,o)=>pe(n._def,{...t,currentPath:[...t.currentPath,"items",`${o}`]})).reduce((n,o)=>o===void 0?n:[...n,o],[])}}function Ty(){return{not:{}}}function Cy(){return{}}const Ay=(e,t)=>pe(e.innerType._def,t);function pe(e,t,n=!1){const o=t.seen.get(e);if(t.override){const r=t.override?.(e,t,o,n);if(r!==Gg)return r}if(o&&!n){const r=Dy(o,t);if(r!==void 0)return"$ref"in r&&t.seenRefs.add(r.$ref),r}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const a=Ey(e,e.typeName,t,n);return a&&Uy(e,t,a),s.jsonSchema=a,a}const Dy=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&t.nameStrategy==="duplicate-ref"&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:$y(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((o,s)=>t.currentPath[s]===o)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},$y=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},Ey=(e,t,n,o)=>{switch(t){case re.ZodString:return ou(e,n);case re.ZodNumber:return vy(e,n);case re.ZodObject:return wy(e,n);case re.ZodBigInt:return ey(e,n);case re.ZodBoolean:return ty();case re.ZodDate:return nu(e,n);case re.ZodUndefined:return Ty();case re.ZodNull:return hy(n);case re.ZodArray:return Xg(e,n);case re.ZodUnion:case re.ZodDiscriminatedUnion:return gy(e,n);case re.ZodIntersection:return ly(e,n);case re.ZodTuple:return Sy(e,n);case re.ZodRecord:return su(e,n);case re.ZodLiteral:return cy(e,n);case re.ZodEnum:return iy(e);case re.ZodNativeEnum:return fy(e);case re.ZodNullable:return yy(e,n);case re.ZodOptional:return by(e,n);case re.ZodMap:return py(e,n);case re.ZodSet:return xy(e,n);case re.ZodLazy:return pe(e.getter()._def,n);case re.ZodPromise:return Iy(e,n);case re.ZodNaN:case re.ZodNever:return my();case re.ZodEffects:return ay(e,n,o);case re.ZodAny:return Qg();case re.ZodUnknown:return Cy();case re.ZodDefault:return ry(e,n);case re.ZodBranded:return ny(e,n);case re.ZodReadonly:return Ay(e,n);case re.ZodCatch:return oy(e,n);case re.ZodPipeline:return ky(e,n);case re.ZodFunction:case re.ZodVoid:case re.ZodSymbol:return;default:return(s=>{})()}},Uy=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Oy=(e,t)=>{const n=Yg(t),o=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=pe(e._def,o===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,o]},!1)??{},a=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;a!==void 0&&(s.title=a);const r=(()=>{if(Kg(n.definitions))return;const l={},u=new Set;for(let c=0;c<500;c++){const d=Object.entries(n.definitions).filter(([p])=>!u.has(p));if(d.length===0)break;for(const[p,m]of d)l[p]=pe(ns(m),{...n,currentPath:[...n.basePath,n.definitionPath,p]},!0)??{},u.add(p)}return l})(),i=o===void 0?r?{...s,[n.definitionPath]:r}:s:n.nameStrategy==="duplicate-ref"?{...s,...r||n.seenRefs.size?{[n.definitionPath]:{...r,...n.seenRefs.size?{[o]:s}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,o].join("/"),[n.definitionPath]:{...r,[o]:s}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i};function Ry(e,{parser:t,callback:n}){const o={...e};return Object.defineProperties(o,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:t,enumerable:!1},$callback:{value:n,enumerable:!1}}),o}function Py(e){if(e.type!=="object")throw new Error(`Root schema must have type: 'object' but got type: ${e.type?`'${e.type}'`:"undefined"}`);const t=structuredClone(e);return It(t,[],t)}function os(e){if(typeof e=="boolean")return!1;if(e.type==="null")return!0;for(const t of e.oneOf??[])if(os(t))return!0;for(const t of e.anyOf??[])if(os(t))return!0;return!1}function It(e,t,n){if(typeof e=="boolean")throw new TypeError(`Expected object schema but got boolean; path=${t.join("/")}`);if(!Zt(e))throw new TypeError(`Expected ${JSON.stringify(e)} to be an object; path=${t.join("/")}`);const o=e.$defs;if(Zt(o))for(const[p,m]of Object.entries(o))It(m,[...t,"$defs",p],n);const s=e.definitions;if(Zt(s))for(const[p,m]of Object.entries(s))It(m,[...t,"definitions",p],n);e.type==="object"&&!("additionalProperties"in e)&&(e.additionalProperties=!1);const r=e.required??[],i=e.properties;if(Zt(i)){for(const[p,m]of Object.entries(i))if(!os(m)&&!r.includes(p))throw new Error(`Zod field at \`${[...t,"properties",p].join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);e.required=Object.keys(i),e.properties=Object.fromEntries(Object.entries(i).map(([p,m])=>[p,It(m,[...t,"properties",p],n)]))}const l=e.items;Zt(l)&&(e.items=It(l,[...t,"items"],n));const u=e.anyOf;Array.isArray(u)&&(e.anyOf=u.map((p,m)=>It(p,[...t,"anyOf",String(m)],n)));const c=e.allOf;if(Array.isArray(c))if(c.length===1){const p=It(c[0],[...t,"allOf","0"],n);Object.assign(e,p),delete e.allOf}else e.allOf=c.map((p,m)=>It(p,[...t,"allOf",String(m)],n));e.default===null&&delete e.default;const d=e.$ref;if(d&&Ly(e,1)){if(typeof d!="string")throw new TypeError(`Received non-string $ref - ${d}; path=${t.join("/")}`);const p=My(n,d);if(typeof p=="boolean")throw new Error(`Expected \`$ref: ${d}\` to resolve to an object schema but got boolean`);if(!Zt(p))throw new Error(`Expected \`$ref: ${d}\` to resolve to an object but got ${JSON.stringify(p)}`);return Object.assign(e,{...p,...e}),delete e.$ref,It(e,t,n)}return e}function My(e,t){if(!t.startsWith("#/"))throw new Error(`Unexpected $ref format ${JSON.stringify(t)}; Does not start with #/`);const n=t.slice(2).split("/");let o=e;for(const s of n){if(!Zt(o))throw new Error(`encountered non-object entry while resolving ${t} - ${JSON.stringify(o)}`);const a=o[s];if(a===void 0)throw new Error(`Key ${s} not found while resolving ${t}`);o=a}return o}function Zt(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Ly(e,t){let n=0;for(const o in e)if(n++,n>t)return!0;return!1}function ru(e,t){return Oy(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function au(e){return Py(Dh(e,{target:"draft-7"}))}function iu(e){return"_zod"in e}function Ny(e,t,n){return Hg({type:"json_schema",...n,name:t,strict:!0,schema:iu(e)?au(e):ru(e,{name:t})},o=>e.parse(JSON.parse(o)))}function zy(e){return Ry({type:"function",name:e.name,parameters:iu(e.parameters)?au(e.parameters):ru(e.parameters,{name:e.name}),strict:!0,...e.description?{description:e.description}:void 0},{callback:e.function,parser:t=>e.parameters.parse(JSON.parse(t))})}class zt extends Error{state;constructor(t,n){super(t),this.state=n}}class Fy extends zt{}class zr extends zt{}class Ge extends zt{}class _e extends zt{}class Fr extends zt{error;constructor(t,n,o){super(t,o),this.error=n}}class By extends zt{error;constructor(t,n,o){super(t,o),this.error=n}}class Br extends zt{result;constructor(t,n,o){super(t,o),this.result=n}}class ss extends zt{result;constructor(t,n,o){super(t,o),this.result=n}}function fn(e){if(typeof e!="object"||e===null)return;const t=e;return t._zod?.def||t._def||t.def}function bo(e){const t=fn(e);if(!t)return;const n=typeof t.typeName=="string"&&t.typeName||typeof t.type=="string"&&t.type;if(typeof n!="string")return;const o=n.toLowerCase();return o.startsWith("zod")?o.slice(3):o}function Vt(e){return fn(e)?bo(e)==="object":!1}function Zy(e){return typeof e=="object"&&e!==null&&"input"in e&&typeof e.input=="string"}const jy="http://json-schema.org/draft-07/schema#",qy=new Set(["optional"]),Jy=new Set(["brand","branded","catch","default","effects","pipeline","pipe","prefault","readonly","refinement","transform"]),Zr={string:{type:"string"},number:{type:"number"},bigint:{type:"integer"},boolean:{type:"boolean"},date:{type:"string",format:"date-time"}};function uu(e){return typeof e=="object"&&e!==null&&e.type==="object"&&"properties"in e&&"additionalProperties"in e}function Vy(e){const t=lu(e);if(t)return Array.isArray(t.required)||(t.required=[]),typeof t.additionalProperties>"u"&&(t.additionalProperties=!1),typeof t.$schema!="string"&&(t.$schema=jy),t}function lu(e){const t=sv(e);if(!t)return;const n={},o=[];for(const[s,a]of Object.entries(t)){const{schema:r,optional:i}=Hy(a);if(!r)return;n[s]=r,i||o.push(s)}return{type:"object",properties:n,required:o,additionalProperties:!1}}function Hy(e){let t=rs(e),n=!1;for(;qy.has(bo(t)??"");){n=!0;const o=fn(t),s=rs(o?.innerType);if(!s||s===t)break;t=s}return{schema:gt(t),optional:n}}function gt(e){if(e===void 0)return;const t=rs(e),n=bo(t),o=fn(t);if(n){if(n in Zr)return Zr[n];switch(n){case"object":return lu(t);case"array":return Gy(o);case"tuple":return Wy(o);case"union":return Ky(o);case"intersection":return Yy(o);case"literal":return nv(o);case"enum":case"nativeenum":return ov(o);case"record":return Qy(o);case"map":return Xy(o);case"set":return ev(o);case"nullable":return tv(o);default:return}}}function Gy(e){const t=gt(cu(e,"element","items","type"));return t?{type:"array",items:t}:void 0}function Wy(e){const t=du(e?.items).map(o=>gt(o)).filter(Boolean);if(!t.length)return;const n={type:"array",items:t,minItems:t.length};return e?.rest||(n.maxItems=t.length),n}function Ky(e){const t=du(e?.options??e?.schemas).map(n=>gt(n)).filter(Boolean);return t.length?{anyOf:t}:void 0}function Yy(e){const t=gt(e?.left),n=gt(e?.right);return t&&n?{allOf:[t,n]}:void 0}function Qy(e){const t=gt(e?.valueType??e?.values);return t?{type:"object",additionalProperties:t}:void 0}function Xy(e){const t=gt(e?.valueType??e?.values);return t?{type:"array",items:t}:void 0}function ev(e){const t=gt(e?.valueType);return t?{type:"array",items:t,uniqueItems:!0}:void 0}function tv(e){const t=gt(e?.innerType??e?.type);return t?{anyOf:[t,{type:"null"}]}:void 0}function rs(e){let t=e;for(;Jy.has(bo(t)??"");){const n=fn(t),o=n?.innerType??n?.schema??n?.base??n?.type??n?.wrapped??n?.underlying;if(!o||o===t)return t;t=o}return t}function cu(e,...t){if(e){for(const n of t)if(n in e&&e[n]!==void 0)return e[n]}}function du(e){return Array.isArray(e)?e:e===void 0?[]:[e]}function nv(e){if(!e)return;const t=cu(e,"value","literal");if(t!==void 0)return{const:t,type:t===null?"null":typeof t}}function ov(e){if(e){if(Array.isArray(e.values))return{enum:e.values};if(Array.isArray(e.options))return{enum:e.options};if(e.values&&typeof e.values=="object")return{enum:Object.values(e.values)};if(e.enum&&typeof e.enum=="object")return{enum:Object.values(e.enum)}}}function sv(e){if(typeof e!="object"||e===null)return;const t=e;if(t.shape&&typeof t.shape=="object")return t.shape;if(typeof t.shape=="function")try{return t.shape()}catch{return}const o=fn(t)?.shape;if(o&&typeof o=="object")return o;if(typeof o=="function")try{return o()}catch{return}}const rv=zy,av=Ny;function pu(e){return Vy(e)}function ro(e){if(e=e.replace(/\s/g,"_"),e=e.replace(/[^a-zA-Z0-9]/g,"_"),e.length===0)throw new Error("Tool name cannot be empty");return e}function Es(e,t){const n=o=>JSON.parse(o);if(Vt(e)){const o=a=>{const r=pu(e);if(r)return{schema:r,parser:l=>e.parse(JSON.parse(l))};const i=a instanceof Error?` Upstream helper error: ${a.message}`:"";throw new _e(`Unable to convert the provided Zod schema to JSON Schema. Ensure that the \`zod\` package is available at runtime or provide a JSON schema object instead.${i}`)};let s;try{s=rv({name:t,parameters:e,function:()=>{},description:""})}catch(a){return o(a)}return uu(s.parameters)?{schema:s.parameters,parser:s.$parseRaw}:o()}else if(typeof e=="object"&&e!==null)return{schema:e,parser:n};throw new _e("Input type is not a ZodObject or a valid JSON schema")}function jr(e){if(e==="text")return"text";if(Vt(e)){const t=(o,s)=>{const a=pu(e);if(a)return{type:o?.type??"json_schema",name:o?.name??"output",strict:o?.strict??!1,schema:a};const r=s instanceof Error?` Upstream helper error: ${s.message}`:"";throw new _e(`Unable to convert the provided Zod schema to JSON Schema. Ensure that the \`zod\` package is available at runtime or provide a JSON schema object instead.${r}`)};let n;try{n=av(e,"output")}catch(o){return t(void 0,o)}return uu(n.schema)?{type:n.type,name:n.name,strict:n.strict||!1,schema:n.schema}:t(n)}return e}var qn={exports:{}},Zo,qr;function iv(){if(qr)return Zo;qr=1;var e=1e3,t=e*60,n=t*60,o=n*24,s=o*7,a=o*365.25;Zo=function(c,d){d=d||{};var p=typeof c;if(p==="string"&&c.length>0)return r(c);if(p==="number"&&isFinite(c))return d.long?l(c):i(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function r(c){if(c=String(c),!(c.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(d){var p=parseFloat(d[1]),m=(d[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return p*a;case"weeks":case"week":case"w":return p*s;case"days":case"day":case"d":return p*o;case"hours":case"hour":case"hrs":case"hr":case"h":return p*n;case"minutes":case"minute":case"mins":case"min":case"m":return p*t;case"seconds":case"second":case"secs":case"sec":case"s":return p*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function i(c){var d=Math.abs(c);return d>=o?Math.round(c/o)+"d":d>=n?Math.round(c/n)+"h":d>=t?Math.round(c/t)+"m":d>=e?Math.round(c/e)+"s":c+"ms"}function l(c){var d=Math.abs(c);return d>=o?u(c,d,o,"day"):d>=n?u(c,d,n,"hour"):d>=t?u(c,d,t,"minute"):d>=e?u(c,d,e,"second"):c+" ms"}function u(c,d,p,m){var y=d>=p*1.5;return Math.round(c/p)+" "+m+(y?"s":"")}return Zo}var jo,Jr;function uv(){if(Jr)return jo;Jr=1;function e(t){o.debug=o,o.default=o,o.coerce=u,o.disable=i,o.enable=a,o.enabled=l,o.humanize=iv(),o.destroy=c,Object.keys(t).forEach(d=>{o[d]=t[d]}),o.names=[],o.skips=[],o.formatters={};function n(d){let p=0;for(let m=0;m<d.length;m++)p=(p<<5)-p+d.charCodeAt(m),p|=0;return o.colors[Math.abs(p)%o.colors.length]}o.selectColor=n;function o(d){let p,m=null,y,_;function b(...x){if(!b.enabled)return;const k=b,S=Number(new Date),A=S-(p||S);k.diff=A,k.prev=p,k.curr=S,p=S,x[0]=o.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let w=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(E,B)=>{if(E==="%%")return"%";w++;const R=o.formatters[B];if(typeof R=="function"){const z=x[w];E=R.call(k,z),x.splice(w,1),w--}return E}),o.formatArgs.call(k,x),(k.log||o.log).apply(k,x)}return b.namespace=d,b.useColors=o.useColors(),b.color=o.selectColor(d),b.extend=s,b.destroy=o.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(y!==o.namespaces&&(y=o.namespaces,_=o.enabled(d)),_),set:x=>{m=x}}),typeof o.init=="function"&&o.init(b),b}function s(d,p){const m=o(this.namespace+(typeof p>"u"?":":p)+d);return m.log=this.log,m}function a(d){o.save(d),o.namespaces=d,o.names=[],o.skips=[];const p=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const m of p)m[0]==="-"?o.skips.push(m.slice(1)):o.names.push(m)}function r(d,p){let m=0,y=0,_=-1,b=0;for(;m<d.length;)if(y<p.length&&(p[y]===d[m]||p[y]==="*"))p[y]==="*"?(_=y,b=m,y++):(m++,y++);else if(_!==-1)y=_+1,b++,m=b;else return!1;for(;y<p.length&&p[y]==="*";)y++;return y===p.length}function i(){const d=[...o.names,...o.skips.map(p=>"-"+p)].join(",");return o.enable(""),d}function l(d){for(const p of o.skips)if(r(d,p))return!1;for(const p of o.names)if(r(d,p))return!0;return!1}function u(d){return d instanceof Error?d.stack||d.message:d}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o.enable(o.load()),o}return jo=e,jo}var Vr;function lv(){return Vr||(Vr=1,(function(e,t){var n={};t.formatArgs=s,t.save=a,t.load=r,t.useColors=o,t.storage=i(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function o(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;u.splice(1,0,c,"color: inherit");let d=0,p=0;u[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(d++,m==="%c"&&(p=d))}),u.splice(p,0,c)}t.log=console.debug||console.log||(()=>{});function a(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch{}}function r(){let u;try{u=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=n.DEBUG),u}function i(){try{return localStorage}catch{}}e.exports=uv()(t);const{formatters:l}=e.exports;l.j=function(u){try{return JSON.stringify(u)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(qn,qn.exports)),qn.exports}var cv=lv();const dv=zl(cv);function fu(){return kv()}function Hr(e){const t=fu();return typeof t<"u"&&(t[e]==="true"||t[e]==="1")}const mu={get disabled(){return!0}},hu={get dontLogModelData(){return Hr("OPENAI_AGENTS_DONT_LOG_MODEL_DATA")},get dontLogToolData(){return Hr("OPENAI_AGENTS_DONT_LOG_TOOL_DATA")}},pv=hu.dontLogModelData,fv=hu.dontLogToolData;function gu(e="openai-agents"){return{namespace:e,debug:dv(e),error:console.error,warn:console.warn,dontLogModelData:pv,dontLogToolData:fv}}const H=gu("openai-agents:core"),Gr=20;function Mt(e){if(e==null)return String(e);if(yu(e))return xn(new Uint8Array(e));if(Mn(e)){const t=e;return xn(new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}if(typeof e=="string")return e;if(typeof e=="object")try{return JSON.stringify(e,hv)}catch{return"[object with circular references]"}return String(e)}function yu(e){if(e instanceof ArrayBuffer)return!0;const t=globalThis.SharedArrayBuffer;return!!(t&&e instanceof t)}function Mn(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e)}function ko(e){return typeof e=="object"&&e!==null&&e.type==="Buffer"&&Array.isArray(e.data)}function Us(e){const t=globalThis.Buffer;return!!(t&&typeof t.isBuffer=="function"&&t.isBuffer(e))}function xn(e){if(e.length===0)return"[byte array (0 bytes)]";const t=Math.min(e.length,Gr),n=[];for(let a=0;a<t;a++)n.push(mv(e[a]));const o=e.length>Gr?" ":"";return`[byte array ${n.join(" ")}${o} (${e.length} bytes)]`}function mv(e){return`0x${e.toString(16).padStart(2,"0")}`}function hv(e,t){if(yu(t))return xn(new Uint8Array(t));if(Mn(t)){const n=t;return xn(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}return ko(t)?xn(Uint8Array.from(t.data)):t}function as(e){return!!e&&typeof e=="object"&&typeof e.create=="function"}const is=new WeakMap,gv=new WeakMap,ao=new WeakMap;function vu(e){const t=gv.get(e);if(t)return t;if(typeof e.computer=="function"||as(e.computer))return e.computer}function Wr(e,t,n){let o=ao.get(t);o||(o=new Map,ao.set(t,o)),o.set(e,n)}async function _u(e){const{tool:t,runContext:n}=e,o=t;let s=is.get(o);s||(s=new WeakMap,is.set(o,s));const a=s.get(n);if(a)return Wr(t,n,a),a.computer;const r=vu(t),i=r&&as(r)?r:as(t.computer)?t.computer:void 0,l=typeof r=="function"?r:i?.create??(typeof t.computer=="function"?t.computer:void 0),u=i?.dispose,c=l&&typeof l=="function"?await l({runContext:n}):t.computer;if(!c)throw new _e("The computer tool did not provide a computer instance.");const d={computer:c,dispose:u};return s.set(n,d),Wr(t,n,d),t.computer=c,c}async function Kr({runContext:e}){const t=ao.get(e);if(!t)return;ao.delete(e);const n=[];for(const[o,s]of t.entries()){is.get(o)?.delete(e);const r=vu(o);r&&(o.computer=r),s.dispose&&n.push(async()=>{await s.dispose?.({runContext:e,computer:s.computer})})}for(const o of n)try{await o()}catch(s){H.warn(`Failed to dispose computer for run context: ${s}`)}}function yv(e,t){return`An error occurred while running the tool. Please try again. Error: ${t instanceof Error?t.toString():String(t)}`}function us(e){const t=e.name?ro(e.name):ro(e.execute.name),n=typeof e.errorFunction>"u"?yv:e.errorFunction;if(!t)throw new Error("Tool name cannot be empty. Either name your function or provide a name in the options.");const o=e.strict??!0;if(!o&&Vt(e.parameters))throw new _e("Strict mode is required for Zod parameters");const{parser:s,schema:a}=Es(e.parameters,t);async function r(c,d,p){const[m,y]=await Is(()=>s(d));if(m!==null)throw H.dontLogToolData?H.debug(`Invalid JSON input for tool ${t}`):H.debug(`Invalid JSON input for tool ${t}: ${d}`),new Ge("Invalid JSON input for tool");H.dontLogToolData?H.debug(`Invoking tool ${t}`):H.debug(`Invoking tool ${t} with input ${d}`);const _=await e.execute(y,c,p),b=Mt(_);return H.dontLogToolData?H.debug(`Tool ${t} completed`):H.debug(`Tool ${t} returned: ${b}`),_}async function i(c,d,p){return r(c,d,p).catch(m=>{if(n)return En()?.setError({message:"Error running tool (non-fatal)",data:{tool_name:t,error:m.toString()}}),n(c,m);throw m})}const l=typeof e.needsApproval=="function"?e.needsApproval:async()=>typeof e.needsApproval=="boolean"?e.needsApproval:!1,u=typeof e.isEnabled=="function"?async(c,d)=>{const p=e.isEnabled;return!!await p({runContext:c,agent:d})}:async()=>typeof e.isEnabled=="boolean"?e.isEnabled:!0;return{type:"function",name:t,description:e.description,parameters:a,strict:o,invoke:i,needsApproval:l,isEnabled:u}}T({name:f(),description:f().optional(),inputSchema:T({type:C("object"),properties:we(f(),ae()),required:se(f()),additionalProperties:Jt()})});const qo={},Jo={},vv=({server:e,agent:t})=>e.toolFilter&&typeof e.toolFilter=="function"&&t?`${e.name}:${t.name}`:e.name;async function _v({server:e,convertSchemasToStrict:t,runContext:n,agent:o,generateMCPToolCacheKey:s}){const a=(s||vv)({server:e,agent:o,runContext:n});if(e.cacheToolsList&&qo[a])return qo[a].map(i=>Yr(i,e,t));const r=async i=>{const l=await e.listTools();let u=l;if(n&&o){const d={runContext:n,agent:o,serverName:e.name},p=[];for(const m of l){const y=e.toolFilter;if(y)if(typeof y=="function"){if(!await y(d,m)){H.debug(`MCP Tool (server: ${e.name}, tool: ${m.name}) is blocked by the callable filter.`);continue}}else{const _=y.allowedToolNames??[],b=y.blockedToolNames??[];if(_.length>0||b.length>0){const x=_.length>0?_.includes(m.name):!0,k=b.length>0?b.includes(m.name):!1;if(!x||k){k?H.debug(`MCP Tool (server: ${e.name}, tool: ${m.name}) is blocked by the static filter.`):x||H.debug(`MCP Tool (server: ${e.name}, tool: ${m.name}) is not allowed by the static filter.`);continue}}}p.push(m)}u=p}i&&(i.spanData.result=u.map(d=>d.name));const c=u.map(d=>Yr(d,e,t));return e.cacheToolsList&&(qo[a]=u,Jo[e.name]||(Jo[e.name]=new Set),Jo[e.name].add(a)),c};return dn()?U_(r,{data:{server:e.name}}):r()}async function wv(e,t,n,o=!1){const s=Array.isArray(e)?{mcpServers:e,runContext:t,agent:n,convertSchemasToStrict:o}:e,{mcpServers:a,convertSchemasToStrict:r=!1,runContext:i,agent:l,generateMCPToolCacheKey:u}=s,c=[],d=new Set;for(const p of a){const m=await _v({server:p,convertSchemasToStrict:r,runContext:i,agent:l,generateMCPToolCacheKey:u}),_=[...new Set(m.map(b=>b.name))].filter(b=>d.has(b));if(_.length>0)throw new _e(`Duplicate tool names found across MCP servers: ${_.join(", ")}`);for(const b of m)d.add(b.name),c.push(b)}return c}function Yr(e,t,n){async function o(r,i){let l={};typeof r=="string"&&r?l=JSON.parse(r):typeof r=="object"&&r!=null&&(l=r);const u=En();u&&(u.spanData.mcp_data={server:t.name});const c=await t.callTool(e.name,l);return c.length===1?c[0]:c}const s={...e.inputSchema,type:e.inputSchema?.type??"object",properties:e.inputSchema?.properties??{},required:e.inputSchema?.required??[],additionalProperties:e.inputSchema?.additionalProperties??!1};if(n||s.additionalProperties===!0)try{const r=bv(s);return us({name:e.name,description:e.description||"",parameters:r,strict:!0,execute:o})}catch(r){H.warn(`Error converting MCP schema to strict mode: ${r}`)}const a={...s,additionalProperties:!0};return us({name:e.name,description:e.description||"",parameters:a,strict:!1,execute:o})}function bv(e){const t={...e,additionalProperties:!1};return t.required||(t.required=[]),t}function kv(){return{}}class Io{#e=new EventTarget;#t=new Map;on(t,n){const o=t;let s=this.#t.get(o);s||(s=new Map,this.#t.set(o,s));let a=s.get(n);a||(a=new Set,s.set(n,a));const r=(i=>n(...i.detail??[]));return a.add(r),this.#e.addEventListener(o,r),this}off(t,n){const o=t,s=this.#t.get(o),a=s?.get(n);if(a?.size){for(const r of a)this.#e.removeEventListener(o,r);s?.delete(n),s?.size===0&&this.#t.delete(o)}return this}emit(t,...n){const o=new CustomEvent(t,{detail:n});return this.#e.dispatchEvent(o)}once(t,n){const o=(...s)=>{this.off(t,o),n(...s)};return this.on(t,o),this}}const wu=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),Iv=class{constructor(){}pipeTo(t,n){}pipeThrough(t,n){}},xv=globalThis.ReadableStream,Sv=globalThis.TransformStream;class Tv{context=null;constructor(){}run(t,n){return this.context=t,n()}getStore(){return this.context}enterWith(t){this.context=t}}class Cv{constructor(){}setTimeout(t,n){const o=setTimeout(t,n);return o.ref=typeof o.ref=="function"?o.ref:()=>o,o.unref=typeof o.unref=="function"?o.unref:()=>o,o.hasRef=typeof o.hasRef=="function"?o.hasRef:()=>!0,o.refresh=typeof o.refresh=="function"?o.refresh:()=>o,o}clearTimeout(t){window.clearTimeout(t)}}const Av=new Cv;class Os{on(t,n){return this.eventEmitter.on(t,n),this.eventEmitter}off(t,n){return this.eventEmitter.off(t,n),this.eventEmitter}emit(t,...n){return this.eventEmitter.emit(t,...n)}once(t,n){return this.eventEmitter.once(t,n),this.eventEmitter}}class Dv extends Os{eventEmitter=new Io}class $v extends Os{eventEmitter=new Io}const Ev="OPENAI_DEFAULT_MODEL";function xo(e){return e.startsWith("gpt-5-chat")?!1:e.startsWith("gpt-5")}function bu(){return xo(ku())}function ku(){return fu()[Ev]?.toLowerCase()??"gpt-4.1"}function Uv(e){const t=ku();return xo(t)?{reasoning:{effort:"low"},text:{verbosity:"low"}}:{}}function Iu(e){return JSON.stringify({assistant:e.name})}function Ov(e){return`transfer_to_${ro(e.name)}`}function Rv(e){return`Handoff to the ${e.name} agent to handle the request. ${e.handoffDescription??""}`}class xu{toolName;toolDescription;inputJsonSchema={type:"object",properties:{},required:[],additionalProperties:!1};strictJsonSchema=!0;onInvokeHandoff;agentName;inputFilter;agent;getHandoffAsFunctionTool(){return{type:"function",name:this.toolName,description:this.toolDescription,parameters:this.inputJsonSchema,strict:this.strictJsonSchema}}isEnabled=async()=>!0;constructor(t,n){this.agentName=t.name,this.onInvokeHandoff=n,this.toolName=Ov(t),this.toolDescription=Rv(t),this.agent=t}}function Su(e,t={}){let n;const o=!!t.onHandoff,s=!!t.inputType;if(!(o===s))throw new _e("You must provide either both `onHandoff` and `inputType` or neither.");async function r(l,u){if(n){if(!u)throw Tt({message:`Handoff function expected non empty input but got: ${u}`,data:{details:"input is empty"}}),new Ge("Handoff function expected non empty input");try{const c=await n(u);t.onHandoff&&await t.onHandoff(l,c)}catch(c){throw Tt({message:"Invalid JSON provided",data:{}}),H.dontLogToolData||H.error(`Invalid JSON when parsing: ${u}. Error: ${c}`),new Ge("Invalid JSON provided")}}else await t.onHandoff?.(l);return e}const i=new xu(e,r);if(typeof t.isEnabled=="function"){const l=t.isEnabled;i.isEnabled=async({runContext:u,agent:c})=>!!await l({runContext:u,agent:c})}else typeof t.isEnabled=="boolean"&&(i.isEnabled=async()=>t.isEnabled);if(t.inputType){const l=Es(t.inputType,i.toolName);i.inputJsonSchema=l.schema,i.strictJsonSchema=!0,n=l.parser}return t.toolNameOverride&&(i.toolName=t.toolNameOverride),t.toolDescriptionOverride&&(i.toolDescription=t.toolDescriptionOverride),t.inputFilter&&(i.inputFilter=t.inputFilter),i}function Pv(e){return e instanceof xu?e:Su(e)}function Tu(e){if(e.type!=="message"||e.role!=="assistant")return;const t=e.content[e.content.length-1];if(t.type==="output_text")return t.text}function Mv(e){return e.output.length===0?"":Tu(e.output[e.output.length-1])||""}const ls=new WeakMap;function Lv(e,t){e&&ls.set(e,t)}function Nv(e){const t=ls.get(e);return t&&ls.delete(e),t}const zv=T({input:f()});class ut extends Dv{static create(t){return new ut({...t,handoffs:t.handoffs,outputType:t.outputType,handoffOutputTypeWarningEnabled:!1})}static DEFAULT_MODEL_PLACEHOLDER="";name;instructions;prompt;handoffDescription;handoffs;model;modelSettings;tools;mcpServers;inputGuardrails;outputGuardrails;outputType="text";toolUseBehavior;resetToolChoice;_toolsExplicitlyConfigured;constructor(t){if(super(),typeof t.name!="string"||t.name.trim()==="")throw new _e("Agent must have a name.");if(this.name=t.name,this.instructions=t.instructions??ut.DEFAULT_MODEL_PLACEHOLDER,this.prompt=t.prompt,this.handoffDescription=t.handoffDescription??"",this.handoffs=t.handoffs??[],this.model=t.model??"",this.modelSettings=t.modelSettings??Uv(),this.tools=t.tools??[],this._toolsExplicitlyConfigured=t.tools!==void 0,this.mcpServers=t.mcpServers??[],this.inputGuardrails=t.inputGuardrails??[],this.outputGuardrails=t.outputGuardrails??[],t.outputType&&(this.outputType=t.outputType),this.toolUseBehavior=t.toolUseBehavior??"run_llm_again",this.resetToolChoice=t.resetToolChoice??!0,t.model!==void 0&&bu()&&(typeof t.model!="string"||!xo(t.model))&&t.modelSettings===void 0&&(this.modelSettings={}),(t.handoffOutputTypeWarningEnabled===void 0||t.handoffOutputTypeWarningEnabled)&&this.handoffs&&this.outputType){const n=new Set([JSON.stringify(this.outputType)]);for(const o of this.handoffs)"outputType"in o&&o.outputType?n.add(JSON.stringify(o.outputType)):"agent"in o&&o.agent.outputType&&n.add(JSON.stringify(o.agent.outputType));n.size>1&&H.warn(`[Agent] Warning: Handoff agents have different output types: ${Array.from(n).join(", ")}. You can make it type-safe by using Agent.create({ ... }) method instead.`)}}get outputSchemaName(){if(this.outputType==="text")return"text";if(Vt(this.outputType))return"ZodOutput";if(typeof this.outputType=="object")return this.outputType.name;throw new Error(`Unknown output type: ${this.outputType}`)}clone(t){return new ut({...this,...t})}asTool(t){const{toolName:n,toolDescription:o,customOutputExtractor:s,needsApproval:a,runConfig:r,runOptions:i,isEnabled:l,onStream:u}=t,c=new Map,d=async y=>{const _=c.get(y.event.type),b=c.get("*"),x=[...u?[u]:[],..._?Array.from(_):[],...b?Array.from(b):[]];await Promise.allSettled(x.map(k=>Promise.resolve().then(()=>k(y))))},m={...us({name:n??ro(this.name),description:o??"",parameters:zv,strict:!0,needsApproval:a,isEnabled:l,execute:async(y,_,b)=>{if(!Zy(y))throw new Ge("Agent tool called with invalid input");const x=new yw(r??{}),k=typeof u=="function"||c.size>0,S=k?await x.run(this,y.input,{context:_,...i??{},stream:!0}):await x.run(this,y.input,{context:_,...i??{}}),A={agent:this,toolCall:b?.toolCall};if(k){const B=S;for await(const R of B)await d({event:R,...A});await B.completed}const w=S,D=typeof this.toolUseBehavior=="object"&&this.toolUseBehavior!==null&&"stopAtToolNames"in this.toolUseBehavior;typeof s!="function"&&D&&H.debug(`You're passing the agent (name: ${this.name}) with toolUseBehavior.stopAtToolNames configured as a tool to a different agent; this may not work as you expect. You may want to have a wrapper function tool to consistently return the final output.`);const E=typeof s=="function"?await s(w):Mv(w.rawResponses[w.rawResponses.length-1]);return b?.toolCall&&Lv(b.toolCall,w),E}}),on:(y,_)=>{const b=c.get(y)??new Set;return b.add(_),c.set(y,b),m}};return m}async getSystemPrompt(t){return typeof this.instructions=="function"?await this.instructions(t,this):this.instructions}async getPrompt(t){return typeof this.prompt=="function"?await this.prompt(t,this):this.prompt}async getMcpTools(t){return this.mcpServers.length>0?wv({mcpServers:this.mcpServers,runContext:t,agent:this,convertSchemasToStrict:!1}):[]}async getAllTools(t){const n=await this.getMcpTools(t),o=[];for(const s of this.tools){if(s.type==="function"){const a=s.isEnabled;if(!(typeof a=="function"?await a(t,this):typeof a=="boolean"?a:!0))continue}o.push(s)}return[...n,...o]}hasExplicitToolConfig(){return this._toolsExplicitlyConfigured}async getEnabledHandoffs(t){const n=this.handoffs?.map(s=>Pv(s))??[],o=[];for(const s of n)await s.isEnabled({runContext:t,agent:this})&&o.push(s);return o}processFinalOutput(t){if(this.outputType==="text")return t;if(typeof this.outputType=="object"){const n=JSON.parse(t);return Vt(this.outputType)?this.outputType.parse(n):n}throw new Error(`Unknown output type: ${this.outputType}`)}toJSON(){return{name:this.name}}}function Qr({name:e,execute:t,runInParallel:n=!0}){return{type:"input",name:e,runInParallel:n,guardrailFunction:t,async run(o){return{guardrail:{type:"input",name:e},output:await t(o)}}}}function cs({name:e,execute:t}){return{type:"output",name:e,guardrailFunction:t,async run(n){return{guardrail:{type:"output",name:e},agent:n.agent,agentOutput:n.agentOutput,output:await t(n)}}}}function Fv(){throw new Error("No default model provider set. Make sure to set a provider using setDefaultModelProvider before calling getDefaultModelProvider or pass an explicit provider.")}const Le=T({providerData:we(f(),ae()).optional()}),ot=Le.extend({id:f().optional()}),Bv=Le.extend({type:C("refusal"),refusal:f()}),Zv=Le.extend({type:C("output_text"),text:f()}),Rs=Le.extend({type:C("input_text"),text:f()}),jv=Le.extend({type:C("reasoning_text"),text:f()}),Cu=Le.extend({type:C("input_image"),image:f().or(T({id:f().describe("OpenAI file ID")})).describe("Either base64 encoded image data, a data URL, or an object with a file ID.").optional(),detail:f().optional()}),Au=Le.extend({type:C("input_file"),file:f().describe("Either base64 encoded file data or a publicly accessible file URL").or(T({id:f().describe("OpenAI file ID")})).or(T({url:f().describe("Publicly accessible file URL")})).describe("Contents of the file or an object with a file ID.").optional(),filename:f().optional()}),Du=Le.extend({type:C("audio"),audio:f().or(T({id:f()})).describe("Base64 encoded audio data or file id"),format:f().nullable().optional(),transcript:f().nullable().optional()}),qv=Le.extend({type:C("image"),image:f().describe("Base64 encoded image data")}),Jv=Le.extend({type:C("text"),text:f()}),Vv=T({data:ht([f(),eu(Uint8Array)]).describe("Base64 image data, or raw bytes that will be base64 encoded automatically."),mediaType:f().optional()}),Hv=T({url:f().describe("Publicly accessible URL pointing to the image content")}),Gv=T({fileId:f().describe("OpenAI file ID referencing uploaded image content")}),Wv=ht([Vv,Hv,Gv]).describe("Inline image data or references to uploaded content."),Kv=T({data:ht([f(),eu(Uint8Array)]).describe("Base64 encoded file data, or raw bytes that will be encoded automatically."),mediaType:f().describe("IANA media type describing the file contents"),filename:f().describe("Filename associated with the inline data")}),Yv=T({url:f().describe("Publicly accessible URL for the file content"),filename:f().optional()}),Qv=T({id:f().describe("OpenAI file ID referencing uploaded content"),filename:f().optional()}),Xv=ht([f().describe("Existing data URL or base64 string"),Kv,Yv,Qv]).describe("Inline data (with metadata) or references pointing to file contents."),e_=(...e)=>f(),t_=Le.extend({type:C("image"),image:f().or(Wv).optional(),detail:e_("low","high","auto").optional()}),n_=Le.extend({type:C("file"),file:Xv}),o_=Le.extend({type:C("computer_screenshot"),data:f().describe("Base64 encoded image data or URL")}),s_=je("type",[T({type:C("screenshot")}),T({type:C("click"),x:N(),y:N(),button:Re(["left","right","wheel","back","forward"])}),T({type:C("double_click"),x:N(),y:N()}),T({type:C("scroll"),x:N(),y:N(),scroll_x:N(),scroll_y:N()}),T({type:C("type"),text:f()}),T({type:C("wait")}),T({type:C("move"),x:N(),y:N()}),T({type:C("keypress"),keys:se(f())}),T({type:C("drag"),path:se(T({x:N(),y:N()}))})]),r_=je("type",[Zv,Bv,Du,qv]),Ps=ot.extend({type:C("message").optional()}),So=Ps.extend({role:C("assistant"),status:Re(["in_progress","completed","incomplete"]),content:se(r_)}),a_=je("type",[Rs,Cu,Au,Du]),$u=Ps.extend({role:C("user"),content:se(a_).or(f())}),Eu=Ps.extend({role:C("system"),content:f()});je("role",[Eu,So,$u]);const Dn=ot.extend({type:C("hosted_tool_call"),name:f().describe("The name of the hosted tool"),arguments:f().describe("The arguments of the hosted tool call").optional(),status:f().optional(),output:f().optional()}),$n=ot.extend({type:C("function_call"),callId:f().describe("The ID of the tool call"),name:f().describe("The name of the function"),status:Re(["in_progress","completed","incomplete"]).optional(),arguments:f()}),i_=je("type",[Jv,t_,n_]),u_=je("type",[Rs,Cu,Au]),io=ot.extend({type:C("function_call_result"),name:f().describe("The name of the tool"),callId:f().describe("The ID of the tool call"),status:Re(["in_progress","completed","incomplete"]),output:ht([f(),i_,se(u_)]).describe("Output returned by the tool call. Supports plain strings, legacy ToolOutput items, or structured input_* items.")}),Ms=ot.extend({type:C("computer_call"),callId:f().describe("The ID of the computer call"),status:Re(["in_progress","completed","incomplete"]),action:s_}),l_=ot.extend({type:C("computer_call_result"),callId:f().describe("The ID of the computer call"),output:o_}),c_=T({commands:se(f()),timeoutMs:N().int().min(0).optional(),maxOutputLength:N().int().min(0).optional()}),To=ot.extend({type:C("shell_call"),callId:f(),status:Re(["in_progress","completed","incomplete"]).optional(),action:c_}),d_=je("type",[T({type:C("timeout")}),T({type:C("exit"),exitCode:N().int().nullable()})]),p_=T({stdout:f(),stderr:f(),outcome:d_}).passthrough(),Uu=ot.extend({type:C("shell_call_output"),callId:f(),maxOutputLength:N().optional(),output:se(p_)}),f_=T({type:C("create_file"),path:f(),diff:f()}),m_=T({type:C("update_file"),path:f(),diff:f()}),h_=T({type:C("delete_file"),path:f()}),g_=je("type",[f_,m_,h_]),Co=ot.extend({type:C("apply_patch_call"),callId:f(),status:Re(["in_progress","completed"]),operation:g_}),Ou=ot.extend({type:C("apply_patch_call_output"),callId:f(),status:Re(["completed","failed"]),output:f().optional()}),y_=je("type",[Ms,To,Co,$n,Dn]),Ls=Le.extend({id:f().optional(),type:C("reasoning"),content:se(Rs),rawContent:se(jv).optional()}),Ru=ot.extend({type:C("compaction"),encrypted_content:f(),id:f().optional(),created_by:f().optional()}),Pu=ot.extend({type:C("unknown")}),Ns=je("type",[So,Dn,$n,Ms,To,Co,io,Uu,Ou,Ls,Ru,Pu]),v_=ht([$u,So,Eu,Dn,$n,Ms,To,Co,io,l_,Uu,Ou,Ls,Ru,Pu]),__=T({inputTokens:N(),outputTokens:N(),totalTokens:N(),inputTokensDetails:we(f(),N()).optional(),outputTokensDetails:we(f(),N()).optional(),endpoint:f().optional()}),w_=T({requests:N().optional(),inputTokens:N(),outputTokens:N(),totalTokens:N(),inputTokensDetails:ht([we(f(),N()),se(we(f(),N()))]).optional(),outputTokensDetails:ht([we(f(),N()),se(we(f(),N()))]).optional(),requestUsageEntries:se(__).optional()}),Mu=Le.extend({type:C("output_text_delta"),delta:f()}),b_=Le.extend({type:C("response_started")}),Lu=Le.extend({type:C("response_done"),response:Le.extend({id:f(),usage:w_,output:se(Ns)})}),k_=Le.extend({type:C("model"),event:ae().describe("The event from the model")});je("type",[Mu,Lu,b_,k_]);class yn{inputTokens;outputTokens;totalTokens;inputTokensDetails;outputTokensDetails;endpoint;constructor(t){this.inputTokens=t?.inputTokens??t?.input_tokens??0,this.outputTokens=t?.outputTokens??t?.output_tokens??0,this.totalTokens=t?.totalTokens??t?.total_tokens??this.inputTokens+this.outputTokens;const n=t?.inputTokensDetails??t?.input_tokens_details;this.inputTokensDetails=n||{};const o=t?.outputTokensDetails??t?.output_tokens_details;this.outputTokensDetails=o||{},typeof t?.endpoint<"u"&&(this.endpoint=t.endpoint)}}class Ln{requests;inputTokens;outputTokens;totalTokens;inputTokensDetails=[];outputTokensDetails=[];requestUsageEntries;constructor(t){if(typeof t>"u")this.requests=0,this.inputTokens=0,this.outputTokens=0,this.totalTokens=0,this.inputTokensDetails=[],this.outputTokensDetails=[],this.requestUsageEntries=void 0;else{this.requests=t?.requests??1,this.inputTokens=t?.inputTokens??t?.input_tokens??0,this.outputTokens=t?.outputTokens??t?.output_tokens??0,this.totalTokens=t?.totalTokens??t?.total_tokens??this.inputTokens+this.outputTokens;const n=t?.inputTokensDetails??t?.input_tokens_details;Array.isArray(n)?this.inputTokensDetails=n:this.inputTokensDetails=n?[n]:[];const o=t?.outputTokensDetails??t?.output_tokens_details;Array.isArray(o)?this.outputTokensDetails=o:this.outputTokensDetails=o?[o]:[];const s=t?.requestUsageEntries??t?.request_usage_entries,a=Array.isArray(s)?s.map(r=>r instanceof yn?r:new yn(r)):void 0;this.requestUsageEntries=a&&a.length>0?a:void 0}}add(t){this.requests+=t.requests??0,this.inputTokens+=t.inputTokens??0,this.outputTokens+=t.outputTokens??0,this.totalTokens+=t.totalTokens??0,t.inputTokensDetails&&this.inputTokensDetails.push(...t.inputTokensDetails),t.outputTokensDetails&&this.outputTokensDetails.push(...t.outputTokensDetails),Array.isArray(t.requestUsageEntries)&&t.requestUsageEntries.length>0?(this.requestUsageEntries??=[],this.requestUsageEntries.push(...t.requestUsageEntries.map(n=>n instanceof yn?n:new yn(n)))):t.requests===1&&t.totalTokens>0&&(this.requestUsageEntries??=[],this.requestUsageEntries.push(new yn({inputTokens:t.inputTokens,outputTokens:t.outputTokens,totalTokens:t.totalTokens,inputTokensDetails:t.inputTokensDetails?.[0],outputTokensDetails:t.outputTokensDetails?.[0]})))}}class nn{context;usage;#e;constructor(t={}){this.context=t,this.usage=new Ln,this.#e=new Map}_rebuildApprovals(t){this.#e=new Map(Object.entries(t))}isToolApproved(t){const{toolName:n,callId:o}=t,s=this.#e.get(n);if(s?.approved===!0&&s.rejected===!0)return H.warn("Tool is permanently approved and rejected at the same time. Approval takes precedence"),!0;if(s?.approved===!0)return!0;if(s?.rejected===!0)return!1;const a=Array.isArray(s?.approved)?s.approved.includes(o):!1,r=Array.isArray(s?.rejected)?s.rejected.includes(o):!1;if(a&&r)return H.warn(`Tool call ${o} is both approved and rejected at the same time. Approval takes precedence`),!0;if(a)return!0;if(r)return!1}approveTool(t,{alwaysApprove:n=!1}={}){const o=t.toolName??t.rawItem.name;if(n){this.#e.set(o,{approved:!0,rejected:[]});return}const s=this.#e.get(o)??{approved:[],rejected:[]};if(Array.isArray(s.approved)){const a="callId"in t.rawItem?t.rawItem.callId:t.rawItem.id;s.approved.push(a)}this.#e.set(o,s)}rejectTool(t,{alwaysReject:n=!1}={}){const o=t.toolName??t.rawItem.name;if(n){this.#e.set(o,{approved:!1,rejected:!0});return}const s=this.#e.get(o)??{approved:[],rejected:[]};if(Array.isArray(s.rejected)){const a="callId"in t.rawItem?t.rawItem.callId:t.rawItem.id;s.rejected.push(a)}this.#e.set(o,s)}toJSON(){return{context:this.context,usage:this.usage,approvals:Object.fromEntries(this.#e.entries())}}}function I_(e){return!!e&&typeof e=="object"&&"environment"in e&&"dimensions"in e}function x_(e){if(e.type==="function")return{type:"function",name:e.name,description:e.description,parameters:e.parameters,strict:e.strict};if(e.type==="computer"){if(!I_(e.computer))throw new _e("Computer tool is not initialized for serialization. Call resolveComputer({ tool, runContext }) first (for example, when building a model payload outside Runner.run).");return{type:"computer",name:e.name,environment:e.computer.environment,dimensions:e.computer.dimensions}}return e.type==="shell"?{type:"shell",name:e.name}:e.type==="apply_patch"?{type:"apply_patch",name:e.name}:{type:"hosted_tool",name:e.name,providerData:e.providerData}}function S_(e){return{toolName:e.toolName,toolDescription:e.toolDescription,inputJsonSchema:e.inputJsonSchema,strictJsonSchema:e.strictJsonSchema}}class Yt{type="base_item";rawItem;toJSON(){return{type:this.type,rawItem:this.rawItem}}}class Ao extends Yt{rawItem;agent;type="message_output_item";constructor(t,n){super(),this.rawItem=t,this.agent=n}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}get content(){let t="";for(const n of this.rawItem.content)n.type==="output_text"&&(t+=n.text);return t}}class St extends Yt{rawItem;agent;type="tool_call_item";constructor(t,n){super(),this.rawItem=t,this.agent=n}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}class yt extends Yt{rawItem;agent;output;type="tool_call_output_item";constructor(t,n,o){super(),this.rawItem=t,this.agent=n,this.output=o}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON(),output:Mt(this.output)}}}class zs extends Yt{rawItem;agent;type="reasoning_item";constructor(t,n){super(),this.rawItem=t,this.agent=n}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}class Fs extends Yt{rawItem;agent;type="handoff_call_item";constructor(t,n){super(),this.rawItem=t,this.agent=n}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}class Bs extends Yt{rawItem;sourceAgent;targetAgent;type="handoff_output_item";constructor(t,n,o){super(),this.rawItem=t,this.sourceAgent=n,this.targetAgent=o}toJSON(){return{...super.toJSON(),sourceAgent:this.sourceAgent.toJSON(),targetAgent:this.targetAgent.toJSON()}}}class Ve extends Yt{rawItem;agent;toolName;type="tool_approval_item";constructor(t,n,o){super(),this.rawItem=t,this.agent=n,this.toolName=o,this.toolName=o??t.name}get name(){return this.toolName??this.rawItem.name}get arguments(){return"arguments"in this.rawItem?this.rawItem.arguments:void 0}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON(),toolName:this.toolName}}}function Do(e){return async(t,...n)=>ms(async()=>{const o=e(...n);qs(o);try{return o.start(),await t(o)}catch(s){throw o.setError({message:s.message,data:s.data}),s}finally{o.end(),kn()}})}function T_(e,t){return _t().createSpan({...e,data:{type:"agent",name:e?.data?.name??"Agent",...e?.data}},t)}function C_(e,t){return _t().createSpan({...e,data:{type:"function",input:e?.data?.input??"",output:e?.data?.output??"",...e?.data}},t)}const Xr=Do(C_);function A_(e,t){return _t().createSpan({...e,data:{type:"handoff",...e?.data}},t)}const D_=Do(A_);function $_(e,t){return _t().createSpan({...e,data:{type:"guardrail",triggered:!1,...e?.data}},t)}const ea=Do($_);function E_(e,t){return _t().createSpan({...e,data:{type:"mcp_tools",...e?.data}},t)}const U_=Do(E_);function et(e){if(e.length===0)return"";const t=typeof globalThis<"u"&&globalThis.Buffer?globalThis.Buffer:void 0;if(t)return t.from(e).toString("base64");let n="";for(let r=0;r<e.length;r+=1)n+=String.fromCharCode(e[r]);if(typeof globalThis.btoa=="function")return globalThis.btoa(n);const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let s="",a=0;for(;a<n.length;){const r=n.charCodeAt(a++),i=n.charCodeAt(a++),l=n.charCodeAt(a++),u=r>>2,c=(r&3)<<4|i>>4,d=isNaN(i)?64:(i&15)<<2|l>>6,p=isNaN(l)?64:l&63;s+=o.charAt(u)+o.charAt(c)+o.charAt(d)+o.charAt(p)}return s}class O_{data;type="raw_model_stream_event";constructor(t){this.data=t}}class R_{name;item;type="run_item_stream_event";constructor(t,n){this.name=t,this.item=n}}class P_{agent;type="agent_updated_stream_event";constructor(t){this.agent=t}}function M_(e){return!!e&&typeof e.runCompaction=="function"}var L_={};function N_(e){if(!e||typeof e!="object"||!("rawItem"in e))return!1;const t=e.rawItem;if(!t||typeof t!="object")return!1;const n=t.type;return n==="function_call"||n==="hosted_tool_call"}function ta(e){const t=e.rawItem;if(!t)return;if(t.type==="function_call"&&t.callId)return`function_call:${t.callId}`;if("callId"in t&&t.callId)return`${t.type}:${t.callId}`;const n="id"in t?t.id:void 0;if(n)return`${t.type}:${n}`;const o=typeof t.providerData=="object"&&t.providerData?t.providerData:void 0;if(o?.id)return`${t.type}:provider:${o.id}`;const s="agent"in e&&e.agent?e.agent.name:"";try{return`${s}:${t.type}:${JSON.stringify(t)}`}catch{return`${s}:${t.type}`}}function z_(e){try{if(e instanceof Nh){const t=e.issues[0];if(t){const n=Array.isArray(t.path)?t.path:[],o=n.length>0?n.map(a=>String(a)).join("."):"(root)",s=na(t.message??"");return`Invalid output type: final assistant output failed schema validation at "${o}" (${s}).`}return"Invalid output type: final assistant output failed schema validation."}if(e instanceof Error&&e.message)return`Invalid output type: ${na(e.message)}`}catch{}return"Invalid output type: final assistant output did not match the expected schema."}function na(e,t=160){const n=e.trim();return n?n.length<=t?n:`${n.slice(0,t-3)}...`:"Schema validation failed."}function oa(e,t,n,o){const s=[],a=[],r=[],i=[],l=[],u=[],c=[],d=[],p=new Map(o.map(k=>[k.toolName,k])),m=new Map(n.filter(k=>k.type==="function").map(k=>[k.name,k])),y=n.find(k=>k.type==="computer"),_=n.find(k=>k.type==="shell"),b=n.find(k=>k.type==="apply_patch"),x=new Map(n.filter(k=>k.type==="hosted_tool"&&k.providerData?.type==="mcp").map(k=>k).map(k=>[k.providerData.server_label,k]));for(const k of e.output){if(k.type==="message")k.role==="assistant"&&s.push(new Ao(k,t));else if(k.type==="hosted_tool_call"){s.push(new St(k,t));const A=k.name;if(d.push(A),k.providerData?.type==="mcp_approval_request"||k.name==="mcp_approval_request"){const w=k.providerData,D=w.server_label,E=x.get(D);if(typeof E>"u"){const R=`MCP server (${D}) not found in Agent (${t.name})`;throw Tt({message:R,data:{mcp_server_label:D}}),new Ge(R)}const B=new Ve({type:"hosted_tool_call",name:w.name,id:w.id,status:"in_progress",providerData:w},t);c.push({requestItem:B,mcpTool:E}),E.providerData.on_approval||s.push(B)}}else if(k.type==="reasoning")s.push(new zs(k,t));else if(k.type==="computer_call"){if(s.push(new St(k,t)),d.push("computer_use"),!y)throw Tt({message:"Model produced computer action without a computer tool.",data:{agent_name:t.name}}),new Ge("Model produced computer action without a computer tool.");i.push({toolCall:k,computer:y})}else if(k.type==="shell_call"){if(s.push(new St(k,t)),d.push("shell"),!_)throw Tt({message:"Model produced shell action without a shell tool.",data:{agent_name:t.name}}),new Ge("Model produced shell action without a shell tool.");l.push({toolCall:k,shell:_})}else if(k.type==="apply_patch_call"){if(s.push(new St(k,t)),d.push("apply_patch"),!b)throw Tt({message:"Model produced apply_patch action without an apply_patch tool.",data:{agent_name:t.name}}),new Ge("Model produced apply_patch action without an apply_patch tool.");u.push({toolCall:k,applyPatch:b})}if(k.type!=="function_call")continue;d.push(k.name);const S=p.get(k.name);if(S)s.push(new Fs(k,t)),a.push({toolCall:k,handoff:S});else{const A=m.get(k.name);if(!A)throw Tt({message:`Tool ${k.name} not found in agent ${t.name}.`,data:{tool_name:k.name,agent_name:t.name}}),new Ge(`Tool ${k.name} not found in agent ${t.name}.`);s.push(new St(k,t)),r.push({toolCall:k,tool:A})}}return{newItems:s,handoffs:a,functions:r,computerActions:i,shellActions:l,applyPatchActions:u,mcpApprovalRequests:c,toolsUsed:d,hasToolsOrApprovalsToRun(){return a.length>0||r.length>0||c.length>0||i.length>0||l.length>0||u.length>0}}}const F_=je("type",[T({type:C("next_step_handoff"),newAgent:ae()}),T({type:C("next_step_final_output"),output:f()}),T({type:C("next_step_run_again")}),T({type:C("next_step_interruption"),data:we(f(),ae())})]);class mt{originalInput;modelResponse;preStepItems;newStepItems;nextStep;constructor(t,n,o,s,a){this.originalInput=t,this.modelResponse=n,this.preStepItems=o,this.newStepItems=s,this.nextStep=a}get generatedItems(){return this.preStepItems.concat(this.newStepItems)}}function B_(e,t,n){return e.resetToolChoice&&t.hasUsedTools(e)?{...n,toolChoice:void 0}:n}async function sa(e,t,n,o,s,a,r){const i=n.filter(w=>w instanceof Ve&&"callId"in w.rawItem&&w.rawItem.type==="function_call").map(w=>w.rawItem.callId),l=r.getInterruptions().filter(N_);if(l.length>0){const w=new Set;for(const D of l){const E=ta(D);E&&w.add(E)}if(w.size>0){let D=0;for(let E=n.length-1;E>=0;E--){const B=n[E];if(!(B instanceof Ve))continue;const R=ta(B);if(R&&w.has(R)&&(D++,w.delete(R),w.size===0))break}D>0&&(r._currentTurnPersistedItemCount=Math.max(0,r._currentTurnPersistedItemCount-D))}}const u=s.functions.filter(w=>i.includes(w.toolCall.callId)),c=await zu(e,u,a,r),d=s.computerActions.length>0?await Bu(e,s.computerActions,a,r._context):[],p=new Set(n),m=[],y=new Set,_=w=>{p.has(w)||y.has(w)||(m.push(w),y.add(w))};for(const w of c)_(w.runItem);for(const w of d)_(w);const b=s.mcpApprovalRequests.filter(w=>w.requestItem.type==="tool_approval_item"&&w.requestItem.rawItem.type==="hosted_tool_call"&&w.requestItem.rawItem.providerData?.type==="mcp_approval_request"),x=new Set,k=new Set;for(const w of b){const D=w.requestItem.rawItem;if(D.type!=="hosted_tool_call")continue;const E=D.id,B=r._context.isToolApproved({toolName:D.name,callId:E});if(typeof B<"u"){const R={approve:B,approval_request_id:E,reason:void 0},z=new St({type:"hosted_tool_call",name:"mcp_approval_response",providerData:R},e);_(z)}else x.add(w.requestItem),k.add(E),c.push({type:"hosted_mcp_tool_approval",tool:w.mcpTool,runItem:w.requestItem}),_(w.requestItem)}const S=n.filter(w=>{if(!(w instanceof Ve))return!0;if(w.rawItem.type==="hosted_tool_call"&&w.rawItem.providerData?.type==="mcp_approval_request"){if(x.has(w))return!0;const D=w.rawItem.id;return D?k.has(D):!1}return!1}),A=await Nu({agent:e,runner:a,state:r,functionResults:c,originalInput:t,newResponse:o,preStepItems:S,newItems:m});return A||new mt(t,o,S,m,{type:"next_step_run_again"})}async function ra(e,t,n,o,s,a,r){const i=n,l=new Set(n),u=[],c=A=>{l.has(A)||(u.push(A),l.add(A))};for(const A of s.newItems)c(A);const[d,p,m,y]=await Promise.all([zu(e,s.functions,a,r),Bu(e,s.computerActions,a,r._context),V_(e,s.shellActions,a,r._context),H_(e,s.applyPatchActions,a,r._context)]);for(const A of d)c(A.runItem);for(const A of p)c(A);for(const A of m)c(A);for(const A of y)c(A);if(s.mcpApprovalRequests.length>0)for(const A of s.mcpApprovalRequests){const w=A.mcpTool.providerData,D=A.requestItem.rawItem.providerData;if(w.on_approval){const E=await w.on_approval(r._context,A.requestItem),B={approve:E.approve,approval_request_id:D.id,reason:E.reason};u.push(new St({type:"hosted_tool_call",name:"mcp_approval_response",providerData:B},e))}else{u.push(A.requestItem);const E={type:"hosted_mcp_tool_approval",tool:A.mcpTool,runItem:new Ve({type:"hosted_tool_call",name:D.name,id:D.id,arguments:D.arguments,status:"in_progress",providerData:D},e)};d.push(E)}}if(s.handoffs.length>0)return await G_(e,t,i,u,o,s.handoffs,a,r._context);const _=await Nu({agent:e,runner:a,state:r,functionResults:d,originalInput:t,newResponse:o,preStepItems:i,newItems:u});if(_)return _;if((s.functions?.length??0)>0||(s.computerActions?.length??0)>0||(s.shellActions?.length??0)>0||(s.applyPatchActions?.length??0)>0||(s.mcpApprovalRequests?.length??0)>0||(s.handoffs?.length??0)>0)return new mt(t,o,i,u,{type:"next_step_run_again"});const x=u.filter(A=>A instanceof Ao),k=x.length>0?Tu(x[x.length-1].rawItem):void 0;if(typeof k>"u")return new mt(t,o,i,u,{type:"next_step_run_again"});if(!d.some(A=>A.runItem instanceof Ve)){if(e.outputType==="text")return new mt(t,o,i,u,{type:"next_step_final_output",output:k});if(e.outputType!=="text"&&k){const{parser:A}=Es(e.outputType,"final_output"),[w]=await Is(()=>A(k));if(w){const D=z_(w);throw Tt({message:D,data:{error:String(w)}}),new Ge(D)}return new mt(t,o,i,u,{type:"next_step_final_output",output:k})}}return new mt(t,o,i,u,{type:"next_step_run_again"})}async function Nu({agent:e,runner:t,state:n,functionResults:o,originalInput:s,newResponse:a,preStepItems:r,newItems:i}){const l=await W_(e,o,n);return l.isFinalOutput?(t.emit("agent_end",n._context,e,l.finalOutput),e.emit("agent_end",n._context,l.finalOutput),new mt(s,a,r,i,{type:"next_step_final_output",output:l.finalOutput})):l.isInterrupted?new mt(s,a,r,i,{type:"next_step_interruption",data:{interruptions:l.interruptions}}):null}function uo(e,t){const n=rw(t);if(n){const o=n.map(aw);return{type:"function_call_result",name:e.name,callId:e.callId,status:"completed",output:o}}return{type:"function_call_result",name:e.name,callId:e.callId,status:"completed",output:{type:"text",text:Mt(t)}}}function Z_(e){const t=e.file;if(typeof t=="string"&&t.length>0)return t;const n=j_(t);if(n)return n;const o=q_(e);return o||null}function j_(e){if(!jt(e))return null;if("data"in e&&e.data!==void 0){const n=e.data,o=typeof n=="string"&&n.length>0,s=n instanceof Uint8Array&&n.length>0;return!o&&!s||!Fe(e.mediaType)||!Fe(e.filename)?null:{data:typeof n=="string"?n:new Uint8Array(n),mediaType:e.mediaType,filename:e.filename}}if(Fe(e.url)){const n={url:e.url};return Fe(e.filename)&&(n.filename=e.filename),n}const t=Fe(e.id)&&e.id||Fe(e.fileId)&&e.fileId;if(t){const n={id:t};return Fe(e.filename)&&(n.filename=e.filename),n}return null}function q_(e){const t=typeof e.filename=="string"&&e.filename.length>0?e.filename:void 0,n=typeof e.mediaType=="string"&&e.mediaType.length>0?e.mediaType:void 0;if(typeof e.fileData=="string"&&e.fileData.length>0)return!n||!t?null:{data:e.fileData,mediaType:n,filename:t};if(e.fileData instanceof Uint8Array&&e.fileData.length>0)return!n||!t?null:{data:new Uint8Array(e.fileData),mediaType:n,filename:t};if(typeof e.fileUrl=="string"&&e.fileUrl.length>0){const o={url:e.fileUrl};return t&&(o.filename=t),o}if(typeof e.fileId=="string"&&e.fileId.length>0){const o={id:e.fileId};return t&&(o.filename=t),o}return null}function jt(e){return typeof e=="object"&&e!==null}function Fe(e){return typeof e=="string"&&e.length>0}function Jn(e,t){if(typeof e=="string")return t&&!e.startsWith("data:")?on(e,t):e;const n=et(e);return on(n,t)}function on(e,t){return t?`data:${t};base64,${e}`:e}async function zu(e,t,n,o){async function s(a){let r=a.toolCall.arguments;if(a.tool.parameters&&(Vt(a.tool.parameters)?r=a.tool.parameters.parse(r):r=JSON.parse(r)),await a.tool.needsApproval(o._context,r,a.toolCall.callId)){const l=o._context.isToolApproved({toolName:a.tool.name,callId:a.toolCall.callId});if(l===!1)return Xr(async u=>{const c="Tool execution was not approved.";return u.setError({message:c,data:{tool_name:a.tool.name,error:`Tool execution for ${a.toolCall.callId} was manually rejected by user.`}}),u.spanData.output=c,{type:"function_output",tool:a.tool,output:c,runItem:new yt(uo(a.toolCall,c),e,c)}},{data:{name:a.tool.name}});if(l!==!0)return{type:"function_approval",tool:a.tool,runItem:new Ve(a.toolCall,e)}}return Xr(async l=>{n.config.traceIncludeSensitiveData&&(l.spanData.input=a.toolCall.arguments);try{n.emit("agent_tool_start",o._context,e,a.tool,{toolCall:a.toolCall}),e.emit("agent_tool_start",o._context,a.tool,{toolCall:a.toolCall});const u=await a.tool.invoke(o._context,a.toolCall.arguments,{toolCall:a.toolCall}),c=Mt(u);n.emit("agent_tool_end",o._context,e,a.tool,c,{toolCall:a.toolCall}),e.emit("agent_tool_end",o._context,a.tool,c,{toolCall:a.toolCall}),n.config.traceIncludeSensitiveData&&(l.spanData.output=c);const d={type:"function_output",tool:a.tool,output:u,runItem:new yt(uo(a.toolCall,u),e,u)},p=Nv(a.toolCall);if(p){d.agentRunResult=p;const m=p.interruptions;m.length>0&&(d.interruptions=m)}return d}catch(u){l.setError({message:"Error running tool",data:{tool_name:a.tool.name,error:String(u)}});const c=String(u);throw n.emit("agent_tool_end",o._context,e,a.tool,c,{toolCall:a.toolCall}),e.emit("agent_tool_end",o._context,a.tool,c,{toolCall:a.toolCall}),u}},{data:{name:a.tool.name}})}try{return await Promise.all(t.map(s))}catch(a){throw new By(`Failed to run function tools: ${a}`,a,o)}}async function J_(e,t){const n=t.action;let o;switch(n.type){case"click":await e.click(n.x,n.y,n.button);break;case"double_click":await e.doubleClick(n.x,n.y);break;case"drag":await e.drag(n.path.map(s=>[s.x,s.y]));break;case"keypress":await e.keypress(n.keys);break;case"move":await e.move(n.x,n.y);break;case"screenshot":o=await e.screenshot();break;case"scroll":await e.scroll(n.x,n.y,n.scroll_x,n.scroll_y);break;case"type":await e.type(n.text);break;case"wait":await e.wait();break}if(typeof o<"u"||typeof e.screenshot=="function"&&(o=await e.screenshot(),typeof o<"u"))return o;throw new Error("Computer does not implement screenshot()")}function Fu(e){if(e instanceof Error)return e.message||e.toString();try{return JSON.stringify(e)}catch{return String(e)}}async function V_(e,t,n,o,s=void 0){const a=s??H,r=[];for(const i of t){const l=i.shell,u=i.toolCall,c=new Ve(u,e,l.name);if(await l.needsApproval(o,u.action,u.callId)){if(l.onApproval){const x=await l.onApproval(o,c);x.approve===!0?o.approveTool(c):x.approve===!1&&o.rejectTool(c)}const b=o.isToolApproved({toolName:l.name,callId:u.callId});if(b===!1){const x="Tool execution was not approved.",k={stdout:"",stderr:x,outcome:{type:"exit",exitCode:null}};r.push(new yt({type:"shell_call_output",callId:u.callId,output:[k]},e,x));continue}if(b!==!0){r.push(c);continue}}n.emit("agent_tool_start",o,e,l,{toolCall:u}),typeof e.emit=="function"&&e.emit("agent_tool_start",o,l,{toolCall:u});let p;const m={};let y;try{const b=await l.shell.run(u.action);p=b.output??[],b.providerData&&Object.assign(m,b.providerData),typeof b.maxOutputLength=="number"&&(y=b.maxOutputLength)}catch(b){p=[{stdout:"",stderr:Fu(b),outcome:{type:"exit",exitCode:null}}],a.error("Failed to execute shell action:",b)}p=p??[],n.emit("agent_tool_end",o,e,l,JSON.stringify(p),{toolCall:u}),typeof e.emit=="function"&&e.emit("agent_tool_end",o,l,JSON.stringify(p),{toolCall:u});const _={type:"shell_call_output",callId:u.callId,output:p??[]};typeof y=="number"&&(_.maxOutputLength=y),Object.keys(m).length>0&&(_.providerData=m),r.push(new yt(_,e,_.output))}return r}async function H_(e,t,n,o,s=void 0){const a=s??H,r=[];for(const i of t){const l=i.applyPatch,u=i.toolCall,c=new Ve(u,e,l.name);if(await l.needsApproval(o,u.operation,u.callId)){if(l.onApproval){const b=await l.onApproval(o,c);b.approve===!0?o.approveTool(c):b.approve===!1&&o.rejectTool(c)}const _=o.isToolApproved({toolName:l.name,callId:u.callId});if(_===!1){const b="Tool execution was not approved.";r.push(new yt({type:"apply_patch_call_output",callId:u.callId,status:"failed",output:b},e,b));continue}if(_!==!0){r.push(c);continue}}n.emit("agent_tool_start",o,e,l,{toolCall:u}),typeof e.emit=="function"&&e.emit("agent_tool_start",o,l,{toolCall:u});let p="completed",m="";try{let _;switch(u.operation.type){case"create_file":_=await l.editor.createFile(u.operation);break;case"update_file":_=await l.editor.updateFile(u.operation);break;case"delete_file":_=await l.editor.deleteFile(u.operation);break;default:throw new Error("Unsupported apply_patch operation")}_&&typeof _.status=="string"&&(p=_.status),_&&typeof _.output=="string"&&(m=_.output)}catch(_){p="failed",m=Fu(_),a.error("Failed to execute apply_patch operation:",_)}n.emit("agent_tool_end",o,e,l,m,{toolCall:u}),typeof e.emit=="function"&&e.emit("agent_tool_end",o,l,m,{toolCall:u});const y={type:"apply_patch_call_output",callId:u.callId,status:p};m&&(y.output=m),r.push(new yt(y,e,m))}return r}async function Bu(e,t,n,o,s=void 0){const a=s??H,r=[];for(const i of t){const l=i.toolCall;n.emit("agent_tool_start",o,e,i.computer,{toolCall:l}),typeof e.emit=="function"&&e.emit("agent_tool_start",o,i.computer,{toolCall:l});let u;try{const p=await _u({tool:i.computer,runContext:o});u=await J_(p,l)}catch(p){a.error("Failed to execute computer action:",p),u=""}n.emit("agent_tool_end",o,e,i.computer,u,{toolCall:l}),typeof e.emit=="function"&&e.emit("agent_tool_end",o,i.computer,u,{toolCall:l});const c=u?`data:image/png;base64,${u}`:"",d={type:"computer_call_result",callId:l.callId,output:{type:"computer_screenshot",data:c}};r.push(new yt(d,e,c))}return r}async function G_(e,t,n,o,s,a,r,i){if(o=[...o],a.length===0)return H.warn("Incorrectly called executeHandoffCalls with no handoffs. This should not happen. Moving on."),new mt(t,s,n,o,{type:"next_step_run_again"});if(a.length>1){const u="Multiple handoffs detected, ignoring this one.";for(let c=1;c<a.length;c++)o.push(new yt(uo(a[c].toolCall,u),e,u))}const l=a[0];return D_(async u=>{const c=l.handoff,d=await c.onInvokeHandoff(i,l.toolCall.arguments);if(u.spanData.to_agent=d.name,a.length>1){const m=a.map(y=>y.handoff.agentName);u.setError({message:"Multiple handoffs requested",data:{requested_agents:m}})}o.push(new Bs(uo(l.toolCall,Iu(d)),e,d)),r.emit("agent_handoff",i,e,d),e.emit("agent_handoff",i,d);const p=c.inputFilter??r.config.handoffInputFilter;if(p){H.debug("Filtering inputs for handoff"),typeof p!="function"&&u.setError({message:"Invalid input filter",data:{details:"not callable"}});const m={inputHistory:Array.isArray(t)?[...t]:t,preHandoffItems:[...n],newItems:[...o],runContext:i},y=p(m);t=y.inputHistory,n=y.preHandoffItems,o=y.newItems}return new mt(t,s,n,o,{type:"next_step_handoff",newAgent:d})},{data:{from_agent:e.name}})}const Vn={isFinalOutput:!1,isInterrupted:void 0};async function W_(e,t,n){if(t.length===0)return Vn;const o=[];for(const r of t)if(r.runItem instanceof Ve&&o.push(r.runItem),r.type==="function_output"){if(Array.isArray(r.interruptions))o.push(...r.interruptions);else if(r.agentRunResult){const i=r.agentRunResult.interruptions;i.length>0&&o.push(...i)}}if(o.length>0)return{isFinalOutput:!1,isInterrupted:!0,interruptions:o};if(e.toolUseBehavior==="run_llm_again")return Vn;const s=t[0];if(e.toolUseBehavior==="stop_on_first_tool")return s?.type==="function_output"?{isFinalOutput:!0,isInterrupted:void 0,finalOutput:Mt(s.output)}:Vn;const a=e.toolUseBehavior;if(typeof a=="object"){const r=t.find(i=>a.stopAtToolNames.includes(i.tool.name));return r?.type==="function_output"?{isFinalOutput:!0,isInterrupted:void 0,finalOutput:Mt(r.output)}:Vn}if(typeof a=="function")return a(n._context,t);throw new _e(`Invalid toolUseBehavior: ${a}`,n)}function K_(e){if(e instanceof Ao)return"message_output_created";if(e instanceof Fs)return"handoff_requested";if(e instanceof Bs)return"handoff_occurred";if(e instanceof St)return"tool_called";if(e instanceof yt)return"tool_output";if(e instanceof zs)return"reasoning_item_created";if(e instanceof Ve)return"tool_approval_requested"}function Zu(e,t){const n=K_(t);if(!n){H.warn("Unknown item type: ",t);return}e._addItem(new R_(n,t))}function Y_(e,t){for(const n of t)Zu(e,n)}function aa(e,t,n){const o=n?.skipItems;for(const s of t.newStepItems)o?.has(s)||Zu(e,s)}class ia{#e=new Map;addToolUse(t,n){this.#e.set(t,n)}hasUsedTools(t){return this.#e.has(t)}toJSON(){return Object.fromEntries(Array.from(this.#e.entries()).map(([t,n])=>[t.name,n]))}}function Q_(e){return typeof e=="string"?[{type:"message",role:"user",content:e}]:[...e]}function ju(e){return e.filter(t=>t.type!=="tool_approval_item").map(t=>t.rawItem)}function Zs(e){return e.map(t=>ds(ps(t)))}function ds(e,t={}){if(e==null)return e;const n=X_(e);if(n)return ew(n,t.mediaType);if(Array.isArray(e))return e.map(r=>ds(r,t));if(!qu(e))return e;const o=e,s={},a=typeof o.mediaType=="string"&&o.mediaType.length>0?o.mediaType:t.mediaType;for(const[r,i]of Object.entries(o)){const l=r==="data"||r==="fileData"?{mediaType:a}:t;s[r]=ds(i,l)}return s}function X_(e){if(e instanceof ArrayBuffer)return new Uint8Array(e);if(Mn(e)){const t=e;return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}if(Us(e)){const t=e;return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}if(ko(e))return Uint8Array.from(e.data)}function ew(e,t){const n=et(e);return`data:${t&&!t.startsWith("data:")?t:"text/plain"};base64,${n}`}function qu(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}function ps(e){if(e==null)return e;if(Array.isArray(e))return e.map(a=>ps(a));if(!qu(e))return e;const t=e,n={},s=typeof t.type=="string"&&t.type.length>0&&tw(t.type);for(const[a,r]of Object.entries(t))s&&a==="id"||(n[a]=ps(r));return n}function tw(e){switch(e){case"function_call":case"function_call_result":return!0;default:return!1}}async function lo(e,t,n){if(!M_(e))return;const o=await e.runCompaction(typeof t>"u"?void 0:{responseId:t});if(!o)return;const s=o.usage;n._context.usage.add(new Ln({requests:1,inputTokens:s.inputTokens,outputTokens:s.outputTokens,totalTokens:s.totalTokens,inputTokensDetails:s.inputTokensDetails,outputTokensDetails:s.outputTokensDetails,requestUsageEntries:[s]}))}async function nw(e,t,n){if(!e)return;const o=t??[],s=n.state,a=s._currentTurnPersistedItemCount??0,r=n.newItems.slice(a);L_.OPENAI_AGENTS__DEBUG_SAVE_SESSION&&console.debug("saveToSession:newRunItems",r.map(c=>c.type));const i=ju(r),l=[...o,...i];if(l.length===0){s._currentTurnPersistedItemCount=a+r.length,await lo(e,n.lastResponseId,s);return}const u=Zs(l);await e.addItems(u),await lo(e,n.lastResponseId,s),s._currentTurnPersistedItemCount=a+r.length}async function ow(e,t){if(!e||!t||t.length===0)return;const n=Zs(t);await e.addItems(n)}async function ua(e,t){if(!e)return;const n=t.state,o=n._currentTurnPersistedItemCount??0,s=t.newItems.slice(o),a=ju(s);if(a.length===0){n._currentTurnPersistedItemCount=o+s.length,await lo(e,t.lastResponseId,n);return}const r=Zs(a);await e.addItems(r),await lo(e,t.lastResponseId,n),n._currentTurnPersistedItemCount=o+s.length}async function sw(e,t,n,o){if(!t)return{preparedInput:e,sessionItems:void 0};const s=o?.includeHistoryInPreparedInput??!0,a=o?.preserveDroppedNewItems??!1,r=await t.getItems(),i=Array.isArray(e)?[...e]:Q_(e);if(!n)return{preparedInput:s?[...r,...i]:i,sessionItems:i};const l=r.slice(),u=i.slice(),c=await n(r,i);if(!Array.isArray(c))throw new _e("Session input callback must return an array of AgentInputItem objects.");const d=ca(l),p=ca(u),m=da(l),y=da(u),_=[];for(const x of c){const k=js(x);if(pa(y,k,x)){fa(p,k),_.push(x);continue}if(pa(m,k,x)){fa(d,k);continue}const S=d.get(k)??0;if(S>0){d.set(k,S-1);continue}const A=p.get(k)??0;if(A>0){p.set(k,A-1),_.push(x);continue}_.push(x)}return{preparedInput:s?c:_.length>0?_:a?u:[],sessionItems:_}}function rw(e){if(Array.isArray(e)){const n=[];for(const o of e){const s=la(o);if(!s)return null;n.push(s)}return n}const t=la(e);return t?[t]:null}function la(e){if(!jt(e))return null;const t=e.type;if(t==="text"&&typeof e.text=="string"){const n={type:"text",text:e.text};return jt(e.providerData)&&(n.providerData=e.providerData),n}if(t==="image"){const n={type:"image"};let o,s;const a=Fe(e.mediaType)?e.mediaType:void 0,r=e.image;if(typeof r=="string"&&r.length>0)o=r;else if(jt(r)){const i=r,l=Fe(i.mediaType)?i.mediaType:a;if(Fe(i.url)?o=i.url:(Fe(i.data)||i.data instanceof Uint8Array&&i.data.length>0)&&(o=Jn(i.data,l)),!o){const u=Fe(i.fileId)&&i.fileId||Fe(i.id)&&i.id||void 0;u&&(s=u)}}if(!o&&typeof e.imageUrl=="string"&&e.imageUrl.length>0&&(o=e.imageUrl),!s&&typeof e.fileId=="string"&&e.fileId.length>0&&(s=e.fileId),!o&&typeof e.data=="string"&&e.data.length>0?o=a?Jn(e.data,a):e.data:!o&&e.data instanceof Uint8Array&&e.data.length>0&&(o=Jn(e.data,a)),typeof e.detail=="string"&&e.detail.length>0&&(n.detail=e.detail),o)n.image=o;else if(s)n.image={fileId:s};else return null;return jt(e.providerData)&&(n.providerData=e.providerData),n}if(t==="file"){const n=Z_(e);if(!n)return null;const o={type:"file",file:n};return jt(e.providerData)&&(o.providerData=e.providerData),o}return null}function aw(e){if(e.type==="text"){const n={type:"input_text",text:e.text};return e.providerData&&(n.providerData=e.providerData),n}if(e.type==="image"){const n={type:"input_image"};if(typeof e.detail=="string"&&e.detail.length>0&&(n.detail=e.detail),typeof e.image=="string"&&e.image.length>0)n.image=e.image;else if(jt(e.image)){const o=e.image,s=Fe(o.mediaType)?o.mediaType:void 0;if(Fe(o.url))n.image=o.url;else if(Fe(o.data))n.image=s&&!o.data.startsWith("data:")?on(o.data,s):o.data;else if(o.data instanceof Uint8Array&&o.data.length>0){const a=et(o.data);n.image=on(a,s)}else{const a=Fe(o.fileId)&&o.fileId||Fe(o.id)&&o.id||void 0;a&&(n.image={id:a})}}return e.providerData&&(n.providerData=e.providerData),n}if(e.type==="file"){const n={type:"input_file"},o=e.file;if(typeof o=="string")n.file=o;else if(o&&typeof o=="object"){const s=o;if("data"in s&&s.data){const a=s.mediaType??"text/plain";if(typeof s.data=="string")n.file=on(s.data,a);else{const r=et(s.data);n.file=on(r,a)}}else if(typeof s.url=="string"&&s.url.length>0)n.file={url:s.url};else{const a=typeof s.id=="string"&&s.id.length>0&&s.id||(typeof s.fileId=="string"&&s.fileId.length>0?s.fileId:void 0);a&&(n.file={id:a})}typeof s.filename=="string"&&s.filename.length>0&&(n.filename=s.filename)}return e.providerData&&(n.providerData=e.providerData),n}return e}function ca(e){const t=new Map;for(const n of e){const o=js(n);t.set(o,(t.get(o)??0)+1)}return t}function da(e){const t=new Map;for(const n of e){const o=js(n),s=t.get(o);s?s.push(n):t.set(o,[n])}return t}function pa(e,t,n){const o=e.get(t);if(!o||o.length===0)return!1;const s=o.findIndex(a=>a===n);return s===-1?!1:(o.splice(s,1),o.length===0&&e.delete(t),!0)}function fa(e,t){const n=(e.get(t)??0)-1;n<=0?e.delete(t):e.set(t,n)}function js(e){return JSON.stringify(e,iw)}function iw(e,t){if(t instanceof ArrayBuffer)return{__type:"ArrayBuffer",data:et(new Uint8Array(t))};if(Mn(t)){const n=t;return{__type:n.constructor.name,data:et(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}}if(Us(t)){const n=t;return{__type:"Buffer",data:et(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}}return ko(t)?{__type:"Buffer",data:et(Uint8Array.from(t.data))}:t}const Kn="1.0",uw=C(Kn),pt=T({name:f()}),lw=T({object:C("trace.span"),id:f(),trace_id:f(),parent_id:f().nullable(),started_at:f().nullable(),ended_at:f().nullable(),error:T({message:f(),data:we(f(),ae()).optional()}).nullable(),span_data:we(f(),ae())}),Ju=lw.extend({previous_span:qg(()=>Ju).optional()}),cw=T({inputTokens:N(),outputTokens:N(),totalTokens:N(),inputTokensDetails:we(f(),N()).optional(),outputTokensDetails:we(f(),N()).optional(),endpoint:f().optional()}),Vu=T({requests:N(),inputTokens:N(),outputTokens:N(),totalTokens:N(),inputTokensDetails:se(we(f(),N())).optional(),outputTokensDetails:se(we(f(),N())).optional(),requestUsageEntries:se(cw).optional()}),ma=T({usage:Vu,output:se(Ns),responseId:f().optional(),providerData:we(f(),ae()).optional()}),Hu=je("type",[T({type:C("message_output_item"),rawItem:So,agent:pt}),T({type:C("tool_call_item"),rawItem:y_.or(Dn),agent:pt}),T({type:C("tool_call_output_item"),rawItem:io,agent:pt,output:f()}),T({type:C("reasoning_item"),rawItem:Ls,agent:pt}),T({type:C("handoff_call_item"),rawItem:$n,agent:pt}),T({type:C("handoff_output_item"),rawItem:io,sourceAgent:pt,targetAgent:pt}),T({type:C("tool_approval_item"),rawItem:$n.or(Dn).or(To).or(Co),agent:pt,toolName:f().optional()})]),dw=T({object:C("trace"),id:f(),workflow_name:f(),group_id:f().nullable(),metadata:we(f(),ae())}),pw=T({newItems:se(Hu),toolsUsed:se(f()),handoffs:se(T({toolCall:ae(),handoff:ae()})),functions:se(T({toolCall:ae(),tool:ae()})),computerActions:se(T({toolCall:ae(),computer:ae()})),shellActions:se(T({toolCall:ae(),shell:ae()})).optional(),applyPatchActions:se(T({toolCall:ae(),applyPatch:ae()})).optional(),mcpApprovalRequests:se(T({requestItem:T({rawItem:T({type:C("hosted_tool_call"),name:f(),arguments:f().optional(),status:f().optional(),output:f().optional(),providerData:we(f(),ae()).nullable().optional()})}),mcpTool:T({type:C("hosted_tool"),name:C("hosted_mcp"),providerData:we(f(),ae())})})).optional()}),Gu=T({tripwireTriggered:Jt(),outputInfo:ae()}),fw=T({guardrail:T({type:C("input"),name:f()}),output:Gu}),mw=T({guardrail:T({type:C("output"),name:f()}),agentOutput:ae(),agent:pt,output:Gu}),ha=T({$schemaVersion:uw,currentTurn:N(),currentAgent:pt,originalInput:f().or(se(v_)),modelResponses:se(ma),context:T({usage:Vu,approvals:we(f(),T({approved:se(f()).or(Jt()),rejected:se(f()).or(Jt())})),context:we(f(),ae())}),toolUseTracker:we(f(),se(f())),maxTurns:N(),currentAgentSpan:Ju.nullable().optional(),noActiveAgentRun:Jt(),inputGuardrailResults:se(fw),outputGuardrailResults:se(mw),currentStep:F_.optional(),lastModelResponse:ma.optional(),generatedItems:se(Hu),lastProcessedResponse:pw.optional(),currentTurnPersistedItemCount:N().int().min(0).optional(),trace:dw.nullable()});class xt{_currentTurn=0;_currentAgent;_originalInput;_modelResponses;_currentAgentSpan;_context;get usage(){return this._context.usage}_toolUseTracker;_generatedItems;_currentTurnPersistedItemCount;_maxTurns;_noActiveAgentRun=!0;_lastTurnResponse;_inputGuardrailResults;_outputGuardrailResults;_currentStep=void 0;_lastProcessedResponse=void 0;_trace=null;constructor(t,n,o,s){this._context=t,this._originalInput=structuredClone(n),this._modelResponses=[],this._currentAgentSpan=void 0,this._currentAgent=o,this._toolUseTracker=new ia,this._generatedItems=[],this._currentTurnPersistedItemCount=0,this._maxTurns=s,this._inputGuardrailResults=[],this._outputGuardrailResults=[],this._trace=dn()}get history(){return an(this._originalInput,this._generatedItems)}getInterruptions(){return this._currentStep?.type!=="next_step_interruption"?[]:this._currentStep.data.interruptions}approve(t,n={alwaysApprove:!1}){this._context.approveTool(t,n)}reject(t,n={alwaysReject:!1}){this._context.rejectTool(t,n)}toJSON(){const t={$schemaVersion:Kn,currentTurn:this._currentTurn,currentAgent:{name:this._currentAgent.name},originalInput:this._originalInput,modelResponses:this._modelResponses.map(o=>({usage:{requests:o.usage.requests,inputTokens:o.usage.inputTokens,outputTokens:o.usage.outputTokens,totalTokens:o.usage.totalTokens,inputTokensDetails:o.usage.inputTokensDetails,outputTokensDetails:o.usage.outputTokensDetails,...o.usage.requestUsageEntries&&o.usage.requestUsageEntries.length>0?{requestUsageEntries:o.usage.requestUsageEntries.map(s=>({inputTokens:s.inputTokens,outputTokens:s.outputTokens,totalTokens:s.totalTokens,inputTokensDetails:s.inputTokensDetails,outputTokensDetails:s.outputTokensDetails,...s.endpoint?{endpoint:s.endpoint}:{}}))}:{}},output:o.output,responseId:o.responseId,providerData:o.providerData})),context:this._context.toJSON(),toolUseTracker:this._toolUseTracker.toJSON(),maxTurns:this._maxTurns,currentAgentSpan:this._currentAgentSpan?.toJSON(),noActiveAgentRun:this._noActiveAgentRun,inputGuardrailResults:this._inputGuardrailResults,outputGuardrailResults:this._outputGuardrailResults.map(o=>({...o,agent:o.agent.toJSON()})),currentStep:this._currentStep,lastModelResponse:this._lastTurnResponse,generatedItems:this._generatedItems.map(o=>o.toJSON()),currentTurnPersistedItemCount:this._currentTurnPersistedItemCount,lastProcessedResponse:this._lastProcessedResponse,trace:this._trace?this._trace.toJSON():null},n=ha.safeParse(t);if(!n.success)throw new Fy(`Failed to serialize run state. ${n.error.message}`);return n.data}toString(){return JSON.stringify(this.toJSON())}static async fromString(t,n){const[o,s]=await Is(()=>JSON.parse(n));if(o)throw new _e(`Failed to parse run state. ${o instanceof Error?o.message:String(o)}`);const a=s.$schemaVersion;if(!a)throw new _e("Run state is missing schema version");if(a!==Kn)throw new _e(`Run state schema version ${a} is not supported. Please use version ${Kn}`);const r=ha.parse(JSON.parse(n)),i=hw(t),l=new nn(r.context.context);l._rebuildApprovals(r.context.approvals);const u=i.get(r.currentAgent.name);if(!u)throw new _e(`Agent ${r.currentAgent.name} not found`);const c=new xt(l,"",u,r.maxTurns);c._currentTurn=r.currentTurn,c._toolUseTracker=new ia;for(const[d,p]of Object.entries(r.toolUseTracker))c._toolUseTracker.addToolUse(i.get(d),p);if(r.currentAgentSpan){r.trace||H.warn("Trace is not set, skipping tracing setup");const d=_t().createTrace({traceId:r.trace?.id,name:r.trace?.workflow_name,groupId:r.trace?.group_id??void 0,metadata:r.trace?.metadata});c._currentAgentSpan=Wu(d,r.currentAgentSpan),c._trace=d}return c._noActiveAgentRun=r.noActiveAgentRun,c._inputGuardrailResults=r.inputGuardrailResults,c._outputGuardrailResults=r.outputGuardrailResults.map(d=>({...d,agent:i.get(d.agent.name)})),c._currentStep=r.currentStep,c._originalInput=r.originalInput,c._modelResponses=r.modelResponses.map(ga),c._lastTurnResponse=r.lastModelResponse?ga(r.lastModelResponse):void 0,c._generatedItems=r.generatedItems.map(d=>Ku(d,i)),c._currentTurnPersistedItemCount=r.currentTurnPersistedItemCount??0,c._lastProcessedResponse=r.lastProcessedResponse?await gw(i,c._currentAgent,c._context,r.lastProcessedResponse):void 0,r.currentStep?.type==="next_step_handoff"&&(c._currentStep={type:"next_step_handoff",newAgent:i.get(r.currentStep.newAgent.name)}),c}}function hw(e){const t=new Map,n=[e];for(;n.length>0;){const o=n.shift();if(!t.has(o.name)){t.set(o.name,o);for(const s of o.handoffs)s instanceof ut?t.has(s.name)||n.push(s):s.agent&&(t.has(s.agent.name)||n.push(s.agent))}}return t}function Wu(e,t){const n=t.span_data,o=t.previous_span?Wu(e,t.previous_span):void 0,s=_t().createSpan({spanId:t.id,traceId:t.trace_id,parentId:t.parent_id??void 0,startedAt:t.started_at??void 0,endedAt:t.ended_at??void 0,data:n},e);return s.previousSpan=o,s}function ga(e){return{usage:new Ln(e.usage),output:e.output.map(n=>Ns.parse(n)),responseId:e.responseId,providerData:e.providerData}}function Ku(e,t){switch(e.type){case"message_output_item":return new Ao(e.rawItem,t.get(e.agent.name));case"tool_call_item":return new St(e.rawItem,t.get(e.agent.name));case"tool_call_output_item":return new yt(e.rawItem,t.get(e.agent.name),e.output);case"reasoning_item":return new zs(e.rawItem,t.get(e.agent.name));case"handoff_call_item":return new Fs(e.rawItem,t.get(e.agent.name));case"handoff_output_item":return new Bs(e.rawItem,t.get(e.sourceAgent.name),t.get(e.targetAgent.name));case"tool_approval_item":return new Ve(e.rawItem,t.get(e.agent.name),e.toolName)}}async function gw(e,t,n,o){const s=await t.getAllTools(n),a=new Map(s.filter(d=>d.type==="function").map(d=>[d.name,d])),r=new Map(s.filter(d=>d.type==="computer").map(d=>[d.name,d])),i=new Map(s.filter(d=>d.type==="shell").map(d=>[d.name,d])),l=new Map(s.filter(d=>d.type==="apply_patch").map(d=>[d.name,d])),u=new Map(t.handoffs.map(d=>d instanceof ut?[d.name,Su(d)]:[d.toolName,d])),c={newItems:o.newItems.map(d=>Ku(d,e)),toolsUsed:o.toolsUsed,handoffs:o.handoffs.map(d=>{if(!u.has(d.handoff.toolName))throw new _e(`Handoff ${d.handoff.toolName} not found`);return{toolCall:d.toolCall,handoff:u.get(d.handoff.toolName)}}),functions:await Promise.all(o.functions.map(async d=>{if(!a.has(d.tool.name))throw new _e(`Tool ${d.tool.name} not found`);return{toolCall:d.toolCall,tool:a.get(d.tool.name)}})),computerActions:o.computerActions.map(d=>{const p=d.computer.name;if(!r.has(p))throw new _e(`Computer tool ${p} not found`);return{toolCall:d.toolCall,computer:r.get(p)}}),shellActions:(o.shellActions??[]).map(d=>{const p=d.shell.name;if(!i.has(p))throw new _e(`Shell tool ${p} not found`);return{toolCall:d.toolCall,shell:i.get(p)}}),applyPatchActions:(o.applyPatchActions??[]).map(d=>{const p=d.applyPatch.name;if(!l.has(p))throw new _e(`Apply patch tool ${p} not found`);return{toolCall:d.toolCall,applyPatch:l.get(p)}}),mcpApprovalRequests:(o.mcpApprovalRequests??[]).map(d=>({requestItem:new Ve(d.requestItem.rawItem,t),mcpTool:d.mcpTool}))};return{...c,hasToolsOrApprovalsToRun(){return c.handoffs.length>0||c.functions.length>0||c.mcpApprovalRequests.length>0||c.computerActions.length>0||c.shellActions.length>0||c.applyPatchActions.length>0}}}class yw extends $v{config;constructor(t={}){super(),this.config={modelProvider:t.modelProvider??Fv(),model:t.model,modelSettings:t.modelSettings,handoffInputFilter:t.handoffInputFilter,inputGuardrails:t.inputGuardrails,outputGuardrails:t.outputGuardrails,tracingDisabled:t.tracingDisabled??!1,traceIncludeSensitiveData:t.traceIncludeSensitiveData??!0,workflowName:t.workflowName??"Agent workflow",traceId:t.traceId,groupId:t.groupId,traceMetadata:t.traceMetadata,sessionInputCallback:t.sessionInputCallback,callModelInputFilter:t.callModelInputFilter},this.inputGuardrailDefs=(t.inputGuardrails??[]).map(Qr),this.outputGuardrailDefs=(t.outputGuardrails??[]).map(cs)}async run(t,n,o={stream:!1,context:void 0}){const s=o??{stream:!1,context:void 0},a=s.sessionInputCallback??this.config.sessionInputCallback,r=s.callModelInputFilter??this.config.callModelInputFilter,i=!!r,l={...s,sessionInputCallback:a,callModelInputFilter:r},u=!!l.conversationId||!!l.previousResponseId,c=l.session,d=n instanceof xt;let p=c&&d?[]:void 0,m,y=c&&d?new Map:void 0;const _=(A,w)=>{const D=y;if(w!==void 0){if(!D){m=w.map(j=>structuredClone(j));return}const B=[],R=new WeakMap;for(const j of A){if(!j||typeof j!="object")continue;const J=(R.get(j)??0)+1;R.set(j,J)}const z=()=>{for(const[j,J]of D)if(J>0)return D.set(j,J-1),!0;return!1};for(let j=0;j<w.length;j++){const J=w[j];if(!J)continue;let le=!1;const oe=A[j];if(oe&&typeof oe=="object"){const ie=(R.get(oe)??0)-1;if(R.set(oe,ie),ie>0)continue;const X=qt(oe),Be=D.get(X)??0;if(Be>0){D.set(X,Be-1),B.push(structuredClone(J)),le=!0;continue}}const ve=qt(J),Ae=D.get(ve)??0;if(Ae>0){D.set(ve,Ae-1),B.push(structuredClone(J)),le=!0;continue}!oe&&z()&&(B.push(structuredClone(J)),le=!0),!le&&!oe&&m===void 0&&B.push(structuredClone(J))}(B.length>0||m===void 0)&&(m=B);return}const E=[];if(D)for(const B of A){if(!B)continue;const R=qt(B),z=D.get(R)??0;z<=0||(D.set(R,z-1),E.push(structuredClone(B)))}else for(const B of A)B&&E.push(structuredClone(B));E.length>0?m=E:m===void 0&&(m=[])},b=()=>{if(m!==void 0)return m;if(!i)return p};let x=n;if(!(x instanceof xt)){if(c&&Array.isArray(x)&&!a)throw new _e("RunConfig.sessionInputCallback must be provided when using session history with list inputs.");const A=await sw(x,c,a,{includeHistoryInPreparedInput:!u,preserveDroppedNewItems:u});if(u&&c){const w=A.sessionItems;w&&w.length>0?x=w:x=A.preparedInput}else x=A.preparedInput;if(c){const w=A.sessionItems??[];p=w.map(D=>structuredClone(D)),y=new Map;for(const D of w){const E=qt(D);y.set(E,(y.get(E)??0)+1)}}}let k;if(c&&!u){let A=!1;k=async()=>{if(A)return;const w=b();!w||w.length===0||(A=!0,await ow(c,w))}}const S=async()=>{if(l.stream)return await this.#r(t,x,l,k,_);const A=await this.#n(t,x,l,_);return c&&!u&&await nw(c,b(),A),A};return x instanceof xt&&x._trace?xw(x._trace,async()=>(x._currentAgentSpan&&qs(x._currentAgentSpan),S())):Sw(async()=>S(),{traceId:this.config.traceId,name:this.config.workflowName,groupId:this.config.groupId,metadata:this.config.traceMetadata})}inputGuardrailDefs;outputGuardrailDefs;#e(t){return this.inputGuardrailDefs.concat(t._currentAgent.inputGuardrails.map(Qr))}#t(t){const n=this.#e(t),o=[],s=[];for(const a of n)a.runInParallel===!1?o.push(a):s.push(a);return{blocking:o,parallel:s}}async#s(t){const n=t.model!==void 0&&t.model!==ut.DEFAULT_MODEL_PLACEHOLDER||this.config.model!==void 0&&this.config.model!==ut.DEFAULT_MODEL_PLACEHOLDER;let o=vw(t.model,this.config.model);return typeof o=="string"&&(o=await this.config.modelProvider.getModel(o)),{model:o,explictlyModelSet:n}}async#n(t,n,o,s){return ms(async()=>{const a=n instanceof xt,r=a?n:new xt(o.context instanceof nn?o.context:new nn(o.context),n,t,o.maxTurns??ya),i=o.conversationId||o.previousResponseId?new _a({conversationId:o.conversationId,previousResponseId:o.previousResponseId}):void 0;i&&a&&i.primeFromState({originalInput:r._originalInput,generatedItems:r._generatedItems,modelResponses:r._modelResponses});let l=!1;try{for(;;){if(r._currentStep=r._currentStep??{type:"next_step_run_again"},r._currentStep.type==="next_step_interruption"){if(H.debug("Continuing from interruption"),!r._lastTurnResponse||!r._lastProcessedResponse)throw new _e("No model response found in previous state",r);const u=await sa(r._currentAgent,r._originalInput,r._generatedItems,r._lastTurnResponse,r._lastProcessedResponse,this,r);if(r._toolUseTracker.addToolUse(r._currentAgent,r._lastProcessedResponse.toolsUsed),r._originalInput=u.originalInput,r._generatedItems=u.generatedItems,u.nextStep.type==="next_step_interruption")return r._currentStep=u.nextStep,new Vo(r);if(u.nextStep.type==="next_step_run_again"){l=!0,r._currentStep=void 0;continue}l=!1,r._currentStep=u.nextStep}if(r._currentStep.type==="next_step_run_again"){const u=await wa(r),c=a&&l;if(l=!1,c||(r._currentTurn++,r._currentTurnPersistedItemCount=0),r._currentTurn>r._maxTurns)throw r._currentAgentSpan?.setError({message:"Max turns exceeded",data:{max_turns:r._maxTurns}}),new zr(`Max turns (${r._maxTurns}) exceeded`,r);H.debug(`Running agent ${r._currentAgent.name} (turn ${r._currentTurn})`);let d;if(r._currentTurn===1&&!c){const b=this.#t(r);b.blocking.length>0&&await this.#a(r,b.blocking),b.parallel.length>0&&(d=this.#a(r,b.parallel),d.catch(()=>{}))}const p=i?i.prepareInput(r._originalInput,r._generatedItems):an(r._originalInput,r._generatedItems);r._noActiveAgentRun&&(r._currentAgent.emit("agent_start",r._context,r._currentAgent,p),this.emit("agent_start",r._context,r._currentAgent,p));const m=await this.#u(r,o,u,p,i,s);r._lastTurnResponse=await m.model.getResponse({systemInstructions:m.modelInput.instructions,prompt:m.prompt,...m.explictlyModelSet?{overridePromptModel:!0}:{},input:m.modelInput.input,previousResponseId:m.previousResponseId,conversationId:m.conversationId,modelSettings:m.modelSettings,tools:m.serializedTools,toolsExplicitlyProvided:m.toolsExplicitlyProvided,outputType:jr(r._currentAgent.outputType),handoffs:m.serializedHandoffs,tracing:va(this.config.tracingDisabled,this.config.traceIncludeSensitiveData),signal:o.signal}),r._modelResponses.push(r._lastTurnResponse),r._context.usage.add(r._lastTurnResponse.usage),r._noActiveAgentRun=!1,i?.trackServerItems(r._lastTurnResponse);const y=oa(r._lastTurnResponse,r._currentAgent,m.tools,m.handoffs);r._lastProcessedResponse=y;const _=await ra(r._currentAgent,r._originalInput,r._generatedItems,r._lastTurnResponse,r._lastProcessedResponse,this,r);r._toolUseTracker.addToolUse(r._currentAgent,r._lastProcessedResponse.toolsUsed),r._originalInput=_.originalInput,r._generatedItems=_.generatedItems,_.nextStep.type==="next_step_run_again"&&(r._currentTurnPersistedItemCount=0),r._currentStep=_.nextStep,d&&await d}if(r._currentStep&&r._currentStep.type==="next_step_final_output")return await this.#o(r,r._currentStep.output),this.emit("agent_end",r._context,r._currentAgent,r._currentStep.output),r._currentAgent.emit("agent_end",r._context,r._currentStep.output),new Vo(r);if(r._currentStep&&r._currentStep.type==="next_step_handoff")r._currentAgent=r._currentStep.newAgent,r._currentAgentSpan&&(r._currentAgentSpan.end(),kn(),r._currentAgentSpan=void 0),r._noActiveAgentRun=!0,r._currentStep={type:"next_step_run_again"};else{if(r._currentStep&&r._currentStep.type==="next_step_interruption")return new Vo(r);H.debug("Running next loop")}}}catch(u){throw r._currentAgentSpan&&r._currentAgentSpan.setError({message:"Error in agent run",data:{error:String(u)}}),u}finally{if(r._currentStep?.type!=="next_step_interruption")try{await Kr({runContext:r._context})}catch(u){H.warn(`Failed to dispose computers after run: ${u}`)}r._currentAgentSpan&&(r._currentStep?.type!=="next_step_interruption"&&r._currentAgentSpan.end(),kn())}})}async#i(t,n,o,s,a){const r=!!n.conversationId||!!n.previousResponseId,i=r?new _a({conversationId:n.conversationId,previousResponseId:n.previousResponseId}):void 0;let l=!1,u=!1;const c=async()=>{u||!s||(await s(),u=!0)};i&&o&&i.primeFromState({originalInput:t.state._originalInput,generatedItems:t.state._generatedItems,modelResponses:t.state._modelResponses});let d=!1;try{for(;;){const p=t.state._currentAgent;if(t.state._currentStep=t.state._currentStep??{type:"next_step_run_again"},t.state._currentStep.type==="next_step_interruption"){if(H.debug("Continuing from interruption"),!t.state._lastTurnResponse||!t.state._lastProcessedResponse)throw new _e("No model response found in previous state",t.state);const m=await sa(t.state._currentAgent,t.state._originalInput,t.state._generatedItems,t.state._lastTurnResponse,t.state._lastProcessedResponse,this,t.state);if(aa(t,m),t.state._toolUseTracker.addToolUse(t.state._currentAgent,t.state._lastProcessedResponse.toolsUsed),t.state._originalInput=m.originalInput,t.state._generatedItems=m.generatedItems,m.nextStep.type==="next_step_interruption"){t.state._currentStep=m.nextStep;return}if(m.nextStep.type==="next_step_run_again"){d=!0,t.state._currentStep=void 0;continue}d=!1,t.state._currentStep=m.nextStep}if(t.state._currentStep.type==="next_step_run_again"){const m=await wa(t.state),y=o&&d;if(d=!1,y||(t.state._currentTurn++,t.state._currentTurnPersistedItemCount=0),t.state._currentTurn>t.state._maxTurns)throw t.state._currentAgentSpan?.setError({message:"Max turns exceeded",data:{max_turns:t.state._maxTurns}}),new zr(`Max turns (${t.state._maxTurns}) exceeded`,t.state);H.debug(`Running agent ${p.name} (turn ${t.state._currentTurn})`);let _,b;if(t.state._currentTurn===1&&!y){const E=this.#t(t.state);E.blocking.length>0&&await this.#a(t.state,E.blocking),E.parallel.length>0&&(b=this.#a(t.state,E.parallel).catch(R=>(_=R,[])))}const x=i?i.prepareInput(t.input,t.newItems):an(t.input,t.newItems);t.state._noActiveAgentRun&&(p.emit("agent_start",t.state._context,p,x),this.emit("agent_start",t.state._context,p,x));let k;const S=await this.#u(t.state,n,m,x,i,a);if(_)throw _;l=!0,await c();for await(const E of S.model.getStreamedResponse({systemInstructions:S.modelInput.instructions,prompt:S.prompt,...S.explictlyModelSet?{overridePromptModel:!0}:{},input:S.modelInput.input,previousResponseId:S.previousResponseId,conversationId:S.conversationId,modelSettings:S.modelSettings,tools:S.serializedTools,toolsExplicitlyProvided:S.toolsExplicitlyProvided,handoffs:S.serializedHandoffs,outputType:jr(p.outputType),tracing:va(this.config.tracingDisabled,this.config.traceIncludeSensitiveData),signal:n.signal})){if(_)throw _;if(E.type==="response_done"){const B=Lu.parse(E);k={usage:new Ln(B.response.usage),output:B.response.output,responseId:B.response.id},t.state._context.usage.add(k.usage)}if(t.cancelled)return;t._addItem(new O_(E))}if(b&&(await b,_))throw _;if(t.state._noActiveAgentRun=!1,!k)throw new Ge("Model did not produce a final response!",t.state);t.state._lastTurnResponse=k,i?.trackServerItems(k),t.state._modelResponses.push(t.state._lastTurnResponse);const A=oa(t.state._lastTurnResponse,p,S.tools,S.handoffs);t.state._lastProcessedResponse=A;const w=new Set(A.newItems);w.size>0&&Y_(t,A.newItems);const D=await ra(p,t.state._originalInput,t.state._generatedItems,t.state._lastTurnResponse,t.state._lastProcessedResponse,this,t.state);aa(t,D,{skipItems:w}),t.state._toolUseTracker.addToolUse(p,A.toolsUsed),t.state._originalInput=D.originalInput,t.state._generatedItems=D.generatedItems,D.nextStep.type==="next_step_run_again"&&(t.state._currentTurnPersistedItemCount=0),t.state._currentStep=D.nextStep}if(t.state._currentStep.type==="next_step_final_output"){await this.#o(t.state,t.state._currentStep.output),await c(),r||await ua(n.session,t),this.emit("agent_end",t.state._context,p,t.state._currentStep.output),p.emit("agent_end",t.state._context,t.state._currentStep.output);return}else if(t.state._currentStep.type==="next_step_interruption"){await c(),r||await ua(n.session,t);return}else t.state._currentStep.type==="next_step_handoff"?(t.state._currentAgent=t.state._currentStep?.newAgent,t.state._currentAgentSpan&&(t.state._currentAgentSpan.end(),kn()),t.state._currentAgentSpan=void 0,t._addItem(new P_(t.state._currentAgent)),t.state._noActiveAgentRun=!0,t.state._currentStep={type:"next_step_run_again"}):H.debug("Running next loop")}}catch(p){throw l&&!u&&await c(),t.state._currentAgentSpan&&t.state._currentAgentSpan.setError({message:"Error in agent run",data:{error:String(p)}}),p}finally{if(t.state._currentStep?.type!=="next_step_interruption")try{await Kr({runContext:t.state._context})}catch(p){H.warn(`Failed to dispose computers after run: ${p}`)}t.state._currentAgentSpan&&(t.state._currentStep?.type!=="next_step_interruption"&&t.state._currentAgentSpan.end(),kn())}}async#r(t,n,o,s,a){return o=o??{},ms(async()=>{const r=n instanceof xt,i=r?n:new xt(o.context instanceof nn?o.context:new nn(o.context),n,t,o.maxTurns??ya),l=new Qu({signal:o.signal,state:i});l.maxTurns=o.maxTurns??i._maxTurns;const u=this.#i(l,o,r,s,a).then(()=>{l._done()},c=>{l._raiseError(c)});return l._setStreamLoopPromise(u),l})}async#a(t,n){const o=n??this.#e(t);if(o.length>0){const s={agent:t._currentAgent,input:t._originalInput,context:t._context};try{const a=await Promise.all(o.map(async r=>ea(async i=>{const l=await r.run(s);return i.spanData.triggered=l.output.tripwireTriggered,l},{data:{name:r.name}},t._currentAgentSpan)));t._inputGuardrailResults.push(...a);for(const r of a)if(r.output.tripwireTriggered)throw t._currentAgentSpan&&t._currentAgentSpan.setError({message:"Guardrail tripwire triggered",data:{guardrail:r.guardrail.name}}),new Br(`Input guardrail triggered: ${JSON.stringify(r.output.outputInfo)}`,r,t);return a}catch(a){throw a instanceof Br?a:(t._currentTurn--,new Fr(`Input guardrail failed to complete: ${a}`,a,t))}}return[]}async#o(t,n){const o=this.outputGuardrailDefs.concat(t._currentAgent.outputGuardrails.map(cs));if(o.length>0){const s=t._currentAgent.processFinalOutput(n),a=an([],t._generatedItems),r={agent:t._currentAgent,agentOutput:s,context:t._context,details:{modelResponse:t._lastTurnResponse,output:a}};try{const i=await Promise.all(o.map(async l=>ea(async u=>{const c=await l.run(r);return u.spanData.triggered=c.output.tripwireTriggered,c},{data:{name:l.name}},t._currentAgentSpan)));for(const l of i)if(l.output.tripwireTriggered)throw t._currentAgentSpan&&t._currentAgentSpan.setError({message:"Guardrail tripwire triggered",data:{guardrail:l.guardrail.name}}),new ss(`Output guardrail triggered: ${JSON.stringify(l.output.outputInfo)}`,l,t)}catch(i){throw i instanceof ss?i:new Fr(`Output guardrail failed to complete: ${i}`,i,t)}}}async#u(t,n,o,s,a,r){const{model:i,explictlyModelSet:l}=await this.#s(t._currentAgent);let u={...this.config.modelSettings,...t._currentAgent.modelSettings};u=ww(l,t._currentAgent.modelSettings,i,u),u=B_(t._currentAgent,t._toolUseTracker,u);const c=await t._currentAgent.getSystemPrompt(t._context),d=await t._currentAgent.getPrompt(t._context),{modelInput:p,sourceItems:m,persistedItems:y,filterApplied:_}=await _w(t._currentAgent,n.callModelInputFilter,t._context,s,c);a?.markInputAsSent(m),r?.(m,_?y:void 0);const b=a?.previousResponseId??n.previousResponseId,x=a?.conversationId??n.conversationId;return{...o,model:i,explictlyModelSet:l,modelSettings:u,modelInput:p,prompt:d,previousResponseId:b,conversationId:x}}}function an(e,t){const n=t.filter(o=>o.type!=="tool_approval_item").map(o=>o.rawItem);return[...fs(e),...n]}const ya=10;function vw(e,t){return typeof e=="string"&&e!==ut.DEFAULT_MODEL_PLACEHOLDER||e?e:t??e??ut.DEFAULT_MODEL_PLACEHOLDER}function va(e,t){return e?!1:t?!0:"enabled_without_data"}async function _w(e,t,n,o,s){const a=(m,y)=>m.map(_=>{const b=structuredClone(_);return y&&b&&typeof b=="object"&&y.set(b,_),b}),r=new WeakMap,i=bw(o),l=[];for(const m of o)m&&typeof m=="object"&&l.push(m);const u=m=>{if(!m||typeof m!="object")return;const y=l.findIndex(_=>_===m);y!==-1&&l.splice(y,1)},c=()=>{const m=l.shift();return m&&ba(i,m),m},p={input:a(o,r),instructions:s};if(!t)return{modelInput:p,sourceItems:[...o],persistedItems:[],filterApplied:!1};try{const m=await t({modelData:p,agent:e,context:n.context});if(!m||!Array.isArray(m.input))throw new _e("callModelInputFilter must return a ModelInputData object with an input array.");const y=m.input.map(b=>{if(!b||typeof b!="object")return;const x=r.get(b);if(x)return u(x),ba(i,x),x;const k=qt(b),S=kw(i,k);if(S)return u(S),S;const A=c();if(A)return A}),_=a(m.input);return{modelInput:{input:_,instructions:typeof m.instructions>"u"?s:m.instructions},sourceItems:y,persistedItems:_.map(b=>structuredClone(b)),filterApplied:!0}}catch(m){throw Tt({message:"Error in callModelInputFilter",data:{error:String(m)}}),m}}class _a{conversationId;previousResponseId;sentInitialInput=!1;sentItems=new WeakSet;serverItems=new WeakSet;remainingInitialInput=null;constructor({conversationId:t,previousResponseId:n}){this.conversationId=t??void 0,this.previousResponseId=n??void 0}primeFromState({originalInput:t,generatedItems:n,modelResponses:o}){if(this.sentInitialInput)return;for(const a of fs(t))a&&typeof a=="object"&&this.sentItems.add(a);this.sentInitialInput=!0,this.remainingInitialInput=null;const s=o[o.length-1];for(const a of o)for(const r of a.output)r&&typeof r=="object"&&this.serverItems.add(r);!this.conversationId&&s?.responseId&&(this.previousResponseId=s.responseId);for(const a of n){const r=a.rawItem;!r||typeof r!="object"||this.serverItems.has(r)&&this.sentItems.add(r)}}trackServerItems(t){if(t){for(const n of t.output)n&&typeof n=="object"&&this.serverItems.add(n);!this.conversationId&&t.responseId&&(this.previousResponseId=t.responseId)}}prepareInput(t,n){const o=[];if(this.sentInitialInput)this.remainingInitialInput&&this.remainingInitialInput.length>0&&o.push(...this.remainingInitialInput);else{const s=fs(t);o.push(...s),this.remainingInitialInput=s.filter(a=>!!a&&typeof a=="object"),this.sentInitialInput=!0}for(const s of n){if(s.type==="tool_approval_item")continue;const a=s.rawItem;!a||typeof a!="object"||this.sentItems.has(a)||this.serverItems.has(a)||o.push(a)}return o}markInputAsSent(t){if(!t.length)return;const n=new Set;for(const o of t)!o||typeof o!="object"||n.has(o)||(n.add(o),this.sentItems.add(o));!this.remainingInitialInput||this.remainingInitialInput.length===0||(this.remainingInitialInput=this.remainingInitialInput.filter(o=>!n.has(o)),this.remainingInitialInput.length===0&&(this.remainingInitialInput=null))}}function ww(e,t,n,o){if(bu()&&e&&(typeof n!="string"||!xo(n))&&(t.providerData?.reasoning||t.providerData?.text?.verbosity||t.providerData?.reasoning_effort)){const s={...o};return delete s.providerData?.reasoning,delete s.providerData?.text?.verbosity,delete s.providerData?.reasoning_effort,s.reasoning&&(delete s.reasoning.effort,delete s.reasoning.summary),s.text&&delete s.text.verbosity,s}return o}async function wa(e){const t=await e._currentAgent.getEnabledHandoffs(e._context),n=await e._currentAgent.getAllTools(e._context),o=n.filter(s=>s.type==="computer");if(o.length>0&&await Promise.all(o.map(async s=>{await _u({tool:s,runContext:e._context})})),e._currentAgentSpan)e._currentAgentSpan.spanData.tools=n.map(s=>s.name);else{const s=t.map(a=>a.agentName);e._currentAgentSpan=T_({data:{name:e._currentAgent.name,handoffs:s,tools:n.map(a=>a.name),output_type:e._currentAgent.outputSchemaName}}),e._currentAgentSpan.start(),qs(e._currentAgentSpan)}return{handoffs:t,tools:n,serializedHandoffs:t.map(s=>S_(s)),serializedTools:n.map(s=>x_(s)),toolsExplicitlyProvided:e._currentAgent.hasExplicitToolConfig()}}function qt(e){return JSON.stringify(e,Iw)}function bw(e){const t=new Map;for(const n of e){const o=qt(n),s=t.get(o);s?s.push(n):t.set(o,[n])}return t}function kw(e,t){const n=e.get(t);if(!n||n.length===0)return;const[o]=n;return n.shift(),n.length===0&&e.delete(t),o}function ba(e,t){const n=qt(t),o=e.get(n);if(!o||o.length===0)return;const s=o.findIndex(a=>a===t);s!==-1&&(o.splice(s,1),o.length===0&&e.delete(n))}function Iw(e,t){if(t instanceof ArrayBuffer)return{__type:"ArrayBuffer",data:et(new Uint8Array(t))};if(Mn(t)){const n=t;return{__type:n.constructor.name,data:et(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}}if(Us(t)){const n=t;return{__type:"Buffer",data:et(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}}return ko(t)?{__type:"Buffer",data:et(Uint8Array.from(t.data))}:t}function fs(e){return typeof e=="string"?[{type:"message",role:"user",content:e}]:[...e]}class Yu{state;constructor(t){this.state=t}get history(){return an(this.input,this.newItems)}get output(){return an([],this.newItems)}get input(){return this.state._originalInput}get newItems(){return this.state._generatedItems}get rawResponses(){return this.state._modelResponses}get lastResponseId(){const t=this.rawResponses;return t&&t.length>0?t[t.length-1].responseId:void 0}get lastAgent(){return this.state._currentAgent}get inputGuardrailResults(){return this.state._inputGuardrailResults}get outputGuardrailResults(){return this.state._outputGuardrailResults}get interruptions(){return this.state._currentStep?.type==="next_step_interruption"?this.state._currentStep.data.interruptions:[]}get finalOutput(){if(this.state._currentStep?.type==="next_step_final_output")return this.state._currentAgent.processFinalOutput(this.state._currentStep.output);H.warn("Accessed finalOutput before agent run is completed.")}}class Vo extends Yu{constructor(t){super(t)}}class Qu extends Yu{get currentAgent(){return this.lastAgent}currentTurn=0;maxTurns;#e=null;#t;#s;#n;#i;#r;#a;#o=!1;#u;constructor(t={}){if(super(t.state),this.#t=t.signal,this.#n=new xv({start:n=>{this.#s=n},cancel:()=>{this.#o=!0}}),this.#i=new Promise((n,o)=>{this.#r=n,this.#a=o}),this.#t){const n=()=>{if(this.#o)return;this.#o=!0;const o=this.#s;if(this.#s=void 0,this.#n.locked){if(o)try{o.close()}catch(s){H.debug(`Failed to close readable stream on abort: ${s}`)}}else this.#n.cancel(this.#t?.reason).catch(s=>{H.debug(`Failed to cancel readable stream on abort: ${s}`)});this.#r?.()};this.#t.aborted?n():this.#t.addEventListener("abort",n,{once:!0})}}_addItem(t){this.cancelled||this.#s?.enqueue(t)}_done(){!this.cancelled&&this.#s&&(this.#s.close(),this.#s=void 0,this.#r?.())}_raiseError(t){!this.cancelled&&this.#s&&(this.#s.error(t),this.#s=void 0),this.#e=t,this.#a?.(t),this.#i.catch(n=>{H.debug(`Resulted in an error: ${n}`)})}get cancelled(){return this.#o}toStream(){return this.#n}get completed(){return this.#i}get error(){return this.#e}toTextStream(t={}){const n=this.#n.pipeThrough(new Sv({transform(o,s){if(o.type==="raw_model_stream_event"&&o.data.type==="output_text_delta"){const a=Mu.parse(o.data);s.enqueue(a.delta)}}}));return t.compatibleWithNodeStreams?Iv.fromWeb(n):n}[Symbol.asyncIterator](){return this.#n[Symbol.asyncIterator]()}_setStreamLoopPromise(t){this.#u=t}_getStreamLoopPromise(){return this.#u}}let ka;function vt(){return ka??=new Tv,ka}function dn(){const e=vt().getStore();return e?.trace?e.trace:null}function En(){const e=vt().getStore();return e?.span?e.span:null}function Xu(e){return async()=>{const t=dn();if(!t)throw new Error("No trace found");await t.start();const n=await e(t);if(n instanceof Qu){const o=n._getStreamLoopPromise();if(o)return o.finally(()=>t.end()),n}return await t.end(),n}}async function xw(e,t,n={}){const o=typeof e=="string"?_t().createTrace({...n,name:e}):e;return vt().run({trace:o},Xu(t))}async function Sw(e,t={}){if(dn())return await e();const o=_t().createTrace(t);return vt().run({trace:o},Xu(e))}function qs(e){const t=vt().getStore();if(!t)throw new Error("No existing trace found");t.span&&(t.span.previousSpan=t.previousSpan,t.previousSpan=t.span),e.previousSpan=t.span??t.previousSpan,t.span=e,vt().enterWith(t)}function kn(){const e=vt().getStore();e&&(e.span=e.previousSpan,e.previousSpan=e.previousSpan?.previousSpan,vt().enterWith(e))}function Tt(e){const t=En();t&&t.setError(e)}function Tw(e){return{trace:e.trace?.clone(),span:e.span?.clone(),previousSpan:e.previousSpan?.clone()}}function ms(e){const t=vt().getStore();if(!t)throw new Error("No existing trace found");const n=Tw(t);return vt().run(n,e)}class Cw{async export(t){if(mu.disabled){H.debug("Tracing is disabled. Skipping export");return}for(const n of t)n.type==="trace"?console.log(`[Exporter] Export trace traceId=${n.traceId} name=${n.name}${n.groupId?` groupId=${n.groupId}`:""}`):console.log(`[Exporter] Export span: ${JSON.stringify(n)}`)}}class Aw{#e;#t;#s;#n;#i;#r=[];#a;#o=null;#u=!1;#c=null;constructor(t,{maxQueueSize:n=1e3,maxBatchSize:o=100,scheduleDelay:s=5e3,exportTriggerRatio:a=.8}={}){this.#e=n,this.#t=o,this.#s=s,this.#n=n*a,this.#i=t,this.#a=Av,H.debug("Automatic trace export loop is not supported in this environment. You need to manually call `getGlobalTraceProvider().forceFlush()` to export traces.")}start(){this.#c=new AbortController,this.#p()}async#l(t){if(this.#r.length+1>this.#e){H.error("Dropping trace because buffer is full");return}this.#r.push(t),this.#r.length>this.#n&&await this.#d()}#p(){this.#o=this.#a.setTimeout(async()=>{await this.#d(),this.#p()},this.#s),typeof this.#o.unref=="function"&&this.#o.unref()}async#d(t=!1){if(this.#r.length!==0){if(H.debug(`Exporting batches. Force: ${t}. Buffer size: ${this.#r.length}`),t||this.#r.length<this.#t){const n=[...this.#r];this.#r=[],this.#u=!0,await this.#i.export(n),this.#u=!1}else if(this.#r.length>0){const n=this.#r.splice(0,this.#t);this.#u=!0,await this.#i.export(n),this.#u=!1}}}async onTraceStart(t){await this.#l(t)}async onTraceEnd(t){}async onSpanStart(t){}async onSpanEnd(t){await this.#l(t)}async shutdown(t){for(t&&this.#a.setTimeout(()=>{this.#c?.abort()},t),H.debug("Shutting down gracefully");this.#r.length>0;){if(H.debug(`Waiting for buffer to empty. Items left: ${this.#r.length}`),this.#u||await this.#d(!0),this.#c?.signal.aborted){H.debug("Timeout reached, force flushing"),await this.#d(!0);break}await new Promise(n=>this.#a.setTimeout(n,500))}H.debug("Buffer empty. Exiting"),this.#a&&this.#o&&this.#a.clearTimeout(this.#o)}async forceFlush(){this.#r.length>0&&await this.#d(!0)}}class Dw{#e=[];start(){for(const t of this.#e)t.start&&t.start()}addTraceProcessor(t){this.#e.push(t)}setProcessors(t){H.debug("Shutting down old processors");for(const n of this.#e)n.shutdown();this.#e=t}async onTraceStart(t){for(const n of this.#e)await n.onTraceStart(t)}async onTraceEnd(t){for(const n of this.#e)await n.onTraceEnd(t)}async onSpanStart(t){for(const n of this.#e)await n.onSpanStart(t)}async onSpanEnd(t){for(const n of this.#e)await n.onSpanEnd(t)}async shutdown(t){for(const n of this.#e)await n.shutdown(t)}async forceFlush(){for(const t of this.#e)await t.forceFlush()}}let Ho=null,Go=null;function $w(){return Ho||(Ho=new Cw),Ho}function el(){return Go||(Go=new Aw($w())),Go}function Ia(){return new Date().toISOString()}function tl(){return`trace_${wu().replace(/-/g,"")}`}function Ew(){return`span_${wu().replace(/-/g,"").slice(0,24)}`}function Uw(e){return Object.fromEntries(Object.entries(e).filter(([t])=>!t.startsWith("_")))}class Un{type="trace.span";#e;#t;#s;#n;#i;#r;#a;#o;#u;constructor(t,n){this.#t=t.traceId,this.#s=t.spanId??Ew(),this.#e=t.data,this.#i=n,this.#n=t.parentId??null,this.#o=t.error??null,this.#r=t.startedAt??null,this.#a=t.endedAt??null}get traceId(){return this.#t}get spanData(){return this.#e}get spanId(){return this.#s}get parentId(){return this.#n}get previousSpan(){return this.#u}set previousSpan(t){this.#u=t}start(){if(this.#r){H.warn("Span already started");return}this.#r=Ia(),this.#i.onSpanStart(this)}end(){if(this.#a){H.debug("Span already finished",this.spanData);return}this.#a=Ia(),this.#i.onSpanEnd(this)}setError(t){this.#o=t}get error(){return this.#o}get startedAt(){return this.#r}get endedAt(){return this.#a}clone(){const t=new Un({traceId:this.traceId,spanId:this.spanId,parentId:this.parentId??void 0,data:this.spanData,startedAt:this.#r??void 0,endedAt:this.#a??void 0,error:this.#o??void 0},this.#i);return t.previousSpan=this.previousSpan?.clone(),t}toJSON(){return{object:this.type,id:this.spanId,trace_id:this.traceId,parent_id:this.parentId,started_at:this.startedAt,ended_at:this.endedAt,span_data:Uw(this.spanData),error:this.error}}}class $t extends Un{constructor(t,n){super({traceId:"no-op",spanId:"no-op",data:t},n)}start(){}end(){}setError(){}toJSON(){return null}}class On{type="trace";traceId;name;groupId=null;metadata;#e;#t;constructor(t,n){this.traceId=t.traceId??tl(),this.name=t.name??"Agent workflow",this.groupId=t.groupId??null,this.metadata=t.metadata??{},this.#e=n??el(),this.#t=t.started??!1}async start(){this.#t||(this.#t=!0,await this.#e.onTraceStart(this))}async end(){this.#t&&(this.#t=!1,await this.#e.onTraceEnd(this))}clone(){return new On({traceId:this.traceId,name:this.name,groupId:this.groupId??void 0,metadata:this.metadata,started:this.#t})}toJSON(){return{object:this.type,id:this.traceId,workflow_name:this.name,group_id:this.groupId,metadata:this.metadata}}}class Wo extends On{constructor(){super({})}async start(){}async end(){}toJSON(){return null}}class Ow{#e;#t;constructor(){this.#e=new Dw,this.#t=mu.disabled,this.#s()}registerProcessor(t){this.#e.addTraceProcessor(t)}setProcessors(t){this.#e.setProcessors(t)}getCurrentTrace(){return dn()}getCurrentSpan(){return En()}setDisabled(t){this.#t=t}startExportLoop(){this.#e.start()}createTrace(t){if(this.#t)return H.debug("Tracing is disabled, Not creating trace %o",t),new Wo;const n=t.traceId??tl(),o=t.name??"Agent workflow";return H.debug("Creating trace %s with name %s",n,o),new On({...t,name:o,traceId:n},this.#e)}createSpan(t,n){if(this.#t||t.disabled)return H.debug("Tracing is disabled, Not creating span %o",t),new $t(t.data,this.#e);let o,s;if(n){if(n instanceof On){if(n instanceof Wo)return H.debug("Parent trace is no-op, returning NoopSpan"),new $t(t.data,this.#e);s=n.traceId}else if(n instanceof Un){if(n instanceof $t)return H.debug("Parent span is no-op, returning NoopSpan"),new $t(t.data,this.#e);o=n.spanId,s=n.traceId}}else{const a=dn(),r=En();if(!a)return H.error("No active trace. Make sure to start a trace with `withTrace()` first. Returning NoopSpan."),new $t(t.data,this.#e);if(r instanceof $t||a instanceof Wo)return H.debug(`Parent ${r} or ${a} is no-op, returning NoopSpan`),new $t(t.data,this.#e);s=a.traceId,r?(H.debug("Using parent span %s",r.spanId),o=r.spanId):H.debug("No parent span, using current trace %s",a.traceId)}return s?(H.debug(`Creating span ${JSON.stringify(t.data)} with id ${t.spanId??s}`),new Un({...t,traceId:s,parentId:o},this.#e)):(H.error("No traceId found. Make sure to start a trace with `withTrace()` first. Returning NoopSpan."),new $t(t.data,this.#e))}async shutdown(t){try{H.debug("Shutting down tracing provider"),await this.#e.shutdown(t)}catch(n){H.error("Error shutting down tracing provider %o",n)}}#s(){if(typeof process<"u"&&typeof process.on=="function"){const t=async()=>{const n=setTimeout(()=>{console.warn("Cleanup timeout, forcing exit"),process.exit(1)},5e3);try{await this.shutdown()}finally{clearTimeout(n)}};process.on("beforeExit",t),process.on("SIGINT",async()=>{await t(),xa("SIGINT")||process.exit(130)}),process.on("SIGTERM",async()=>{await t(),xa("SIGTERM")||process.exit(0)}),process.on("unhandledRejection",async(n,o)=>{H.error("Unhandled rejection",n,o),await t(),Rw("unhandledRejection")||process.exit(1)})}}async forceFlush(){await this.#e.forceFlush()}}function xa(e){return process.listeners(e).length>1}function Rw(e){return process.listeners(e).length>1}let Ko;function _t(){return Ko||(Ko=new Ow),Ko}function Pw(e){_t().registerProcessor(e)}Pw(el());function Mw(e){const t=atob(e),n=t.length,o=new Uint8Array(n);for(let s=0;s<n;s++)o[s]=t.charCodeAt(s);return o.buffer}function Lw(e){const t=String.fromCharCode(...new Uint8Array(e));return btoa(t)}function Nw(e){if(typeof e>"u"||e===null||typeof e!="object"||!("type"in e)||typeof e.type!="string"||!e.type||e.type!=="message"||!("content"in e)||!Array.isArray(e.content)||e.content.length<1)return;const t=e.content[e.content.length-1];if(!(!("type"in t)||typeof t.type!="string")){if(t.type==="output_text")return typeof t.text=="string"?t.text:void 0;if(t.type==="output_audio")return typeof t.transcript=="string"?t.transcript:void 0}}function zw(e,t){const n=e.filter(a=>!t.some(r=>r.itemId===a.itemId)),o=t.filter(a=>!e.some(r=>r.itemId===a.itemId)),s=t.filter(a=>e.some(r=>r.itemId===a.itemId&&JSON.stringify(r)!==JSON.stringify(a)));return{removals:n,additions:o,updates:s}}function Fw(){return typeof window>"u"?!1:typeof window.RTCPeerConnection<"u"}function Sa(e){return e.role==="system"?e:e.role==="assistant"?{...e,content:e.content.map(t=>t.type==="output_audio"?{...t,audio:null}:t)}:e.role==="user"?{...e,content:e.content.map(t=>t.type==="input_audio"?{...t,audio:null}:t)}:e}function Bw(e,t){if(e.role!=="assistant"||t.role!=="assistant")return t;const n=t.content.map((o,s)=>{if(o.type!=="output_audio"||!(typeof o.transcript!="string"||o.transcript.length===0))return o;const r=e.content[s];return r&&r.type==="output_audio"&&typeof r.transcript=="string"&&r.transcript.length>0?{...o,transcript:r.transcript}:o});return{...t,content:n}}function Ta(e,t,n){if(t.type==="conversation.item.input_audio_transcription.completed")return e.map(a=>{if(a.itemId===t.item_id&&a.type==="message"&&"role"in a&&a.role==="user"){const r=a.content.map(i=>i.type==="input_audio"?{...i,transcript:t.transcript}:i);return{...a,content:r,status:"completed"}}return a});const o=!n&&t.type==="message"?Sa(t):t,s=e.findIndex(a=>a.itemId===t.itemId);if(s!==-1){const a=e[s],r=o.type==="message"&&a.type==="message"?Bw(a,o):o;return e.map((i,l)=>l===s?r:!n&&i.type==="message"?Sa(i):i)}else if(t.previousItemId){const a=e.findIndex(r=>r.itemId===t.previousItemId);return a!==-1?[...e.slice(0,a+1),o,...e.slice(a+1)]:[...e,o]}else return[...e,o]}const nl={"User-Agent":`Agents/JavaScript ${Qo.version}`,"X-OpenAI-Agents-SDK":`openai-agents-sdk.${Qo.version}`},Zw=`openai-agents-sdk.${Qo.version}`;function jw(e,t){const{name:n,arguments:o,...s}=t;return new Ve({type:"hosted_tool_call",name:n,arguments:JSON.stringify(o),status:"in_progress",providerData:{...s}},e)}function Ca(e){if(e.rawItem.type!=="function_call"&&e.rawItem.type!=="hosted_tool_call")throw new Error("Invalid approval item type for Realtime MCP approval request");const{name:t,arguments:n,providerData:o}=e.rawItem,{itemId:s,serverLabel:a,...r}=o??{};if(!s||!a)throw new Error("Invalid approval item for Realtime MCP approval request");return{type:"mcp_approval_request",itemId:s,serverLabel:a,...r,name:t,arguments:n?JSON.parse(n):{},approved:null}}class qw extends ut{voice;constructor(t){super(t),this.voice=t.voice}}function Jw(e){return{debounceTextLength:e.debounceTextLength??100}}function Vw({policyHint:e,...t}){const n=cs(t),o=e??n.name;return{...n,policyHint:o,run:async s=>{const a=await n.run(s);return{...a,guardrail:{...a.guardrail,policyHint:o}}}}}function Hw(e){return`
 Your last answer was blocked. 
Failed Guardrail Reason: ${e.guardrail.policyHint}. 
Failure Details: ${JSON.stringify(e.output.outputInfo??{})}. 
Please respond again following policy. Apologize for not being able to answer the question (while avoiding the specific reason) and divert discussion back to an approved topic immediately and not invite more discussion.
`.trim()}function Bt(e,t){return e in t&&typeof t[e]<"u"}function Gw(e){return Bt("modalities",e)||Bt("inputAudioFormat",e)||Bt("outputAudioFormat",e)||Bt("inputAudioTranscription",e)||Bt("turnDetection",e)||Bt("inputAudioNoiseReduction",e)||Bt("speed",e)}function Ww(e){if(!Gw(e)){const t=e.audio?.input?{format:Hn(e.audio.input.format),noiseReduction:e.audio.input.noiseReduction??null,transcription:e.audio.input.transcription,turnDetection:e.audio.input.turnDetection}:void 0,n=e.audio?.output?.voice??e.voice,o=e.audio?.output||typeof n<"u"?{format:Hn(e.audio?.output?.format),voice:n,speed:e.audio?.output?.speed}:void 0;return{model:e.model,instructions:e.instructions,toolChoice:e.toolChoice,tools:e.tools,tracing:e.tracing,providerData:e.providerData,prompt:e.prompt,outputModalities:e.outputModalities,audio:t||o?{input:t,output:o}:void 0}}return{model:e.model,instructions:e.instructions,toolChoice:e.toolChoice,tools:e.tools,tracing:e.tracing,providerData:e.providerData,prompt:e.prompt,outputModalities:e.modalities,audio:{input:{format:Hn(e.inputAudioFormat),noiseReduction:e.inputAudioNoiseReduction??null,transcription:e.inputAudioTranscription,turnDetection:e.turnDetection},output:{format:Hn(e.outputAudioFormat),voice:e.voice,speed:e.speed}}}}function Hn(e){if(!e)return;if(typeof e=="object")return e;const t=String(e);return t==="pcm16"?{type:"audio/pcm",rate:24e3}:t==="g711_ulaw"?{type:"audio/pcmu"}:t==="g711_alaw"?{type:"audio/pcma"}:{type:"audio/pcm",rate:24e3}}T({itemId:f()});const Aa=je("role",[T({itemId:f(),previousItemId:f().nullable().optional(),type:C("message"),role:C("system"),content:se(T({type:C("input_text"),text:f()}))}),T({itemId:f(),previousItemId:f().nullable().optional(),type:C("message"),role:C("user"),status:Re(["in_progress","completed"]),content:se(T({type:C("input_text"),text:f()}).or(T({type:C("input_audio"),audio:f().nullable().optional(),transcript:f().nullable()})))}),T({itemId:f(),previousItemId:f().nullable().optional(),type:C("message"),role:C("assistant"),status:Re(["in_progress","completed","incomplete"]),content:se(T({type:C("output_text"),text:f()}).or(T({type:C("output_audio"),audio:f().nullable().optional(),transcript:f().nullable().optional()})))})]),Da=T({itemId:f(),previousItemId:f().nullable().optional(),type:C("function_call"),status:Re(["in_progress","completed","incomplete"]),arguments:f(),name:f(),output:f().nullable()}),$a=T({itemId:f(),previousItemId:f().nullable().optional(),type:Re(["mcp_call","mcp_tool_call"]),status:Re(["in_progress","completed","incomplete"]),arguments:f(),name:f(),output:f().nullable()}),Kw=T({itemId:f(),type:C("mcp_approval_request"),serverLabel:f(),name:f(),arguments:we(f(),ae()),approved:Jt().optional().nullable()}),Xe=gu("openai-agents:realtime"),ol=T({id:f().optional().nullable(),conversation_id:f().optional().nullable(),max_output_tokens:N().or(C("inf")).optional().nullable(),metadata:we(f(),ae()).optional().nullable(),output_modalities:se(f()).optional().nullable(),object:C("realtime.response").optional().nullable(),output:se(ae()).optional().nullable(),audio:T({output:T({format:ae().optional().nullable(),voice:f().optional().nullable()}).optional().nullable()}).optional().nullable(),status:Re(["completed","incomplete","failed","cancelled","in_progress"]).optional().nullable(),status_details:we(f(),ae()).optional().nullable(),usage:T({input_tokens:N().optional(),input_token_details:we(f(),ae()).optional().nullable(),output_tokens:N().optional(),output_token_details:we(f(),ae()).optional().nullable()}).optional().nullable()}),Yw=T({id:f().optional(),audio:f().nullable().optional(),text:f().nullable().optional(),transcript:f().nullable().optional(),type:ht([C("input_text"),C("input_audio"),C("item_reference"),C("output_text"),C("output_audio")])}),mn=T({id:f().optional(),arguments:f().optional(),call_id:f().optional(),content:se(Yw).optional(),name:f().optional(),output:f().nullable().optional(),role:Re(["user","assistant","system"]).optional(),status:Re(["completed","incomplete","in_progress"]).optional(),type:Re(["message","function_call","function_call_output","mcp_list_tools","mcp_tool_call","mcp_call","mcp_approval_request","mcp_approval_response"]).optional(),approval_request_id:f().nullable().optional(),approve:Jt().nullable().optional(),reason:f().nullable().optional(),server_label:f().optional(),error:ae().nullable().optional(),tools:se(T({name:f(),description:f(),input_schema:we(ae()).optional()}).passthrough()).optional()}).passthrough(),Qw=T({type:C("conversation.created"),event_id:f(),conversation:T({id:f().optional(),object:C("realtime.conversation").optional()})}),Xw=T({type:C("conversation.item.added"),event_id:f(),item:mn,previous_item_id:f().nullable().optional()}),eb=T({type:C("conversation.item.done"),event_id:f(),item:mn,previous_item_id:f().nullable().optional()}),tb=T({type:C("conversation.item.deleted"),event_id:f(),item_id:f()}),nb=T({type:C("conversation.item.input_audio_transcription.completed"),event_id:f(),item_id:f(),content_index:N(),transcript:f(),logprobs:se(ae()).nullable().optional(),usage:T({type:C("tokens"),total_tokens:N(),input_tokens:N(),input_token_details:T({text_tokens:N(),audio_tokens:N()}),output_tokens:N()}).optional()}),ob=T({type:C("conversation.item.input_audio_transcription.delta"),event_id:f(),item_id:f(),content_index:N().optional(),delta:f().optional(),logprobs:se(ae()).nullable().optional()}),sb=T({type:C("conversation.item.input_audio_transcription.failed"),event_id:f(),item_id:f(),content_index:N(),error:T({code:f().optional(),message:f().optional(),param:f().optional(),type:f().optional()})}),rb=T({type:C("conversation.item.retrieved"),event_id:f(),item:mn}),ab=T({type:C("conversation.item.truncated"),event_id:f(),item_id:f(),audio_end_ms:N(),content_index:N()}),ib=T({type:C("conversation.item.create"),item:mn,event_id:f().optional(),previous_item_id:f().nullable().optional()}),ub=T({type:C("conversation.item.delete"),item_id:f(),event_id:f().optional()}),lb=T({type:C("conversation.item.retrieve"),item_id:f(),event_id:f().optional()}),cb=T({type:C("conversation.item.truncate"),item_id:f(),audio_end_ms:N(),content_index:N(),event_id:f().optional()}),db=T({type:C("error"),event_id:f().optional(),error:ae().optional()}),pb=T({type:C("input_audio_buffer.cleared"),event_id:f()}),fb=T({type:C("input_audio_buffer.append"),audio:f(),event_id:f().optional()}),mb=T({type:C("input_audio_buffer.clear"),event_id:f().optional()}),hb=T({type:C("input_audio_buffer.commit"),event_id:f().optional()}),gb=T({type:C("input_audio_buffer.committed"),event_id:f(),item_id:f(),previous_item_id:f().nullable().optional()}),yb=T({type:C("input_audio_buffer.speech_started"),event_id:f(),item_id:f(),audio_start_ms:N()}),vb=T({type:C("input_audio_buffer.speech_stopped"),event_id:f(),item_id:f(),audio_end_ms:N()}),_b=T({type:C("output_audio_buffer.started"),event_id:f()}).passthrough(),wb=T({type:C("output_audio_buffer.stopped"),event_id:f()}).passthrough(),bb=T({type:C("output_audio_buffer.cleared"),event_id:f()}),kb=T({type:C("rate_limits.updated"),event_id:f(),rate_limits:se(T({limit:N().optional(),name:Re(["requests","tokens"]).optional(),remaining:N().optional(),reset_seconds:N().optional()}))}),Ib=T({type:C("response.output_audio.delta"),event_id:f(),item_id:f(),content_index:N(),delta:f(),output_index:N(),response_id:f()}),xb=T({type:C("response.output_audio.done"),event_id:f(),item_id:f(),content_index:N(),output_index:N(),response_id:f()}),Sb=T({type:C("response.output_audio_transcript.delta"),event_id:f(),item_id:f(),content_index:N(),delta:f(),output_index:N(),response_id:f()}),Tb=T({type:C("response.output_audio_transcript.done"),event_id:f(),item_id:f(),content_index:N(),transcript:f(),output_index:N(),response_id:f()}),Cb=T({type:C("response.content_part.added"),event_id:f(),item_id:f(),content_index:N(),output_index:N(),response_id:f(),part:T({audio:f().optional(),text:f().optional(),transcript:f().optional(),type:Re(["text","audio"]).optional()})}),Ab=T({type:C("response.content_part.done"),event_id:f(),item_id:f(),content_index:N(),output_index:N(),response_id:f(),part:T({audio:f().optional(),text:f().optional(),transcript:f().optional(),type:Re(["text","audio"]).optional()})}),Db=T({type:C("response.created"),event_id:f(),response:ol}),sl=T({type:C("response.done"),event_id:f(),response:ol}),$b=T({type:C("response.function_call_arguments.delta"),event_id:f(),item_id:f(),call_id:f(),delta:f(),output_index:N(),response_id:f()}),Eb=T({type:C("response.function_call_arguments.done"),event_id:f(),item_id:f(),call_id:f(),arguments:f(),output_index:N(),response_id:f()}),Ub=T({type:C("response.output_item.added"),event_id:f(),item:mn,output_index:N(),response_id:f()}),Ob=T({type:C("response.output_item.done"),event_id:f(),item:mn,output_index:N(),response_id:f()}),Rb=T({type:C("response.output_text.delta"),event_id:f(),item_id:f(),content_index:N(),delta:f(),output_index:N(),response_id:f()}),Pb=T({type:C("response.output_text.done"),event_id:f(),item_id:f(),content_index:N(),text:f(),output_index:N(),response_id:f()}),Mb=T({type:C("session.created"),event_id:f(),session:ae()}),Lb=T({type:C("session.updated"),event_id:f(),session:ae()}),Nb=T({type:C("response.cancel"),event_id:f().optional(),response_id:f().optional()}),zb=T({type:C("response.create"),event_id:f().optional(),response:ae().optional()}),Fb=T({type:C("session.update"),event_id:f().optional(),session:ae()}),Bb=T({type:C("mcp_list_tools.in_progress"),event_id:f().optional(),item_id:f().optional()}),Zb=T({type:C("mcp_list_tools.completed"),event_id:f().optional(),item_id:f().optional()}),jb=T({type:C("response.mcp_call_arguments.delta"),event_id:f(),response_id:f(),item_id:f(),output_index:N(),delta:f(),obfuscation:f()}),qb=T({type:C("response.mcp_call_arguments.done"),event_id:f(),response_id:f(),item_id:f(),output_index:N(),arguments:f()}),Jb=T({type:C("response.mcp_call.in_progress"),event_id:f(),output_index:N(),item_id:f()}),Vb=T({type:C("response.mcp_call.completed"),event_id:f(),output_index:N(),item_id:f()}),Hb=T({type:C("mcp_list_tools.failed"),event_id:f().optional(),item_id:f().optional()}),Gb=T({type:f(),event_id:f().optional().nullable()}).passthrough(),Wb=je("type",[Qw,Xw,eb,tb,nb,ob,sb,rb,ab,db,pb,gb,yb,vb,_b,wb,bb,kb,Ib,xb,Sb,Tb,Cb,Ab,Db,sl,$b,Eb,Ub,Ob,Rb,Pb,Mb,Lb,Bb,Zb,Hb,jb,qb,Jb,Vb]);je("type",[ib,ub,lb,cb,fb,mb,hb,Nb,zb,Fb]);function Js(e){const t=JSON.parse(e.data.toString()),n=Wb.safeParse(t);if(!n.success){const o=Gb.safeParse(t);return o.success?{data:o.data,isGeneric:!0}:{data:null,isGeneric:!0}}return{data:n.data,isGeneric:!1}}const Kb="gpt-realtime",dt={outputModalities:["audio"],audio:{input:{format:{type:"audio/pcm",rate:24e3},transcription:{model:"gpt-4o-mini-transcribe"},turnDetection:{type:"semantic_vad"},noiseReduction:null},output:{format:{type:"audio/pcm",rate:24e3},speed:1}}};class $o extends Os{#e;#t;#s=null;#n=null;eventEmitter=new Io;constructor(t={}){super(),this.#e=t.model??Kb,this.#t=t.apiKey}get currentModel(){return this.#e}set currentModel(t){this.#e=t}_afterAudioDoneEvent(){}get _rawSessionConfig(){return this.#n??null}async _getApiKey(t){const n=t.apiKey??this.#t;return typeof n=="function"?await n():n}_onMessage(t){const{data:n,isGeneric:o}=Js(t);if(n!==null&&(this.emit("*",n),!o)){if(n.type==="error"?this.emit("error",{type:"error",error:n}):this.emit(n.type,n),n.type==="response.created"){this.emit("turn_started",{type:"response_started",providerData:{...n}});return}if(n.type==="session.updated"&&(this.#n=n.session),n.type==="response.done"){const s=sl.safeParse(n);if(!s.success){Xe.error("Error parsing response done event",s.error);return}const a=s.data.response.usage?.input_tokens??0,r=s.data.response.usage?.output_tokens??0,i=a+r,l=new Ln({inputTokens:a,inputTokensDetails:s.data.response.usage?.input_token_details??{},outputTokens:r,outputTokensDetails:s.data.response.usage?.output_token_details??{},totalTokens:i});this.emit("usage_update",l),this.emit("turn_done",{type:"response_done",response:{id:s.data.response.id??"",output:s.data.response.output??[],usage:{inputTokens:a,inputTokensDetails:s.data.response.usage?.input_token_details??{},outputTokens:r,outputTokensDetails:s.data.response.usage?.output_token_details??{},totalTokens:i}}});return}if(n.type==="response.output_audio.done"){this.emit("audio_done"),this._afterAudioDoneEvent();return}if(n.type==="conversation.item.deleted"){this.emit("item_deleted",{itemId:n.item_id});return}if(n.type==="conversation.item.input_audio_transcription.completed"||n.type==="conversation.item.truncated"){this.sendEvent({type:"conversation.item.retrieve",item_id:n.item_id});return}if(n.type==="conversation.item.input_audio_transcription.delta"||n.type==="response.output_text.delta"||n.type==="response.output_audio_transcript.delta"||n.type==="response.function_call_arguments.delta"){n.type==="response.output_audio_transcript.delta"&&this.emit("audio_transcript_delta",{type:"transcript_delta",delta:n.delta,itemId:n.item_id,responseId:n.response_id});return}if(n.type==="conversation.item.added"||n.type==="conversation.item.done"||n.type==="conversation.item.retrieved"){if(n.item.type==="mcp_list_tools"&&n.type==="conversation.item.done"){const s=n.item.server_label??"",a=n.item.tools??[];try{this.emit("mcp_tools_listed",{serverLabel:s,tools:a})}catch(r){Xe.error("Error emitting mcp_tools_listed",r,n.item)}return}if(n.item.type==="message"){const s=n.type==="conversation.item.added"||n.type==="conversation.item.done"?n.previous_item_id:null,a=Aa.parse({itemId:n.item.id,previousItemId:s,type:n.item.type,role:n.item.role,content:n.item.content,status:n.item.status});this.emit("item_update",a);return}if(n.item.type==="mcp_approval_request"&&n.type==="conversation.item.done"){const s=n.item,a=Kw.parse({itemId:s.id,type:s.type,serverLabel:s.server_label,name:s.name,arguments:JSON.parse(s.arguments||"{}"),approved:s.approved});this.emit("item_update",a),this.emit("mcp_approval_request",a);return}if(n.item.type==="mcp_tool_call"||n.item.type==="mcp_call"){const s=n.type==="conversation.item.done"?"completed":"in_progress",a=$a.parse({itemId:n.item.id,type:n.item.type,status:s,arguments:n.item.arguments,name:n.item.name,output:n.item.output});this.emit("item_update",a),n.type==="conversation.item.done"&&this.emit("mcp_tool_call_completed",a);return}}if(n.type==="response.mcp_call.in_progress"){const s=n;this.sendEvent({type:"conversation.item.retrieve",item_id:s.item_id});return}if(n.type==="mcp_list_tools.in_progress"){const s=n;s.item_id&&this.sendEvent({type:"conversation.item.retrieve",item_id:s.item_id});return}if(n.type==="response.output_item.done"||n.type==="response.output_item.added"){const s=n.item;if(s.type==="function_call"&&s.status==="completed"){const a=Da.parse({itemId:s.id,type:s.type,status:"in_progress",arguments:s.arguments,name:s.name,output:null});this.emit("item_update",a),this.emit("function_call",{id:s.id,type:"function_call",callId:s.call_id??"",arguments:s.arguments??"",name:s.name??""});return}if(s.type==="mcp_tool_call"||s.type==="mcp_call"){const a=$a.parse({itemId:s.id,type:s.type,status:n.type==="response.output_item.done"?"completed":"in_progress",arguments:s.arguments,name:s.name,output:s.output});this.emit("item_update",a);return}if(s.type==="message"){const a=Aa.parse({itemId:n.item.id,type:n.item.type,role:n.item.role,content:n.item.content,status:n.type==="response.output_item.done"?s.status??"completed":s.status??"in_progress"});this.emit("item_update",a);return}}}}_onError(t){this.emit("error",{type:"error",error:t})}_onOpen(){this.emit("connected")}_onClose(){this.emit("disconnected")}sendMessage(t,n,{triggerResponse:o=!0}={}){const s=typeof t=="string"?[{type:"input_text",text:t}]:t.content.map(a=>a.type==="input_image"?{type:"input_image",image_url:a.image,...a.providerData??{}}:a);this.sendEvent({type:"conversation.item.create",item:{type:"message",role:"user",content:s},...n}),o&&this.sendEvent({type:"response.create"})}addImage(t,{triggerResponse:n=!0}={}){this.sendMessage({type:"message",role:"user",content:[{type:"input_image",image:t}]},{},{triggerResponse:n})}_getMergedSessionConfig(t){const n=Ww(t),o={type:"realtime",instructions:n.instructions,model:n.model??this.#e,output_modalities:n.outputModalities??dt.outputModalities,audio:{input:{format:n.audio?.input?.format??dt.audio?.input?.format,noise_reduction:n.audio?.input?.noiseReduction??dt.audio?.input?.noiseReduction,transcription:n.audio?.input?.transcription??dt.audio?.input?.transcription,turn_detection:$o.buildTurnDetectionConfig(n.audio?.input?.turnDetection)??dt.audio?.input?.turnDetection},output:{format:n.audio?.output?.format??dt.audio?.output?.format,voice:n.audio?.output?.voice??dt.audio?.output?.voice,speed:n.audio?.output?.speed??dt.audio?.output?.speed}},tool_choice:n.toolChoice??dt.toolChoice,...n.providerData??{}};return n.prompt&&(o.prompt={id:n.prompt.promptId,version:n.prompt.version,variables:n.prompt.variables}),n.tools&&n.tools.length>0&&(o.tools=n.tools.map(s=>({...s,strict:void 0}))),o}buildSessionPayload(t){return this._getMergedSessionConfig(t)}static buildTurnDetectionConfig(t){if(typeof t>"u")return;const{type:n,createResponse:o,create_response:s,eagerness:a,interruptResponse:r,interrupt_response:i,prefixPaddingMs:l,prefix_padding_ms:u,silenceDurationMs:c,silence_duration_ms:d,threshold:p,idleTimeoutMs:m,idle_timeout_ms:y,..._}=t,b={type:n,create_response:o||s,eagerness:a,interrupt_response:r||i,prefix_padding_ms:l||u,silence_duration_ms:c||d,idle_timeout_ms:m||y,threshold:p,..._};return Object.keys(b).forEach(x=>{b[x]===void 0&&delete b[x]}),Object.keys(b).length>0?b:void 0}set _tracingConfig(t){this.#s=t}_updateTracingConfig(t){if(typeof this.#s>"u"&&(this.#s=null),t==="auto"){this.sendEvent({type:"session.update",session:{type:"realtime",tracing:"auto"}});return}if(this.#s!==null&&typeof this.#s!="string"&&typeof t!="string"){Xe.warn("Tracing config is already set, skipping setting it again. This likely happens when you already set a tracing config on session creation.");return}if(t===null){Xe.debug("Disabling tracing for this session. It cannot be turned on for this session from this point on."),this.sendEvent({type:"session.update",session:{type:"realtime",tracing:null}});return}if(this.#s===null||typeof this.#s=="string"){this.sendEvent({type:"session.update",session:{type:"realtime",tracing:t}});return}if(t?.group_id!==this.#s?.group_id||t?.metadata!==this.#s?.metadata||t?.workflow_name!==this.#s?.workflow_name){Xe.warn("Mismatch in tracing config. Ignoring the new tracing config. This likely happens when you already set a tracing config on session creation. Current tracing config: %s, new tracing config: %s",JSON.stringify(this.#s),JSON.stringify(t));return}this.sendEvent({type:"session.update",session:{type:"realtime",tracing:t}})}updateSessionConfig(t){const n=this.buildSessionPayload(t);this.sendEvent({type:"session.update",session:n})}sendFunctionCallOutput(t,n,o=!0){this.sendEvent({type:"conversation.item.create",item:{type:"function_call_output",output:n,call_id:t.callId}});try{const s=Da.parse({itemId:t.id,previousItemId:t.previousItemId,type:"function_call",status:"completed",arguments:t.arguments,name:t.name,output:n});this.emit("item_update",s)}catch(s){Xe.error("Error parsing tool call item",s,t)}o&&this.sendEvent({type:"response.create"})}sendAudio(t,{commit:n=!1}={}){this.sendEvent({type:"input_audio_buffer.append",audio:Lw(t)}),n&&this.sendEvent({type:"input_audio_buffer.commit"})}resetHistory(t,n){const{removals:o,additions:s,updates:a}=zw(t,n),r=new Set(o.map(l=>l.itemId));for(const l of a)r.add(l.itemId);if(r.size>0)for(const l of r)this.sendEvent({type:"conversation.item.delete",item_id:l});const i=[...s,...a];for(const l of i)if(l.type==="message"){const u={type:"message",role:l.role,content:l.content,id:l.itemId};l.role!=="system"&&l.status&&(u.status=l.status),this.sendEvent({type:"conversation.item.create",item:u})}else l.type==="function_call"&&Xe.warn("Function calls cannot be manually added or updated at the moment. Ignoring.")}sendMcpResponse(t,n){this.sendEvent({type:"conversation.item.create",previous_item_id:t.itemId,item:{type:"mcp_approval_response",approval_request_id:t.itemId,approve:n}})}}class Yb extends $o{options;#e;#t={status:"disconnected",peerConnection:void 0,dataChannel:void 0,callId:void 0};#s;#n=!1;#i=!1;constructor(t={}){if(typeof RTCPeerConnection>"u")throw new Error("WebRTC is not supported in this environment");super(t),this.options=t,this.#e=t.baseUrl??"https://api.openai.com/v1/realtime/calls",this.#s=t.useInsecureApiKey??!1}get callId(){return this.#t.callId}get status(){return this.#t.status}get connectionState(){return this.#t}get muted(){return this.#i}async connect(t){if(this.#t.status==="connected")return;this.#t.status==="connecting"&&Xe.warn("Realtime connection already in progress. Please await original promise");const n=t.model??this.currentModel;this.currentModel=n;const o=t.url??this.#e,s=await this._getApiKey(t),a=typeof s=="string"&&s.startsWith("ek_");if(!this.#s&&!a)throw new _e("Using the WebRTC connection in a browser environment requires an ephemeral client key. If you need to use a regular API key, use the WebSocket transport or set the `useInsecureApiKey` option to true.");return new Promise(async(r,i)=>{try{const l={...t.initialSessionConfig||{},model:this.currentModel},u=new URL(o);let c=new RTCPeerConnection;const d=c.createDataChannel("oai-events");let p;const m=S=>{S.onconnectionstatechange=()=>{switch(S.connectionState){case"disconnected":case"failed":case"closed":this.close();break}}};m(c),this.#t={status:"connecting",peerConnection:c,dataChannel:d,callId:p},this.emit("connection_change",this.#t.status),d.addEventListener("open",()=>{this.#t={status:"connected",peerConnection:c,dataChannel:d,callId:p},this.updateSessionConfig(l),this.emit("connection_change",this.#t.status),this._onOpen(),r()}),d.addEventListener("error",S=>{this.close(),this._onError(S),i(S)}),d.addEventListener("message",S=>{this._onMessage(S);const{data:A,isGeneric:w}=Js(S);if(!(!A||w)&&(A.type==="response.created"?this.#n=!0:A.type==="response.done"&&(this.#n=!1),A.type==="session.created")){this._tracingConfig=A.session.tracing;const D=typeof l.tracing>"u"?"auto":l.tracing;this._updateTracingConfig(D)}});const y=this.options.audioElement??document.createElement("audio");y.autoplay=!0,c.ontrack=S=>{y.srcObject=S.streams[0]};const _=this.options.mediaStream??await navigator.mediaDevices.getUserMedia({audio:!0});if(c.addTrack(_.getAudioTracks()[0]),this.options.changePeerConnection){const S=c;c=await this.options.changePeerConnection(c),S!==c&&(S.onconnectionstatechange=null),m(c),this.#t={...this.#t,peerConnection:c}}const b=await c.createOffer();if(await c.setLocalDescription(b),!b.sdp)throw new Error("Failed to create offer");const x=await fetch(u,{method:"POST",body:b.sdp,headers:{"Content-Type":"application/sdp",Authorization:`Bearer ${s}`,"X-OpenAI-Agents-SDK":nl["X-OpenAI-Agents-SDK"]}});p=x.headers?.get("Location")?.split("/").pop(),this.#t={...this.#t,callId:p};const k={type:"answer",sdp:await x.text()};await c.setRemoteDescription(k)}catch(l){this.close(),this._onError(l),i(l)}})}sendEvent(t){if(!this.#t.dataChannel||this.#t.dataChannel.readyState!=="open")throw new Error("WebRTC data channel is not connected. Make sure you call `connect()` before sending events.");this.#t.dataChannel.send(JSON.stringify(t))}mute(t){this.#i=t,this.#t.peerConnection&&this.#t.peerConnection.getSenders().forEach(o=>{o.track&&(o.track.enabled=!t)})}_afterAudioDoneEvent(){this.#n=!1}close(){if(this.#t.dataChannel&&this.#t.dataChannel.close(),this.#t.peerConnection){const t=this.#t.peerConnection;t.onconnectionstatechange=null,t.getSenders().forEach(n=>{n.track?.stop()}),t.close()}this.#t.status!=="disconnected"&&(this.#t={status:"disconnected",peerConnection:void 0,dataChannel:void 0,callId:void 0},this.emit("connection_change",this.#t.status),this._onClose())}interrupt(){this.#n&&(this.sendEvent({type:"response.cancel"}),this.#n=!1),this.sendEvent({type:"output_audio_buffer.clear"})}}const Qb=globalThis.WebSocket;class Xb extends $o{#e;#t;#s;#n={status:"disconnected",websocket:void 0};#i;#r;#a;_firstAudioTimestamp;_audioLengthMs=0;#o=!1;#u;#c;#l(){this.#r=void 0,this._firstAudioTimestamp=void 0,this._audioLengthMs=0,this.#a=void 0}constructor(t={}){super(t),this.#t=t.url,this.#s=t.url,this.#i=t.useInsecureApiKey??!1,this.#u=t.createWebSocket,this.#c=t.skipOpenEventListeners??!1}getCommonRequestHeaders(){return nl}get status(){return this.#n.status}get connectionState(){return this.#n}get muted(){return null}get currentItemId(){return this.#r}_onAudio(t){this.emit("audio",t)}_afterAudioDoneEvent(){this.#l()}async#p(t,n,o){if(this.#n.websocket){t();return}if(!this.#e)throw new _e("API key is not set. Please call `connect()` with an API key first.");if(!this.#e.startsWith("ek_")&&!this.#i)throw new _e("Using the WebSocket connection in a browser environment requires an ephemeral client key. If you have to use a regular API key, set the `useInsecureApiKey` option to true.");let s=null;if(this.#u)s=await this.#u({url:this.#t,apiKey:this.#e});else{const r=["realtime","openai-insecure-api-key."+this.#e,Zw];s=new Qb(this.#t,r)}this.#n={status:"connecting",websocket:s},this.emit("connection_change",this.#n.status);const a=()=>{this.#n={status:"connected",websocket:s},this.emit("connection_change",this.#n.status),this._onOpen(),t()};this.#c===!0?a():s.addEventListener("open",a),s.addEventListener("error",r=>{this._onError(r),this.#n={status:"disconnected",websocket:void 0},this.emit("connection_change",this.#n.status),n(r)}),s.addEventListener("message",r=>{this._onMessage(r);const{data:i,isGeneric:l}=Js(r);if(!(!i||l)){if(i.type==="response.output_audio.delta"){this.#a=i.content_index,this.#r=i.item_id,this._firstAudioTimestamp===void 0&&(this._firstAudioTimestamp=Date.now(),this._audioLengthMs=0);const u=Mw(i.delta),c=this._rawSessionConfig?.audio?.output?.format;if(c&&typeof c=="object"){const p=c.type;if(p==="audio/pcmu"||p==="audio/pcma")this._audioLengthMs+=u.byteLength/8;else if(p==="audio/pcm"){const m=c.rate??24e3;this._audioLengthMs+=u.byteLength/2/m*1e3}else this._audioLengthMs+=u.byteLength/24/2}else typeof c=="string"?c.startsWith("g711_")?this._audioLengthMs+=u.byteLength/8:this._audioLengthMs+=u.byteLength/24/2:this._audioLengthMs+=u.byteLength/24/2;const d={type:"audio",data:u,responseId:i.response_id};this._onAudio(d)}else if(i.type==="input_audio_buffer.speech_started"){const u=this._rawSessionConfig?.audio?.input?.turn_detection?.interrupt_response??!1;this.interrupt(!u)}else if(i.type==="response.created")this.#o=!0;else if(i.type==="response.done")this.#o=!1;else if(i.type==="session.created"){this._tracingConfig=i.session.tracing;const u=typeof o.tracing>"u"?"auto":o.tracing;this._updateTracingConfig(u)}}}),s.addEventListener("close",()=>{this.#n={status:"disconnected",websocket:void 0},this.emit("connection_change",this.#n.status),this._onClose()})}async connect(t){const n=t.model??this.currentModel;this.currentModel=n,this.#e=await this._getApiKey(t);const o=t.callId;let s;t.url?(s=t.url,this.#s=t.url):o?s=`wss://api.openai.com/v1/realtime?call_id=${o}`:this.#s?s=this.#s:s=`wss://api.openai.com/v1/realtime?model=${this.currentModel}`,this.#t=s;const a={...t.initialSessionConfig||{},model:this.currentModel};await new Promise((r,i)=>{this.#p(r,i,a).catch(i)}),await this.updateSessionConfig(a)}sendEvent(t){if(!this.#n.websocket)throw new Error("WebSocket is not connected. Make sure you call `connect()` before sending events.");this.#n.websocket.send(JSON.stringify(t))}close(){this.#n.websocket?.close(),this.#r=void 0,this._firstAudioTimestamp=void 0,this._audioLengthMs=0,this.#a=void 0}mute(t){throw new Error("Mute is not supported for the WebSocket transport. You have to mute the audio input yourself.")}sendAudio(t,n={}){this.#n.status==="connected"&&super.sendAudio(t,n)}_cancelResponse(){this.#o&&(this.sendEvent({type:"response.cancel"}),this.#o=!1)}_interrupt(t,n=!0){if(t<0)return;n&&this._cancelResponse();const o=this._audioLengthMs??Number.POSITIVE_INFINITY,s=Math.max(0,Math.floor(Math.min(t,o)));this.emit("audio_interrupted"),this.sendEvent({type:"conversation.item.truncate",item_id:this.#r,content_index:this.#a,audio_end_ms:s})}interrupt(t=!0){if(!this.#r||typeof this._firstAudioTimestamp!="number")return;const n=Date.now()-this._firstAudioTimestamp;n>=0&&this._interrupt(n,t),this.#l()}}const ek=Symbol("backgroundResult");function tk(e){return typeof e=="object"&&e!==null&&ek in e}function nk(e){return e.type==="function"||e.type==="hosted_tool"&&e.name==="hosted_mcp"}function ok(e){if(e.type==="function")return e;if(e.type==="hosted_tool"&&e.name==="hosted_mcp"){const t=e.providerData.server_url&&e.providerData.server_url.length>0?e.providerData.server_url:void 0;return{type:"mcp",server_label:e.providerData.server_label,server_url:t,headers:e.providerData.headers,allowed_tools:e.providerData.allowed_tools,require_approval:e.providerData.require_approval}}throw new _e(`Invalid tool type: ${e}`)}function sk(){return JSON.parse(JSON.stringify(dt))}class Vs extends Io{initialAgent;options;#e;#t;#s;#n;#i=[];#r;#a={};#o=[];#u;#c={};#l=!1;#p=new Map;#d=[];#g=sk();#y=!0;constructor(t,n={}){super(),this.initialAgent=t,this.options=n,typeof n.transport>"u"&&Fw()||n.transport==="webrtc"?this.#e=new Yb:n.transport==="websocket"||typeof n.transport>"u"?this.#e=new Xb:this.#e=n.transport,this.#t=t,this.#n=new nn({...n.context??{},history:this.#o}),this.#i=(n.outputGuardrails??[]).map(Vw),this.#r=Jw(n.outputGuardrailSettings??{}),this.#u=n.historyStoreAudio??!1,this.#y=n.automaticallyTriggerResponseForMcpToolCalls??!0}get transport(){return this.#e}get currentAgent(){return this.#t}get usage(){return this.#n.usage}get context(){return this.#n}get muted(){return this.#e.muted}get history(){return this.#o}get availableMcpTools(){return this.#d}async#f(t){this.#t=t;const n=await this.#t.getEnabledHandoffs(this.#n),o=n.map(i=>i.getHandoffAsFunctionTool()),s=(await this.#t.getAllTools(this.#n)).filter(nk).map(ok),a=typeof this.#t.tools<"u"||typeof this.#t.mcpServers<"u",r=n.length>0;this.#s=a||r?[...s,...o]:void 0,this.#_()}async#m(t={}){const n=t??{},o=this.options.config??{},s=await this.#t.getSystemPrompt(this.#n),a=p=>p.audio?.output?.voice,r=this.options.tracingDisabled?null:this.options.workflowName?{workflow_name:this.options.workflowName}:"auto";r!==null&&r!=="auto"?(this.options.groupId&&(r.group_id=this.options.groupId),this.options.traceMetadata&&(r.metadata=this.options.traceMetadata)):(this.options.groupId||this.options.traceMetadata)&&Xe.warn("In order to set traceMetadata or a groupId you need to specify a workflowName.");const i=a(n)??a(o),l=n.voice??o.voice,u=typeof i<"u"?i:typeof l<"u"?l:this.#t.voice,d={...{...this.#g??{},...o,...n},instructions:s,voice:u,model:this.options.model,tools:this.#s,tracing:r,prompt:typeof this.#t.prompt=="function"?await this.#t.prompt(this.#n,this.#t):this.#t.prompt};return this.#g=d,d}async getInitialSessionConfig(t={}){return await this.#f(this.initialAgent),this.#m({...this.options.config??{},...t??{}})}static async computeInitialSessionConfig(t,n={},o={}){const s=new Vs(t,n);try{return await s.getInitialSessionConfig(o)}finally{s.close()}}async updateAgent(t){return this.#t.emit("agent_handoff",this.#n,t),this.emit("agent_handoff",this.#n,this.#t,t),await this.#f(t),await this.#e.updateSessionConfig(await this.#m()),t}async#w(t,n){const o=await n.onInvokeHandoff(this.#n,t.arguments);this.#t.emit("agent_handoff",this.#n,o),this.emit("agent_handoff",this.#n,this.#t,o),await this.#f(o),await this.#e.updateSessionConfig(await this.#m());const s=Iu(o);return this.#e.sendFunctionCallOutput(t,s,!0),o}async#h(t,n){this.#n.context.history=JSON.parse(JSON.stringify(this.#o));let o=t.arguments;if(n.parameters&&(Vt(n.parameters)?o=n.parameters.parse(o):o=JSON.parse(o)),await n.needsApproval(this.#n,o,t.callId)){const i=this.context.isToolApproved({toolName:n.name,callId:t.callId});if(i===!1){this.emit("agent_tool_start",this.#n,this.#t,n,{toolCall:t}),this.#t.emit("agent_tool_start",this.#n,n,{toolCall:t});const l="Tool execution was not approved.";this.#e.sendFunctionCallOutput(t,l,!0),this.emit("agent_tool_end",this.#n,this.#t,n,l,{toolCall:t}),this.#t.emit("agent_tool_end",this.#n,n,l,{toolCall:t});return}else if(typeof i>"u"){this.emit("tool_approval_requested",this.#n,this.#t,{type:"function_approval",tool:n,approvalItem:new Ve(t,this.#t)});return}}this.emit("agent_tool_start",this.#n,this.#t,n,{toolCall:t}),this.#t.emit("agent_tool_start",this.#n,n,{toolCall:t}),this.#n.context.history=JSON.parse(JSON.stringify(this.#o));const a=await n.invoke(this.#n,t.arguments,{toolCall:t});let r;tk(a)?(r=Mt(a.content),this.#e.sendFunctionCallOutput(t,r,!1)):(r=Mt(a),this.#e.sendFunctionCallOutput(t,r,!0)),this.emit("agent_tool_end",this.#n,this.#t,n,r,{toolCall:t}),this.#t.emit("agent_tool_end",this.#n,n,r,{toolCall:t})}async#b(t){const n=await this.#t.getEnabledHandoffs(this.#n),o=new Map(n.map(i=>[i.toolName,i])),s=await this.#t.getAllTools(this.#n),a=new Map(s.map(i=>[i.name,i])),r=o.get(t.name);if(r)await this.#w(t,r);else{const i=a.get(t.name);if(i&&i.type==="function")await this.#h(t,i);else throw new Ge(`Tool ${t.name} not found`)}}async#v(t,n,o){if(this.#i.length===0)return;const s={agent:this.#t,agentOutput:t,context:this.#n},r=(await Promise.all(this.#i.map(i=>i.run(s)))).find(i=>i.output.tripwireTriggered);if(r){if(this.#c[n])return;this.#c[n]=!0;const i=new ss(`Output guardrail triggered: ${JSON.stringify(r.output.outputInfo)}`,r);this.emit("guardrail_tripped",this.#n,this.#t,i,{itemId:o}),this.interrupt();const l=Hw(r);this.sendMessage(l);return}}#k(){this.#e.on("*",o=>{if(this.emit("transport_event",o),o.type==="conversation.item.input_audio_transcription.completed")try{const s=o;this.#o=Ta(this.#o,s,this.#u),this.#n.context.history=this.#o,this.emit("history_updated",this.#o)}catch(s){this.emit("error",{type:"error",error:s})}}),this.#e.on("mcp_tools_listed",({serverLabel:o,tools:s})=>{try{this.#p.set(o,s??[]),this.#_()}catch(a){this.emit("error",{type:"error",error:a})}}),this.#e.on("audio",o=>{this.#l||(this.#l=!0,this.emit("audio_start",this.#n,this.#t)),this.emit("audio",o)}),this.#e.on("turn_started",()=>{this.#l=!1,this.emit("agent_start",this.#n,this.#t),this.#t.emit("agent_start",this.#n,this.#t)}),this.#e.on("turn_done",o=>{const s=o.response.output[o.response.output.length-1],a=Nw(s)??"",r=s?.id??"";this.emit("agent_end",this.#n,this.#t,a),this.#t.emit("agent_end",this.#n,a),this.#v(a,o.response.id,r)}),this.#e.on("audio_done",()=>{this.#l&&(this.#l=!1),this.emit("audio_stopped",this.#n,this.#t)});let t=0,n;this.#e.on("audio_transcript_delta",o=>{try{const s=o.delta,a=o.itemId,r=o.responseId;n!==a&&(n=a,t=0);const l=(this.#a[a]??"")+s;if(this.#a[a]=l,this.#r.debounceTextLength<0)return;const u=Math.floor(l.length/this.#r.debounceTextLength);u>t&&(t=u,this.#v(l,r,a))}catch(s){this.emit("error",{type:"error",error:s})}}),this.#e.on("item_update",o=>{try{const s=!this.#o.some(a=>a.itemId===o.itemId);if(this.#o=Ta(this.#o,o,this.#u),this.#n.context.history=this.#o,s){const a=this.#o.find(r=>r.itemId===o.itemId);a&&this.emit("history_added",a)}this.emit("history_updated",this.#o)}catch(s){this.emit("error",{type:"error",error:s})}}),this.#e.on("item_deleted",o=>{try{this.#o=this.#o.filter(s=>s.itemId!==o.itemId),this.#n.context.history=this.#o,this.emit("history_updated",this.#o)}catch(s){this.emit("error",{type:"error",error:s})}}),this.#e.on("function_call",async o=>{try{await this.#b(o)}catch(s){Xe.error("Error handling function call",s),this.emit("error",{type:"error",error:s})}}),this.#e.on("usage_update",o=>{this.#n.usage.add(o)}),this.#e.on("audio_interrupted",()=>{this.#l&&(this.#l=!1),this.emit("audio_interrupted",this.#n,this.#t)}),this.#e.on("error",o=>{this.emit("error",o)}),this.#e.on("mcp_tool_call_completed",o=>{this.emit("mcp_tool_call_completed",this.#n,this.#t,o),this.#y&&this.#e.sendEvent({type:"response.create"})}),this.#e.on("mcp_approval_request",o=>{this.emit("tool_approval_requested",this.#n,this.#t,{type:"mcp_approval_request",approvalItem:jw(this.#t,o)})})}#_(){const t=this.#s?.filter(i=>i.type==="mcp"),n=i=>{const l=i.allowed_tools;if(l){if(Array.isArray(l))return l;if(l&&Array.isArray(l.tool_names))return l.tool_names}},o=new Map;for(const i of t){const l=this.#p.get(i.server_label)??[],u=n(i);for(const c of l)u&&!u.includes(c.name)||o.has(c.name)||o.set(c.name,c)}const s=Array.from(o.values()),a=this.#d;(a.length!==s.length||JSON.stringify(a.map(i=>i.name).sort())!==JSON.stringify(s.map(i=>i.name).sort()))&&(this.#d=s,this.emit("mcp_tools_changed",this.#d))}async connect(t){await this.#f(this.initialAgent),this.#k(),await this.#e.connect({apiKey:t.apiKey??this.options.apiKey,model:this.options.model,url:t.url,callId:t.callId,initialSessionConfig:await this.#m(this.options.config)}),this.#o=[],this.emit("history_updated",this.#o)}updateHistory(t){let n;typeof t=="function"?n=t(this.#o):n=t,this.#e.resetHistory(this.#o,n)}sendMessage(t,n={}){this.#e.sendMessage(t,n)}addImage(t,{triggerResponse:n=!0}={}){this.#e.addImage(t,{triggerResponse:n})}mute(t){this.#e.mute(t)}close(){this.#c={},this.#e.close()}sendAudio(t,n={}){this.#e.sendAudio(t,n)}interrupt(){this.#e.interrupt()}async approve(t,n={alwaysApprove:!1}){this.#n.approveTool(t,n);const o=t.toolName??t.rawItem.name,s=this.#t.tools.find(a=>a.name===o);if(s&&s.type==="function"&&t.rawItem.type==="function_call")await this.#h(t.rawItem,s);else if(t.rawItem.type==="hosted_tool_call"){n.alwaysApprove&&Xe.warn("Always approving MCP tools is not supported. Use the allowed tools configuration instead.");const a=Ca(t);this.#e.sendMcpResponse(a,!0)}else throw new Ge(`Tool ${o??"unknown"} not found`)}async reject(t,n={alwaysReject:!1}){this.#n.rejectTool(t,n);const o=t.toolName??t.rawItem.name,s=this.#t.tools.find(a=>a.name===o);if(s&&s.type==="function"&&t.rawItem.type==="function_call")await this.#h(t.rawItem,s);else if(t.rawItem.type==="hosted_tool_call"){n.alwaysReject&&Xe.warn("Always rejecting MCP tools is not supported. Use the allowed tools configuration instead.");const a=Ca(t);this.#e.sendMcpResponse(a,!1)}else throw new Ge(`Tool ${o??"unknown"} not found`)}}const Ea=128;function rk(e){let t=0;for(let n=0;n<e.length;n++){const o=(e[n]-Ea)/Ea;t+=o*o}return Math.sqrt(t/e.length)}const Ua=6e4,ak=1e3;function ik(e,t){if(e===0)return`${t}:00`;const n=Math.floor(e/Ua),o=Math.floor(e%Ua/ak).toString().padStart(2,"0");return`${n}:${o}`}function uk(e=150){const t=W(!1),n=W(),{audioInputs:o,ensurePermissions:s}=Fl({constraints:{audio:!0,video:!1}}),a=K(()=>o.value[0]?.deviceId),{start:r,stop:i}=Bl({constraints:Zl({audio:{deviceId:a}}),autoSwitch:!0});let l,u,c;const{pause:d,resume:p}=Za(m,e,{immediate:!1});function m(){if(!u||!c)return;u.getByteTimeDomainData(c);const x=rk(c);n.value=new Float32Array([x])}async function y(){if(t.value)return;await s();const x=await r();if(!x)throw new Error("No audio stream available");l=new AudioContext;const k=l.createMediaStreamSource(x);u=l.createAnalyser(),u.fftSize=512,u.smoothingTimeConstant=.8,c=new Uint8Array(u.fftSize),k.connect(u),t.value=!0,p()}function _(){t.value&&(d(),i(),b())}function b(){l?.close(),l=void 0,u=void 0,c=void 0,n.value=void 0,t.value=!1}return po(b),{isActive:sr(t),audioData:sr(n),start:y,stop:_,cleanup:b}}const lk={class:"flex items-center gap-2"},ck=["disabled"],dk={key:1,class:"p-2"},pk={key:2,class:"flex items-center gap-1 px-2 text-xs text-gray-400"},fk={class:"font-mono tabular-nums"},mk="LESSON_CONTEXT:",hk=he({__name:"RealtimeBoots",props:{sourceUUID:{},sourceType:{},lessonComplete:{type:Boolean},currentChatUUID:{},hintAlreadyViewed:{type:Boolean},focusInput:{},handleConfirmHint:{},streamResponse:{},storeMessages:{},appendUserMessage:{},getLatestMessage:{},getCurrentChatMetadata:{},reloadUserSourceData:{},disabled:{type:Boolean,default:!1}},setup(e,{expose:t}){const n=e,o=jl(),{createToast:s,errToast:a}=Gt(),r=W(!1),i=W(!1),l=W(!1),u=W(!1),c=W(!1),d=W(!1),p=W(!1),m=W(),y=W(Date.now()),_=K(()=>m.value?y.value-m.value:0),b=K(()=>ik(_.value,Math.floor(_.value/6e4))),x=ue("hintViewModal"),k=uk(),S=W({});W([]);const A=new qw({name:"Boots"}),w=new Vs(A,{});w.on("transport_event",async q=>{const G=q.item||{},xe=q.item_id||G.id,ge=q.delta||G.content?.[0]?.text||G.content?.[0]?.transcript||"";switch(q.type){case"conversation.item.input_audio_transcription.delta":ge&&D("user",xe,ge);break;case"response.output_audio_transcript.delta":ge&&D("assistant",xe,ge);break;case"response.done":{n.storeMessages();const Ee=q.response?.usage;if(!Ee)break;Qe(Ee);break}case"response.created":u.value=!0;break;case"output_audio_buffer.stopped":u.value=!1;break;case"input_audio_buffer.speech_started":p.value=!0;break;case"input_audio_buffer.speech_stopped":p.value=!1,ve(xe);break}}),w.on("error",q=>{const G=q.error;Pe(G)}),w.transport.on("connected",()=>{R()}),w.transport.on("disconnected",()=>{z()});function D(q,G,xe){let ge;const Ee=S.value[G];if(Ee)ge=Ee;else{const Ze=n.getLatestMessage();Ze?.UUID&&q==="user"&&Ze?.Role==="user"?(ge=Ze.UUID,xe=`

`+xe):ge=crypto?.randomUUID(),S.value[G]=ge}n.streamResponse(q,ge,xe)}async function E(){!n.lessonComplete&&!n.hintAlreadyViewed?x.value?.show():B()}async function B(){try{l.value=!0;const q=await Kl(n.sourceType,n.sourceUUID,n.currentChatUUID),G=q.SecretKey,xe=new Date(q.ExpiresAt*1e3).getTime();try{Date.now()<xe&&await w.connect({apiKey:G})}catch(ge){Pe(ge),l.value=!1}}catch(q){a(q),l.value=!1}await n.getCurrentChatMetadata(),await n.reloadUserSourceData()}function R(){Z(),l.value=!1,oe(),d.value=!0,be()}function z(){w.close(),Z(),l.value=!1,le(),u.value=!1,d.value=!1,ee(),m.value=void 0}function j(){w.interrupt(),c.value=!0,u.value=!1}function J(){c.value=!1}function le(){k.stop(),w.mute(!0),Be()}function oe(){ce(),w.mute(!1),Be()}function ve(q){const G=n.appendUserMessage();if(!G)return;S.value[q]=G.UUID;const xe=G.Metadata||{};ie(xe)}function Ae(q,G){w.interrupt(),ie(q,G)}function ie(q,G=""){G&&(G=`

`+G);const xe=JSON.stringify(q),ge=mk+xe+G;w.transport.sendMessage(ge,{},{triggerResponse:!0})}function X(){d.value=!d.value,d.value||n.focusInput()}function Be(){r.value=!!w.muted}function Z(){i.value=w.transport.status==="connected"}const{pause:ee,resume:De}=Za(()=>{y.value=Date.now()},1e3,{immediate:!1});function be(){m.value=Date.now(),y.value=m.value,De()}async function ce(){try{await k.start()}catch(q){if(q instanceof DOMException&&q.name==="NotAllowedError"){a("Enable mic access");return}a("Couldn't start audio visual")}}async function Qe(q){const G=q.output_tokens;if(q.input_tokens+G===0)return;const ge=q.output_token_details.audio_tokens,Ee=q.output_token_details.text_tokens,Ze=q.input_token_details.audio_tokens,st=q.input_token_details.text_tokens,fe=q.input_token_details.cached_tokens_details.audio_tokens,bt=q.input_token_details.cached_tokens_details.text_tokens,Ne=Ze-fe,hn=st-bt;try{const Dt=await ql({ChatUUID:n.currentChatUUID,InputTokensText:hn,OutputTokensText:Ee,InputTokensRealtime:Ne,OutputTokensRealtime:ge});Dt.message&&Jl()&&(Vl(),s({type:"info",text:Dt.message,id:Dt.code}))}catch(Dt){a(Dt),Dt instanceof Hl&&z()}}function Pe(q){if(q instanceof DOMException&&q.name==="NotAllowedError"){a("Enable mic access");return}q?.error?.code==="response_cancel_not_active"||q?.error?.code==="conversation_already_has_active_response"||a("Boots may be experiencing some magical difficulties")}const wt=o.beforeEach((q,G)=>{q.params.lessonUUID===G.params.lessonUUID&&q.params.challengeUUID===G.params.challengeUUID||(l.value||i.value)&&z()});return ys(()=>{wt(),ee()}),t({isStarting:l,isStarted:i,isSpeaking:u,sendTextMessage:Ae,isSpeechDetected:p,handleStartSession:B,showingAudioVisual:d,inputAudioData:k.audioData}),(q,G)=>{const xe=ei,ge=Bc,Ee=He,Ze=Gl,st=Zc,fe=Nc,bt=Ha,Ne=Fc,hn=Wl;return g(),I(me,null,[U(xe,{ref_key:"hintViewModal",ref:x,"on-confirm":e.handleConfirmHint(B)},null,8,["on-confirm"]),h("div",lk,[!i.value&&!l.value?(g(),F(Ee,{key:0,position:"top-left"},{tip:O(()=>[...G[1]||(G[1]=[h("p",null,"Start Voice Chat",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700 disabled:cursor-not-allowed",disabled:e.disabled&&!i.value,onClick:E},[U(ge,{"stroke-width":"1.5",class:Oe(["h-5 w-5",{"opacity-50":e.disabled}])},null,8,["class"]),G[0]||(G[0]=h("span",{class:"sr-only"},"Start Voice Chat",-1))],8,ck)]),_:1})):l.value?(g(),I("div",dk,[U(Ze,{"stroke-width":"1.5",class:"h-5 w-5 animate-spin"})])):L("",!0),i.value?(g(),I("div",pk,[h("span",fk,M(b.value),1)])):L("",!0),i.value?(g(),F(Ee,{key:3},{tip:O(()=>[...G[3]||(G[3]=[h("p",null,"Stop Response",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700",onMousedown:j,onMouseup:J,onMouseleave:J,onKeydown:j,onKeyup:J},[c.value?(g(),F(st,{key:0,fill:"currentColor","stroke-width":"1.5",class:"h-5 w-5 scale-90 transform"})):(g(),F(st,{key:1,"stroke-width":"1.5",class:"h-5 w-5"})),G[2]||(G[2]=h("span",{class:"sr-only"},"Stop Response",-1))],32)]),_:1})):L("",!0),i.value&&d.value?(g(),F(Ee,{key:4},{tip:O(()=>[...G[5]||(G[5]=[h("p",null,"Show Text Input",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700",onClick:X},[U(fe,{"stroke-width":"1.5",class:"h-5 w-5"}),G[4]||(G[4]=h("span",{class:"sr-only"},"Show Text Input",-1))])]),_:1})):i.value&&!d.value?(g(),F(Ee,{key:5},{tip:O(()=>[...G[7]||(G[7]=[h("p",null,"Hide Text Input",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors bg-gray-700",onClick:X},[U(bt,{"stroke-width":"1.5",class:"h-5 w-5"}),G[6]||(G[6]=h("span",{class:"sr-only"},"Hide Text Input",-1))])]),_:1})):L("",!0),i.value&&!r.value?(g(),F(Ee,{key:6},{tip:O(()=>[...G[9]||(G[9]=[h("p",null,"Mute",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700",onClick:le},[U(ge,{"stroke-width":"1.5",class:"h-5 w-5"}),G[8]||(G[8]=h("span",{class:"sr-only"},"Mute",-1))])]),_:1})):i.value&&r.value?(g(),F(Ee,{key:7},{tip:O(()=>[...G[11]||(G[11]=[h("p",null,"Unmute",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700",onClick:oe},[U(Ne,{"stroke-width":"1.5",class:"h-5 w-5"}),G[10]||(G[10]=h("span",{class:"sr-only"},"Unmute",-1))])]),_:1})):L("",!0),i.value?(g(),F(Ee,{key:8,position:"top-left"},{tip:O(()=>[...G[13]||(G[13]=[h("p",null,"End Voice Chat",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700",onClick:z},[U(hn,{"stroke-width":"1.5",class:"h-5 w-5"}),G[12]||(G[12]=h("span",{class:"sr-only"},"End Voice Chat",-1))])]),_:1})):L("",!0)])],64)}}}),gk={class:"vl-parent px-4 pt-2 pb-8"},yk={class:"pb-4"},vk={class:"flex flex-col gap-1"},_k={key:1,class:"text-center text-yellow-500"},wk={class:"relative mb-3"},bk={key:0,class:"absolute bottom-2 right-12"},kk=["disabled"],Ik={key:1,class:"absolute inset-0 z-elevated h-12 w-full"},xk={class:"absolute bottom-0 right-0 flex items-center justify-between p-2"},Sk=":::",Tk=he({__name:"BootsChat",props:{sourceUUID:{},sourceType:{},lessonComplete:{type:Boolean},hintAlreadyViewed:{type:Boolean},currentFiles:{default:()=>[]},progLang:{default:void 0},editorOutput:{default:void 0},readOnly:{type:Boolean,default:!1}},setup(e,{expose:t}){const n=e,{loadBootsChats:o}=it(),{getLesson:s}=Yl(),{getChallenge:a}=Ql(),{loadUserSourceData:r}=Tc(),{inGuestMode:i}=At(),l=tt(),{loadNumBakedSalmon:u,decrementBakedSalmon:c}=l,{loadBuyBakedSalmon:d}=Cc(),{user:p,numBakedSalmon:m}=ke(l),{createToast:y,errToast:_}=Gt(),b=Xl(),x=W(!0),k=W(""),S=W(""),A=ue("hintViewModal"),w=ue("personalInstructionsModal"),D=W("Ask Boots a question..."),E=W(!1),B=()=>{w.value?.toggle()},R=K(()=>`/u/${p.value?.Handle}`),z=K(()=>!!b.query.debug||p.value?.IsAdmin),j=P=>{const Y=P.target?.scrollTop,ne=P.target?.scrollHeight-P.target?.clientHeight;Y>=ne-2?E.value=!1:E.value=!0},J=()=>{E.value||Wa()},le=K(()=>p.value?.ProfileImageURL?p.value.ProfileImageURL:ja),oe=Ac(),ve=K(()=>n.lessonComplete||n.hintAlreadyViewed?`**Need help?** I, ${oe}, can assist _without penalty_!`:`**Need help?** I, ${oe}, can assist... _for a price_.`),{cacheBootsMessages:Ae}=ke(it()),ie=K(()=>Ae.value.get(n.sourceUUID)??[]),X=K(()=>ie.value[ee.value]),Be=K(()=>ie.value.length),Z=K(()=>ie.value.filter(P=>P.Title)),ee=W(0),De=K(()=>!(X.value?.Messages??[]).some(V=>V.Role==="assistant")),be=K(()=>Be.value>1||!De.value),ce=K(()=>{switch(n.sourceType){case"lesson":return Qe(n.sourceUUID);case"challenge":return Pe(n.sourceUUID);default:return!1}}),Qe=P=>{const V=s(P);if(!V)return!1;const Y=V.Lesson;return Et(Y)||Ut(Y)||ft(Y)},Pe=P=>{const V=a(P);return V?Et(V)||Ut(V)||ft(V):!1},wt=()=>{fe.value(),x.value=!1,S.value=k.value,k.value=""},q=W(!1),G=async()=>{Qt.value="",await o(n.sourceUUID,n.sourceType)},xe=async(P,V=!0)=>{q.value||(wt(),S.value="",ee.value=P,Qt.value="",V&&(Ys(),J()))},ge=(P=!0)=>{if(q.value)return;const V=Ee();if(V!==-1){xe(V,P);return}let Y=Ae.value.get(n.sourceUUID);Y||(Y=[],Ae.value.set(n.sourceUUID,Y)),Y.push({Messages:[]}),xe(Be.value-1,P)};function Ee(){if(!ie.value)return-1;const P=Be.value;return ie.value[P-1]?.Messages?.length===0?P-1:-1}const Ze=async()=>{if(!X.value||X.value.UUID)return;let P=[];n.sourceType==="lesson"?P=await ec(n.sourceUUID):n.sourceType==="challenge"&&(P=await tc(n.sourceUUID));const V=new Set(ie.value.map(Y=>Y.UUID));for(const Y of P)if(!V.has(Y.UUID)){const ne=X.value;ne&&(ne.Model=Y.Model,ne.Title=Y.Title,ne.UUID=Y.UUID);break}},st=async P=>{xe(P),await G()};Ht(async()=>{document.getElementById("markdown-side")?.addEventListener("scroll",j),document.getElementById("lesson-or-challenge")?.addEventListener("scroll",j);try{await G(),ge(!1)}catch(Y){_(Y)}}),po(()=>{document.getElementById("markdown-side")?.removeEventListener("scroll",j),document.getElementById("lesson-or-challenge")?.removeEventListener("scroll",j),E.value=!0});const fe=W(()=>{}),bt=K(()=>P=>{P.shiftKey||kt?.value.trim()!==""&&(!n.lessonComplete&&!n.hintAlreadyViewed?A.value?.show():Eo())});function Ne(P){return async function(V){await hn(V),await P()}}const hn=async P=>{P&&await d(!1);const V=m.value>0||P;ul(V)},Dt=()=>{const P={};if(X.value?.Messages?.length===0)return n.currentFiles.forEach(ne=>{ne.IsHidden||ne.IsReadonly||(P[ne.Name]=ne.Content)}),P;const Y={};for(const ne of X.value?.Messages??[])if(!(ne.Role!=="user"||!ne.Metadata?.UpdatedUserFiles))for(const[Me,Nn]of Object.entries(ne.Metadata?.UpdatedUserFiles))Y[Me]=Nn;return n.currentFiles.forEach(ne=>{if(ne.IsHidden||ne.IsReadonly)return;Y[ne.Name]!==ne.Content&&(P[ne.Name]=ne.Content)}),P},al=()=>{const P=Array.isArray(n.editorOutput)?n.editorOutput.join(`
`):n.editorOutput??"";if(X.value?.Messages?.length===0)return P;const Y=X.value?.Messages??[];for(let ne=Y.length-1;ne>=0;ne--){const Me=Y[ne];if(!(Me?.Role!=="user"||!Me.Metadata?.UpdatedEditorOutput))return Me?.Metadata?.UpdatedEditorOutput===P?"":P}return P},il=()=>{if(!ce.value)return!1;const P=X.value?.Messages??[];for(let V=P.length-1;V>=0;V--){const Y=P[V];if(!(Y?.Role!=="user"||!Y.Metadata?.UpdatedEditorOutput)&&Y?.Metadata?.UpdatedEditorOutput!=="")return!1}return!0},Eo=async()=>{if(ze.value?.isStarted){gl();return}if(!(!kt.value||q.value||ze.value?.isStarting||ze.value?.isStarted)){if(!De.value&&!X.value?.UUID){_("Your messenger owl got rotisseried, cast refresh to revive it!");return}q.value=!0,x.value=!0,E.value=!1,setTimeout(async()=>{await Ze()},1e3);try{const P=await ll();P&&(fe.value=P.stopStreaming)}catch(P){_(P)}u()}},Uo=W(""),Qt=W(""),Hs=async P=>{if(P){const Y=P.split(Sk);Y[1]&&(Uo.value=Y[1]),Y[2]&&(Qt.value=Y[2]),k.value+=Y[0]??"",J();return}const V=X.value;V?.Messages&&k.value.trim().length&&V.Messages.push({UUID:Uo.value,Role:"assistant",Content:k.value}),Uo.value="",k.value="",q.value=!1,await Ze(),Gs(),J(),Ys()},Gs=async()=>{try{await r(n.sourceUUID,n.sourceType)}catch(P){_(P)}},ul=P=>{P?(c(),y({type:"success",text:"Baked salmon used!"})):y({type:"success",text:"XP for this lesson reduced by 50%"})},ll=async()=>{Qt.value="";const P=X.value,V=kt.value,Y=Xs();if(P&&(P.Messages||(P.Messages=[]),P.Messages.push({UUID:"",Role:"user",Content:V,Metadata:Y}),kt.value="",J()),De.value)try{return await nc(n.sourceUUID,n.sourceType,V,Y,Hs)}catch(Me){console.log(Me);return}const ne=X.value?.UUID;if(!ne){_("No chat found. THIS SHOULD NEVER HAPPEN PLEASE REPORT THIS BUG.");return}try{return await oc(ne,V,Y,Hs)}catch(Me){console.log(Me)}},Ws=async(P,V)=>{if(q.value||!X.value?.UUID||!P.UUID||P.Role!=="assistant")return;const Y=X.value.UUID,ne=P.UUID;P.Metadata||(P.Metadata={}),P.Metadata.Reaction=V,cl(),await sc(Y,ne,V)},Oo=W(!1),gn=W(void 0);ys(()=>{gn.value&&clearTimeout(gn.value)});function cl(){gn.value&&clearTimeout(gn.value),Oo.value=!0,gn.value=setTimeout(()=>{Oo.value=!1},1e3)}const kt=W(""),Ro=ue("bootsChatInput"),ze=ue("realtimeBoots"),Ks=K(()=>n.readOnly||i.value||q.value||ze.value?.isStarting||ze.value?.showingAudioVisual),dl=async()=>{kt.value="Explain the solution to the multiple choice question, I don't quite understand why this is the answer.",Eo()};function pl(P){return z.value?`${P.Title} (${P.Model})`:`${P.Title}`}const{setModalQuery:fl}=ho(),Po=()=>{fl("info-boots")},Mo=()=>{Ro.value?.focusInput()},Ys=()=>{E.value||Mo()},ml=()=>Ro.value?.isFocused?.()??!1;function hl(P,V,Y){if(!X.value)return;X.value?.Messages||(X.value.Messages=[]);const ne=X.value?.Messages.find(Me=>Me.UUID===V);ne?ne.Content.endsWith(Y)||(ne.Content+=Y):X.value?.Messages.push({UUID:V,Role:P,Content:Y}),J()}function gl(){const P=kt.value;kt.value="";const V=Qs(P);ze.value?.sendTextMessage(V?.Metadata,P)}async function yl(){const P=X.value?.UUID;if(!P)return;const V=X.value?.Messages;if(!V)return;const Y=V.slice(-10);try{const ne=await rc(P,Y)}catch(ne){console.log(ne)}}function Qs(P=""){if(!X.value)return;X.value?.Messages||(X.value.Messages=[]);const V=Xs(),Y=X.value?.Messages?.at(-1);if(Y?.UUID&&Y?.Role=="user")return Y.Content+=`

`+P,Y.Metadata=V,J(),Y;const ne={UUID:crypto?.randomUUID(),Role:"user",Content:P,Metadata:V};return X.value?.Messages?.push(ne),J(),ne}function Xs(){const P={LessonComplete:n.lessonComplete};if(!ce.value)return P;const V=Dt(),Y=!!Object.keys(V).length;if(Y&&(P.UpdatedUserFiles=V),Y||il()){const ne=al();if(ne){const Me=ne.trim().slice(-1e3);P.UpdatedEditorOutput=Me}}return P}function vl(){return X.value?.Messages?.at(-1)}return t({explainMultipleChoiceCallback:dl,focusInput:Mo,isFocused:ml,newChat:ge}),(P,V)=>{const Y=ei,ne=lp,Me=ks,Nn=Sc,Lo=He,_l=jc,wl=Wt,bl=qc,kl=cp,Il=hk;return g(),I("div",gk,[U(Y,{ref_key:"hintViewModal",ref:A,"on-confirm":Ne(Eo)},null,8,["on-confirm"]),U(ne,{ref_key:"personalInstructionsModal",ref:w},null,512),h("div",yk,[h("div",vk,[U(Me,{img:v(Wn),content:ve.value,"img-click":Po},null,8,["img","content"]),(g(!0),I(me,null,Ue(X.value?.Messages,(qe,zn)=>(g(),I(me,{key:qe.UUID},[qe.Role==="assistant"?(g(),F(Me,{key:0,"message-u-u-i-d":qe.UUID,"chat-u-u-i-d":X.value?.UUID,img:v(Wn),content:qe.Content,"reactions-disabled":Oo.value,"img-click":Po,reaction:qe.Metadata?.Reaction,"audio-enabled":"","audio-type":"chat","is-streaming":ze.value?.isSpeaking&&X.value?.Messages&&zn===X.value?.Messages.length-1,"ratings-enabled":"",onThumbsUp:er=>Ws(qe,"like"),onThumbsDown:er=>Ws(qe,"dislike")},null,8,["message-u-u-i-d","chat-u-u-i-d","img","content","reactions-disabled","reaction","is-streaming","onThumbsUp","onThumbsDown"])):qe.Role==="user"?(g(),F(Me,{key:1,"message-u-u-i-d":qe.UUID,"chat-u-u-i-d":X.value?.UUID,img:le.value,"img-link":R.value,content:qe.Content,"audio-type":"chat"},null,8,["message-u-u-i-d","chat-u-u-i-d","img","img-link","content"])):L("",!0)],64))),128)),q.value||k.value&&x.value||S.value&&!x.value?(g(),F(Me,{key:0,"is-streaming":q.value,img:v(Wn),content:x.value?k.value:S.value,"img-click":Po},null,8,["is-streaming","img","content"])):L("",!0),Qt.value?(g(),I("div",_k,M(Qt.value),1)):L("",!0)])]),h("div",{class:Oe(["flex flex-wrap gap-1",{"mb-2":be.value}])},[(g(!0),I(me,null,Ue(Z.value,(qe,zn)=>(g(),F(Lo,{key:qe.UUID,position:"top"},{tip:O(()=>[...V[1]||(V[1]=[te(" Resume chat ",-1)])]),default:O(()=>[U(Nn,{class:"rounded-full px-2 py-1 text-xs",active:zn===ee.value,disabled:q.value||ze.value?.isStarting||ze.value?.isStarted,onClick:er=>st(zn)},{default:O(()=>[te(M(pl(qe)),1)]),_:2},1032,["active","disabled","onClick"])]),_:2},1024))),128)),U(Lo,{position:"top"},{tip:O(()=>[...V[2]||(V[2]=[te(" New chat ",-1)])]),default:O(()=>[be.value?(g(),F(Nn,{key:0,class:"rounded-full px-2 py-1 text-xs",disabled:De.value||q.value||ze.value?.isStarting||ze.value?.isStarted,onClick:ge},{default:O(()=>[U(_l,{"stroke-width":"1.5",class:"inline-block h-4 w-4"}),V[3]||(V[3]=h("span",{class:"sr-only"},"New Chat",-1))]),_:1},8,["disabled"])):L("",!0)]),_:1})],2),h("div",wk,[U(wl,{ref_key:"bootsChatInput",ref:Ro,modelValue:kt.value,"onUpdate:modelValue":V[0]||(V[0]=qe=>kt.value=qe),tabindex:"0",class:Oe(["max-h-96 w-full overflow-y-auto",{"pointer-events-none opacity-0":ze.value?.showingAudioVisual}]),type:"textarea","textarea-rows":3,disabled:Ks.value,placeholder:D.value,"aria-label":"Ask Boots a question","enable-auto-resize":"",onKeydown:Ke(v(Ga),["enter"]),onKeyup:Ke(bt.value,["enter"])},null,8,["modelValue","class","disabled","placeholder","onKeydown","onKeyup"]),!ze.value?.isStarting&&!ze.value?.isStarted?(g(),I("div",bk,[U(Lo,{position:"top-left"},{tip:O(()=>[...V[4]||(V[4]=[h("p",null,"Personal Instructions",-1)])]),default:O(()=>[h("button",{class:"rounded-full p-2 transition-colors hover:bg-gray-700 disabled:cursor-not-allowed",disabled:q.value,onClick:B},[U(bl,{"stroke-width":"1.5",class:Oe(["h-5 w-5",{"opacity-50":q.value}])},null,8,["class"])],8,kk)]),_:1})])):L("",!0),ze.value?.showingAudioVisual?(g(),I("div",Ik,[U(kl,{"audio-data":ze.value?.inputAudioData,"is-speech-detected":ze.value?.isSpeechDetected},null,8,["audio-data","is-speech-detected"])])):L("",!0),h("div",xk,[U(Il,{ref_key:"realtimeBoots",ref:ze,"source-u-u-i-d":e.sourceUUID,"source-type":e.sourceType,"lesson-complete":e.lessonComplete,"current-chat-u-u-i-d":X.value?.UUID,"hint-already-viewed":e.hintAlreadyViewed,"focus-input":Mo,"handle-confirm-hint":Ne,"stream-response":hl,"store-messages":yl,"append-user-message":Qs,"get-latest-message":vl,"get-current-chat-metadata":Ze,"reload-user-source-data":Gs,disabled:Ks.value},null,8,["source-u-u-i-d","source-type","lesson-complete","current-chat-u-u-i-d","hint-already-viewed","disabled"])])])])}}}),Ck={class:"relative px-4"},Ak={class:"flex w-full items-center justify-between"},Dk={key:0,class:"mb-4"},$k={key:1,class:"flex w-full items-end justify-between gap-3 text-gray-200"},Ek={class:"font-mono font-thin lowercase"},Uk={class:"flex gap-1"},Ok={key:0,class:"flex flex-col sm:flex-row gap-x-2 items-end sm:items-center text-xs"},Rk={key:0,class:"py-4"},Pk={class:"flex gap-x-4 w-full"},Mk={key:0},Lk={class:"text-start text-xs m-2 text-gray-400"},Nk={class:"p-2"},zk={key:0,class:"flex justify-center py-8 w-full"},Fk={key:1,class:"py-8 text-center text-gray-400"},Bk={key:2,class:"flex flex-col gap-4 py-1"},Zk=["to","onClick","onMouseenter"],jk={class:"flex-col flex-nowrap text-sm text-gray-400 w-full"},qk={class:"text-start text-gray-200 underline"},Jk={key:0,class:"flex text-nowrap"},Vk={class:"max-w-1/2 overflow-hidden text-ellipsis"},Hk={class:"max-w-1/2 overflow-hidden text-ellipsis"},Gk={key:1,class:"flex text-nowrap"},Wk={class:"max-w-1/2 overflow-hidden text-ellipsis"},Kk={class:"max-w-1/2 overflow-hidden text-ellipsis"},Yk={key:3,class:"mt-4 flex items-center justify-between"},Qk=["disabled"],Xk={class:"text-sm text-gray-400"},eI=["disabled"],tI={key:1,class:"pb-8"},nI={key:2,class:"pb-8"},oI={class:"grid grid-cols-[1fr_auto] items-center"},sI={class:"whitespace-nowrap break-keep"},rI={class:"whitespace-nowrap break-keep"},aI={class:"whitespace-nowrap break-keep"},iI={class:"whitespace-nowrap break-keep"},uI={class:"whitespace-nowrap break-keep"},Oa=15,lI=he({__name:"SpellBook",props:{sourceType:{},sourceUUID:{},courseUUID:{}},setup(e,{expose:t}){const n=e,{getSpellbookContent:o,setCurrPageUUID:s,prefetchSpellbookPage:a,search:r,clearResults:i,setLanguageFilterEnabled:l}=rr(),{spellbookWidgetOpen:u,currPage:c,spellbookSearch:d,lastSpellbookSearch:p,currSpellbookPageUUID:m,searchResults:y,isLoading:_,unlockedSpellbookMetadata:b,isLanguageFilterEnabled:x}=ke(rr()),k=ue("searchInput"),S=()=>{k.value?.focusInput()},A=()=>le.value||k.value?.isFocused?.(),w=async()=>{s(""),await sn(),S()},D=K(()=>y.value.length||p.value?y.value:b.value),{paginatedItems:E,currentPage:B,totalResults:R,range:z,nextPage:j,prevPage:J}=Ka(D,Oa);Ot(D,()=>B.value=1);const le=K(()=>m.value&&u.value),oe=K(()=>le.value&&!c.value),{courses:ve}=ke(it()),Ae=K(()=>{if(!n.courseUUID||!x.value)return;const ce=ve.value.get(n.courseUUID)?.Language;if(ce)return ce}),{eventSpellbookPageOpen:ie,eventSpellbookSearch:X}=hs(),Be=be=>{o(be),n.sourceType&&n.sourceUUID&&ie(n.sourceType,n.sourceUUID,be)},Z=async()=>{await r(d.value,Ae.value),n.sourceType&&n.sourceUUID&&X(n.sourceType,n.sourceUUID)},ee=K(()=>n.sourceType==="lesson"),De=K(()=>{const be=b.value;return be?be.length===1?`unlocked ${be.length} page`:`unlocked ${be.length} pages`:""});return t({focusInput:S,isFocused:A,backClick:w}),(be,ce)=>{const Qe=ct,Pe=Ec,wt=He,q=ac,G=Wt,xe=$c,ge=bs,Ee=ws,Ze=mo,st=Xa;return g(),I("div",Ck,[h("div",Ak,[le.value?(g(),I("div",Dk,[U(Qe,{color:"outline",size:"small",onClick:w},{default:O(()=>[...ce[6]||(ce[6]=[te(" Back ",-1)])]),_:1})])):(g(),I("div",$k,[h("div",null,[U(wt,{position:"bottom-right"},{tip:O(()=>[h("em",Ek,M(De.value),1)]),default:O(()=>[h("div",Uk,[U(Pe,{"stroke-width":"1.5",class:"h-6 w-6"}),h("span",null,M(v(b).length),1)])]),_:1}),ce[7]||(ce[7]=h("p",{class:"w-full rounded-sm text-xs/5 italic text-gray-300"}," Unlock new spellbook pages by completing lessons ",-1))]),ee.value?(g(),I("div",Ok,[ce[8]||(ce[8]=te(" Limit to topics in this course ",-1)),U(q,{modelValue:v(x),"onUpdate:modelValue":[ce[0]||(ce[0]=fe=>Yo(x)?x.value=fe:null),ce[1]||(ce[1]=fe=>{v(l)(fe)})],class:"pt-1"},null,8,["modelValue"])])):L("",!0)]))]),v(c)?L("",!0):(g(),I("div",Rk,[h("div",Pk,[U(G,{ref_key:"searchInput",ref:k,modelValue:v(d),"onUpdate:modelValue":ce[2]||(ce[2]=fe=>Yo(d)?d.value=fe:null),placeholder:"Search spellbook pages...",class:"max-h-96 w-full self-center overflow-y-auto rounded-xl border border-gray-500 px-4 py-2!","aria-label":"Search spellbook pages",onKeyup:Ke(We(Z,["prevent"]),["enter"])},null,8,["modelValue","onKeyup"]),U(Qe,{color:"gray",disabled:!v(d).trim()||v(_),class:"px-6 md:min-w-36",onClick:Z},{default:O(()=>[te(M(v(_)?"Searching...":"Search"),1)]),_:1},8,["disabled"])]),v(p)&&!v(_)?(g(),I("div",Mk,[h("div",Lk,' Showing results for: "'+M(v(p))+'" ',1),v(p)?(g(),I("button",{key:0,class:"flex items-center text-xs text-gray-200 underline hover:opacity-70 py-2",onClick:ce[3]||(ce[3]=(...fe)=>v(i)&&v(i)(...fe))},[U(xe,{"stroke-width":"1.5",class:"h-6 w-6 mr-2"}),ce[9]||(ce[9]=te(" Return to Spellbooks ",-1))])):L("",!0)])):L("",!0),h("div",Nk,[v(_)?(g(),I("div",zk,[U(ge,{width:"100%",height:"250"})])):v(p)&&!v(_)&&v(y).length===0?(g(),I("div",Fk,[h("p",null,'No results found for "'+M(v(p))+'"',1)])):(g(),I("div",Bk,[(g(!0),I(me,null,Ue(v(E),fe=>(g(),I("div",{key:fe.LessonUUID,class:"flex"},[h("button",{to:`/lessons/${fe.LessonUUID}`,target:"_blank",class:"flex flex-nowrap gap-x-2 hover:underline hover:opacity-70 w-full",onClick:bt=>Be(fe.LessonUUID),onMouseenter:bt=>v(a)(fe.LessonUUID)},[h("div",jk,[h("div",qk,M(fe.Title),1),fe.ChapterTitle==="Placeholder"?(g(),I("div",Jk,[h("div",Vk,M(fe.CourseTitle),1),h("div",Hk," > "+M(fe.LessonTitle),1)])):(g(),I("div",Gk,[h("div",Wk,M(fe.CourseTitle),1),h("div",Kk," > "+M(fe.ChapterTitle),1)]))])],40,Zk)]))),128))])),v(R)>Oa&&!v(_)?(g(),I("div",Yk,[h("button",{disabled:v(B)===1,class:"rounded-sm border px-3 py-1 disabled:cursor-not-allowed disabled:opacity-50",onClick:ce[4]||(ce[4]=(...fe)=>v(J)&&v(J)(...fe))}," Prev ",8,Qk),h("p",Xk," Showing "+M(v(z)[0])+"-"+M(v(z)[1])+" of "+M(v(R)),1),h("button",{disabled:v(z)[1]===v(R),class:"rounded-sm border px-3 py-1 disabled:cursor-not-allowed disabled:opacity-50",onClick:ce[5]||(ce[5]=(...fe)=>v(j)&&v(j)(...fe))}," Next ",8,eI)])):L("",!0)])])),oe.value?(g(),I("div",tI,[U(ge,{height:"400"})])):v(c)?(g(),I("div",nI,[(g(),F(Ee,{key:v(c).LessonUUID,class:"mb-8",source:v(c).Entry,"collapse-headings":"","allow-html":""},null,8,["source"])),h("div",oI,[U(Ze,{to:`/lessons/${v(c).LessonUUID}`,target:"_blank",class:"textlink flex flex-wrap justify-center text-gray-400"},{default:O(()=>[v(c).ChapterTitle==="Placeholder"?(g(),I(me,{key:0},[h("span",sI,M(v(c).CourseTitle)+" > ",1),h("span",rI,M(v(c).LessonTitle)+"  ",1)],64)):(g(),I(me,{key:1},[h("span",aI,M(v(c).CourseTitle)+" > ",1),h("span",iI,M(v(c).ChapterTitle)+" > ",1),h("span",uI,M(v(c).LessonTitle)+"  ",1)],64))]),_:1},8,["to"]),e.sourceType==="lesson"?(g(),F(st,{key:0,"lesson-u-u-i-d":v(c).LessonUUID,"is-spellbook":!0},null,8,["lesson-u-u-i-d"])):L("",!0)])])):L("",!0)])}}}),cI={class:"relative px-4"},dI={class:"flex w-full items-center justify-between"},pI={key:1,class:"flex w-full items-end justify-between gap-3 text-gray-200"},fI={class:"flex gap-1"},mI={class:"w-full rounded-sm text-xs/5 italic text-gray-300"},hI={class:"py-4"},gI={class:"flex gap-x-4 w-full"},yI={key:0},vI={class:"text-start text-xs m-2 text-gray-400"},_I={class:"p-2"},wI={key:0,class:"flex justify-center py-8 w-full"},bI={key:1,class:"py-8 text-center text-gray-400"},kI={key:2,class:"py-8 text-center text-gray-400"},II={key:3,class:"flex flex-col gap-4 py-1"},xI={class:"flex"},SI={class:"flex-col flex-nowrap text-sm text-gray-400 w-full group-hover:opacity-70"},TI={class:"text-start text-gray-200 underline"},CI={key:0,class:"flex text-nowrap"},AI={class:"max-w-1/2 overflow-hidden text-ellipsis"},DI={class:"max-w-1/2 overflow-hidden text-ellipsis"},$I={key:1,class:"flex text-nowrap"},EI={class:"max-w-1/2 overflow-hidden text-ellipsis"},UI={class:"max-w-1/2 overflow-hidden text-ellipsis"},OI={key:4,class:"mt-4 flex items-center justify-between"},RI=["disabled"],PI={class:"text-sm text-gray-400"},MI=["disabled"],Ra=15,LI=he({__name:"SearchLessons",props:{sourceType:{},sourceUUID:{},courseUUID:{}},setup(e,{expose:t}){const n=e,{preloadLesson:o}=ic(),s=uc(),{performSearch:a,clearSearch:r}=s,{searchQuery:i,lastSearchQuery:l,isLoading:u,hasSearched:c,displayList:d}=ke(s),{paginatedItems:p,currentPage:m,totalResults:y,range:_,nextPage:b,prevPage:x}=Ka(d,Ra);Ot(d,()=>m.value=1);const{eventLessonSearchResultClicked:k,eventLessonSearch:S}=hs(),A=async()=>{n.sourceType&&n.sourceUUID&&await S(n.sourceType,n.sourceUUID),await a(i.value)},w=z=>{n.sourceType&&n.sourceUUID&&k(n.sourceType,n.sourceUUID,z)},D=()=>{r()},E=ue("searchInput");return t({focusInput:()=>{E.value?.focusInput()},isFocused:()=>E.value?.isFocused?.()}),(z,j)=>{const J=ct,le=Dc,oe=Wt,ve=bs,Ae=mo;return g(),I("div",cI,[h("div",dI,[v(l)?(g(),F(J,{key:0,color:"outline",size:"small",class:"mb-4",disabled:v(u),onClick:D},{default:O(()=>[...j[3]||(j[3]=[te(" Back ",-1)])]),_:1},8,["disabled"])):(g(),I("div",pI,[h("div",null,[h("div",fI,[U(le,{"stroke-width":"1.5",class:"h-6 w-6"})]),h("p",mI," Showing "+M(v(d).length)+" of your most recent lessons ",1)])]))]),h("div",hI,[h("div",gI,[U(oe,{ref_key:"searchInput",ref:E,modelValue:v(i),"onUpdate:modelValue":j[0]||(j[0]=ie=>Yo(i)?i.value=ie:null),placeholder:"Search all lessons...",class:"max-h-96 w-full self-center overflow-y-auto rounded-xl border border-gray-500 px-4 py-2!","aria-label":"Search lessons",onKeyup:Ke(We(A,["prevent"]),["enter"])},null,8,["modelValue","onKeyup"]),U(J,{color:"gray",disabled:!v(i).trim()||v(u),class:"px-6 md:min-w-36",onClick:A},{default:O(()=>[te(M(v(u)?"Searching...":"Search"),1)]),_:1},8,["disabled"])]),v(c)&&v(l)&&!v(u)?(g(),I("div",yI,[h("div",vI,' Showing results for: "'+M(v(l))+'" ',1)])):L("",!0)]),h("div",_I,[v(u)?(g(),I("div",wI,[U(ve,{width:"100%",height:"250"})])):v(c)&&v(l)&&!v(u)&&v(d).length===0?(g(),I("div",bI,[h("p",null,'No lessons found for "'+M(v(l))+'"',1)])):!v(c)&&v(d).length===0?(g(),I("div",kI,[...j[4]||(j[4]=[h("p",null,"Your latest lesson completions will appear here",-1),h("p",null,"Use the search bar to find lessons!",-1)])])):(g(),I("div",II,[(g(!0),I(me,null,Ue(v(p),ie=>(g(),F(Ae,{key:ie.LessonUUID,to:`/lessons/${ie.LessonUUID}`,class:"flex flex-nowrap gap-x-2 hover:underline group w-full",onClick:X=>w(ie.LessonUUID),onMouseenter:X=>v(o)(ie.LessonUUID)},{default:O(()=>[h("div",xI,[h("div",null,[U(La,{color:ie.IsComplete?v(In).Yellow:v(In).Gray,size:12},null,8,["color"])])]),h("div",SI,[h("div",TI,M(ie.LessonTitle),1),ie.ChapterTitle==="Placeholder"?(g(),I("div",CI,[h("div",AI,M(ie.CourseTitle),1),h("div",DI," > "+M(ie.LessonTitle),1)])):(g(),I("div",$I,[h("div",EI,M(ie.CourseTitle),1),h("div",UI," > "+M(ie.ChapterTitle),1)]))])]),_:2},1032,["to","onClick","onMouseenter"]))),128))])),v(y)>Ra&&!v(u)?(g(),I("div",OI,[h("button",{disabled:v(m)===1,class:"rounded-sm border px-3 py-1 disabled:cursor-not-allowed disabled:opacity-50",onClick:j[1]||(j[1]=(...ie)=>v(x)&&v(x)(...ie))}," Prev ",8,RI),h("p",PI," Showing "+M(v(_)[0])+"-"+M(v(_)[1])+" of "+M(v(y)),1),h("button",{disabled:v(_)[1]===v(y),class:"rounded-sm border px-3 py-1 disabled:cursor-not-allowed disabled:opacity-50",onClick:j[2]||(j[2]=(...ie)=>v(b)&&v(b)(...ie))}," Next ",8,MI)])):L("",!0)])])}}}),NI=["aria-selected","onClick"],zI=he({__name:"TabPanes",props:{focusCallbacks:{},isFocusedCallbacks:{},toolTipPosition:{default:"top"}},setup(e,{expose:t}){const{lastKeyPress:n}=ke(vs()),{isMobile:o}=go(),s=e,a=W(0),r=K(()=>{const b=lc();return Object.keys(b).filter(x=>x!=="default")}),i=()=>{sn(()=>{Wa()})},l=async b=>{const x=r.value.findIndex(k=>k===b);x!==-1&&await u(x)},u=async b=>{y(),a.value=b;const x=r.value[b];if(!x)return;await sn(),_(x);const k=s.focusCallbacks[x];k&&k()};function c(){const b=r.value[a.value];if(!b)return!1;const x=s.isFocusedCallbacks[b];if(!x||x())return!1;const k=s.focusCallbacks[b];return k?(k(),!0):!1}un(()=>{if(n.value==="helpTabNext"){if(!c()&&ir()){const x=(a.value+1)%r.value.length;u(x)}i()}if(n.value==="helpTabBack"){if(!c()&&ir()){const x=(a.value-1+r.value.length)%r.value.length;u(x)}i()}});const d=ue("toggle"),p=K(()=>{if(!d.value?.children)return;let b=0,x=0,k=0;for(const S of d.value?.children||[]){if(b===a.value){x=S.offsetWidth;break}k+=S.offsetWidth,b++}return{width:`${x}px`,transform:`translateX(${k}px)`}}),m=W({}),y=()=>{const b=r.value[a.value];if(!b)return;const x=document.getElementById("lesson-container");x&&(m.value[b]=x.scrollTop)},_=b=>{sn(()=>{const x=document.getElementById("lesson-container");x&&m.value[b]!==void 0&&(x.scrollTop=m.value[b])})};return t({selectTabByName:l}),(b,x)=>{const k=He;return g(),I(me,null,[h("div",{class:Oe({hidden:r.value.length<=1,"flex justify-end border-t border-gray-600":!v(o)&&r.value.length>1,"bg-image-blue top-nav-bar-height sticky top-0 z-elevated flex items-center justify-center border-b border-gray-600":v(o)&&r.value.length>1})},[U(k,{position:e.toolTipPosition},{tip:O(()=>[...x[0]||(x[0]=[h("p",null,[te(" Next tab: "),h("span",{class:"font-mono text-xs italic text-gray-300"},"ctrl+g")],-1),h("p",null,[te(" Prev tab: "),h("span",{class:"font-mono text-xs italic text-gray-300"},"ctrl+shift+g")],-1)])]),default:O(()=>[h("div",{ref_key:"toggle",ref:d,class:Oe([{"m-4 mb-0":!v(o)},"inner-shadow relative z-base flex h-8 w-fit cursor-pointer rounded-full bg-gray-600 text-sm font-bold"])},[(g(!0),I(me,null,Ue(r.value,(S,A)=>(g(),I("div",{key:A,role:"tablist",class:"flex-1"},[h("button",{role:"tab",class:Oe(["relative z-elevated h-full px-4 hover:text-gray-200",a.value===A?"text-gray-200":"text-gray-400"]),"aria-selected":a.value===A,onClick:w=>u(A)},M(S),11,NI)]))),128)),h("div",{class:"absolute top-0 h-full justify-start rounded-full bg-gray-500 shadow transition-all duration-500 ease-in-out",style:Na(p.value)},null,4)],2)]),_:1},8,["position"])],2),(g(!0),I(me,null,Ue(r.value,(S,A)=>fo((g(),I("div",{key:A,class:"h-full"},[qa(b.$slots,S)])),[[gs,a.value===A]])),128))],64)}}}),FI={class:"min-h-full"},BI=he({__name:"MarkdownMCQ.client",props:{source:{default:""},type:{}},setup(e){const t=e,n=Ya({allowHtml:!1,useHighlight:!0}),o=ue("viewerMCQ");return Ot(()=>t.source,a=>{sn(()=>{o.value&&(o.value.innerHTML=n.render(a,{}))})},{immediate:!0}),(a,r)=>(g(),I("div",null,[h("div",FI,[h("div",{ref_key:"viewerMCQ",ref:o,class:Oe(["viewer-mcq overflow-auto",t.type==="question"?"question":"answer"])},null,2)])]))}}),co=he({__name:"BlockButtonGiant",props:{autofocus:{type:Boolean,default:!1},ring:{type:Boolean,default:!1},index:{}},emits:["focussed"],setup(e,{expose:t,emit:n}){const o=e,s=K(()=>({"ring-2":o.ring,"ring-offset-2":o.ring,"ring-yellow-600":o.ring,"ring-offset-gray-750":o.ring})),a=n,r=ue("clickButton");Ht(()=>{o.autofocus&&r.value?.focus()});const i=()=>{o.index&&a("focussed",o.index)};return t({focus:()=>{r.value?.focus(),i()}}),(u,c)=>(g(),I("button",{ref_key:"clickButton",ref:r,class:Oe(["relative max-w-sm cursor-pointer break-words border-2 border-gray-400 px-8 py-6 text-center text-lg text-gray-300 hover:border-yellow-500 focus:border-white focus:outline-hidden focus:ring-gray-500 focus:hover:border-yellow-500 disabled:cursor-not-allowed disabled:border-gray-500 disabled:text-gray-500",s.value]),onFocus:i},[qa(u.$slots,"default")],34))}}),ZI=Ja(BI),jI={class:"my-8 w-4/5 max-w-md rounded-sm text-gray-200"},qI={class:"my-4 max-w-xl px-4 text-lg"},JI={class:"mb-4 flex py-4"},VI={key:0},HI={key:1},GI={key:2},WI=he({__name:"CardMultipleChoice",props:{submitCallback:{},viewSolutionFilesCallback:{},explanationCallback:{},question:{},answer:{},answers:{default:()=>[]},isFree:{type:Boolean,default:!1},isLessonComplete:{type:Boolean,default:!1},solutionAlreadyViewed:{type:Boolean,default:!1},lessonUUID:{},containsCompleteDir:{type:Boolean,default:!1}},setup(e,{expose:t}){const n=e,{submissionLoading:o}=ke(it()),{inGuestMode:s}=At(),a=tt(),{isLoggedIn:r}=ke(a),i=W(!1),l=K(()=>n.isFree?"Login for quiz access":"Become a member for quiz access"),u=()=>{if(r.value){Ct("/pricing");return}Ct("/")},c=ue("buttonRefs"),d=ue("buttonContainer"),p=W(0),m=S=>{S>0&&(p.value=S-1,b(p.value))},y=()=>{n.explanationCallback(),i.value=!0},_=S=>{S<n.answers.length-1&&(p.value=S+1,b(p.value))},b=S=>{c.value&&c.value[S]?.focus()},x=S=>{switch(S.key){case"ArrowUp":m(p.value);break;case"ArrowDown":_(p.value);break}};Ht(()=>{window.addEventListener("keydown",x),k()}),ys(()=>{window.removeEventListener("keydown",x)});const k=()=>{d.value?.focus()};return t({focusContainer:k}),(S,A)=>{const w=ZI,D=Oc,E=ct,B=He,R=Pn;return g(),I("div",{ref_key:"buttonContainer",ref:d,class:"flex flex-col items-center focus:outline-hidden",tabindex:"0"},[h("div",jI,[h("p",qI,[U(w,{type:"answer",source:e.question},null,8,["source"])])]),(g(!0),I(me,null,Ue(e.answers,(z,j)=>(g(),F(v(co),{ref_for:!0,ref_key:"buttonRefs",ref:c,key:j,class:"mb-3 w-4/5 max-w-md text-lg disabled:from-gray-650 disabled:to-gray-700",ring:e.isLessonComplete&&e.answer===z,color:"gray",disabled:v(s)||v(o),index:j,onClick:J=>e.submitCallback(z),onFocussed:A[0]||(A[0]=J=>p.value=J)},{default:O(()=>[h("span",null,[U(w,{type:"question",source:z},null,8,["source"])])]),_:2},1032,["ring","disabled","index","onClick"]))),128)),h("div",JI,[e.isLessonComplete&&!i.value?(g(),F(B,{key:0,position:"bottom-gap"},{tip:O(()=>[v(s)&&e.isFree?(g(),I("p",VI,"Login to ask Boots")):v(s)?(g(),I("p",HI,"Become a member to ask Boots")):(g(),I("p",GI,"Ask Boots"))]),default:O(()=>[U(E,{class:"flex max-w-md gap-1 p-8 text-lg",color:"gray",onClick:y},{default:O(()=>[U(D,{"stroke-width":"1.5",class:"h-4 w-4"}),A[1]||(A[1]=h("span",null,"Explain",-1))]),_:1})]),_:1})):L("",!0),e.containsCompleteDir?(g(),F(R,{key:1,class:"ml-4",text:"Solution Files","is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(s)||v(o),"is-free":e.isFree,"solution-type":"Solution Files",color:"gray","tool-tip-position":"top",onClick:e.viewSolutionFilesCallback},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","onClick"])):L("",!0)]),v(s)?(g(),F(v(co),{key:0,class:"m-4 w-4/5 max-w-md",onClick:u},{default:O(()=>[h("span",null,M(l.value),1)]),_:1})):L("",!0)],512)}}}),rl=he({__name:"ToggleSolutionButton",props:{isLessonComplete:{type:Boolean},solutionAlreadyViewed:{type:Boolean},disabled:{type:Boolean},onToggle:{},size:{default:"medium"},isFree:{type:Boolean,default:!1},toolTipPosition:{default:"bottom"},solutionType:{default:void 0},toggleState:{type:Boolean,default:!1},showTextOnMobile:{type:Boolean,default:!1},buttonClass:{}},setup(e){const{numSeerStones:t}=ke(tt()),n=e,o=K(()=>n.toggleState?`Hide ${n.solutionType}`:`Show ${n.solutionType}`),s=K(()=>({"hidden md:inline ":!n.showTextOnMobile,"inline ":n.showTextOnMobile}));return(a,r)=>{const i=Rc,l=ct,u=gc,c=He;return g(),F(c,{position:e.toolTipPosition},{tip:O(()=>[U(u,{"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"seer-stone-available":v(t)>0,"is-free":e.isFree,"solution-type":e.solutionType},null,8,["is-lesson-complete","solution-already-viewed","seer-stone-available","is-free","solution-type"])]),default:O(()=>[U(l,{color:e.toggleState?"outline":"gray",disabled:e.disabled,size:e.size,class:Oe(e.buttonClass),onClick:e.onToggle},{default:O(()=>[U(i,{"stroke-width":"1.5",class:"inline-block h-5 w-5"}),h("span",{class:Oe(["ml-1 mr-1",s.value])},M(o.value),3)]),_:1},8,["color","disabled","size","class","onClick"])]),_:1},8,["position"])}}}),KI={class:"flex flex-col items-center"},YI={class:"my-8 w-4/5 text-gray-200"},QI={class:"mb-8 flex w-4/5 max-w-xl flex-col gap-4 rounded-sm py-8 text-gray-250"},XI={class:"flex justify-center gap-4"},e0={key:0},t0={class:"list-inside list-decimal"},n0={key:0,class:"mb-2"},o0={class:"ml-6 list-inside"},s0={class:"mt-1 overflow-auto px-2 py-1 text-sm"},r0={key:1,class:"mb-2"},a0={class:"ml-6 list-inside"},i0={class:"mt-1 overflow-auto px-2 py-1 text-sm"},u0={key:2,class:"mb-2"},l0={class:"text-lg text-white"},c0={key:0},d0={class:"ml-6 list-inside"},p0={class:"mt-1 overflow-auto px-2 py-1 text-sm"},f0=he({__name:"CardTextInput",props:{currentText:{},submitCallback:{},lessonData:{},isFree:{type:Boolean},cheatCallback:{type:Function,default:void 0},isLessonComplete:{type:Boolean,default:!1},solutionAlreadyViewed:{type:Boolean,default:!1},containsCompleteDir:{type:Boolean,default:!1},sourceUUID:{},sourceType:{},viewSolutionFilesCallback:{}},emits:["update:currentText"],setup(e,{expose:t,emit:n}){const o=e,{attemptCheatWithCallback:s}=Sn(),{isFetchingSolution:a}=ke(Sn()),{inGuestMode:r}=At(),i=tt(),{isLoggedIn:l}=ke(i),u=W(!1),c=W(!1),d=W(!1),p=async()=>{if(!c.value){c.value=!0;try{await s(o.sourceUUID,o.sourceType,m)}finally{c.value=!1}}};un(()=>{d.value=a.value});const m=()=>{u.value=!u.value},{submissionLoading:y}=ke(it()),{lastKeyPress:_}=ke(vs()),b=E=>{E.preventDefault()},x=ue("textInputRef");Ht(()=>{D()});const k=async()=>{await o.submitCallback(o.currentText)},S=K(()=>o.isFree?"Login to submit":"Become a member to submit"),A=()=>{if(l.value){Ct("/pricing");return}Ct("/")};un(()=>{_.value==="lessonSubmit"&&k()});const w=n,D=()=>{x.value?.focusInput()};return t({focusInput:D}),(E,B)=>{const R=_s,z=Wt,j=co,J=rl,le=Pn;return g(),I("div",KI,[U(R,{"is-loading":d.value,"display-text":"Fetching the checks..."},null,8,["is-loading"]),h("div",YI,[U(z,{ref_key:"textInputRef",ref:x,"model-value":e.currentText,placeholder:"text goes here",type:"textarea",required:"",class:"font-mono text-sm","textarea-rows":12,spellcheck:!1,"aria-label":"Lesson answer",disabled:v(r),onKeydown:[Ke(We(b,["meta"]),["s"]),Ke(We(b,["ctrl"]),["s"])],"onUpdate:modelValue":B[0]||(B[0]=oe=>w("update:currentText",oe))},null,8,["model-value","disabled","onKeydown"])]),U(j,{class:"mb-3 w-4/5 max-w-md",ring:e.isLessonComplete,color:"gray",disabled:v(r)||v(y),onClick:k},{default:O(()=>[...B[1]||(B[1]=[h("span",null,"Submit",-1)])]),_:1},8,["ring","disabled"]),v(r)?(g(),F(j,{key:0,class:"m-4 w-4/5 max-w-md",onClick:A},{default:O(()=>[h("span",null,M(S.value),1)]),_:1})):L("",!0),h("div",QI,[h("div",XI,[U(J,{"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(r),"is-free":e.isFree,"solution-type":"Checks","toggle-state":u.value,"button-class":"w-40","show-text-on-mobile":"",onToggle:p},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","toggle-state"]),e.containsCompleteDir?(g(),F(le,{key:0,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(r),text:"Solution Files","solution-type":"Solution Files","is-free":e.isFree,color:"gray","show-text-on-mobile":"",onClick:e.viewSolutionFilesCallback},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","onClick"])):L("",!0)]),u.value?(g(),I("div",e0,[B[6]||(B[6]=h("p",{class:"text-sm italic text-gray-300"}," The following checks run against your input: ",-1)),h("ol",t0,[e.lessonData.TextInputData.ContainsAll?(g(),I("li",n0,[B[2]||(B[2]=h("span",{class:"text-lg text-white"},"Input text must contain:",-1)),h("ol",o0,[(g(!0),I(me,null,Ue(e.lessonData.TextInputData.ContainsAll,(oe,ve)=>(g(),I("li",{key:ve,class:"mb-2"},[h("pre",s0,M(oe),1)]))),128))])])):L("",!0),e.lessonData.TextInputData.ContainsNone?(g(),I("li",r0,[B[3]||(B[3]=h("span",{class:"text-lg text-white"},"Input text must not contain:",-1)),h("ol",a0,[(g(!0),I(me,null,Ue(e.lessonData.TextInputData.ContainsNone,(oe,ve)=>(g(),I("li",{key:ve,class:"mb-2"},[h("pre",i0,M(oe),1)]))),128))])])):L("",!0),e.lessonData.TextInputData.MatchesOne?(g(),I("li",u0,[h("span",l0,[B[4]||(B[4]=te(" Input text must exactly match",-1)),e.lessonData.TextInputData.MatchesOne.length>1?(g(),I("span",c0," one of")):L("",!0),B[5]||(B[5]=te(": ",-1))]),h("ol",d0,[(g(!0),I(me,null,Ue(e.lessonData.TextInputData.MatchesOne,(oe,ve)=>(g(),I("li",{key:ve,class:"mb-2"},[h("pre",p0,M(oe),1)]))),128))])])):L("",!0)])])):L("",!0)])])}}}),m0=["onKeydown"],h0={key:0,class:"mb-12 flex w-4/5 max-w-md flex-col gap-4"},g0={key:0,class:"w-full max-w-md text-sm italic text-gray-400"},y0={key:1,class:"max-w-md pb-5 text-red-500"},v0={class:"mb-8 w-4/5 max-w-md rounded-sm text-gray-250"},_0={class:"ml-4 list-disc"},w0={class:"ml-4 list-disc"},b0=he({__name:"CardGitHubChecks",props:{lessonData:{},submitCallback:{},islessonComplete:{type:Boolean,default:!1},courseUUID:{},solutionAlreadyViewed:{type:Boolean,default:!1},isFree:{type:Boolean,default:!1},containsCompleteDir:{type:Boolean,default:!1},viewSolutionFilesCallback:{}},setup(e,{expose:t}){const{submissionLoading:n}=ke(it()),{lastKeyPress:o}=ke(vs()),s=W(""),{inGuestMode:a}=At(),r=e,{getLastGitHubChecksURL:i}=it();un(()=>{if(!r.courseUUID)return;const R=i(r.courseUUID);R&&(s.value=R)}),un(()=>{o.value==="lessonSubmit"&&_()});const l=()=>{if(d.value?.GithubSynced){_();return}D()},{createToast:u}=Gt(),{isLoggedIn:c,user:d}=ke(tt()),p=K(()=>r.isFree?"Login to submit":"Become a member to submit"),m=()=>{if(c.value){Ct("/pricing");return}Ct("/")},{saveGitHubChecksURL:y}=it(),_=async()=>{s.value.endsWith(".git")&&(s.value=s.value.slice(0,-4)),r.courseUUID&&y(r.courseUUID,s.value),await r.submitCallback(s.value.trim())},b=R=>{R.preventDefault()},x=K(()=>r.lessonData.GitHubChecks.Steps.some(R=>R.StepType!=="user_exists")),k=R=>{switch(R.StepType){case"repo_exists":return"Repository exists and is public";case"user_exists":return"Ensure that your GitHub user exists and is authenticated with Boot.dev";case"submit_repo_for_course":return"Repository exists and is public";case"branch_exists":return`Branch '${R.BranchExistsData.BranchName}' exists`;case"pr_exists":return`PR from '${R.PRExistsData.CompareBranchName}' branch to '${R.PRExistsData.BaseBranchName}' branch exists`;case"workflow_status":return`Latest '${R.WorkflowStatusData.WorkflowName}' workflow run has status '${R.WorkflowStatusData.Status}'`;case"workflow_logs_contains":return`Latest '${R.WorkflowLogsContainsData.WorkflowName}' workflow run contains:`;case"file_contains":return`${R.FileContainsData.FilePath} contains:`;default:return R}},S=R=>R.StepType==="workflow_logs_contains"?Object.keys(R.WorkflowLogsContainsData.Jobs??{}).flatMap(z=>R.WorkflowLogsContainsData.Jobs[z].map(j=>`'${z}' job: ${j}`)):R.StepType==="file_contains"?R.FileContainsData.ContainsAll:null,{setModalQuery:A}=ho(),w=()=>{A("settings")},D=()=>{u({type:"error",text:"Sync your github account in Settings to submit your repo"})},E=ue("textInputRef");return t({focusInput:()=>{E.value?.focusInput()}}),(R,z)=>{const j=_s,J=Wt,le=mo,oe=co,ve=Pn;return g(),I("div",{class:"flex flex-col items-center sm:pt-12 p-8",onKeydown:[Ke(We(b,["meta"]),["s"]),Ke(We(b,["ctrl"]),["s"])]},[U(j,{"is-loading":v(n)},null,8,["is-loading"]),x.value?(g(),I("div",h0,[z[1]||(z[1]=h("p",{class:"my-4 mb-8 max-w-xl rounded-sm px-4 text-lg text-gray-200"}," Paste the link to your public GitHub repo: ",-1)),U(J,{ref_key:"textInputRef",ref:E,modelValue:s.value,"onUpdate:modelValue":z[0]||(z[0]=Ae=>s.value=Ae),placeholder:"https://github.com/example/repo","aria-label":"Github Repo URL",required:"",autofocus:""},null,8,["modelValue"]),e.lessonData.GitHubChecks.ShowcaseRepo?(g(),I("p",g0," This repository will be displayed on your profile page! ")):L("",!0)])):L("",!0),!v(a)&&!v(d)?.GithubSynced?(g(),I("div",y0,[z[3]||(z[3]=te(" You'll need to sync your GitHub account in your ",-1)),U(le,{class:"textlink",tabindex:"0",onClick:w,onKeydown:[Ke(We(w,["prevent"]),["space"]),Ke(We(w,["prevent"]),["enter"])]},{default:O(()=>[...z[2]||(z[2]=[h("span",null,"settings",-1)])]),_:1},8,["onKeydown"]),z[4]||(z[4]=te(" to complete this lesson. ",-1))])):L("",!0),U(oe,{autofocus:"",class:"mb-8 w-4/5 max-w-md text-lg",ring:e.islessonComplete,disabled:v(a)||v(n)||!s.value&&x.value,onClick:l},{default:O(()=>[...z[5]||(z[5]=[h("span",null,"Submit All Checks",-1)])]),_:1},8,["ring","disabled"]),v(a)?(g(),F(oe,{key:2,class:"m-4 w-4/5 max-w-md text-lg",onClick:m},{default:O(()=>[h("span",null,M(p.value),1)]),_:1})):L("",!0),z[6]||(z[6]=h("p",{class:"w-4/5 max-w-md text-sm italic text-gray-500"}," Checks that will be submitted: ",-1)),h("div",v0,[h("ol",_0,[(g(!0),I(me,null,Ue(e.lessonData.GitHubChecks.Steps,(Ae,ie)=>(g(),I("li",{key:ie},[te(M(k(Ae))+" ",1),h("ul",w0,[(g(!0),I(me,null,Ue(S(Ae),(X,Be)=>(g(),I("li",{key:Be},M(X),1))),128))])]))),128))])]),e.containsCompleteDir?(g(),F(ve,{key:3,text:"Solution Files","is-lesson-complete":e.islessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(a),"is-free":e.isFree,color:"gray",onClick:e.viewSolutionFilesCallback},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","onClick"])):L("",!0)],40,m0)}}}),k0=he({__name:"MarkdownJSON.client",props:{source:{}},setup(e){const t=e,n=i=>"```json\n"+JSON.stringify(i,null,2)+"\n```",o=K(()=>n(t.source)),s=Ya({allowHtml:!0,useHighlight:!0}),a=ue("viewer"),r=i=>{sn(()=>{ur(),a.value&&(a.value.innerHTML=s.render(i)),Uc()})};return Ot(()=>o.value,r,{immediate:!0}),Ht(()=>r(o.value)),po(()=>{ur()}),(i,l)=>(g(),I("div",{ref_key:"viewer",ref:a,class:"viewer-json"},null,512))}}),I0=Ja(k0),x0=["onKeydown"],S0={class:"flex h-full w-full flex-col items-center overflow-y-auto overflow-x-hidden"},T0={class:"px-4"},C0={key:0,class:"mb-4 text-red-400 sm:mt-8"},A0={class:"mb-2 flex w-4/5 justify-between rounded-sm border border-gray-500 bg-gray-950 p-4 text-gray-200"},D0={class:"max-w-3xl font-mono"},$0={class:"mb-4 flex w-4/5 justify-between rounded-sm border border-gray-500 bg-gray-950 p-4 text-gray-200"},E0={class:"max-w-3xl font-mono"},U0={key:0,class:"mb-4 flex w-4/5 max-w-md list-disc flex-col justify-center text-sm text-gray-400 sm:justify-normal"},O0={key:0},R0={key:1},P0={key:2},M0={class:"mb-4 w-4/5 max-w-md"},L0={key:1,class:"text-sm"},N0={key:1,class:"mb-8 w-4/5 max-w-md rounded-sm"},z0={class:"list-inside list-decimal"},F0={class:"rounded-sm bg-gray-650 px-2 py-0.5 font-mono font-bold"},B0={key:0,class:"text-sm italic text-gray-300"},Z0={class:"ml-4 list-inside list-disc"},j0={key:0},q0={class:"rounded-sm bg-gray-700 px-2 py-0.5 font-mono"},J0={key:1},V0={class:"ml-4 list-inside list-disc"},H0={class:"rounded-sm bg-gray-700 px-1 font-mono"},G0={key:2},W0={class:"ml-4 list-inside list-disc"},K0={class:"rounded-sm bg-gray-700 px-1 font-mono"},Y0={key:3},Q0={class:"font-mono font-bold"},X0={key:4},ex={class:"rounded-sm bg-gray-700 px-1 py-0.5 font-mono"},tx={class:"ml-4 list-inside list-disc"},nx={class:"rounded-sm bg-gray-700 px-1 py-0.5 font-mono"},ox={key:0},sx={key:1},rx={class:"font-bold"},ax={key:0,class:"ml-4 italic"},ix={class:"mb-3"},ux={key:0},lx={class:"mb-3 list-disc marker:text-sm"},cx={key:1},dx={class:"ml-4 pb-2 text-sm text-white"},px={key:0,class:"inline"},fx={key:1,class:"inline"},mx={class:"rounded-sm bg-gray-700 px-2 py-0.5"},hx={key:2,class:"inline"},gx={class:"rounded-sm bg-gray-700 px-2 py-0.5"},yx={key:3,class:"inline"},vx={key:4,class:"inline"},_x={key:5,class:"inline"},wx={class:"inline bg-gray-700 p-1"},bx={class:"inline bg-gray-700 p-1"},kx={class:"ml-4 list-inside list-disc pb-2 text-sm italic text-white"},Ix={class:"inline bg-gray-700 p-1"},xx={class:"inline bg-gray-700 p-1"},Sx={key:2,class:"mb-2 max-w-sm text-center text-sm italic text-gray-400"},Tx=he({__name:"CardCLI",props:{lessonData:{},isLessonComplete:{type:Boolean,default:!1},solutionAlreadyViewed:{type:Boolean,default:!1},lessonUUID:{},isFree:{type:Boolean,default:!1},containsCompleteDir:{type:Boolean,default:!1},viewSolutionFilesCallback:{}},setup(e){const{isLoggedIn:t}=ke(tt()),{inGuestMode:n}=At(),{submissionEvent:o}=ke(it()),s=e,a=m=>{m.preventDefault()},r=K(()=>n.value&&!s.isFree),i=K(()=>s.isFree?"Login to submit":"Become a Member "),l=()=>{if(t.value){Ct("/pricing");return}Ct("/")},u=m=>m.includes(ar)?m.replace(ar,""):m,c=K(()=>s.lessonData.CLIData.BaseURLDefault===cc),d=K(()=>{const m=s.lessonData.CLIData.BaseURLDefault;if(m)return c.value?"No default Base URL":`Default Base URL: ${m}`}),p=m=>{switch(m){case"gt":return"to be greater than";case"eq":return"to be equal to";case"contains":return"to contain";case"not_contains":return"to not contain";default:return"UNKNOWN"}};return(m,y)=>{const _=Pc,b=I0,x=ct,k=Pn;return g(),I("div",{onKeydown:[Ke(We(a,["meta"]),["s"]),Ke(We(a,["ctrl"]),["s"])]},[h("div",S0,[h("div",T0,[v(t)?L("",!0):(g(),I("p",C0," The Boot.dev CLI requires you to be signed in to submit your solution! ")),y[0]||(y[0]=h("p",{class:"mb-4 mt-8"}," Copy/paste one of the following commands into your terminal: ",-1))]),y[25]||(y[25]=h("div",{class:"flex w-4/5"},[h("p",{class:"text-sm font-bold"},"Run")],-1)),h("div",A0,[h("p",D0,"bootdev run "+M(e.lessonUUID),1),U(_,{content:`bootdev run ${e.lessonUUID}`},null,8,["content"])]),y[26]||(y[26]=h("div",{class:"flex w-4/5"},[h("p",{class:"text-sm font-bold"},"Submit")],-1)),h("div",$0,[h("p",E0,"bootdev run "+M(e.lessonUUID)+" -s",1),U(_,{content:`bootdev run ${e.lessonUUID} -s`},null,8,["content"])]),r.value?L("",!0):(g(),I("ul",U0,[d.value?(g(),I("li",O0,M(d.value),1)):L("",!0),c.value?(g(),I("li",R0,[...y[1]||(y[1]=[te(" Set a Base URL with ",-1),h("code",{class:"rounded-sm bg-gray-600 p-[1px_4px] text-gray-200"},"bootdev config base_url <url>",-1)])])):d.value?(g(),I("li",P0,[...y[2]||(y[2]=[te(" Optionally configure your CLI to override the default base URL by running ",-1),h("code",{class:"rounded-sm bg-gray-600 p-[1px_4px] text-gray-200"},"bootdev config base_url <url>",-1)])])):L("",!0)])),h("div",M0,[v(o)?(g(),I("p",{key:0,class:Oe(["text-sm",{"text-red-400":v(o).ResultSlug==="failure"||v(o).ResultSlug==="system-error","text-green-400":v(o).ResultSlug==="success"}])}," Check the output of your CLI command to see a results breakdown. ",2)):r.value?L("",!0):(g(),I("p",L0," Run the CLI commands to test your solution. "))]),r.value?L("",!0):(g(),I("div",N0,[h("ol",z0,[(g(!0),I(me,null,Ue(e.lessonData.CLIData.Steps,(S,A)=>(g(),I("li",{key:A,class:"mb-2"},[S.CLICommand?(g(),I(me,{key:0},[h("span",F0,M(S.CLICommand.Command),1),S.CLICommand.Command.includes("${")?(g(),I("span",B0,[...y[3]||(y[3]=[h("br",null,null,-1),te(" ${key} is a variable that is automatically parsed and interpolated ",-1),h("br",null,null,-1)])])):L("",!0),h("ul",Z0,[(g(!0),I(me,null,Ue(S.CLICommand.Tests,(w,D)=>(g(),I("li",{key:D,class:"my-1"},[w?.ExitCode!==void 0?(g(),I("span",j0,[y[4]||(y[4]=h("span",null,"Expecting exit code: ",-1)),h("span",q0,M(w.ExitCode),1)])):w?.StdoutContainsAll?(g(),I("span",J0,[y[5]||(y[5]=h("span",null,"Expecting stdout to contain all of:",-1)),h("ul",V0,[(g(!0),I(me,null,Ue(w?.StdoutContainsAll,(E,B)=>(g(),I("li",{key:B},[h("span",H0,M(E),1)]))),128))])])):w?.StdoutContainsNone?(g(),I("span",G0,[y[6]||(y[6]=h("span",null,"Expecting stdout to contain none of:",-1)),h("ul",W0,[(g(!0),I(me,null,Ue(w?.StdoutContainsNone,(E,B)=>(g(),I("li",{key:B},[h("span",K0,M(E),1)]))),128))])])):w?.StdoutLinesGt!==void 0?(g(),I("span",Y0,[h("span",null,[y[7]||(y[7]=te(" Expecting to have more than ",-1)),h("span",Q0,M(w?.StdoutLinesGt),1),y[8]||(y[8]=te(" lines ",-1))])])):w?.StdoutJq?(g(),I("span",X0,[h("span",null,[y[9]||(y[9]=te(" Expecting ",-1)),y[10]||(y[10]=h("span",{class:"rounded-sm bg-gray-700 px-1 py-0.5 font-mono"},"jq",-1)),y[11]||(y[11]=te(" query ",-1)),h("span",ex,M(w.StdoutJq.Query),1),y[12]||(y[12]=te(" to yield values satisfying: ",-1))]),h("ul",tx,[(g(!0),I(me,null,Ue(w.StdoutJq.ExpectedResults,(E,B)=>(g(),I("li",{key:B},[h("span",nx,[te(M(E.Type)+" "+M(E.Operator)+" ",1),E.Type==="string"?(g(),I("span",ox,' "'+M(E.Value)+'" ',1)):(g(),I("span",sx,M(E.Value),1))])]))),128))])])):L("",!0)]))),128))])],64)):L("",!0),S.HTTPRequest?(g(),I(me,{key:1},[h("span",rx,M(S.HTTPRequest.Request.Method)+" "+M(u(S.HTTPRequest.Request.FullURL)),1),S.HTTPRequest.Request.BasicAuth?(g(),I("p",ax," basic authentication = "+M(S.HTTPRequest.Request.BasicAuth.Username)+":"+M(S.HTTPRequest.Request.BasicAuth.Password),1)):L("",!0),h("div",ix,[S.HTTPRequest.Request.Headers?(g(),I("div",ux,[y[13]||(y[13]=h("span",{class:"ml-5 text-xs font-bold"},"Headers:",-1)),h("ul",lx,[h("li",null,[(g(!0),I(me,null,Ue(S.HTTPRequest.Request.Headers,(w,D)=>(g(),I("code",{key:D},M(D)+": "+M(w),1))),128))])])])):L("",!0),S.HTTPRequest.Request.BodyJSON?(g(),I("div",cx,[y[14]||(y[14]=h("span",{class:"ml-5 text-xs font-bold"},"Request Body:",-1)),U(b,{source:S.HTTPRequest.Request.BodyJSON},null,8,["source"])])):L("",!0)]),h("ul",dx,[(g(!0),I(me,null,Ue(S.HTTPRequest.Tests,(w,D)=>(g(),I("li",{key:D,class:"my-1"},[te(M(D+1)+". ",1),w?.StatusCode?(g(),I("div",px,[te(" Expecting status code: "+M(w.StatusCode)+" ",1),y[15]||(y[15]=h("br",null,null,-1))])):w?.BodyContains?(g(),I("div",fx,[y[16]||(y[16]=te(" Expecting body to contain: ",-1)),h("span",mx,M(w.BodyContains),1),y[17]||(y[17]=h("br",null,null,-1))])):w?.BodyContainsNone?(g(),I("div",hx,[y[18]||(y[18]=te(" Expecting body to not contain: ",-1)),h("span",gx,M(w.BodyContainsNone),1),y[19]||(y[19]=h("br",null,null,-1))])):w?.HeadersContain?(g(),I("div",yx,[te(' Expecting "'+M(w.HeadersContain.Key)+'" header to contain "'+M(w.HeadersContain.Value)+'" ',1),y[20]||(y[20]=h("br",null,null,-1))])):w?.TrailersContain?(g(),I("div",vx,[te(' Expecting "'+M(w.TrailersContain.Key)+'" trailer to contain "'+M(w.TrailersContain.Value)+'" ',1),y[21]||(y[21]=h("br",null,null,-1))])):w?.JSONValue?(g(),I("div",_x,[y[22]||(y[22]=te(" Expecting JSON at ",-1)),h("pre",wx,M(w.JSONValue.Path),1),te(" "+M(p(w.JSONValue.Operator))+" ",1),h("pre",bx,M(w.JSONValue.BoolValue!==void 0?w.JSONValue.BoolValue:w.JSONValue.StringValue!==void 0?w.JSONValue.StringValue:w.JSONValue.IntValue!==void 0?w.JSONValue.IntValue:"UNKNOWN"),1)])):L("",!0)]))),128))]),h("ul",kx,[(g(!0),I(me,null,Ue(S.HTTPRequest.ResponseVariables,(w,D)=>(g(),I("li",{key:D,class:"my-1 text-gray-300"},[y[23]||(y[23]=te(" Parsing ",-1)),h("pre",Ix,M(w.Name),1),y[24]||(y[24]=te(" variable from response body ",-1)),h("pre",xx,M(w.Path),1)]))),128))])],64)):L("",!0)]))),128))])])),r.value?(g(),I("p",Sx," To run and submit the tests for this lesson, you must have an active Boot.dev membership ")):L("",!0),v(n)?(g(),F(x,{key:3,class:"mb-4 min-h-12 w-4/5 max-w-md px-8 text-lg",onClick:l},{default:O(()=>[h("span",null,M(i.value),1)]),_:1})):L("",!0),e.containsCompleteDir?(g(),F(k,{key:4,text:"Solution Files","is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(n),"is-free":e.isFree,color:"gray",onClick:e.viewSolutionFilesCallback},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","onClick"])):L("",!0),y[27]||(y[27]=h("div",{class:"mb-8 mt-12 flex max-w-xl flex-col gap-2 p-2 text-xs italic text-gray-400"},[h("p",{class:"text-sm font-bold"},"Using the Bootdev CLI"),h("p",null," The Bootdev CLI is the only way to submit your solution for this type of lesson. We need to be able to run commands in your environment to verify your solution. "),h("p",null,[te(" You can "),h("a",{class:"textlink",href:"https://github.com/bootdotdev/bootdev",target:"_blank"},"install it here"),te(". It's a Go program hosted on GitHub, so you'll need Go installed as well. Instructions are on the GitHub page. ")])],-1))])],40,x0)}}}),Cx={id:"interview-side"},Ax={class:"vl-parent flex flex-col gap-5 px-4 pt-2"},Dx={class:"flex-col gap-2"},$x={key:0,class:"flex flex-col gap-1"},Ex={key:1,class:"flex items-center justify-center rounded-2xl"},Ux={class:"mb-4 flex items-start justify-between"},Ox={key:2,class:"mb-4 rounded-sm border border-gray-500 p-4"},Rx={class:"mb-1 text-sm text-gray-300 whitespace-pre-line"},Pa=":::",Px=he({__name:"CardInterviewChat",props:{currentText:{default:""},lessonData:{},isLessonComplete:{type:Boolean,default:!1},solutionAlreadyViewed:{type:Boolean,default:!1},sourceUUID:{},sourceType:{},isFree:{type:Boolean,default:!1},initialInterviewChat:{default:void 0},readOnly:{type:Boolean,default:!1}},emits:["update:currentText"],setup(e,{expose:t,emit:n}){const o=e,s=`https://storage.googleapis.com/qvault-webapp-dynamic-assets/course_assets/interview_question_audio/${o.sourceUUID}.mp3`,a=tt(),{user:r}=ke(a),{inGuestMode:i}=At(),{attemptCheatWithCallback:l}=Sn(),{isFetchingSolution:u}=ke(Sn()),c=K({get:()=>o.currentText||"",set:Z=>Be("update:currentText",Z)}),d=W(),p=W(""),m=W(!1),y=K(()=>o.lessonData.AcceptanceCriteria||""),_=W(!1),b=K(()=>_.value&&!!y.value),x=K(()=>`/u/${r.value?.Handle}`),{setModalQuery:k}=ho(),S=()=>{k("info-boots-interview")},A=K(()=>r.value?.ProfileImageURL?r.value.ProfileImageURL:ja),w=W(""),D=W("");let E="";const B=Z=>{if(!Z){R();return}E+=Z;const ee=E.split(Pa);ee[0]&&(w.value=ee[0]),ee[2]&&(D.value=ee[2])};function R(){if(E){const Z=E.split(Pa);Z[0]&&(w.value+=Z[0]),Z[2]&&(D.value=Z[2]),E=""}}const z=async Z=>{if(Z.shiftKey||!c.value.trim()||m.value||o.isLessonComplete)return;const ee=c.value;p.value=ee,c.value="",m.value=!0,w.value="",D.value="",E="";try{await dc(o.sourceType,o.sourceUUID,ee,De=>{De===null?(d.value||(d.value={status:"in_progress",conversation:{version:"",messages:[]}}),d.value.conversation.messages.push({UUID:"",Role:"user",Content:p.value}),d.value.conversation.messages.push({UUID:D.value,Role:"assistant",Content:w.value}),p.value="",w.value="",D.value="",m.value=!1,Ae()):B(De)})}catch{p.value="",w.value="",D.value="",m.value=!1}},j=W(!1),J=async()=>{if(!j.value){j.value=!0;try{await l(o.sourceUUID,o.sourceType,le)}finally{j.value=!1}}},le=()=>{_.value=!_.value},oe=K(()=>o.lessonData.StudentPrompt),ve=ue("interviewInputElement"),Ae=()=>{const Z=document.getElementById("interview-side");Z&&(Z.scrollIntoView({behavior:"instant",block:"end"}),requestAnimationFrame(()=>{Z.scrollTop=Z.scrollHeight}),ve.value?.focusInput&&ve.value?.focusInput())},ie=()=>{d.value=void 0,c.value="",_.value=!1},X=K(()=>o.isLessonComplete||(o.initialInterviewChat?.messages?.some(Z=>Z.Metadata?.EvaluationResult==="success")??!1));Ot(()=>o.initialInterviewChat?.messages?.length??0,(Z,ee)=>{(ee===void 0&&Z>0||ee===0&&Z>0)&&(d.value={status:"in_progress",conversation:o.initialInterviewChat??{version:"",messages:[]}})},{immediate:!0});const Be=n;return t({focusInput:Ae,reset:ie}),(Z,ee)=>{const De=_s,be=ks,ce=Wt,Qe=rl;return g(),I("div",Cx,[U(De,{"is-loading":v(u),"display-text":"Getting the acceptance criteria..."},null,8,["is-loading"]),h("div",Ax,[ee[4]||(ee[4]=h("h2",{class:"text-2xl"},"Interview with Boots",-1)),h("div",Dx,[U(be,{img:v(No),content:oe.value,"img-click":S,"audio-u-r-l":s,"audio-enabled":""},null,8,["img","content"]),(g(!0),I(me,null,Ue(d.value?.conversation?.messages||[],(Pe,wt)=>(g(),I(me,{key:wt},[Pe.Role==="assistant"?(g(),F(be,{key:0,content:Pe.Content,img:v(No),"img-click":S,"source-u-u-i-d":e.sourceUUID,"message-u-u-i-d":Pe.UUID,"audio-type":"interview_message","audio-enabled":""},null,8,["content","img","source-u-u-i-d","message-u-u-i-d"])):Pe.Role==="user"?(g(),F(be,{key:1,content:Pe.Content,img:A.value,"img-link":x.value,"source-u-u-i-d":e.sourceUUID,"message-u-u-i-d":Pe.UUID,"audio-type":"interview_message"},null,8,["content","img","img-link","source-u-u-i-d","message-u-u-i-d"])):L("",!0)],64))),128)),p.value?(g(),F(be,{key:0,content:p.value,img:A.value,"img-link":x.value},null,8,["content","img","img-link"])):L("",!0),m.value?(g(),F(be,{key:1,"is-streaming":"",img:v(No),content:w.value,"img-click":S},null,8,["img","content"])):L("",!0)]),X.value?(g(),I("div",Ex,[...ee[2]||(ee[2]=[h("div",{class:"px-4 text-center text-sm text-gray-300"},[h("h2",{class:"text-xl"},"Lesson Complete!"),h("div",null," You've successfully addressed all the points Boots wanted to hear. ")],-1)])])):(g(),I("div",$x,[ee[1]||(ee[1]=h("p",{class:"ml-4 text-sm italic text-gray-400"}," Keep chatting until Boots is satisfied with your response ",-1)),U(ce,{ref_key:"interviewInputElement",ref:ve,modelValue:c.value,"onUpdate:modelValue":ee[0]||(ee[0]=Pe=>c.value=Pe),autofocus:"",tabindex:"0",class:"min-h-24 max-h-96 w-full overflow-y-auto field-sizing-content",type:"textarea","textarea-rows":3,placeholder:e.isLessonComplete?"":"Write your answer and press `Enter` to submit...","aria-label":"Respond to prompt","enable-auto-resize":"",disabled:m.value||e.isLessonComplete||v(i)||e.readOnly,onKeydown:Ke(v(Ga),["enter"]),onKeyup:Ke(z,["enter"])},null,8,["modelValue","placeholder","disabled","onKeydown"])])),h("div",Ux,[U(Qe,{"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,disabled:v(i)||e.readOnly,"is-free":e.isFree,"solution-type":"Solution","toggle-state":b.value,"button-class":"w-40","show-text-on-mobile":"",onToggle:J},null,8,["is-lesson-complete","solution-already-viewed","disabled","is-free","toggle-state"])]),b.value?(g(),I("div",Ox,[ee[3]||(ee[3]=h("p",{class:"mb-2 text-sm italic text-gray-300"}," Boots is expecting you to satisfy the acceptance criteria: ",-1)),h("pre",Rx,M(y.value),1)])):L("",!0)])])}}}),Mx={id:"lesson-container",class:"h-full overflow-auto"},Lx={class:"h-full w-full"},Nx={key:0,class:"h-full"},zx={id:"markdown-side",class:"z-base flex w-1/2 flex-col overflow-auto border-r border-gray-500"},Fx={key:1,class:"items-center lg:flex lg:flex-col"},Bx={class:"h-full w-full lg:max-w-4xl"},Zx={key:2,id:"markdown-side",class:"flex justify-center"},jx={class:"z-elevated h-full w-full lg:max-w-4xl"},qx={class:"flex h-full overflow-hidden"},Jx={class:"h-full w-full overflow-auto border-r border-gray-500 md:w-1/2"},Vx={key:0,class:"top-nav-bar-height z-elevated h-full flex md:hidden border-t border-gray-600 border-b bg-image-blue"},Hx={class:"hidden md:flex md:flex-col"},Gx={class:"hidden flex-1 items-center justify-center md:flex"},Ma=!1,Wx=he({__name:"LessonOrChallenge",props:{sourceType:{},source:{},courseUUID:{},hintAlreadyViewed:{type:Boolean},submitCallback:{},isFree:{type:Boolean,default:!1},currentFiles:{default:()=>[]},currentTextInput:{default:""},isLessonComplete:{type:Boolean,default:!1},containsCompleteDir:{type:Boolean,default:!1},solutionAlreadyViewed:{type:Boolean,default:!1},resetCodeCallback:{type:Function,default:void 0},resetLessonCallback:{type:Function,default:void 0},initialInterviewChat:{default:void 0},readOnly:{type:Boolean,default:!1},isLoadingUserData:{type:Boolean,default:!1},seriesIndex:{default:0},seriesLength:{default:0}},emits:["update:currentFiles","update:currentText"],setup(e,{emit:t}){const n=e,o=tt(),{isLoggedIn:s}=ke(o),{isMobile:a}=go(),{viewSolutionFiles:r}=Sn(),i=K(()=>n.sourceType==="lesson"&&n.source.GenerateChallenge||!1),l=async(Z,ee)=>{if(n.sourceType==="lesson"){const De=n.source;await n.submitCallback({input:Z,files:ee,codeLastModAt:De.CodeLastMod})}else await n.submitCallback({input:Z,files:ee})},u=async Z=>{await n.submitCallback({input:Z})},c=async(Z,ee,De)=>{if(n.sourceType==="lesson"){const be=n.source;await n.submitCallback({files:De,headings:Z,rows:ee,codeLastModAt:be.CodeLastMod})}else await n.submitCallback({files:De,headings:Z,rows:ee})},d=async()=>{await n.submitCallback({})},p=t,m=ue("tabPanesRef"),y=ue("bootsChatRef"),_=ue("spellbookRef"),b=ue("lessonsRef"),x=ue("interviewChatRef"),k=ue("textInputRef"),S=ue("codeEditorRef"),A=ue("gitHubChecksRef"),w=ue("multipleChoiceRef"),D={Code:()=>S.value?.focusInput?.(),Boots:()=>y.value?.focusInput?.(),Input:()=>k.value?.focusInput?.(),Checks:()=>A.value?.focusInput?.(),Interview:()=>x.value?.focusInput?.(),Question:()=>w.value?.focusContainer?.(),Spellbook:()=>_.value?.focusInput?.(),Lessons:()=>b.value?.focusInput?.()},E={Boots:()=>y.value?.isFocused?.(),Spellbook:()=>_.value?.isFocused?.(),Lessons:()=>b.value?.isFocused?.()},B=()=>{m.value?.selectTabByName?.("Boots"),y.value?.explainMultipleChoiceCallback?.()},R=()=>{n.resetLessonCallback?.(),x.value?.reset(),y.value?.newChat(!1)},{currentFiles:z,currentTextInput:j}=Ba(n),J=async()=>{await r(n.source.UUID,n.sourceType)},le=K(()=>z.value?mc(z.value):""),oe=K(()=>ve(n.source));function ve(Z){if(Ut(Z))return Z.LessonDataCodeTests.ProgLang;if(ft(Z))return Z.LessonDataCodeOutput.ProgLang;if(Et(Z))return Z.LessonDataCodeSQL.ProgLang}const Ae=K(()=>ie(n.source));function ie(Z){return Va(Z)?Ut(Z)?Z.LessonDataCodeTests.SolutionFiles||[]:ft(Z)?Z.LessonDataCodeOutput.SolutionFiles||[]:Et(Z)?Z.LessonDataCodeSQL.SolutionFiles||[]:Z:void 0}const X=K(()=>Be(n.source));function Be(Z){return wn(Z)?Z.LessonDataCLI.Readme:Xt(Z)?Z.LessonDataManual.Readme:_n(Z)?Z.LessonDataTextInput.Readme:Ut(Z)?Z.LessonDataCodeTests.Readme:Gn(Z)?Z.LessonDataGitHubChecks.Readme:vn(Z)?Z.LessonDataMultipleChoice.Readme:ft(Z)?Z.LessonDataCodeOutput.Readme:Et(Z)?Z.LessonDataCodeSQL.Readme:Fn(Z)?Z.LessonDataInterviewChat.Readme:Z}return(Z,ee)=>{const De=Yd,be=Tk,ce=lI,Qe=LI,Pe=zI,wt=vc,q=bs,G=_c,xe=WI,ge=f0,Ee=b0,Ze=Tx,st=Px,fe=yc,bt=fc;return g(),I("div",Mx,[U(bt,null,{default:O(()=>[h("div",Lx,[!v(a)&&!v(Xt)(e.source)?(g(),I("div",Nx,[U(fe,{layout:"horizontal",class:"h-full flex-1 overflow-y-auto"},{default:O(()=>[h("div",zx,[U(De,{readme:X.value,"reset-callback":R,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID,"source-type":e.sourceType,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"read-only":e.readOnly,"user-code":v(j)||le.value,"prog-lang":oe.value,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J,"series-index":e.seriesIndex,"series-length":e.seriesLength,topics:e.source.Topics,"generate-challenge":i.value},null,8,["readme","source-u-u-i-d","course-u-u-i-d","source-type","is-lesson-complete","solution-already-viewed","is-free","read-only","user-code","prog-lang","contains-complete-dir","series-index","series-length","topics","generate-challenge"]),v(s)?(g(),F(Pe,{key:0,ref_key:"tabPanesRef",ref:m,"focus-callbacks":D,"is-focused-callbacks":E},{Boots:O(()=>[U(be,{ref_key:"bootsChatRef",ref:y,class:"mt-sm","source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"lesson-complete":e.isLessonComplete,"hint-already-viewed":e.hintAlreadyViewed,"current-files":v(z),"prog-lang":oe.value,"editor-output":S.value?.output,"read-only":e.readOnly},null,8,["source-u-u-i-d","source-type","lesson-complete","hint-already-viewed","current-files","prog-lang","editor-output","read-only"])]),Spellbook:O(()=>[U(ce,{ref_key:"spellbookRef",ref:_,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID,class:"mt-sm"},null,8,["source-type","source-u-u-i-d","course-u-u-i-d"])]),Lessons:O(()=>[U(Qe,{ref_key:"lessonsRef",ref:b,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,class:"mt-sm"},null,8,["source-type","source-u-u-i-d"])]),_:1},512)):L("",!0)]),U(wt,{id:"card-resizer",layout:"horizontal",class:"z-sticky"}),n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%",class:"flex-1"})):v(ft)(e.source)||v(Et)(e.source)||v(Ut)(e.source)?(g(),F(G,{key:1,ref_key:"codeEditorRef",ref:S,class:"flex flex-1 flex-col overflow-auto","current-files":v(z),solutionfiles:Ae.value,"submit-callback":l,"prog-lang":oe.value,"source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"read-only":e.readOnly,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"reset-callback":e.resetCodeCallback,"expected-output":v(ft)(e.source)?e.source.LessonDataCodeOutput.CodeExpectedOutput:void 0,"submit-type-code-s-q-l-callback":c,"enable-lsp":Ma,"onUpdate:currentFiles":ee[0]||(ee[0]=Ne=>p("update:currentFiles",Ne))},null,8,["current-files","solutionfiles","prog-lang","source-u-u-i-d","source-type","read-only","is-lesson-complete","solution-already-viewed","is-free","reset-callback","expected-output"])):v(vn)(e.source)?(g(),F(xe,{key:2,ref_key:"multipleChoiceRef",ref:w,class:"flex flex-1 flex-col overflow-auto","submit-callback":u,"solution-already-viewed":e.solutionAlreadyViewed,question:e.source.LessonDataMultipleChoice.Question.Question,answer:e.source.LessonDataMultipleChoice.Question.Answer,answers:e.source.LessonDataMultipleChoice.Question.Answers,"is-lesson-complete":e.isLessonComplete,"is-free":e.isFree,"explanation-callback":B,"lesson-u-u-i-d":e.source.UUID,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J},null,8,["solution-already-viewed","question","answer","answers","is-lesson-complete","is-free","lesson-u-u-i-d","contains-complete-dir"])):v(_n)(e.source)?(g(),F(ge,{key:3,ref_key:"textInputRef",ref:k,"current-text":v(j),class:"flex flex-1 flex-col overflow-auto","submit-callback":u,"lesson-data":e.source.LessonDataTextInput,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J,"onUpdate:currentText":ee[1]||(ee[1]=Ne=>p("update:currentText",Ne))},null,8,["current-text","lesson-data","is-lesson-complete","solution-already-viewed","is-free","source-type","source-u-u-i-d","contains-complete-dir"])):v(Gn)(e.source)?(g(),F(Ee,{key:4,ref_key:"gitHubChecksRef",ref:A,class:"flex flex-1 flex-col overflow-auto","submit-callback":u,"lesson-data":e.source.LessonDataGitHubChecks,"is-lesson-complete":e.isLessonComplete,"course-u-u-i-d":e.courseUUID,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J},null,8,["lesson-data","is-lesson-complete","course-u-u-i-d","solution-already-viewed","is-free","contains-complete-dir"])):v(wn)(e.source)?(g(),F(Ze,{key:5,class:"flex flex-1 flex-col overflow-auto","lesson-data":e.source.LessonDataCLI,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"lesson-u-u-i-d":e.source.UUID,"is-free":e.isFree,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J},null,8,["lesson-data","is-lesson-complete","solution-already-viewed","lesson-u-u-i-d","is-free","contains-complete-dir"])):v(Fn)(e.source)?(g(),F(st,{key:6,ref_key:"interviewChatRef",ref:x,class:"flex flex-1 flex-col overflow-auto","current-text":v(j),"source-type":e.sourceType,"lesson-data":e.source.LessonDataInterviewChat,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"source-u-u-i-d":e.source.UUID,"is-free":e.isFree,"read-only":e.readOnly,"initial-interview-chat":e.initialInterviewChat,"onUpdate:currentText":ee[2]||(ee[2]=Ne=>p("update:currentText",Ne))},null,8,["current-text","source-type","lesson-data","is-lesson-complete","solution-already-viewed","source-u-u-i-d","is-free","read-only","initial-interview-chat"])):L("",!0)]),_:1})])):!v(a)&&v(Xt)(e.source)?(g(),I("div",Fx,[h("div",Bx,[U(De,{readme:X.value,"submit-callback":d,"reset-callback":R,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID,"source-type":e.sourceType,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"user-code":v(j)||le.value,"prog-lang":oe.value,"read-only":e.readOnly,"is-lesson-complete":e.isLessonComplete,"is-manual-lesson-type":v(Xt)(e.source),"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J,"series-index":e.seriesIndex,"series-length":e.seriesLength,topics:e.source.Topics,"generate-challenge":i.value,"add-side-borders":""},null,8,["readme","source-u-u-i-d","course-u-u-i-d","source-type","solution-already-viewed","is-free","user-code","prog-lang","read-only","is-lesson-complete","is-manual-lesson-type","contains-complete-dir","series-index","series-length","topics","generate-challenge"]),v(s)?(g(),F(Pe,{key:0,ref_key:"tabPanesRef",ref:m,"focus-callbacks":D,"is-focused-callbacks":E},{Boots:O(()=>[U(be,{ref_key:"bootsChatRef",ref:y,class:"mt-sm","source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"lesson-complete":e.isLessonComplete,"hint-already-viewed":e.hintAlreadyViewed,"current-files":v(z),"prog-lang":oe.value,"editor-output":S.value?.output},null,8,["source-u-u-i-d","source-type","lesson-complete","hint-already-viewed","current-files","prog-lang","editor-output"])]),Spellbook:O(()=>[U(ce,{ref_key:"spellbookRef",ref:_,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID,class:"mt-sm"},null,8,["source-type","source-u-u-i-d","course-u-u-i-d"])]),Lessons:O(()=>[U(Qe,{ref_key:"lessonsRef",ref:b,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,class:"mt-sm"},null,8,["source-type","source-u-u-i-d"])]),_:1},512)):L("",!0)])])):(g(),I("div",Zx,[h("div",jx,[U(Pe,{ref_key:"tabPanesRef",ref:m,"tool-tip-position":"bottom","focus-callbacks":D,"is-focused-callbacks":E},pc({Lesson:O(()=>[U(De,{readme:X.value,"submit-callback":d,"reset-callback":R,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID,"source-type":e.sourceType,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"read-only":e.readOnly,"user-code":v(j)||le.value,"prog-lang":oe.value,"is-manual-lesson-type":v(Xt)(e.source),"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J,"series-index":e.seriesIndex,"series-length":e.seriesLength,topics:e.source.Topics,"generate-challenge":i.value},null,8,["readme","source-u-u-i-d","course-u-u-i-d","source-type","is-lesson-complete","solution-already-viewed","is-free","read-only","user-code","prog-lang","is-manual-lesson-type","contains-complete-dir","series-index","series-length","topics","generate-challenge"])]),_:2},[v(ft)(e.source)||v(Et)(e.source)||v(Ut)(e.source)?{name:"Code",fn:O(()=>[n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%"})):(g(),F(G,{key:1,ref_key:"codeEditorRef",ref:S,class:"h-2/3","current-files":v(z),solutionfiles:Ae.value,"submit-callback":l,"prog-lang":oe.value,"source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"read-only":e.readOnly,"reset-callback":e.resetCodeCallback,"expected-output":v(ft)(e.source)?e.source.LessonDataCodeOutput.CodeExpectedOutput:void 0,"submit-type-code-s-q-l-callback":c,"enable-lsp":Ma,"onUpdate:currentFiles":ee[3]||(ee[3]=Ne=>p("update:currentFiles",Ne))},null,8,["current-files","solutionfiles","prog-lang","source-u-u-i-d","source-type","is-lesson-complete","solution-already-viewed","is-free","read-only","reset-callback","expected-output"]))]),key:"0"}:v(vn)(e.source)?{name:"Question",fn:O(()=>[n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%"})):v(vn)(e.source)?(g(),F(xe,{key:1,ref_key:"multipleChoiceRef",ref:w,"submit-callback":u,"solution-already-viewed":e.solutionAlreadyViewed,question:e.source.LessonDataMultipleChoice.Question.Question,answer:e.source.LessonDataMultipleChoice.Question.Answer,answers:e.source.LessonDataMultipleChoice.Question.Answers,"is-lesson-complete":e.isLessonComplete,"is-free":e.isFree,"explanation-callback":B,"lesson-u-u-i-d":e.source.UUID,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J},null,8,["solution-already-viewed","question","answer","answers","is-lesson-complete","is-free","lesson-u-u-i-d","contains-complete-dir"])):L("",!0)]),key:"1"}:v(_n)(e.source)?{name:"Input",fn:O(()=>[n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%"})):v(_n)(e.source)?(g(),F(ge,{key:1,ref_key:"textInputRef",ref:k,"current-text":v(j),class:"mt-md","submit-callback":u,"lesson-data":e.source.LessonDataTextInput,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J,"onUpdate:currentText":ee[4]||(ee[4]=Ne=>p("update:currentText",Ne))},null,8,["current-text","lesson-data","is-lesson-complete","solution-already-viewed","source-type","source-u-u-i-d","contains-complete-dir"])):L("",!0)]),key:"2"}:void 0,v(Gn)(e.source)?{name:"Checks",fn:O(()=>[n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%"})):(g(),F(Ee,{key:1,ref_key:"gitHubChecksRef",ref:A,"submit-callback":u,"lesson-data":e.source.LessonDataGitHubChecks,"is-lesson-complete":e.isLessonComplete,"course-u-u-i-d":e.courseUUID,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J},null,8,["lesson-data","is-lesson-complete","course-u-u-i-d","solution-already-viewed","is-free","contains-complete-dir"]))]),key:"3"}:v(wn)(e.source)?{name:"Checks",fn:O(()=>[n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%"})):v(wn)(e.source)?(g(),F(Ze,{key:1,class:"mt-md","lesson-data":e.source.LessonDataCLI,"is-lesson-complete":e.isLessonComplete,"course-u-u-i-d":e.courseUUID,"solution-already-viewed":e.solutionAlreadyViewed,"lesson-u-u-i-d":e.source.UUID,"is-free":e.isFree,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J},null,8,["lesson-data","is-lesson-complete","course-u-u-i-d","solution-already-viewed","lesson-u-u-i-d","is-free","contains-complete-dir"])):L("",!0)]),key:"4"}:v(Fn)(e.source)?{name:"Interview",fn:O(()=>[n.isLoadingUserData?(g(),F(q,{key:0,height:"100%",width:"100%"})):v(Fn)(e.source)?(g(),F(st,{key:1,ref_key:"interviewChatRef",ref:x,class:"flex flex-1 flex-col overflow-auto","current-text":v(j),"lesson-data":e.source.LessonDataInterviewChat,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"is-free":e.isFree,"initial-interview-chat":e.initialInterviewChat,"submit-callback":u,"read-only":e.readOnly,"onUpdate:currentText":ee[5]||(ee[5]=Ne=>p("update:currentText",Ne))},null,8,["current-text","lesson-data","is-lesson-complete","solution-already-viewed","source-u-u-i-d","source-type","is-free","initial-interview-chat","read-only"])):L("",!0)]),key:"5"}:void 0,v(s)?{name:"Boots",fn:O(()=>[U(be,{ref_key:"bootsChatRef",ref:y,class:"mt-md","source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"lesson-complete":e.isLessonComplete,"hint-already-viewed":e.hintAlreadyViewed,"current-files":v(z),"prog-lang":oe.value,"editor-output":S.value?.output},null,8,["source-u-u-i-d","source-type","lesson-complete","hint-already-viewed","current-files","prog-lang","editor-output"])]),key:"6"}:void 0,v(s)?{name:"Spellbook",fn:O(()=>[U(ce,{ref_key:"spellbookRef",ref:_,class:"mt-lg","source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID},null,8,["source-type","source-u-u-i-d","course-u-u-i-d"])]),key:"7"}:void 0]),1536)])]))])]),fallback:O(()=>[h("div",qx,[h("div",Jx,[v(s)?(g(),I("div",Vx)):L("",!0),U(De,{readme:X.value,"reset-callback":R,"source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"course-u-u-i-d":e.courseUUID,"is-lesson-complete":e.isLessonComplete,"solution-already-viewed":e.solutionAlreadyViewed,"is-free":e.isFree,"read-only":e.readOnly,"user-code":v(j)||le.value,"prog-lang":oe.value,"contains-complete-dir":e.containsCompleteDir,"view-solution-files-callback":J,"series-index":e.seriesIndex,"series-length":e.seriesLength,topics:e.source.Topics,"generate-challenge":i.value},null,8,["readme","source-u-u-i-d","source-type","course-u-u-i-d","is-lesson-complete","solution-already-viewed","is-free","read-only","user-code","prog-lang","contains-complete-dir","series-index","series-length","topics","generate-challenge"]),h("div",Hx,[v(s)?(g(),F(Pe,{key:0,ref_key:"tabPanesRef",ref:m,"focus-callbacks":D,"is-focused-callbacks":E},{Boots:O(()=>[U(be,{ref_key:"bootsChatRef",ref:y,class:"mt-sm","source-u-u-i-d":e.source.UUID,"source-type":e.sourceType,"lesson-complete":e.isLessonComplete,"hint-already-viewed":e.hintAlreadyViewed,"current-files":v(z),"prog-lang":oe.value,"editor-output":S.value?.output,"read-only":e.readOnly},null,8,["source-u-u-i-d","source-type","lesson-complete","hint-already-viewed","current-files","prog-lang","editor-output","read-only"])]),Spellbook:O(()=>[U(ce,{ref_key:"spellbookRef",ref:_,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,"course-u-u-i-d":e.courseUUID,class:"mt-sm"},null,8,["source-type","source-u-u-i-d","course-u-u-i-d"])]),Lessons:O(()=>[U(Qe,{ref_key:"lessonsRef",ref:b,"source-type":e.sourceType,"source-u-u-i-d":e.source.UUID,class:"mt-sm"},null,8,["source-type","source-u-u-i-d"])]),_:1},512)):L("",!0)])]),h("div",Gx,[U(q,{height:"100%",width:"100%"})])])]),_:1})])}}}),CS=za(Wx,[["__scopeId","data-v-66ab6f3c"]]);function AS(e){return e?wn(e)?e.LessonDataCLI.CLIData.ContainsCompleteDir:Xt(e)?e.LessonDataManual.ManualData.ContainsCompleteDir:_n(e)?e.LessonDataTextInput.TextInputData.ContainsCompleteDir:vn(e)?e.LessonDataMultipleChoice.Question.ContainsCompleteDir:Gn(e)?e.LessonDataGitHubChecks.GitHubChecks.ContainsCompleteDir:!1:!1}function DS(e){return Et(e)?e.LessonDataCodeSQL.StarterFiles:ft(e)?e.LessonDataCodeOutput.StarterFiles:Ut(e)?e.LessonDataCodeTests.StarterFiles:Va(e)?e:void 0}export{CS as _,co as a,BI as b,SS as c,DS as g,AS as l};
