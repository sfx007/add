import{d as cs,h as vs,r as C,g as ds,cs as ps,N as ms,ax as fs,aU as G,R as hs,b0 as Us,f as Cs,ed as Ls,H as gs,E as H,I as Is,Q as Ds,bh as bs,j as t,z as _s,G as V,k as ws,ee as xs,az as ys,u as ks,aW as Ss,aX as Ts,l as A,i as Rs,ef as Ps,m as q,a as z,w as As,F as $s,ec as Ms,bG as Fs,eg as Ns,eh as Bs,ei as Es,ej as Os,ek as Gs,o as L,p as Hs,b as Q,c as W,n as g,y as Vs,el as y,du as le,q as qs,em as zs,en as Qs,eo as Ws,ep as js,eq as Ks,P as ie}from"./Djz0RQIo.js";import{_ as Ys}from"./FbJafgTE.js";import{_ as Xs,a as Js}from"./D4egAwb7.js";import{l as Zs,g as et,_ as st}from"./BIqCaf6n.js";import{_ as tt}from"./HT-jZiGK.js";import{u as ot}from"./BqYrpIRu.js";import{O as k}from"./D6Ho5i_A.js";import"./BcpmulYk.js";import"./960lqcUJ.js";import"./C-qm-qlq.js";import"./CsS1LiK0.js";import"./BZ8i8vD6.js";import"./Bc5pNPN_.js";import"./lazwdnT5.js";import"./0YUWycGk.js";import"./Bkt-Up1H.js";import"./DvE5EybM.js";import"./BUi9Q6PF.js";import"./CeI-xotQ.js";/* empty css        */import"./BQ1Pr_bT.js";import"./CeWElIlH.js";import"./mEd-U4yU.js";import"./DMbg0n8b.js";import"./DZls_1QG.js";import"./TAdLFOgE.js";import"./Ci1uNmdM.js";import"./Cnao2d2z.js";import"./BRKYYb7N.js";import"./BmzF0E8B.js";import"./B97M0pee.js";import"./C3lkWRQw.js";import"./UNvvHO8y.js";import"./DLM9x6eN.js";import"./LzMEUYpQ.js";import"./DUy7MZc7.js";import"./u1FX4Fat.js";import"./cmT8Ehoo.js";import"./CBLkfl4i.js";import"./CSmVOpRL.js";import"./I2833azj.js";import"./Hp647MZf.js";const nt=Hs(qs),at={class:"h-full"},rt={class:"flex h-full flex-col"},ut={key:0,class:"bg-gray-800"},lt={key:2},Jt=cs({__name:"[lessonUUID]",setup(it){const{eventLessonSubmit:ce,eventChapterSubmit:ve}=vs(),l=C(),I=C(),{errToast:de}=ds(),pe=ps(),me=ms(),{loadLessonCluster:fe,preloadLesson:$,loadCourseProgressByLesson:j,loadUserLessonData:he}=fs(),{setNeedsCheckBoxListeners:Ue,getNextLessonRoute:Ce,getPreviousLessonRoute:Le}=G(),{getProgressForCourse:ge}=hs(),{loadCourse:Ie}=Us(),{getLesson:K,getUserLessonData:m}=Cs(),{setLessonProgressState:De}=Ls(),{loadOnce:f}=gs(),{user:c,isLoggedIn:D,sharpshooterProgress:Y,engagementProgress:X,userEmbers:J}=H(Is()),{lastKeyPress:Z}=H(Ds()),{setSubmissionLoading:ee,unsetSubmissionEvent:be}=G(),_e=pe.beforeEach(()=>{be()});bs(()=>{_e()});const we=t(()=>!!m(n.value)?.ArmorUsedAt),o=t(()=>K(n.value)?.Lesson),xe=t(()=>!!m(n.value)?.SolutionViewedAt),ye=t(()=>m(n.value)?.SuccessCount||0),ke=t(()=>ye.value>0?!0:!!m(n.value)?.HintViewedAt),Se=t(()=>m(n.value)?.PreviousInterviewChat),{inGuestMode:se}=ot(),n=t(()=>me.params.lessonUUID),te=t(()=>o.value?.ChapterUUID),u=t(()=>o.value?.CourseUUID),b=t(()=>{if(u.value)return ge(u.value)}),d=t(()=>b.value?.Chapters),Te=t(()=>(d.value??[]).flatMap(e=>e.Lessons)),oe=t(()=>Te.value.find(e=>e.UUID==n.value)),S=t(()=>!!oe.value?.IsComplete),ne=t(()=>!!oe.value?.IsReset),Re=t(()=>K(n.value)?.LessonDifficulty),_=t(()=>d.value?d.value.map((e,s)=>{const a=e.Lessons.length>0?e.Lessons[0]?.UUID:void 0,r=a?`/lessons/${a}`:"";let i=k.Gray;return e.Lessons.length>0&&e.Lessons.every(w=>w.IsComplete)&&(i=k.Yellow),{name:`${s+1}: ${e.Title}`,selectedName:`CH${s+1}: ${e.Title}`,color:i,link:{path:r},hoverCallback:()=>$(a)}}):[]),M=t(()=>h.value===void 0?[]:(b.value?.Chapters[h.value]?.Lessons||[]).map((s,a)=>{let r=k.Gray;return s.IsComplete?r=k.Yellow:s.IsReset&&(r=k.Red),{name:`${a+1}: ${s.Title}`,selectedName:`L${a+1}: ${s.Title}`,color:r,link:{path:`/lessons/${s.UUID}`},hoverCallback:()=>$(s.UUID)}})),Pe=t(()=>{const e=d.value;if(!e||e.length===0)return!1;const a=e[e.length-1].Lessons.at(-1)?.UUID||"";return n.value===a}),Ae=t(()=>!b.value?.Chapters||h.value===void 0?[]:(b.value?.Chapters[h.value]?.Lessons||[]).map((s,a)=>{let r="incomplete";return s.IsComplete?r="completed":s.IsReset&&(r="completed and reset"),{isComplete:s.IsComplete,isReset:s.IsReset,selected:s.UUID===n.value,text:`${a+1}: ${s.Title}`,subtext:r,link:{path:`/lessons/${s.UUID}`},hoverCallback:()=>$(s.UUID)}})),$e=t(()=>!(!M.value||h.value===void 0||F.value===void 0)),F=t(()=>{if(!T.value)return;const e=T.value.Lessons.findIndex(s=>s.UUID===n.value);return e!==-1?e:void 0}),T=t(()=>{if(d.value)return d.value.find(e=>e.UUID==te.value)}),h=t(()=>{if(!d.value)return;const e=d.value.findIndex(s=>s.UUID===te.value);return e!==-1?e:void 0}),Me=t(()=>!o.value?.CourseTitle||!o.value?.Title?"":`${o.value?.CourseTitle}: ${o.value.Title}`),Fe=t(()=>o.value?.CourseSlug?Ms(o.value.CourseSlug):""),Ne=t(()=>ae.value?!1:!o.value),ae=C(!1);_s(o,e=>{e&&(ae.value=!0)});const re=C(!0);V(()=>{re.value=!1});const Be=t(()=>re.value?!0:!o.value),{refreshLesson:Ee}=ws(n);xs(async()=>{p.value=!1,Ee()}),V(async()=>{b.value||await j(n.value),qe()});const{data:Oe}=ys(()=>`course-${u.value}`,()=>u.value?Ie(u.value):Promise.resolve({}),{watch:[u]}),Ge=t(()=>(Oe.value?.ShortDescription??"").trim());ks({title:Me,description:Ge,featuredImageURL:Fe}),Ss(),Ts();async function He(){D.value&&await Promise.allSettled([f("embers"),f("achievement-progress"),f("spellbooks"),f("items-and-gems"),f("bookmarks"),f("lessonCompletions")])}V(()=>{He()});const{submissionEvent:Ve}=H(G());A(()=>{const e=Ve.value;if(!e)return;(Ws(e)?e.LessonUUID:e.ChallengeUUID)!==n.value&&de("Submission detected for another lesson")});const R=t(()=>{if(u.value)return Ce(n.value,u.value)}),N=t(()=>{if(u.value)return Le(n.value,u.value)}),qe=async()=>{try{if(!u.value)return;await fe(u.value,n.value)}catch(e){console.log(e)}},ze=t(()=>Zs(o.value)),Qe=async()=>{await We({lessonUUID:n.value,courseUUID:u.value,lessonData:o.value,user:c.value})},{mutate:We}=Fs({mutation:async e=>{if(D.value)return Os(e.lessonUUID)},onMutate(e){const{lessonUUID:s,courseUUID:a,user:r,lessonData:i}=e;if(!r||!i)return;Ns(r.UUID,s),Bs(r.UUID,s),Es(r.UUID,s);const U=ne.value||S.value;return l.value=B(i),I.value="",Ue(!0),De({courseUUID:a,lessonUUID:s,state:{isReset:U,isComplete:!1}})},onSuccess:(e,s)=>{if(D.value){const{lessonUUID:a}=s;j(a),he(a)}}}),ue=Rs("confetti"),je=()=>{ue?.value?.startLowIntensity()},{onLessonCompletion:Ke}=Ps(je),Ye=t(()=>{if(!T.value)return!1;const e=T.value.Lessons.at(-1)?.UUID||"";return n.value===e}),Xe=async e=>{ee(!0),ce(n.value),Ye.value&&ve();try{const s=await Vs("lesson",n.value,e);Ke(s)}catch{ee(!1)}},Je=le(e=>{se.value||!c.value||!e||!o.value?.CodeLastMod||zs(c.value.UUID,o.value.UUID,e,o.value.CodeLastMod)},500),Ze=le(e=>{se.value||!c.value||!o.value||Qs(c.value?.UUID,o.value.UUID,e)},500),es=e=>{if(l.value=e,!!o.value)switch(o.value.Type){case y.CodeOutput:case y.CodeTests:case y.CodeSQL:Je(e)}},ss=e=>{if(I.value=e,!!o.value)switch(o.value.Type){case y.InterviewChat:case y.TextInput:Ze(e)}},B=e=>{const s=et(e);return Gs(s)},p=C(!1);A(()=>{if(!o.value)return;if(!D.value){l.value=B(o.value),p.value=!0;return}if(p.value||!c.value)return;const e=m(n.value);if(!e)return;if(l.value=B(o.value),!o.value?.CodeLastMod){p.value=!0;return}const{files:s,createdAt:a,codeLastModAt:r}=js(c.value.UUID,n.value)??{},i=e?.PreviousSubmissionCode?.Files,U=e?.PreviousSubmissionCode?.SubmittedAt,w=e?.PreviousSubmissionCode?.CodeLastModAt,P=new Date(o.value?.CodeLastMod||0).getTime(),rs=new Date(a||0).getTime(),us=new Date(r||0).getTime(),ls=new Date(U||0).getTime(),is=new Date(w||0).getTime();if(s&&us>=P&&rs>ls){for(const v of l.value){const x=s.find(O=>O.Name===v.Name);x&&(v.Content=x.Content,l.value[l.value.indexOf(v)]=v)}p.value=!0;return}if(i&&is>=P){for(const v of l.value){const x=i.find(O=>O.Name===v.Name);x&&(v.Content=x.Content,l.value[l.value.indexOf(v)]=v)}p.value=!0;return}p.value=!0});const E=C(!1);A(()=>{if(!o.value||I.value)return;if(!D.value){E.value=!0;return}if(E.value||!c.value)return;const{text:e}=Ks(c.value.UUID,n.value)??{};e&&(I.value=e),E.value=!0}),A(()=>{Z.value==="navNextLesson"&&ts(),Z.value==="navPrevLesson"&&os()});const ts=()=>{R.value&&ie(R.value)},os=()=>{N.value&&ie(N.value)},ns=t(()=>o.value?.SeriesIndex??0),as=t(()=>o.value?.SeriesLength??0);return(e,s)=>{const a=nt,r=Ys,i=Xs,U=Js,w=st,P=tt;return L(),q($s,null,[z(a,{ref_key:"confetti",ref:ue},null,512),z(P,{class:"static-bgimage bg-image-blue"},{default:As(()=>[Q("div",at,[Q("div",rt,[Q("div",null,[$e.value?(L(),W(i,{key:1,class:"box-border w-full border-b border-gray-600 p-2","course-u-u-i-d":u.value,"dropdown-one-items":_.value.length>1?_.value:M.value,"dropdown-two-items":_.value.length>1?M.value:void 0,"dropdown-one-index":(_.value.length>1?h.value:F.value)||0,"dropdown-two-index":_.value.length>1?F.value:void 0,"lessons-progress-steps":Ae.value,"used-armor":we.value,"back-link":N.value,"forward-link":R.value,"next-bounce-squish":S.value&&!!R.value,"current-sharpshooter-spree":g(Y)?.CurrentProgress,"current-sharpshooter-streak":g(Y)?.AchievementData?.SharpshooterData?.CurrentStreak,"current-streak-count":g(X)?.CurrentProgress,"current-ember-count":g(J)?.Count,"current-ember-progress":g(J)?.Progress,"current-streak-expires-at":g(X)?.AchievementData?.EngagementStreakData?.ExpiresAt,"is-lesson-complete":S.value,"is-lesson-reset":ne.value,"lesson-difficulty-data":Re.value,"is-last-lesson":Pe.value},null,8,["course-u-u-i-d","dropdown-one-items","dropdown-two-items","dropdown-one-index","dropdown-two-index","lessons-progress-steps","used-armor","back-link","forward-link","next-bounce-squish","current-sharpshooter-spree","current-sharpshooter-streak","current-streak-count","current-ember-count","current-ember-progress","current-streak-expires-at","is-lesson-complete","is-lesson-reset","lesson-difficulty-data","is-last-lesson"])):(L(),q("div",ut,[z(r,{height:"48",width:"100%"})]))]),Ne.value?(L(),W(U,{key:0,height:"100%",width:"100%"})):o.value?(L(),W(w,{key:1,id:"lesson-or-challenge","source-type":"lesson","current-files":l.value,"current-text-input":I.value,source:o.value,"submit-callback":Xe,"reset-lesson-callback":Qe,"hint-already-viewed":ke.value,"is-lesson-complete":S.value,"course-u-u-i-d":u.value,"solution-already-viewed":xe.value,"is-free":o.value.IsFree,"contains-complete-dir":ze.value,"initial-interview-chat":Se.value,"is-loading-user-data":Be.value,"series-index":ns.value,"series-length":as.value,"onUpdate:currentFiles":es,"onUpdate:currentText":ss},null,8,["current-files","current-text-input","source","hint-already-viewed","is-lesson-complete","course-u-u-i-d","solution-already-viewed","is-free","contains-complete-dir","initial-interview-chat","is-loading-user-data","series-index","series-length"])):(L(),q("p",lt,"something went wrong"))])])]),_:1})],64)}}});export{Jt as default};
