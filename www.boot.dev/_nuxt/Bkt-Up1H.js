import{bQ as F,dd as Z,cG as X,bZ as Y,r as P,d as ee,i as te,E as R,aU as H,aJ as oe,z as ne,G as se,aG as re,f as ae,N as ie,I as le,l as ce,m as de,o as ue,J as fe,P as he,de as pe,df as me,dg as ge,dh as ve,di as ke,dj as be}from"./Djz0RQIo.js";import{g as M,r as T,a as we}from"./DvE5EybM.js";import{g as L}from"./BUi9Q6PF.js";/* empty css        */const ye="$s";function Le(...s){const r=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(r);const[n,a]=s;if(!n||typeof n!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+n);if(a!==void 0&&typeof a!="function")throw new Error("[nuxt] [useState] init must be a function: "+a);const c=ye+n,h=F(),d=Z(h.payload.state,c);if(d.value===void 0&&a){const p=a();if(X(p))return h.payload.state[c]=p,p;d.value=p}return d}const xe=Y("markdown",()=>{const s=P(!1);return{hasCompletedInitialRender:s,markInitialRenderComplete:()=>{s.value=!0},needsInitialRender:()=>!s.value,$reset:()=>{s.value=!1}}});function Ce(){return Le("user-os",()=>{{const r=navigator.platform.toLowerCase(),n=navigator.userAgent.toLowerCase();if(r.includes("win")||n.includes("windows"))return"windows";if(r.includes("mac")||n.includes("mac"))return"macos";if(r.includes("linux")||n.includes("linux"))return"linux"}return"unknown"})}function Ee(){return{highlightAll:()=>{L().highlightAll()},highlightElement:a=>{L().highlightElement(a)},highlight:(a,c)=>{const h=L(),d=h.languages[c];return d?h.highlight(a,d,c):Se(a)}}}function Se(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const Ae=["innerHTML"],Me=ee({__name:"MarkdownViewer",props:{source:{default:""},renderCheckboxes:{type:Boolean,default:!1},collapseHeadings:{type:Boolean,default:!1},allowHtml:{type:Boolean,default:!1}},setup(s){const r=s,n=te("viewer"),a=Ce(),c=xe(),{highlightAll:h}=Ee();M({allowHtml:r.allowHtml,useHighlight:!0});const d=M({allowHtml:r.allowHtml,useHighlight:!1}),{needsCheckboxListeners:p}=R(H()),{setNeedsCheckBoxListeners:x}=H(),{setModalQuery:B}=oe(),U=()=>{B("info-video")},w=new Set,C=e=>{e.preventDefault(),e.stopPropagation(),U()},q=()=>{if(!n.value)return;n.value.querySelectorAll(".video-wrapper").forEach(t=>{if(t.querySelector(".video-info-button"))return;const o=document.createElement("button");o.className="video-info-button absolute top-2 right-2 z-elevated p-1 bg-gray-900/60 rounded-full text-gray-300 hover:text-gray-100",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info-icon lucide-info"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',o.setAttribute("aria-label","Video playback information"),o.addEventListener("click",C),w.add(o),t.appendChild(o)})},E=()=>{w.forEach(e=>{e.removeEventListener("click",C),e.remove()}),w.clear()},_=P(""),y=e=>{n.value&&(n.value.innerHTML=d.render(e,{renderCheckboxes:r.renderCheckboxes,collapseHeadings:r.collapseHeadings,userOS:a.value})),h(),D()},D=()=>{n.value&&(E(),S(),A(),V(),T(),fe(()=>{we(),q(),Q(),r.renderCheckboxes&&x(!0)}))};ne(()=>r.source,y),se(()=>{n.value&&(y(r.source),c.needsInitialRender()&&(c.markInitialRenderComplete(),setTimeout(()=>{n.value&&y(r.source)},300)))}),re(()=>{E(),S(),A(),V(),T()});const{getLesson:N}=ae(),j=ie(),{user:O}=R(le()),v=new Map,$=()=>{const e=j.params.lessonUUID||"",t=N(e),o=O.value?.UUID??"guest-id",l=t?.Lesson?.LastMod;if(!e||!l)return;const u=document.querySelectorAll(".markdown-checkbox");if(!u.length)return;const f=pe(o,e,l)||Array(u.length).fill(!1);u.forEach((i,m)=>{if(v.has(i))return;i.id=`checkbox-${m}`,i.checked=f[m];const g=J=>{const I=J.target,K=Number(I.id.split("-")[1]);f[K]=I.checked,ve(o,e,f,l)};i.addEventListener("change",g),v.set(i,g)})},S=()=>{for(const[e,t]of v.entries())e.removeEventListener("change",t);v.clear()},W=()=>{const e=document.querySelectorAll(".markdown-checkbox-label");let t=0;for(const o of e)o.htmlFor=`checkbox-${t}`,t++},k=new Map,G=()=>{if(!localStorage||!n.value)return;n.value.querySelectorAll(".video-wrapper").forEach(t=>{const o=t.querySelector("video");if(!o||k.has(o))return;const l=me();l&&(o.volume=l);const u=ge();u&&(o.playbackRate=u);const f=m=>{const g=m.target;ke(g.volume)},i=m=>{const g=m.target;be(g.playbackRate)};o.addEventListener("volumechange",f),o.addEventListener("ratechange",i),k.set(o,{volume:f,rate:i})})},A=()=>{for(const[e,{volume:t,rate:o}]of k.entries())e.removeEventListener("volumechange",t),e.removeEventListener("ratechange",o);k.clear()},b=new Map,Q=()=>{if(!n.value)return;n.value.querySelectorAll(".collapsible-video").forEach(t=>{if(b.has(t))return;const o=t.querySelector("span"),l=t.querySelector("video");if(!o||!l)return;const u="Click to hide video",f="Click to show video",i=()=>{o.textContent=t.open?u:f,t.open||l.paused||l.pause()};t.addEventListener("toggle",i),b.set(t,i)})},V=()=>{for(const[e,t]of b.entries())e.removeEventListener("toggle",t);b.clear()};ce(()=>{p.value&&($(),W(),x(!1),G())});const z=e=>{const t=e.target;if(t&&t.hasAttribute("data-modal-link")){e.preventDefault();const o=t.getAttribute("data-modal-link");o&&he({query:{modal:o}})}};return(e,t)=>(ue(),de("div",{ref_key:"viewer",ref:n,class:"viewer",onClick:z,innerHTML:_.value},null,8,Ae))}});export{Me as _};
