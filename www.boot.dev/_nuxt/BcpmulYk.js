import{d as Y,E as T,I as D,j as u,i as $,c as A,o as m,cd as O,w as x,b as r,C,m as X,n as M,A as U,a as j,V as q,e as y,g as z,aI as F,bG as E,dn as H,dI as Q}from"./Djz0RQIo.js";import{x as R}from"./960lqcUJ.js";import{b as S}from"./C-qm-qlq.js";import{u as Z}from"./BqYrpIRu.js";const G=""+new URL("potion-100.B9a4GSLs.webp",import.meta.url).href,J={class:"w-full max-w-4xl p-6"},K={class:"mb-4 text-gray-400"},W={class:"flex items-center mb-4"},tt=["src"],et=["src"],ot={class:"ml-2 flex items-baseline text-gray-400"},nt={class:"ml-3 text-3xl font-bold text-gray-200"},st={class:"flex flex-row"},I=!0,mt=Y({__name:"PotionActivateModal",props:{onActivate:{type:Function},xpPotionExpiresInMS:{}},setup(f,{expose:_}){const{numXPPotions:d,user:g,activeXPPotions:o}=T(D()),s=f,l=u(()=>(g.value?.Gems||0)>=S),n=u(()=>d.value>0),c=()=>{s.onActivate(I),p()},P=()=>{s.onActivate(!I),p()},w=u(()=>{const t=o.value.length>0&&s.xpPotionExpiresInMS>0?"another":"an";return n.value?`You'll gain +25% XP for ${t} hour.`:l.value?`You are out of potions! Buy another to gain +25% XP for ${t} hour!`:"You don't have any potions and can't afford to buy one."}),i=$("potionActivateModal"),b=()=>i.value?.show(),p=()=>i.value?.hide();return _({show:b,hide:p,toggle:()=>i.value?.toggle()}),(h,t)=>{const v=q,e=O;return m(),A(e,{ref_key:"potionActivateModal",ref:i,"enable-teleport":""},{default:x(()=>[r("div",J,[t[6]||(t[6]=r("h1",{class:"mb-4 pr-6 text-2xl"},"Activate an XP potion?",-1)),r("p",K,C(w.value),1),r("div",W,[n.value?(m(),X("img",{key:0,src:M(G),alt:"xp potion",class:"-ml-2 h-16"},null,8,tt)):(m(),X("img",{key:1,src:M(R),alt:"xp potion empty",class:"-ml-2 h-16"},null,8,et)),r("div",ot,[t[0]||(t[0]=r("span",{class:"text-lg"},"You have",-1)),r("span",nt,C(M(d)),1),t[1]||(t[1]=r("span",{class:"ml-0.5 text-lg"},"x",-1))])]),r("div",st,[n.value?(m(),A(v,{key:0,class:"mr-4",autofocus:n.value,onClick:P},{default:x(()=>[...t[2]||(t[2]=[y(" Activate ",-1)])]),_:1},8,["autofocus"])):U("",!0),!n.value&&l.value?(m(),A(v,{key:1,class:"mr-4",autofocus:!n.value&&l.value,onClick:c},{default:x(()=>[...t[3]||(t[3]=[y(" Buy Potion and Activate ",-1)])]),_:1},8,["autofocus"])):U("",!0),n.value?U("",!0):(m(),A(v,{key:2,color:l.value?"gray":"yellow",class:"mr-4",autofocus:!n.value&&!l.value,onClick:P},{default:x(()=>[...t[4]||(t[4]=[y(" Activate ",-1)])]),_:1},8,["color","autofocus"])),j(v,{color:"gray",onClick:p},{default:x(()=>[...t[5]||(t[5]=[y(" Cancel ",-1)])]),_:1})])])]),_:1},512)}}}),at=""+new URL("potion-20.DXq6EZA-.webp",import.meta.url).href,it=""+new URL("potion-40.YsSf3eBQ.webp",import.meta.url).href,rt=""+new URL("potion-60.CkVbpInB.webp",import.meta.url).href,ut=""+new URL("potion-80.CjkVzw6a.webp",import.meta.url).href;function ft(){const f=D(),{inGuestMode:_}=Z(),{activatePotion:d}=f,{createToast:g}=z(),{activeXPPotions:o,numXPPotions:s,user:l}=T(f),n=u(()=>{const e=o.value;return e?.length?e.at(-1).ExpiresAt:""}),c=u(()=>(f.user?.Gems??0)>=S),P=3600*1e3,w=u(()=>{const e=o.value.length*P,a=i.value/e;return a>=.8?G:a>=.6?ut:a>=.4?rt:a>=.2?it:a>0?at:R}),{msRemaining:i}=F(n),b=u(()=>{if(_.value)return!0;const e=o.value.length>0&&i.value>0,a=s.value>0||c.value;return e&&!a?!0:!a}),p=u(()=>o.value.length>0&&i.value>0?"+25% XP Gain":s.value>0?"Activate XP Potion":c.value?"Buy and use a potion":"No active XP Potion"),k=u(()=>s.value===0?"":`${s.value} left`);function h(){const e=l.value;if(!e)return;const a=new Date().getTime(),L=o.value.length>0?new Date(o.value.at(-1).ExpiresAt).getTime():0,V=Math.max(a,L),{start:B,end:N}=Q({endTimeMs:P,start:V});return o.value.push({ID:crypto.randomUUID(),CreatedAt:B,UpdatedAt:B,UserUUID:e.UUID,ExpiresAt:N}),()=>{o.value.pop()}}const{mutate:t}=E({mutation:async()=>{c.value&&(await H(),await d())},onMutate(){if(c.value)return g({type:"success",text:`Potion bought and used! +25% XP gain for ${o.value.length>0?"another ":""}60 minutes!`}),h()}}),{mutate:v}=E({mutation:async()=>{s.value!==0&&await d()},onMutate(){if(s.value!==0)return g({type:"success",text:`Potion used! +25% XP gain for ${o.value.length>0?"another ":""}60 minutes!`}),h()}});return{canAffordPotion:c,lastPotionExpiresAt:n,xpPotionExpiresInMS:i,xpPotionImage:w,shouldDisablePotionButton:b,xpPotionToolTip:p,xpPotionsLeft:k,buyAndActivatePotion:t,activatePotionClick:v}}export{mt as _,ft as u};
